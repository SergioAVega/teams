/*! For license information please see skype-calling-electron.bundle.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("@skype/rt-js-bindings")):"function"==typeof define&&define.amd?define("skype-calling-electron",["lodash","@skype/rt-js-bindings"],t):"object"==typeof exports?exports["skype-calling-electron"]=t(require("lodash"),require("@skype/rt-js-bindings")):e["skype-calling-electron"]=t(e.lodash,e["@skype/rt-js-bindings"])}(window,(function(e,t){return function(){var n={3397:function(e,t,n){"use strict";var r=n(4661),i=n(3919),o=n(3377),a=n(5778),s=n(7895),c=n(7494),l=n(2353),u=n(3022),d=n(5881),p=function(e){function t(){var n=e.call(this)||this;return n.pluginVersionStringArr=[],(0,i.A)(t,n,(function(e,t){e.logger&&e.logger.queue||(e.logger=new o.wq({loggingLevelConsole:1})),e.initialize=function(n,r,i,l){(0,a.r2)(e,(function(){return"AppInsightsCore.initialize"}),(function(){var a=e.pluginVersionStringArr;if(n){n.endpointUrl||(n.endpointUrl=u.S);var d=n.propertyStorageOverride;!d||d.getProperty&&d.setProperty||(0,s.$8)("Invalid property storage override passed."),n.channels&&(0,s.Iu)(n.channels,(function(e){e&&(0,s.Iu)(e,(function(e){if(e.identifier&&e.version){var t=e.identifier+"="+e.version;a.push(t)}}))}))}e.getWParam=function(){return"undefined"!=typeof document||n.enableWParam?0:-1},r&&(0,s.Iu)(r,(function(e){if(e&&e.identifier&&e.version){var t=e.identifier+"="+e.version;a.push(t)}})),e.pluginVersionString=a.join(";"),e.pluginVersionStringArr=a;try{t.initialize(n,r,i,l),e.pollInternalLogs("InternalLog")}catch(t){var p=e.logger,h=(0,c.mm)(t);-1!==h.indexOf("channels")&&(h+="\n - Channels must be provided through config.channels only!"),(0,o.ZP)(p,1,514,"SDK Initialization Failed - no telemetry will be sent: "+h)}}),(function(){return{config:n,extensions:r,logger:i,notificationManager:l}}))},e.track=function(n){(0,a.r2)(e,(function(){return"AppInsightsCore.track"}),(function(){var r=n;if(r){r.timings=r.timings||{},r.timings.trackStart=(0,d.WB)(),(0,d.Hh)(r.latency)||(r.latency=1);var i=r.ext=r.ext||{};i.sdk=i.sdk||{},i.sdk.ver=d.xE;var o=r.baseData=r.baseData||{};o[u._0]=o[u._0]||{};var a=o[u._0];a[u.hj]=a[u.hj]||e.pluginVersionString||u.m5}t.track(r)}),(function(){return{item:n}}),!n.sync)}})),n}return(0,r.qU)(t,e),t.__ieDyn=1,t}(l._);t.A=p},7849:function(e,t,n){"use strict";var r=n(3919),i=n(7895).Tn;function o(e,t,n){return function(r){e[t]=r,n()}}var a=function(){function e(t){var n=0,o=null,a=[];function s(){if(a.length>0){var e=a.slice();a=[],setTimeout((function(){for(var t=0,n=e.length;t<n;++t)try{e[t]()}catch(e){}}),0)}}function c(e){0===n&&(o=e,n=1,s())}function l(e){0===n&&(o=e,n=2,s())}(0,r.A)(e,this,(function(t){t.then=function(t,r){return new e((function(c,l){!function(t,r,c,l){a.push((function(){var a;try{(a=1===n?i(t)?t(o):o:i(r)?r(o):o)instanceof e?a.then(c,l):2!==n||i(r)?c(a):l(a)}catch(e){return void l(e)}})),0!==n&&s()}(t,r,c,l)}))},t.catch=function(e){return t.then(null,e)}})),function(){if(!i(t))throw new TypeError("ESPromise: resolvedFunc argument is not a Function");try{t(c,l)}catch(e){l(e)}}()}return e.resolve=function(t){return t instanceof e?t:t&&i(t.then)?new e((function(e,n){try{t.then(e,n)}catch(e){n(e)}})):new e((function(e){e(t)}))},e.reject=function(t){return new e((function(e,n){n(t)}))},e.all=function(t){if(t&&t.length)return new e((function(e,n){try{for(var r=[],a=0,s=0;s<t.length;s++){var c=t[s];c&&i(c.then)?(a++,c.then(o(r,s,(function(){0==--a&&e(r)})),n)):r[s]=c}0===a&&setTimeout((function(){e(r)}),0)}catch(e){n(e)}}))},e.race=function(t){return new e((function(e,n){if(t&&t.length)try{for(var r=function(r){var o=t[r];o&&i(o.then)?o.then(e,n):setTimeout((function(){e(o)}),0)},o=0;o<t.length;o++)r(o)}catch(e){n(e)}}))},e}();t.A=a},784:function(e,t,n){"use strict";var r=n(3919),i=n(7849),o=n(6570),a=n(3377),s=0,c=[],l=[],u=[];function d(){return(new Date).getTime()}var p=function(){function e(t,n){var p=0,h=(t||"<unnamed>")+"."+s;function g(e){var t=(0,o.mS)();t&&t.QUnit&&console&&console.log("ESPromiseScheduler["+h+"] "+e)}function f(e){(0,a.OG)(n,"ESPromiseScheduler["+h+"] "+e)}s++,(0,r.A)(e,this,(function(e){var t=null,n=0;function r(e,t){for(var n=0;n<e.length;n++)if(e[n].id===t)return e.splice(n,1)[0];return null}e.scheduleEvent=function(e,o,a){var s=h+"."+n;n++,o&&(s+="-("+o+")");var m=s+"{"+p+"}";p++;var _,y,v,S={evt:null,tm:d(),id:m,isRunning:!1,isAborted:!1};return S.evt=t?(_=S,y=t,v=new i.A((function(e,t){var n=d()-y.tm,i=y.id;g("["+s+"] is waiting for ["+i+":"+n+" ms] to complete before starting -- ["+l.length+"] waiting and ["+c.length+"] running"),_.abort=function(e){_.abort=null,r(l,s),_.isAborted=!0,t(new Error(e))},y.evt.then((function(n){r(l,s),O(_).then(e,t)}),(function(n){r(l,s),O(_).then(e,t)}))})),l.push(_),v):O(S),(t=S).evt._schId=m,S.evt;function C(e){for(var t=d(),n=t-6e5,r=e.length,i=0;i<r;){var o=e[i];if(o&&o.tm<n){var a=null;o.abort?(a="Aborting ["+o.id+"] due to Excessive runtime ("+(t-o.tm)+" ms)",o.abort(a)):a="Removing ["+o.id+"] due to Excessive runtime ("+(t-o.tm)+" ms)",f(a),e.splice(i,1),r--}else i++}}function E(e,n){var i=!1,o=r(c,e);if(o||(o=r(u,e),i=!0),o){o.to&&(clearTimeout(o.to),o.to=null);var a=d()-o.tm;n?i?f("Timed out event ["+e+"] finally complete -- "+a+" ms"):g("Promise ["+e+"] Complete -- "+a+" ms"):(u.push(o),f("Event ["+e+"] Timed out and removed -- "+a+" ms"))}else g("Failed to remove ["+e+"] from running queue");t&&t.id===e&&(t=null),C(c),C(l),C(u)}function T(e,t){return function(n){return E(e,!0),t&&t(n),n}}function I(e,t,n,r){t.then((function(t){return t instanceof i.A?(g("Event ["+e+"] returned a promise -- waiting"),I(e,t,n,r),t):T(e,n)(t)}),T(e,r))}function P(e,t){var n=e.id;return new i.A((function(r,o){g("Event ["+n+"] Starting -- waited for "+(e.wTm||"--")+" ms"),e.isRunning=!0,e.abort=function(t){e.abort=null,e.isAborted=!0,E(n,!1),o(new Error(t))};var s=t(n);s instanceof i.A?(a&&(e.to=setTimeout((function(){E(n,!1),o(new Error("Timed out after ["+a+"] ms"))}),a)),I(n,s,(function(t){g("Event ["+n+"] Resolving after "+(d()-e.tm)+" ms"),r(t)}),o)):(g("Promise ["+n+"] Auto completed as the start action did not return a promise"),r())}))}function O(t){var n=d();return t.wTm=n-t.tm,t.tm=n,t.isAborted?i.A.reject(new Error("["+s+"] was aborted")):(c.push(t),P(t,e))}}}))}return e.incomplete=function(){return c},e.waitingToStart=function(){return l},e}();t.A=p},6586:function(e,t,n){"use strict";n.d(t,{AN:function(){return s},KG:function(){return p},XA:function(){return c},iD:function(){return u},kp:function(){return d},sC:function(){return l}});var r=n(4661),i=n(3296),o=n(7895),a=n(5391),s=(0,i.Hj)({NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,Pii_IPv6ScrubLastHextets:14,Pii_DropValue:15,CustomerContent_GenericContent:32}),c=(0,i.Hj)({Normal:1,CostDeferred:2,RealTime:3,Immediate:4}),l=(0,i.Hj)({Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9}),u=(0,i.Hj)({Normal:1,Critical:2}),d=(0,i.Hj)({NONE:0,ERROR:1,WARNING:2,INFORMATION:3}),p=(0,o.N6)((0,r.Im)((0,r.Im)({},a.$),(0,i.Hj)({AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520})))},4204:function(e,t,n){"use strict";n.r(t),n.d(t,{AppInsightsCore:function(){return i.A},BaseCore:function(){return h},BaseTelemetryPlugin:function(){return v.s},CoreUtils:function(){return d.jS},DiagnosticLogger:function(){return s.wq},ESPromise:function(){return g.A},ESPromiseScheduler:function(){return f.A},EventHelper:function(){return P.fs},EventLatency:function(){return r.XA},EventPersistence:function(){return r.iD},EventPropertyType:function(){return r.sC},EventsDiscardedReason:function(){return E.x},FullVersionString:function(){return d.xE},InternalAppInsightsCore:function(){return O._},InternalBaseCore:function(){return l.F},LoggingSeverity:function(){return T.b},MinChannelPriorty:function(){return C.T},NotificationManager:function(){return y.h},PerfEvent:function(){return I.Q6},PerfManager:function(){return I.NS},ProcessTelemetryContext:function(){return S.W0},TraceLevel:function(){return r.kp},Undefined:function(){return D.bA},Utils:function(){return d.Aq},ValueKind:function(){return r.AN},ValueSanitizer:function(){return _},Version:function(){return d.Rx},_ExtendedInternalMessageId:function(){return r.KG},_InternalLogMessage:function(){return s.WD},_InternalMessageId:function(){return T.$},__getRegisteredEvents:function(){return A.El},_logInternalMessage:function(){return s.Oc},_throwInternal:function(){return s.ZP},_warnToConsole:function(){return s.OG},addEventHandler:function(){return A.So},addEventListeners:function(){return A.lQ},addPageHideEventListener:function(){return A.Fc},addPageShowEventListener:function(){return A.oS},addPageUnloadEventListener:function(){return A.ee},areCookiesSupported:function(){return L.gi},arrForEach:function(){return m.Iu},arrIndexOf:function(){return m.rD},arrMap:function(){return m.W$},arrReduce:function(){return m.KT},attachEvent:function(){return A.Q3},cookieAvailable:function(){return L.gi},createCookieMgr:function(){return L.xN},createEnumStyle:function(){return b.Hj},createGuid:function(){return d.gj},createProcessTelemetryContext:function(){return S.i8},createTraceParent:function(){return k.wk},createUniqueNamespace:function(){return N.Z},createUnloadHandlerContainer:function(){return M.P},dateNow:function(){return m.x3},deleteCookie:function(){return d.Yj},detachEvent:function(){return A.Ym},disableCookies:function(){return d.WD},disallowsSameSiteNone:function(){return L.It},doPerf:function(){return I.r2},dumpObj:function(){return c.mm},eventOff:function(){return A.ML},eventOn:function(){return A.mB},extend:function(){return d.X$},findW3cTraceParent:function(){return k.ef},formatTraceParent:function(){return k.L0},generateW3CId:function(){return P.cL},getCommonSchemaMetaData:function(){return d.Go},getConsole:function(){return c.U5},getCookie:function(){return d.Ri},getCookieValue:function(){return d.UM},getCrypto:function(){return c.MY},getDocument:function(){return c.YE},getExceptionName:function(){return m.lL},getFieldValueType:function(){return d.cq},getGlobal:function(){return R.mS},getGlobalInst:function(){return c.EH},getHistory:function(){return c.JK},getIEVersion:function(){return c.L0},getISOString:function(){return m._u},getJSON:function(){return c.hm},getLocation:function(){return c.g$},getMsCrypto:function(){return c.iN},getNavigator:function(){return c.w3},getPerformance:function(){return c.FJ},getSetValue:function(){return m.c2},getTenantId:function(){return d.EO},getTime:function(){return d.WB},getWindow:function(){return c.zk},hasDocument:function(){return c.Wt},hasHistory:function(){return c.tw},hasJSON:function(){return c.Z},hasNavigator:function(){return c.w9},hasOwnProperty:function(){return m.mQ},hasWindow:function(){return c.Vd},isArray:function(){return m.cy},isArrayValid:function(){return d.wJ},isBeaconsSupported:function(){return c.Uf},isBoolean:function(){return m.Lm},isChromium:function(){return d.F2},isDate:function(){return m.$P},isDocumentObjectAvailable:function(){return d.g8},isError:function(){return m.bJ},isFetchSupported:function(){return c.R7},isFunction:function(){return m.Tn},isIE:function(){return c.lT},isLatency:function(){return d.Hh},isNotTruthy:function(){return m.wo},isNullOrUndefined:function(){return m.hX},isNumber:function(){return m.Et},isObject:function(){return m.Gv},isReactNative:function(){return c.lV},isSampledFlag:function(){return k.N7},isString:function(){return m.Kg},isTruthy:function(){return m.zz},isTypeof:function(){return m.Ed},isUint8ArrayAvailable:function(){return d.h3},isUndefined:function(){return m.b0},isValidSpanId:function(){return k.wN},isValidTraceId:function(){return k.hX},isValidTraceParent:function(){return k.mJ},isValueAssigned:function(){return d.yD},isValueKind:function(){return d.m0},isWindowObjectAvailable:function(){return d.P$},isXhrSupported:function(){return c.xk},mergeEvtNamespace:function(){return A.Hm},newGuid:function(){return P.aq},newId:function(){return w.Si},normalizeJsName:function(){return m.cH},objCreate:function(){return R.AQ},objDefineAccessors:function(){return m.r},objForEachKey:function(){return m.z},objFreeze:function(){return m.N6},objKeys:function(){return m.cG},objSeal:function(){return m.js},openXhr:function(){return d.H$},optimizeObject:function(){return m.hW},parseTraceParent:function(){return k.ZI},perfNow:function(){return P.UU},proxyAssign:function(){return m.qz},proxyFunctionAs:function(){return m.RF},proxyFunctions:function(){return m.o$},random32:function(){return w.VN},randomValue:function(){return w.Z1},removeEventHandler:function(){return A.zh},removeEventListeners:function(){return A.Wg},removePageHideEventListener:function(){return A.sq},removePageShowEventListener:function(){return A.vF},removePageUnloadEventListener:function(){return A.Ds},safeGetCookieMgr:function(){return L.um},safeGetLogger:function(){return s.y0},sanitizeProperty:function(){return d.TC},setCookie:function(){return d.TV},setEnableEnvMocks:function(){return c.cU},setProcessTelemetryTimings:function(){return d.u9},setValue:function(){return m.KY},strContains:function(){return m.Ju},strEndsWith:function(){return m.Cv},strFunction:function(){return D.hW},strObject:function(){return D._1},strPrototype:function(){return D.vR},strStartsWith:function(){return m.tG},strTrim:function(){return m.EH},strUndefined:function(){return D.bA},throwError:function(){return m.$8},toISOString:function(){return m._u},useXDomainRequest:function(){return c.PV}});var r=n(6586),i=n(3397),o=n(4661),a=n(3919),s=n(3377),c=n(7494),l=n(699),u=n(3022),d=n(5881),p=function(e){function t(){var n=e.call(this)||this;return(0,a.A)(t,n,(function(e,t){e.initialize=function(n,r,i,o){n&&!n.endpointUrl&&(n.endpointUrl=u.S),e.getWParam=function(){return d.g8||n.enableWParam?0:-1};try{t.initialize(n,r,i,o)}catch(t){(0,s.ZP)(e.logger,1,514,"Initialization Failed: "+(0,c.mm)(t)+"\n - Note: Channels must be provided through config.channels only")}},e.track=function(e){var n=e;if(n){var r=n.ext=n.ext||{};r.sdk=r.sdk||{},r.sdk.ver=d.xE}t.track(n)}})),n}return(0,o.qU)(t,e),t.__ieDyn=1,t}(l.F),h=p,g=n(7849),f=n(784),m=n(7895),_=function(){function e(e){var t=this,n={},r=[],i=[];function o(e,t){var o,a=n[e];if(a&&(o=a[t]),!o&&null!==o){if((0,m.Kg)(e)&&(0,m.Kg)(t))if(i.length>0){for(var s=0;s<i.length;s++)if(i[s].handleField(e,t)){o={canHandle:!0,fieldHandler:i[s]};break}}else 0===r.length&&(o={canHandle:!0});if(!o&&null!==o){o=null;for(s=0;s<r.length;s++)if(r[s].handleField(e,t)){o={canHandle:!0,handler:r[s],fieldHandler:null};break}}a||(a=n[e]={}),a[t]=o}return o}function a(e,t,n,r,i,o){if(e.handler)return e.handler.property(t,n,i,o);if(!(0,m.hX)(i.kind)){if(!(4096&~r&&(0,d.m0)(i.kind)))return null;i.value=i.value.toString()}return c(e.fieldHandler,t,n,r,i)}function s(e,t,n){return(0,d.yD)(n)?{value:n}:null}function c(e,n,r,i,o){if(o&&e){var a=e.getSanitizer(n,r,i,o.kind,o.propertyType);if(a)if(4===i){var l={},u=o.value;(0,m.z)(u,(function(t,i){var o=n+"."+r;if((0,d.yD)(i)){var a=s(0,0,i);(a=c(e,o,t,(0,d.cq)(i),a))&&(l[t]=a.value)}})),o.value=l}else{var p={path:n,name:r,type:i,prop:o,sanitizer:t};o=a.call(t,p)}}return o}e&&i.push(e),t.addSanitizer=function(e){e&&(r.push(e),n={})},t.addFieldSanitizer=function(e){e&&(i.push(e),n={})},t.handleField=function(e,t){var n=o(e,t);return!!n&&n.canHandle},t.value=function(e,t,n,r){var i=o(e,t);if(i&&i.canHandle){if(!i||!i.canHandle)return null;if(i.handler)return i.handler.value(e,t,n,r);if(!(0,m.Kg)(t)||(0,m.hX)(n)||n===u.m5)return null;var c=null,l=(0,d.cq)(n);if(8192&~l)1!==l&&2!==l&&3!==l&&4096&~l?4===l&&(c=s(e,t,r?JSON.stringify(n):n)):c=s(e,t,n);else{var p=-8193&l;if(c=n,!(0,d.yD)(c.value)||1!==p&&2!==p&&3!==p&&4096&~p)return null}if(c)return a(i,e,t,l,c,r)}return null},t.property=function(e,t,n,r){var i=o(e,t);if(!i||!i.canHandle)return null;if(!(0,m.Kg)(t)||(0,m.hX)(n)||!(0,d.yD)(n.value))return null;var s=(0,d.cq)(n.value);return 0===s?null:a(i,e,t,s,n,r)}}return e.getFieldType=d.cq,e}(),y=n(3394),v=n(4111),S=n(4963),C=n(9844),E=n(1628),T=n(5391),I=n(5778),P=n(5372),O=n(2353),b=n(3296),A=n(6611),R=n(6570),w=n(9021),D=n(9166),L=n(8388),N=n(8106),M=n(2190),k=n(4074)},3022:function(e,t,n){"use strict";n.d(t,{S:function(){return i},_0:function(){return a},hj:function(){return o},m5:function(){return r}});var r="",i="https://browser.events.data.microsoft.com/OneCollector/1.0/",o="version",a="properties"},5881:function(e,t,n){"use strict";n.d(t,{Aq:function(){return U},EO:function(){return T},F2:function(){return B},Go:function(){return b},H$:function(){return G},Hh:function(){return P},P$:function(){return C},Ri:function(){return D},Rx:function(){return h},TC:function(){return O},TV:function(){return R},UM:function(){return L},WB:function(){return k},WD:function(){return A},X$:function(){return M},Yj:function(){return w},cq:function(){return H},g8:function(){return S},gj:function(){return N},h3:function(){return I},jS:function(){return V},m0:function(){return F},u9:function(){return j},wJ:function(){return x},xE:function(){return g},yD:function(){return E}});var r,i=n(7494),o=n(7895),a=n(8388),s=n(5372),c=n(9166),l=n(6611),u=n(9021),d=n(6570),p=n(3022),h="3.2.17",g="1DS-Web-JS-"+h,f="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",m="withCredentials",_="timeout",y=((r={})[0]=0,r[2]=6,r[1]=1,r[3]=7,r[4098]=6,r[4097]=1,r[4099]=7,r),v=null,S=Boolean((0,i.YE)()),C=Boolean((0,i.zk)());function E(e){return!(e===p.m5||(0,o.hX)(e))}function T(e){if(e){var t=e.indexOf("-");if(t>-1)return e.substring(0,t)}return p.m5}function I(){return null===v&&(v=!(0,o.b0)(Uint8Array)&&!function(){var e=(0,i.w3)();if(!(0,o.b0)(e)&&e.userAgent){var t=e.userAgent.toLowerCase();if((t.indexOf("safari")>=0||t.indexOf("firefox")>=0)&&t.indexOf("chrome")<0)return!0}return!1}()&&!(0,i.lV)()),v}function P(e){return!!(e&&(0,o.Et)(e)&&e>=1&&e<=4)}function O(e,t,n){if(!t&&!E(t)||"string"!=typeof e)return null;var r=typeof t;if("string"===r||"number"===r||"boolean"===r||(0,o.cy)(t))t={value:t};else if("object"!==r||c.J$.call(t,"value")){if((0,o.hX)(t.value)||t.value===p.m5||!(0,o.Kg)(t.value)&&!(0,o.Et)(t.value)&&!(0,o.Lm)(t.value)&&!(0,o.cy)(t.value))return null}else t={value:n?JSON.stringify(t):t};if((0,o.cy)(t.value)&&!x(t.value))return null;if(!(0,o.hX)(t.kind)){if((0,o.cy)(t.value)||!F(t.kind))return null;t.value=t.value.toString()}return t}function b(e,t,n){var r=-1;if(!(0,o.b0)(e))if(t>0&&(32===t?r=8192:t<=13&&(r=t<<5)),function(e){if(e>=0&&e<=9)return!0;return!1}(n))-1===r&&(r=0),r|=n;else{var i=y[H(e)]||-1;-1!==r&&-1!==i?r|=i:6===i&&(r=i)}return r}function A(){(0,a.um)(null).setEnabled(!1)}function R(e,t,n){(0,a.gi)(null)&&(0,a.um)(null).set(e,t,86400*n,null,"/")}function w(e){(0,a.gi)(null)&&(0,a.um)(null).del(e)}function D(e){return(0,a.gi)(null)?L((0,a.um)(null),e):p.m5}function L(e,t,n){var r;return void 0===n&&(n=!0),e&&(r=e.get(t),n&&r&&decodeURIComponent&&(r=decodeURIComponent(r))),r||p.m5}function N(e){void 0===e&&(e="D");var t=(0,s.aq)();return"B"===e?t="{"+t+"}":"P"===e?t="("+t+")":"N"===e&&(t=t.replace(/-/g,p.m5)),t}function M(e,t,n,r,i){var a={},s=!1,l=0,u=arguments.length,d=arguments;for("[object Boolean]"===Object[c.vR].toString.call(d[0])&&(s=d[0],l++);l<u;l++){e=d[l];(0,o.z)(e,(function(e,t){s&&t&&(0,o.Gv)(t)?(0,o.cy)(t)?(a[e]=a[e]||[],(0,o.Iu)(t,(function(t,n){t&&(0,o.Gv)(t)?a[e][n]=M(!0,a[e][n],t):a[e][n]=t}))):a[e]=M(!0,a[e],t):a[e]=t}))}return a}var k=s.UU;function F(e){return 0===e||e>0&&e<=13||32===e}function x(e){return e.length>0}function j(e,t){var n=e;n.timings=n.timings||{},n.timings.processTelemetryStart=n.timings.processTelemetryStart||{},n.timings.processTelemetryStart[t]=k()}function H(e){var t=0;if(null!=e){var n=typeof e;"string"===n?t=1:"number"===n?t=2:"boolean"===n?t=3:n===c._1&&(t=4,(0,o.cy)(e)?(t=4096,e.length>0&&(t|=H(e[0]))):c.J$.call(e,"value")&&(t=8192|H(e.value)))}return t}var U={Version:h,FullVersionString:g,strUndefined:c.bA,strObject:c._1,Undefined:c.bA,arrForEach:o.Iu,arrIndexOf:o.rD,arrMap:o.W$,arrReduce:o.KT,objKeys:o.cG,toISOString:o._u,isReactNative:i.lV,isString:o.Kg,isNumber:o.Et,isBoolean:o.Lm,isFunction:o.Tn,isArray:o.cy,isObject:o.Gv,strTrim:o.EH,isDocumentObjectAvailable:S,isWindowObjectAvailable:C,isValueAssigned:E,getTenantId:T,isBeaconsSupported:i.Uf,isUint8ArrayAvailable:I,isLatency:P,sanitizeProperty:O,getISOString:o._u,useXDomainRequest:i.PV,getCommonSchemaMetaData:b,cookieAvailable:a.gi,disallowsSameSiteNone:a.It,setCookie:R,deleteCookie:w,getCookie:D,createGuid:N,extend:M,getTime:k,isValueKind:F,isArrayValid:x,objDefineAccessors:o.r,addPageUnloadEventListener:l.ee,setProcessTelemetryTimings:j,addEventHandler:l.So,getFieldValueType:H,strEndsWith:o.Cv,objForEachKey:o.z},V={_canUseCookies:void 0,isTypeof:o.Ed,isUndefined:o.b0,isNullOrUndefined:o.hX,hasOwnProperty:o.mQ,isFunction:o.Tn,isObject:o.Gv,isDate:o.$P,isArray:o.cy,isError:o.bJ,isString:o.Kg,isNumber:o.Et,isBoolean:o.Lm,toISOString:o._u,arrForEach:o.Iu,arrIndexOf:o.rD,arrMap:o.W$,arrReduce:o.KT,strTrim:o.EH,objCreate:d.AQ,objKeys:o.cG,objDefineAccessors:o.r,addEventHandler:l.So,dateNow:o.x3,isIE:i.lT,disableCookies:A,newGuid:s.aq,perfNow:s.UU,newId:u.Si,randomValue:u.Z1,random32:u.VN,mwcRandomSeed:u.yc,mwcRandom32:u.k5,generateW3CId:s.cL};function B(){return!!(0,i.EH)("chrome")}function G(e,t,n,r,i,o){function a(e,t,n){try{e[t]=n}catch(e){}}void 0===r&&(r=!1),void 0===i&&(i=!1);var s=new XMLHttpRequest;return r&&a(s,f,r),n&&a(s,m,n),s.open(e,t,!i),n&&a(s,m,n),!i&&o&&a(s,_,o),s}},3224:function(e,t,n){"use strict";n.r(t),n.d(t,{BaseTelemetryPlugin:function(){return h.s},LocalStorageChannel:function(){return te},LoggingSeverity:function(){return ne.b},StorageProviders:function(){return r},_InternalLogMessage:function(){return re.WD},_InternalMessageId:function(){return ne.$}});var r,i=n(4661),o=n(3919),a=n(5778),s=n(784),c=n(5881),l=n(7895),u=n(5372),d=n(7849),p=n(4963),h=n(4111);function g(e){return(0,l.Et)(e)&&e>=1&&e<=2}!function(e){e[e.LocalStorage=1]="LocalStorage",e[e.SessionStorage=2]="SessionStorage",e[e.IndexedDb=3]="IndexedDb"}(r||(r={}));var f=n(6570),m=n(7494),_="result",y="DBError: Unable to open database",v="Database is not open",S="DBError: Failed to delete the database",C=["indexedDB"],E=l.Tn,T=l.Kg;function I(e,t){(0,m.EH)("QUnit")&&console&&console.log("IndexedDbHelper ["+e+"] "+t)}function P(e,t,n){e&&e.warnToConsole("IndexedDbHelper ["+t+"] "+n)}function O(e,t,n,r){return function(i){n(new Error(t)),I(e,"["+r+"] event rejected")}}var b=[];function A(e,t){for(var n=null,r=0;r<b.length;r++)if((n=b[r]).name===e)return n;return n={name:e,sch:new s.A("IndexedDbHelper["+e+"]",t),dbHdl:[],add:function(t){n.dbHdl.push(t),I(e,"- dbOpened (add) -- hdls ["+n.dbHdl.length+"]")},remove:function(t){for(var r=n.dbHdl,i=0;i<r.length;i++)if(r[i]===t){r.splice(i,1);break}I(e,"- dbClosed (remove) -- hdls ["+n.dbHdl.length+"]")},isOpen:function(){return n.dbHdl.length>0},openHdl:function(){return n.dbHdl.length>0?n.dbHdl[0]:null}},b.push(n),n}var R=function(){function e(t){(0,o.A)(e,this,(function(e){var n=function(){var e=(0,f.mS)()||{},t=null;if(e)try{for(var n=0;n<C.length;n++)if((t=e[C[n]])&&E(t.open))return t}catch(e){t=null}return t||null}()||null;function r(e,n){var r=e.db.transaction(n,"readwrite");return r.onabort=function(){P(t,e.dbName,"txn.onabort")},r.onerror=function(){P(t,e.dbName,"txn.onerror")},r.oncomplete=function(){I(e.dbName,"txn.oncomplete")},{db:e,store:r.objectStore(n),tx:r,tbl:n,openCursor:function(t,r){return o(e,n,t,r)},newTransaction:function(t){return i(e,n,t)}}}function i(e,t,n){if(!e||!e.db)return d.A.reject(new Error(v));try{var i=n(r(e,t));return i instanceof d.A?i:d.A.resolve(i)}catch(e){return d.A.reject(e)}}function o(e,t,n,i){if(!e||!e.db)return d.A.reject(new Error(v));var o=null;return n&&T(n)?o=new w(n):n&&n.isMatch&&(o=n),new d.A((function(n,a){var s=[],c=null,l=null;o&&o.keyRange&&(l=o.keyRange());var u=r(e,t);(c=l?u.store.openCursor(l):u.store.openCursor()).onerror=O(u.db.dbName,"DBError: Failed to Open Cursor",a,"openCursor"),c.onsuccess=function(e){var t=e.target[_];if(t){var r={store:u,cursor:t,continue:function(){t.continue()},done:function(){n(s)}},c=t.value;if(!o||o.isMatch(c))if(i)try{switch(i(r,c,s)){case 2:n(s);break;case 1:break;default:r.continue()}}catch(e){a(e)}else s.push(c),r.continue();else r.continue()}else n(s)}}))}function a(e,t,n,r){return A(e).sch.scheduleEvent(n,t,r)}e.isAvailable=function(){return!!n},e.openDb=function(e,r,s,c){return a(e,"openDb",(function(a){return new d.A((function(l,u){var d=!1;function p(t,n,a,s,c){var l={db:n,dbName:e,dbVersion:r,ctx:null,isNew:s,txn:a?a.transaction:null};return c||(l.openStore=function(e,t){return i(l,e,t)},l.openCursor=function(e,t,n){return o(l,e,t,n)}),l}var h=A(e);if(null==n)u(new Error("No available storage factory"));else if(h.isOpen()){var g=p(0,h.openHdl(),null,!1);s(g).then(l,u)}else{var f=n.open(e,r);f.onblocked=function(n){P(t,e,"Db Open Blocked event ["+a+"] - "+(f.error||"")),u(new Error(y))},f.onerror=function(n){P(t,e,"Db Open Error event ["+a+"] - "+(f.error||"")),u(new Error(y))},f.onupgradeneeded=function(t){I(e,"Db Open Create/Upgrade needed event ["+a+"]");try{var n=t.target[_];if(!n)return void u(new Error(y));!function(e,t){var n=p(0,e,t,!0,!0);if(c)d=!0,c(n).then((function(){n.txn||(n.txn=t.transaction)}),(function(e){try{t.transaction&&t.transaction.abort()}finally{u(e)}}));else try{t.transaction&&t.transaction.abort()}finally{u(new Error("DBError: Database upgrade required"))}}(n,f)}catch(t){O(e,y,u,a)(t)}},f.onsuccess=function(n){var r=n.target[_];r?function(n,r){var i=A(e);i.add(n),n.onabort=function(r){P(t,e,"onabort -- closing the Db"),i.remove(n)},n.onerror=function(r){P(t,e,"onerror -- closing the Db"),i.remove(n)},n.onclose=function(r){P(t,e,"onclose -- closing the Db"),i.remove(n)},n.onversionchange=function(r){P(t,e,"onversionchange -- force closing the Db"),n.close(),i.remove(n)};var o,a=null;i.dbHdl.length>0&&(a=i.dbHdl[0]),o=p(0,a,r,d);try{s(o).then((function(e){l(e)}),u)}catch(e){u(e)}}(r,f):u(new Error(y))}}}))}))},e.closeDb=function(e){a(e,"closeDb",(function(t){var n=A(e),r=n.dbHdl,i=r.length;if(i>0){for(var o=0;o<i;o++)r[o].close();n.dbHdl=[]}return d.A.resolve(1)}))},e.deleteDb=function(e){return null==n?d.A.resolve(!1):a(e,"deleteDb",(function(r){var i=A(e),o=i.dbHdl,a=o.length;if(a>0){P(t,e,"Db is open ["+a+"] force closing");for(var s=0;s<a;s++)o[s].close();i.dbHdl=[]}return new d.A((function(i,o){setTimeout((function(){try{I(e,"["+r+"] starting");var a=n.deleteDatabase(e);a.onerror=function(n){P(t,e,"["+r+"] error!!"),o(new Error(S))},a.onblocked=function(n){P(t,e,"["+r+"] blocked!!"),o(new Error(S))},a.onupgradeneeded=function(n){P(t,e,"["+r+"] upgrade needed!!"),o(new Error(S))},a.onsuccess=function(t){I(e,"["+r+"] complete"),i(!0)},I(e,"["+r+"] started")}catch(n){P(t,e,"["+r+"] threw - "+n),o(new Error(S+" - "+n))}}),0)}))}))},e.getDbDetails=function(e){return a(e,"getDbDetails",(function(t){return null!=n&&n.databases?new d.A((function(t,r){n.databases().then((function(n){for(var i=0;i<n.length;i++)if(n[i].name===e)return void t(n[i]);r(new Error("DBError: Database does not exist"))}),r)})):d.A.reject(new Error("DBError: Feature not supported"))}),2e3)}}))}return e.__ieDyn=1,e}(),w=function(){function e(t){var n=[],r=null;(0,o.A)(e,this,(function(e){e.keyRange=function(){return r},e.parseQuery=function(t){if(n=[],t)for(var i=t.split(";"),o=0;o<i.length;o++){var a=i[o],s=a.indexOf("=");if(-1!==s){var c=a.substring(0,s),l=a.substring(s+1);0===c.indexOf("#")&&(c=c.substring(1),r||(r=IDBKeyRange.bound(l,l+"￿"))),e.startsWith(c,l)}}},e.startsWith=function(e,t){n.push({name:e,value:t,type:0})},e.contains=function(e,t){n.push({name:e,value:t,type:1})},e.isMatch=function(e){if(!n||0===n.length)return!0;if(!e)return!1;for(var t=0;t<n.length;t++){var r=n[t],i=e[r.name];if(i)if(0===r.type){if(0!==i.indexOf(r.value))return!1}else if(1===r.type&&-1===i.indexOf(r.value))return!1}return!0},t&&e.parseQuery(t)}))}return e.__ieDyn=1,e}(),D=6e5,L=1008e4,N="DBError: Unable to add event",M="Evts",k="iKey",F=g;function x(){return(new Date).getTime()}function j(e){return e.openStore(k,(function(t){return new d.A((function(n,r){var i,o,a={iKey:e.ctx.iKey,tm:x()},s=t.store.put(a);s.onsuccess=function(e){n(s.result.toString())},s.onerror=function(e){r(new Error(N))},s.onerror=(i="DBError: Unable to update iKey",o=r,function(e){return o(new Error(i))})}))}))}function H(e){for(var t=[],n=2;n>=1;n--)for(var r=0;r<e.length;r++){var i=e[r];i&&i.evt.persistence===n&&t.push(i.evt)}return t}function U(e){return function(t){return e.continue()}}function V(e){var t=e.cursor.delete();return t.onerror=U(e),t.onsuccess=U(e),1}function B(e,t,n){return e.openCursor(M,t,(function(e,t,r){return n(t)?(r.push(t),V(e)):0}))}function G(e){return e.openCursor(M,"#key="+e.ctx.iKeyPrefix(),(function(t,n){var r,i,o=n.key;if(0===o.indexOf(e.ctx.iKeyPrefix())&&-1===o.indexOf(e.ctx.evtKeyPrefix())&&(r=D,i=n.tm,x()-i>r)){n.key=e.ctx.evtKeyPrefix()+n.id;var a=t.store.store.put(n);return a.onerror=U(t),a.onsuccess=function(e){try{V(t)}catch(e){t.continue()}},1}return 0}))}function W(e){return new d.A((function(t,n){(function(e){return new d.A((function(t,n){var r=!1;e.openCursor(k,null,(function(e,t,n){var i=t.tm;return x()-i<L?0:(r=!0,2)})).then((function(){if(r){var i={};B(e,null,(function(e){if(!e||!e.evt||!e.evt.iKey)return!0;var t=e.tm;return x()-t>L||(i[e.evt.iKey]=1,!1)})).then((function(){var r=[];e.openCursor(k,null,(function(e,t,n){var o=t.tm;return x()-o<L||i[t.iKey]?0:(r.push(t),V(e))})).then((function(){t(r)}),n)}),n)}else t([])}),n)}))})(e).then((function(){G(e).then(t,t)}),n)}))}var q=function(){function e(t){(0,o.A)(e,this,(function(e){var n=null,r=null,i="Unknown",o=null,a=null,s=null,c=-1,l=0;function p(e){return n.openDb(r,1,(function(t){return new d.A((function(n,r){var c={iKey:i,storageId:o,iKeyPrefix:function(){return a},evtKeyPrefix:function(){return s}};t.ctx=c,j(t).then((function(){e(t).then(n,r)}),r)}))}),(function(e){return new d.A((function(t,n){var r;(r=e.db).objectStoreNames.contains(M)||r.createObjectStore(M,{keyPath:"key"}).createIndex("EvntId","key",{unique:!1}),r.objectStoreNames.contains(k)||r.createObjectStore(k,{keyPath:"iKey"}).createIndex("iKey","iKey",{unique:!0}),t()}))}))}function h(e,t,n){return new d.A((function(r,i){function o(t,n){(function(e,t){return new d.A((function(n,r){var i=0,o=e.ctx.evtKeyPrefix();function a(){n(i)}function s(e,t){return new d.A((function(n){var r=e.store.delete(t.key);r.onsuccess=function(e){i++,n()},r.onerror=function(e){n()}}))}e.openCursor(M,"#key="+o,(function(e,n,r){return n.evt.persistence<=t&&0===n.key.indexOf(o)&&(function(e,t){for(var n=0;n<e.length;n++)if(t.tm<e[n].tm)return void e.splice(n,0,t);e.push(t)}(r,n),r.length>10&&r.splice(r.length-1,1)),0})).then((function(t){0!==t.length?e.openStore(M,(function(e){for(var n=[],r=0;r<t.length;r++)n.push(s(e,t[r]));return d.A.all(n).then(a,a)})):a()}),(function(){n(0)}))}))})(e,t).then((function(e){e>0&&(l-=e),n(e)}),(function(e){n(0)}))}function a(e){r(t.evt)}function s(){e.openStore(M,(function(s){var c=s.store.put(t);c.onsuccess=function(i){n&&j(e).then(a,a),l++,r(t.evt)},c.onerror=function(a){function s(n){0===n&&i(new Error(N)),h(e,t,!1).then((function(e){r(t.evt)}),(function(){i(new Error(N))}))}n?o(1,(function(e){e>0?s(e):t.evt.persistence>=2?o(2,(function(e){s(e)})):i(new Error(N))})):i(new Error(N))}}))}c>0&&l>=c?o(1,(function(e){0===e?t.evt.persistence>=2?o(2,(function(e){s()})):i(new Error(N)):s()})):s()}))}e.id=t,e.initialize=function(t){var l=t.itemCtx.diagLog();if(!(n=new R(l)).isAvailable())return n=null,!1;var h=t.itemCtx.getCfg(),g=t.storageConfig||{};return r=g.indexedDbName||"AppInsightEvents.1",i=h.instrumentationKey||i,o=e.id||t.id||(0,u.aq)(),s=(a=i+"::")+o+"::",c=g.maxStorageItems>0?g.maxStorageItems:c,p((function(e){return e.isNew?d.A.resolve(!0):W(e)})).then((function(e){}),(function(e){l.warnToConsole("IndexedDbProvider failed to initialize - "+(e||"<unknown>")),n=null})),!0},e.supportsSyncRequests=function(){return!1},e.getAllEvents=function(){return null!=n&&n.isAvailable()?p((function(e){return new d.A((function(t,n){(function(e,t){return e.openCursor(M,t,(function(e,t,n){return n.push(t),0}))})(e,"#key="+e.ctx.evtKeyPrefix()).then((function(e){l=e.length,t(H(e))}),n)}))})):d.A.resolve([])},e.addEvent=function(e,t,r){return null!=n&&n.isAvailable()?(t.id=t.id||(0,u.aq)(),F(t.persistence)||(t.persistence=1),p((function(n){var r=e||t.id,i={key:n.ctx.evtKeyPrefix()+r,id:r,evt:t,tm:x(),v:1};return h(n,i,!0)}))):d.A.resolve(t)},e.removeEvents=function(e){if(null==n||!n.isAvailable())return d.A.resolve([]);var t=[];return new d.A((function(n,r){p((function(n){return n.openCursor(M,"#key="+n.ctx.iKey,(function(n,r,i){if(-1!==function(e,t){for(var n=t.length,r=0;r<n;r++)if(e===t[r].id)return r;return-1}(r.id,e)){var o=n.cursor.delete();return o.onerror=U(n),o.onsuccess=function(){t.push(r.evt),n.continue()},1}return 0}))})).then((function(e){l-=t.length,n(t)}),(function(e){l-=t.length,n(t)}))}))},e.clear=function(){return null!=n&&n.isAvailable()?new d.A((function(e,t){p((function(e){return B(e,"#key="+e.ctx.evtKeyPrefix(),(function(t){return 0===t.key.indexOf(e.ctx.evtKeyPrefix())}))})).then((function(t){l=0,e(H(t))}),t)})):d.A.resolve([])},e.teardown=function(){n&&n.closeDb(r)}}))}return e.__ieDyn=1,e}(),K=6e5,J="AWTEvents";function z(e){var t=(0,f.mS)()||{},n=null;try{if(n=t[e]){var r="__storage_test__";n.setItem(r,r),n.removeItem(r)}}catch(e){(function(e,t){var n=!1;return t instanceof DOMException&&(22!==t.code&&"QuotaExceededError"!==t.name&&1014!==t.code&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||e&&0!==e.length&&(n=!0)),n})(n,e)||(n=null)}return n}function Q(e,t){if(e)for(var n=(0,l.cG)(e),r=0;r<n.length;r++){var i=n[r];if(!t(e[i],i))break}}function Y(e){var t=!0;return Q(e,(function(e,n){return e&&(t=!1),t})),t}function Z(e,t){for(var n=1,r=0,i=function(){var e=[],i=t[n];if(Q(i,(function(t,n){return e.push(n),++r<10})),r>0){for(var o=0;o<e.length;o++)delete i[e[o]];return{value:!0}}n++};n<=e&&r<10;){var o=i();if("object"==typeof o)return o.value}return r>0}var X=g,$=function(){function e(t,n){(0,o.A)(e,this,(function(e){var r=null,i=J,o=null,a=null,s=null,l=5e6,p=null,h=null;function g(e,t){return{key:e,db:t}}function f(e,t){void 0===t&&(t=!0);var n=null;if(r){var i=r.getItem(e);if(i)try{n=JSON.parse(i)}catch(t){r.removeItem(e)}}return t&&!n&&(n={events:{1:{},2:{},3:{}},lastAccessTime:0}),g(e,n)}function m(e,t){void 0===t&&(t=!0);var n=!0,i=e.db;if(i){t&&(i.lastAccessTime=(new Date).getTime());for(var o=1;o<=2;o++)if(!Y(i.events[o])){n=!1;break}}try{if(n)r&&r.removeItem(e.key);else{var a=JSON.stringify(i);if(a.length>l)return!1;r&&r.setItem(e.key,a)}}catch(e){return!1}return!0}e.id=n,r=z(t)||null,e.initialize=function(t){if(!r)return!1;var n=t.storageConfig||{};return l=n.maxStorageSizeInBytes>0?n.maxStorageSizeInBytes:l,i=n.storageKey||J,o=e.id||t.id||(0,u.aq)(),h=i+"."+o,p=i+"Version",a=t.itemCtx.getCfg().instrumentationKey,s=(0,c.EO)(a)||a,function(){if(!r)return;for(var e=r.getItem(p),t=[],n=f(h),o=!1,a=0;a<r.length;a++){var l=r.key(a);if(0===l.indexOf(i)&&l!==p){if("3"!==e){t.push(g(l,null));continue}var u=f(l,!1),d=u.db;if(d){if((new Date).getTime()-d.lastAccessTime>K){for(var _=1,y=function(){var e=d.events[_],t=n.db.events[_];Q(e,(function(n,r){return((0,c.EO)(n.iKey)||n.iKey)===s&&(t[r]=n,delete e[r]),!0})),_++};_<=2;)y();o=!0,t.push(u)}}else t.push(g(l,null))}}for(a=0;a<t.length;a++)m(t[a],!1);o&&m(n);r.setItem(p,"3")}(),!0},e.supportsSyncRequests=function(){return!0},e.getAllEvents=function(){try{var e=[],t=f(h,!1).db;if(t)for(var n=t.events,r=2;r>=1;r--)Q(n[r],(function(t){t&&(((0,c.EO)(t.iKey)||t.iKey)===s&&e.push(t));return!0}));return d.A.resolve(e)}catch(e){return d.A.reject(e)}},e.addEvent=function(e,t,n){try{var r=f(h);t.id=t.id||(0,u.aq)(),X(t.persistence)||(t.persistence=1);for(var i=t.persistence,o=t.id,a=r.db.events;;){if(a[i][o]=t,m(r))return d.A.resolve(t);if(delete a[i][o],!Z(i,a))return d.A.reject(new Error("Unable to free up event space"))}}catch(e){return d.A.reject(e)}},e.removeEvents=function(e){try{var t=f(h,!1),n=t.db;if(n){var i=n.events;try{for(var o=0;o<e.length;++o){var a=e[o];delete i[a.persistence][a.id]}if(m(t))return d.A.resolve(e)}catch(e){}e=function(e){var t=[],n=f(e,!1),i=n.db;if(i){var o=i.events;try{for(var a=1;a<=2;a++)Q(o[a],(function(e,n){return e&&t.push(e),!0}))}catch(e){}r&&r.removeItem(n.key)}return t}(t.key)}return d.A.resolve(e)}catch(e){return d.A.reject(e)}},e.clear=function(){try{var e=[],t=f(h,!1),n=t.db;if(n){for(var r=n.events,i=function(t){var n=r[t];Q(n,(function(t){t&&(((0,c.EO)(t.iKey)||t.iKey)===s&&(delete n[t.id],e.push(t)));return!0}))},o=2;o>=1;o--)i(o);m(t)}return d.A.resolve(e)}catch(e){return d.A.reject(e)}},e.teardown=function(){try{var e=f(h,!1),t=e.db;t&&(t.lastAccessTime=0,m(e,!1))}catch(e){}}}))}return e.__ieDyn=1,e}(),ee=g,te=function(e){function t(){var n=e.call(this)||this;return n.identifier="LocalStorage",n.priority=1009,n.version="3.2.17",(0,o.A)(t,n,(function(e,t){var n,i,o,h;function f(){n=!1,i=!1,o=null,h=[]}function m(e,t){o||(o=new s.A("LocalStorage")),o.scheduleEvent((function(e){return t(e)}),e)}function _(t){(0,a.r2)(e.core,(function(){return"LocalStorageChannel:_sendStoredEventsToNextPlugin"}),(function(){m("sendToNext",(function(n){return t.provider.getAllEvents().then((function(n){for(var r=0;r<n.length;r++)try{var i=n[r];((0,c.EO)(i.iKey)||i.iKey)===t.tenantId&&e.processNext(i,t.coreRootCtx.createNew())}catch(e){}}))}))}),(function(){return{iKeyConfig:t}}))}function y(t,n){(0,a.r2)(e.core,(function(){return"LocalStorageChannel:_removeEvents"}),(function(){m("removeEvents",(function(e){var r=[];return(0,l.Iu)(n,(function(e){((0,c.EO)(e.iKey)||e.iKey)===t.tenantId&&r.push(e)})),r.length>0?t.provider.removeEvents(r).then((function(e){})).catch((function(e){})):d.A.resolve()}))}),(function(){return{iKeyConfig:t,events:n}}))}function v(e){var t=new q;return t.initialize(e)||(t=null),t}function S(e,t){var n=new $(e);return n.initialize(t)||(n=null),n}f(),e.initialize=function(i,l,u,d){(0,a.r2)(l,(function(){return"LocalStorageChannel.initialize"}),(function(){n||(t.initialize(i,l,u),t.setInitialized(!1),n=!0,o=new s.A("LocalStorage",l.logger)),function(t,n,i,o){var a=e.identifier,s=t.extensionConfig=t.extensionConfig||[],l=s[a]=s[a]||{};l.providers||(l.providers=[r.LocalStorage,r.IndexedDb]);var u=function(t,n,r,i){t&&(t.extensionConfig=t.extensionConfig||[]);!i&&n&&(i=n.getProcessTelContext().getNext());var o=null,a=e._getTelCtx().getNext();a&&(o=a.getPlugin());return new p.W0(i,t,n,o)}(t,n,0,o),d={itemCtx:u,storageConfig:l,id:e.id},g=function(e){var t=e.storageConfig.providers,n=null,i=0;for(;!n&&i<t.length&&i<5;)switch(t[i++]){case r.LocalStorage:n=S("localStorage",e);break;case r.SessionStorage:n=S("sessionStorage",e);break;case r.IndexedDb:n=v(e)}return n}(d);if(g){var f={iKey:t.instrumentationKey,tenantId:(0,c.EO)(t.instrumentationKey)||t.instrumentationKey,minPersistenceCacheLevel:1,coreRootCtx:u,providerContext:d,provider:g};ee(l.minPersistenceLevel||-1)&&(f.minPersistenceCacheLevel=l.minPersistenceLevel),h.push(f),n.addNotificationListener({eventsSent:function(e){y(f,e)},eventsDiscarded:function(e,t){y(f,e)}}),_(f)}}(i,l,0,d)}),(function(){return{coreConfig:i,core:l,extensions:u,pluginChain:d}}))},e.processTelemetry=function(t,r){var o=t;if(n&&!i){r=e._getTelCtx(r),(0,c.u9)(t,e.identifier);var a=null;(0,l.Iu)(h,(function(e){e.iKey===t.iKey&&(a=e)}));var s=a?a.provider:null;if(o.sync||!s)return void e.processNext(o,r);o.id=o.id||(0,u.aq)(),g(o.persistence)||(o.persistence=1),function(e,t){if(t.sync||t.persistence<e.minPersistenceCacheLevel)return!1;return!0}(a,o)&&m("processTelemetry",(function(e){return s.addEvent(o.id,o,r)}))}e.processNext(o,r)},e.pause=function(){i=!0},e.resume=function(){(0,a.r2)(e.core,(function(){return"LocalStorageChannel:resume"}),(function(){i=!1,(0,l.Iu)(h,(function(e){e.provider&&_(e)}))}))},e._doTeardown=function(e,t){(0,l.Iu)(h,(function(e){var t=e.provider;t&&t.teardown()})),f()},e.flush=function(e,t){void 0===e&&(e=!0)}})),n}return(0,i.qU)(t,e),t.__ieDyn=1,t}(h.s),ne=n(5391),re=n(3377)},3685:function(e,t,n){"use strict";n.r(t),n.d(t,{AppExtensionKeys:function(){return h},AppInsightsCore:function(){return se.A},Application:function(){return L},ApplicationInsights:function(){return pn},ApplicationInsightsManager:function(){return dn},BE_PROFILE:function(){return he},BaseTelemetryPlugin:function(){return a.s},Cloud:function(){return Rt},CoreUtils:function(){return o.jS},Device:function(){return wt},DeviceExtKeys:function(){return E},DiagnosticLogger:function(){return oe.wq},EventLatency:function(){return gn.XA},EventPersistence:function(){return gn.iD},EventsDiscardedReason:function(){return ue.x},Extensions:function(){return p},InternalAppInsightsCore:function(){return hn._},Loc:function(){return Mt},LoggingSeverity:function(){return mn.b},MinChannelPriorty:function(){return fn.T},NRT_PROFILE:function(){return pe},NotificationManager:function(){return ie.h},OSExtKeys:function(){return m},OperatingSystem:function(){return z},OverridePropertiesPlugin:function(){return re},PostChannel:function(){return _t},PropertiesPlugin:function(){return on},RT_PROFILE:function(){return de},Session:function(){return Ot},TelemetryContext:function(){return nn},TraceLevel:function(){return gn.kp},UserExtensionKeys:function(){return f},ValueKind:function(){return gn.AN},WebExtensionKeys:function(){return g},_InternalLogMessage:function(){return oe.WD},_InternalMessageId:function(){return mn.$},cookieAvailable:function(){return O.gi},defaultFlightIdNameSpaces:function(){return A},getISOString:function(){return s._u},isArray:function(){return s.cy},isBeaconsSupported:function(){return b.Uf},isBoolean:function(){return s.Lm},isLatency:function(){return o.Hh},isNumber:function(){return s.Et},isReactNative:function(){return b.lV},isString:function(){return s.Kg},isUint8ArrayAvailable:function(){return o.h3},isValueAssigned:function(){return o.yD}});var r=n(4661),i=n(3919),o=n(5881),a=n(4111),s=n(7895),c=n(3296),l="locale",u="ver",d="name",p=(0,c.oP)({UserExt:[0,"user"],DeviceExt:[1,"device"],TraceExt:[2,"trace"],WebExt:[3,"web"],AppExt:[4,"app"],OSExt:[5,"os"],SdkExt:[6,"sdk"],IntWebExt:[7,"intweb"],UtcExt:[8,"utc"],LocExt:[9,"loc"],CloudExt:[10,"cloud"],DtExt:[11,"dt"]}),h=(0,c.oP)({id:[0,"id"],ver:[1,u],appName:[2,d],locale:[3,l],expId:[4,"expId"],env:[5,"env"]}),g=(0,c.oP)({domain:[0,"domain"],browser:[1,"browser"],browserVer:[2,"browserVer"],screenRes:[3,"screenRes"],userConsent:[4,"userConsent"],consentDetails:[5,"consentDetails"]}),f=(0,c.oP)({locale:[0,l],localId:[1,"localId"],id:[2,"id"]}),m=(0,c.oP)({osName:[0,d],ver:[1,u]}),_=(0,c.oP)({ver:[0,u],seq:[1,"seq"],installId:[2,"installId"],epoch:[3,"epoch"]}),y=(0,c.oP)({msfpc:[0,"msfpc"],anid:[1,"anid"],serviceName:[2,"serviceName"]}),v=(0,c.oP)({popSample:[0,"popSample"],eventFlags:[1,"eventFlags"]}),S=(0,c.oP)({tz:[0,"tz"]}),C=(0,c.oP)({sessionId:[0,"sesId"]}),E=(0,c.oP)({localId:[0,"localId"],deviceClass:[1,"deviceClass"],make:[2,"make"],model:[3,"model"]}),T=(0,c.oP)({role:[0,"role"],roleInstance:[1,"roleInstance"],roleVer:[2,"roleVer"]}),I=(0,c.oP)({traceId:[0,"traceID"],traceName:[1,d],parentId:[2,"parentID"]}),P=(0,c.oP)({traceId:[0,"traceId"],spanId:[1,"spanId"],traceFlags:[2,"traceFlags"]}),O=n(8388),b=n(7494),A=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"];function R(e,t){void 0===t&&(t=A);var n=null;if(e)for(var r=e.split(","),i=0;i<r.length;i++)w(r[i],t)&&(n?n+=","+r[i]:n=r[i]);return n}function w(e,t){if(void 0===t&&(t=A),!e||e.length<4)return!1;for(var n=!1,r=e.substring(0,3).toString().toUpperCase(),i=0;i<t.length;i++)if(t[i]+":"===r&&e.length<=256){n=!0;break}return n}function D(){return this.getExpId()}var L=function(){function e(t,n){var r=null,a=A.slice(0),s="Treatments",c=(0,O.um)(n),l=t;(0,i.A)(e,this,(function(e){if((0,b.Wt)()){var n=(0,b.YE)().documentElement;n&&(e.locale=n.lang)}function i(e){e!==r&&(r=R(e,a))}e.env=t.env?t.env:function(e){var t,n={},r=(0,b.YE)();if(r){t=r&&r.querySelectorAll("meta");for(var i=0;i<t.length;i++){var o=t[i];if(o.name)if(0===o.name.toLowerCase().indexOf(e))n[o.name.replace(e,"")]=o.content}}return n}("awa-").env,e.getExpId=function(){return l.expId?(i(l.expId),r):(i((0,o.UM)(c,s)),r)}}))}return e.validateAppExpId=R,e._staticInit=void(0,s.r)(e.prototype,"expId",D),e}(),N=function(e){this._setOverride=function(t,n){e.setOverride(t,n)},this._getOverride=function(t){return e.getOverride(t)}},M=function(e){function t(t,n){var r=e.call(this,t)||this,i=r;return i.setId=function(e){i._setOverride(h.id,e)},i.getId=function(){return i._getOverride(h.id)},i.setVer=function(e){i._setOverride(h.ver,e)},i.getVer=function(){return i._getOverride(h.ver)},i.setName=function(e){i._setOverride(h.appName,e)},i.getName=function(){return i._getOverride(h.appName)},i.setLocale=function(e){i._setOverride(h.locale,e)},i.getLocale=function(){return i._getOverride(h.locale)},i.setEnv=function(e){i._setOverride(h.env,e)},i.getEnv=function(){return i._getOverride(h.env)},i.setExpId=function(e){i._setOverride(h.expId,L.validateAppExpId(e))},i.getExpId=function(){return i._getOverride(h.expId)},n&&((0,s.b0)(n.env)||i.setEnv(n.env),(0,s.hX)(n.expId)||i.setExpId(n.expId)),r}return(0,r.qU)(t,e),t}(N),k=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setRole=function(e){r._setOverride(T.role,e)},r.getRole=function(){return r._getOverride(T.role)},r.setRoleInstance=function(e){r._setOverride(T.roleInstance,e)},r.getRoleInstance=function(){return r._getOverride(T.roleInstance)},r.setRoleVer=function(e){r._setOverride(T.roleVer,e)},r.getRoleVer=function(){return r._getOverride(T.roleVer)},n}return(0,r.qU)(t,e),t}(N),F=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setProperty=function(e,t){r._setOverride(e,t)},r.getProperty=function(e){return r._getOverride(e)},n}return(0,r.qU)(t,e),t}(N),x=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setLocalId=function(e){r._setOverride(E.localId,e)},r.getLocalId=function(){return r._getOverride(E.localId)},r.setDeviceClass=function(e){r._setOverride(E.deviceClass,e)},r.getDeviceClass=function(){return r._getOverride(E.deviceClass)},r.setMake=function(e){r._setOverride(E.make,e)},r.getMake=function(){return r._getOverride(E.make)},r.setModel=function(e){r._setOverride(E.model,e)},r.getModel=function(){return r._getOverride(E.model)},n}return(0,r.qU)(t,e),t}(N),j=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setTz=function(e){r._setOverride(S.tz,e)},r.getTz=function(){return r._getOverride(S.tz)},n}return(0,r.qU)(t,e),t}(N),H={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\sphone\s\d+\.\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},U={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},V="([\\d,.]+)",B="([\\d,_,.]+)",G="Unknown",W=[{r:H.WINPHONE,os:"Windows Phone"},{r:H.WINRT,os:"Windows RT"},{r:H.WIN,os:"Windows"},{r:H.IOS,os:"iOS"},{r:H.ANDROID,os:"Android"},{r:H.LINUX,os:"Linux"},{r:H.CROS,os:"Chrome OS"},{s:"x11",os:"Unix"},{s:"blackberry",os:"BlackBerry"},{s:"symbian",os:"Symbian"},{s:"nokia",os:"Nokia"},{r:H.OSX,os:"Mac OS X"}];function q(e,t){return"Windows"===t?K(e,"Windows NT"):"Android"===t?K(e,t):"Mac OS X"===t?function(e){var t=e.match(new RegExp("Mac OS X "+B));if(t){var n=t[1].replace(/_/g,".");if(n){var r=J(n);return r?n.split(r)[0]:n}}return G}(e):"iOS"===t?function(e){var t=e.match(new RegExp("OS "+B));if(t){var n=t[1].replace(/_/g,".");if(n){var r=J(n);return r?n.split(r)[0]:n}}return G}(e):G}function K(e,t){var n=e.match(new RegExp(t+" "+V));return n?U[n[1]]?U[n[1]]:n[1]:G}function J(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}var z=function(e){if(e.populateOperatingSystemInfo){var t=this,n=(0,b.w3)()||{},r=e.userAgent||n.userAgent||"",i=e.userAgentData||n.userAgentData||{};if(r){var o=function(e){for(var t=0;t<W.length;t++){var n=W[t];if(n.r&&e.match(n.r))return n.os;if(n.s&&-1!==e.indexOf(n.s))return n.os}return G}(r.toLowerCase());t.name=o,t.ver=q(r,o)}t.name&&t.name!==G||!(0,s.Kg)(i.platform)||(t.name=i.platform)}},Q=function(e){function t(t,n){var r=e.call(this,t)||this,i=r;if(i.setOsName=function(e){i._setOverride(m.osName,e)},i.getOsName=function(){return i._getOverride(m.osName)},i.setVer=function(e){i._setOverride(m.ver,e)},i.getVer=function(){return i._getOverride(m.ver)},n&&n.userAgent&&n.populateOperatingSystemInfo){var o=new z(n);i.setOsName(o.name),i.setVer(o.ver)}return r}return(0,r.qU)(t,e),t}(N);function Y(e,t){if(e)for(var n=0;n<t.length;n++){var r=t[n];(0,s.hX)(e[r])&&(e[r]={}),e=e[r]}return e}var Z=function(e){var t=this,n=[];t.setOverride=function(e,t){e&&n.push({key:e,value:t})},t.hasOverride=function(e){var t=!1;return(0,s.Iu)(n,(function(n){n.key===e&&(t=!0)})),t},t.getOverride=function(e){var t;return(0,s.Iu)(n,(function(n){n.key===e&&(t=n.value)})),t},t.applyOverrides=function(t,r){if(n.length>0)try{var i=Y(t,e);(0,s.Iu)(n,(function(e){!function(e,t,n){if(e&&t){var r=t.split("."),i=r[r.length-1];r.length>1&&(e=Y(e,r.slice(0,-1))),(0,s.hX)(n)?(0,s.b0)(e[i])||delete e[i]:e[i]=n}}(i,e.key,e.value)}))}catch(e){}}},X=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setLocalId=function(e){r._setOverride(f.localId,e)},r.getLocalId=function(){return r._getOverride(f.localId)},r.setLocale=function(e){r._setOverride(f.locale,e)},r.getLocale=function(){return r._getOverride(f.locale)},r.setId=function(e){r._setOverride(f.id,e)},r.getId=function(){return r._getOverride(f.id)},n}return(0,r.qU)(t,e),t}(N),$=function(e){function t(t,n){var r=e.call(this,t)||this,i=r;return i.setDomain=function(e){i._setOverride(g.domain,e)},i.getDomain=function(){return i._getOverride(g.domain)},i.setBrowser=function(e){i._setOverride(g.browser,e)},i.getBrowser=function(){return i._getOverride(g.browser)},i.setBrowserVer=function(e){i._setOverride(g.browserVer,e)},i.getBrowserVer=function(){return i._getOverride(g.browserVer)},i.setScreenRes=function(e){i._setOverride(g.screenRes,e)},i.getScreenRes=function(){return i._getOverride(g.screenRes)},i.setUserConsent=function(e){i._setOverride(g.userConsent,e)},i.getUserContext=function(){return i._getOverride(g.userConsent)},n&&((0,s.b0)(n.userConsented)||i.setUserConsent(n.userConsented)),r}return(0,r.qU)(t,e),t}(N),ee="ext",te=function(e,t,n){var r=this,i={};function o(e){for(var t="",n=0;n<e.length;n++)t&&(t+="_"),t+=e[n];return(0,s.b0)(i[t])&&(i[t]=new Z(e)),t?i[t]:null}r.data=new F(o(["data"])),r.app=new M(o([ee,p.AppExt]),t),r.user=new X(o([ee,p.UserExt])),r.os=new Q(o([ee,p.OSExt]),t),r.web=new $(o([ee,p.WebExt]),t),r.device=new x(o([ee,p.DeviceExt])),r.loc=new j(o([ee,p.LocExt])),r.cloud=new k(o([ee,p.CloudExt])),r.applyOverrides=function(e,t){var n=(0,s.cG)(i);n&&n.length>0&&(0,s.Iu)(n,(function(n){i[n].applyOverrides(e,t)}))}},ne=function(e){function t(){var n=e.call(this)||this;n.identifier="OverridePropertiesPlugin",n.priority=4,n.version="3.2.17";var r=null;return(0,i.A)(t,n,(function(e,t){e.initialize=function(n,r,i){t.initialize(n,r,i),e._baseInit(n,r,i)},e.processTelemetry=function(t,r){(0,o.u9)(t,n.identifier),r=e._getTelCtx(r);var i=e.getOverrideContext();i&&i.applyOverrides(t,r),e.processNext(t,r)},e._baseInit=function(e,t,i){r=new te(e,n._getTelCtx().getExtCfg(n.identifier),t)},e.setProperty=function(e,t){r&&r.data.setProperty(e,t)},e.getOverrideContext=function(){return r}})),n}return(0,r.qU)(t,e),t.__ieDyn=1,t}(a.s),re=ne,ie=n(3394),oe=n(3377),ae=n(5778),se=n(3397),ce=n(6611),le=n(8106),ue=n(1628),de="REAL_TIME",pe="NEAR_REAL_TIME",he="BEST_EFFORT",ge="",fe="POST",me="drop",_e="send",ye="requeue",ve="rspFail",Se="application/x-json-stream",Ce="cache-control",Ee="content-type",Te="kill-tokens",Ie="kill-duration",Pe="time-delta-millis",Oe="client-version",be="client-id",Ae="time-delta-to-apply-millis",Re="upload-time",we="apikey",De="AuthMsaDeviceTicket",Le="AuthXToken",Ne="msfpc",Me="trace",ke="user";function Fe(e){var t=(e.ext||{}).intweb;return t&&(0,o.yD)(t[Ne])?t[Ne]:null}function xe(e){for(var t=null,n=0;null===t&&n<e.length;n++)t=Fe(e[n]);return t}var je=function(){function e(t,n){var r=n?[].concat(n):[],i=this,o=xe(r);i.iKey=function(){return t},i.Msfpc=function(){return o||ge},i.count=function(){return r.length},i.events=function(){return r},i.addEvent=function(e){return!!e&&(r.push(e),o||(o=Fe(e)),!0)},i.split=function(n,i){var a;if(n<r.length){var c=r.length-n;(0,s.hX)(i)||(c=i<c?i:c),a=r.splice(n,c),o=xe(r)}return new e(t,a)}}return e.create=function(t,n){return new e(t,n)},e}(),He=function(){function e(){var t=!0,n=!0,r=!0,o="use-collector-delta",a=!1;(0,i.A)(e,this,(function(e){e.allowRequestSending=function(){return t},e.firstRequestSent=function(){r&&(r=!1,a||(t=!1))},e.shouldAddClockSkewHeaders=function(){return n},e.getClockSkewHeaderValue=function(){return o},e.setClockSkew=function(e){a||(e?(o=e,n=!0,a=!0):n=!1,t=!0)}}))}return e.__ieDyn=1,e}(),Ue=function(){function e(){var t={};(0,i.A)(e,this,(function(e){e.setKillSwitchTenants=function(e,n){if(e&&n)try{var r=(a=e.split(","),c=[],a&&(0,s.Iu)(a,(function(e){c.push((0,s.EH)(e))})),c);if("this-request-only"===n)return r;for(var i=1e3*parseInt(n,10),o=0;o<r.length;++o)t[r[o]]=(0,s.x3)()+i}catch(e){return[]}var a,c;return[]},e.isTenantKilled=function(e){var n=t,r=(0,s.EH)(e);return void 0!==n[r]&&n[r]>(0,s.x3)()||(delete n[r],!1)}}))}return e.__ieDyn=1,e}(),Ve=n(9166);function Be(e){var t,n=Math.floor(1200*Math.random())+2400;return t=Math.pow(2,e)*n,Math.min(t,6e5)}var Ge,We=2e6,qe=Math.min(We,65e3),Ke="metadata",Je="f",ze=/\./,Qe=function(){function e(t,n,r,a){var c="data",l="baseData",u=!!a,d=!0,p=n,h={};(0,i.A)(e,this,(function(e){function n(e,t,i,a,c,l,d){(0,s.z)(e,(function(e,g){var f=null;if(g||(0,o.yD)(g)){var m=i,_=e,y=c,v=t;if(u&&!a&&ze.test(e)){var S=e.split("."),C=S.length;if(C>1){y&&(y=y.slice());for(var E=0;E<C-1;E++){var T=S[E];v=v[T]=v[T]||{},m+="."+T,y&&y.push(T)}_=S[C-1]}}var I=a&&function(e,t){var n=h[e];return void 0===n&&(e.length>=7&&(n=(0,s.tG)(e,"ext.metadata")||(0,s.tG)(e,"ext.web")),h[e]=n),n}(m);if(f=!I&&p&&p.handleField(m,_)?p.value(m,_,g,r):(0,o.TC)(_,g,r)){var P=f.value;if(v[_]=P,l&&l(y,_,f),d&&"object"==typeof P&&!(0,s.cy)(P)){var O=y;O&&(O=O.slice()).push(_),n(g,P,m+"."+_,a,O,l,d)}}}}))}e.createPayload=function(e,t,n,r,i,o){return{apiKeys:[],payloadBlob:ge,overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:e,isTeardown:t,isSync:n,isBeacon:r,sendType:o,sendReason:i}},e.appendPayload=function(n,r,i){var o=n&&r&&!n.overflow;return o&&(0,ae.r2)(t,(function(){return"Serializer:appendPayload"}),(function(){for(var t=r.events(),o=n.payloadBlob,a=n.numEvents,c=!1,l=[],u=[],d=n.isBeacon,p=d?65e3:3984588,h=d?qe:We,g=0,f=0;g<t.length;){var m=t[g];if(m){if(a>=i){n.overflow=r.split(g);break}var _=e.getEventBlob(m);if(_&&_.length<=h){var y=_.length;if(o.length+y>p){n.overflow=r.split(g);break}o&&(o+="\n"),o+=_,++f>20&&(o.substr(0,1),f=0),c=!0,a++}else _?l.push(m):u.push(m),t.splice(g,1),g--}g++}if(l&&l.length>0&&n.sizeExceed.push(je.create(r.iKey(),l)),u&&u.length>0&&n.failedEvts.push(je.create(r.iKey(),u)),c){n.batches.push(r),n.payloadBlob=o,n.numEvents=a;var v=r.iKey();-1===(0,s.rD)(n.apiKeys,v)&&n.apiKeys.push(v)}}),(function(){return{payload:n,theBatch:{iKey:r.iKey(),evts:r.events()},max:i}})),o},e.getEventBlob=function(e){try{return(0,ae.r2)(t,(function(){return"Serializer.getEventBlob"}),(function(){var t={};t.name=e.name,t.time=e.time,t.ver=e.ver,t.iKey="o:"+(0,o.EO)(e.iKey);var r={},i=e.ext;i&&(t.ext=r,(0,s.z)(i,(function(e,t){n(t,r[e]={},"ext."+e,!0,null,null,!0)})));var a=t[c]={};a.baseType=e.baseType;var u=a[l]={};return n(e.baseData,u,l,!1,[l],(function(e,t,n){Ye(r,e,t,n)}),d),n(e.data,a,c,!1,[],(function(e,t,n){Ye(r,e,t,n)}),d),JSON.stringify(t)}),(function(){return{item:e}}))}catch(e){return null}}}))}return e.__ieDyn=1,e}();function Ye(e,t,n,r){if(r&&e){var i=(0,o.Go)(r.value,r.kind,r.propertyType);if(i>-1){var a=e[Ke];a||(a=e[Ke]={f:{}});var c=a[Je];if(c||(c=a[Je]={}),t)for(var l=0;l<t.length;l++){var u=t[l];c[u]||(c[u]={f:{}});var d=c[u][Je];d||(d=c[u][Je]={}),c=d}c=c[n]={},(0,s.cy)(r.value)?c.a={t:i}:c.t=i}}}var Ze="sendAttempt",Xe="&NoResponseBody=true",$e=((Ge={})[1]=ye,Ge[100]=ye,Ge[200]="sent",Ge[8004]=me,Ge[8003]=me,Ge),et={},tt={};function nt(e,t,n){et[e]=t,!1!==n&&(tt[t]=e)}function rt(e){try{return e.responseText}catch(e){}return ge}function it(e,t){var n=!1;if(e&&t){var r=(0,s.cG)(e);if(r&&r.length>0)for(var i=t.toLowerCase(),o=0;o<r.length;o++){var a=r[o];if(a&&(0,s.mQ)(t,a)&&a.toLowerCase()===i){n=!0;break}}}return n}function ot(e,t,n,r){t&&n&&n.length>0&&(r&&et[t]?(e.hdrs[et[t]]=n,e.useHdrs=!0):e.url+="&"+t+"="+n)}function at(e,t){return t&&((0,s.Et)(t)?e=[t].concat(e):(0,s.cy)(t)&&(e=t.concat(e))),e}nt(De,De,!1),nt(Oe,Oe),nt(be,"Client-Id"),nt(we,we),nt(Ae,Ae),nt(Re,Re),nt(Le,Le);var st=function(){function e(t,n,r,a,c){this._responseHandlers=[];var l,u,d,p,h,g,f,m,_,y,v="?cors=true&"+Ee.toLowerCase()+"="+Se,S=new Ue,C=!1,E=new He,T=!1,I=0,P=!0,O=[],A={},R=[],w=null,D=!1,L=!1,N=!1;(0,i.A)(e,this,(function(e){var i=!0;function M(e,t){for(var n=0,r=null,i=0;null==r&&i<e.length;)1===(n=e[i])?(0,b.PV)()?r=k:(0,b.xk)()&&(r=x):2===n&&(0,b.R7)(t)&&(!t||t&&!m)?r=F:T&&3===n&&(0,b.Uf)()&&(r=H),i++;return r?{_transport:n,_isSync:t,sendPOST:r}:null}function k(e,t,n){var r=new XDomainRequest;r.open(fe,e.urlString),e.timeout&&(r.timeout=e.timeout),r.onload=function(){var e=rt(r);j(t,200,{},e),Z(e)},r.onerror=function(){j(t,400,{})},r.ontimeout=function(){j(t,500,{})},r.onprogress=function(){},n?r.send(e.data):c.set((function(){r.send(e.data)}),0)}function F(e,t,n){var r,o=e.urlString,a=!1,l=!1,u=((r={body:e.data,method:fe}).Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0,r);n&&(u.keepalive=!0,2===e._sendReason&&(a=!0,y&&(o+=Xe))),i&&(u.credentials="include"),e.headers&&(0,s.cG)(e.headers).length>0&&(u.headers=e.headers),fetch(o,u).then((function(e){var n={},r=ge,i=e.headers;i&&i.forEach((function(e,t){n[t]=e})),e.body&&e.text().then((function(e){r=e})),l||(l=!0,j(t,e.status,n,r),Z(r))})).catch((function(e){l||(l=!0,j(t,0,{}))})),a&&!l&&(l=!0,j(t,200,{})),!l&&e.timeout>0&&c.set((function(){l||(l=!0,j(t,500,{}))}),e.timeout)}function x(e,t,n){var r=e.urlString;function a(e,t,n){if(!e[n]&&t&&t.getResponseHeader){var r=t.getResponseHeader(n);r&&(e[n]=(0,s.EH)(r))}return e}function c(e){var t={};return e.getAllResponseHeaders?t=function(e){var t={};if((0,s.Kg)(e)){var n=(0,s.EH)(e).split(/[\r\n]+/);(0,s.Iu)(n,(function(e){if(e){var n=e.indexOf(": ");if(-1!==n){var r=(0,s.EH)(e.substring(0,n)).toLowerCase(),i=(0,s.EH)(e.substring(n+1));t[r]=i}else t[(0,s.EH)(e)]=1}}))}return t}(e.getAllResponseHeaders()):(t=a(t,e,Pe),t=a(t,e,Ie),t=a(t,e,"kill-duration-seconds")),t}function l(e,n){j(t,e.status,c(e),n)}n&&e.disableXhrSync&&(n=!1);var u=(0,o.H$)(fe,r,i,!0,n,e.timeout);(0,s.z)(e.headers,(function(e,t){u.setRequestHeader(e,t)})),u.onload=function(){var e=rt(u);l(u,e),Z(e)},u.onerror=function(){l(u)},u.ontimeout=function(){l(u)},u.send(e.data)}function j(e,t,n,r){try{e(t,n,r)}catch(e){(0,oe.ZP)(u,2,518,(0,b.mm)(e))}}function H(e,t,n){var r=200,i=e._thePayload,o=e.urlString+(y?Xe:ge);try{var a=(0,b.w3)();if(!a.sendBeacon(o,e.data))if(i){var c=[];(0,s.Iu)(i.batches,(function(e){if(c&&e&&e.count()>0){for(var t=e.events(),n=0;n<t.length;n++)if(!a.sendBeacon(o,w.getEventBlob(t[n]))){c.push(e.split(n));break}}else c.push(e.split(0))})),X(c,8003,i.sendType,!0)}else r=0}catch(e){(0,oe.OG)(u,"Failed to send telemetry using sendBeacon API. Ex:"+(0,b.mm)(e)),r=0}finally{j(t,r,{},ge)}}function U(e){return 2===e||3===e}function V(e){return L&&U(e)&&(e=2),e}function B(){return!C&&I<n}function G(){var e=R;return R=[],e}function W(e,t,n){var r=!1;return e&&e.length>0&&!C&&d[t]&&w&&(r=0!==t||B()&&(n>0||E.allowRequestSending())),r}function q(e){var t={};return e&&(0,s.Iu)(e,(function(e,n){t[n]={iKey:e.iKey(),evts:e.events()}})),t}function K(e,n,r,i,a){if(e&&0!==e.length)if(C)X(e,1,i);else{i=V(i);try{var s=e,c=0!==i;(0,ae.r2)(p,(function(){return"HttpManager:_sendBatches"}),(function(s){s&&(e=e.slice(0));for(var l=[],u=null,p=(0,o.WB)(),h=d[i]||(c?d[1]:d[0]),g=h&&h._transport,f=_&&(L||U(i)||3===g||h._isSync&&2===g);W(e,i,n);){var m=e.shift();m&&m.count()>0&&(S.isTenantKilled(m.iKey())?l.push(m):(u=u||w.createPayload(n,r,c,f,a,i),w.appendPayload(u,m,t)?null!==u.overflow&&(e=[u.overflow].concat(e),u.overflow=null,Q(u,p,(0,o.WB)(),a),p=(0,o.WB)(),u=null):(Q(u,p,(0,o.WB)(),a),p=(0,o.WB)(),e=[m].concat(e),u=null)))}u&&Q(u,p,(0,o.WB)(),a),e.length>0&&(R=e.concat(R)),X(l,8004,i)}),(function(){return{batches:q(s),retryCount:n,isTeardown:r,isSynchronous:c,sendReason:a,useSendBeacon:U(i),sendType:i}}),!c)}catch(e){(0,oe.ZP)(u,2,48,"Unexpected Exception sending batch: "+(0,b.mm)(e))}}}function J(e,t){var n={url:v,hdrs:{},useHdrs:!1};t?(n.hdrs=(0,o.X$)(n.hdrs,A),n.useHdrs=(0,s.cG)(n.hdrs).length>0):(0,s.z)(A,(function(e,t){tt[e]?ot(n,tt[e],t,!1):(n.hdrs[e]=t,n.useHdrs=!0)})),ot(n,be,"NO_AUTH",t),ot(n,Oe,o.xE,t);var r=ge;(0,s.Iu)(e.apiKeys,(function(e){r.length>0&&(r+=","),r+=e})),ot(n,we,r,t),ot(n,Re,(0,s.x3)().toString(),t);var i=function(e){for(var t=0;t<e.batches.length;t++){var n=e.batches[t].Msfpc();if(n)return encodeURIComponent(n)}return ge}(e);if((0,o.yD)(i)&&(n.url+="&ext.intweb.msfpc="+i),E.shouldAddClockSkewHeaders()&&ot(n,Ae,E.getClockSkewHeaderValue(),t),p.getWParam){var a=p.getWParam();a>=0&&(n.url+="&w="+a)}for(var c=0;c<O.length;c++)n.url+="&"+O[c].name+"="+O[c].value;return n}function z(e,t,n){e[t]=e[t]||{},e[t][l.identifier]=n}function Q(t,n,i,a){if(t&&t.payloadBlob&&t.payloadBlob.length>0){var c=!!e.sendHook,h=d[t.sendType];!U(t.sendType)&&t.isBeacon&&2===t.sendReason&&(h=d[2]||d[3]||h);var _=N;(t.isBeacon||3===h._transport)&&(_=!1);var y=J(t,_);_=_||y.useHdrs;var v=(0,o.WB)();(0,ae.r2)(p,(function(){return"HttpManager:_doPayloadSend"}),(function(){for(var d=0;d<t.batches.length;d++)for(var C=t.batches[d].events(),T=0;T<C.length;T++){var O=C[T];if(D){var A=O.timings=O.timings||{};z(A,"sendEventStart",v),z(A,"serializationStart",n),z(A,"serializationCompleted",i)}O[Ze]>0?O[Ze]++:O[Ze]=1}X(t.batches,1e3+(a||0),t.sendType,!0);var R={data:t.payloadBlob,urlString:y.url,headers:y.hdrs,_thePayload:t,_sendReason:a,timeout:g,disableXhrSync:f,disableFetchKeepAlive:m};_&&(it(R.headers,Ce)||(R.headers[Ce]="no-cache, no-store"),it(R.headers,Ee)||(R.headers[Ee]=Se));var w=null;h&&(w=function(n){E.firstRequestSent();var i=function(n,i){!function(t,n,i,a){var c=9e3,u=null,d=!1,p=!1;try{var h=!0;if(typeof t!==Ve.bA){if(n){E.setClockSkew(n[Pe]);var g=n[Ie]||n["kill-duration-seconds"];(0,s.Iu)(S.setKillSwitchTenants(n[Te],g),(function(e){(0,s.Iu)(i.batches,(function(t){if(t.iKey()===e){u=u||[];var n=t.split(0);i.numEvents-=n.count(),u.push(n)}}))}))}if(200==t||204==t)return void(c=200);((m=t)>=300&&m<500&&408!=m&&429!=m||501==m||505==m||i.numEvents<=0)&&(h=!1),c=9e3+t%1e3}if(h){c=100;var f=i.retryCnt;0===i.sendType&&(f<r?(d=!0,Y((function(){0===i.sendType&&I--,K(i.batches,f+1,i.isTeardown,L?2:i.sendType,5)}),L,Be(f))):(p=!0,L&&(c=8001)))}}finally{d||(E.setClockSkew(),function(t,n,r,i){try{i&&l._backOffTransmission(),200===n&&(i||t.isSync||l._clearBackOff(),function(e){if(D){var t=(0,o.WB)();(0,s.Iu)(e,(function(e){e&&e.count()>0&&function(e,t){D&&(0,s.Iu)(e,(function(e){z(e.timings=e.timings||{},"sendEventCompleted",t)}))}(e.events(),t)}))}}(t.batches)),X(t.batches,n,t.sendType,!0)}finally{0===t.sendType&&(I--,5!==r&&e.sendQueuedRequests(t.sendType,r))}}(i,c,a,p)),X(u,8004,i.sendType)}var m}(n,i,t,a)},c=t.isTeardown||t.isSync;try{h.sendPOST(n,i,c),e.sendListener&&e.sendListener(R,n,c,t.isBeacon)}catch(e){(0,oe.OG)(u,"Unexpected exception sending payload. Ex:"+(0,b.mm)(e)),j(i,0,{})}}),(0,ae.r2)(p,(function(){return"HttpManager:_doPayloadSend.sender"}),(function(){if(w)if(0===t.sendType&&I++,c&&!t.isBeacon&&3!==h._transport){var n={data:R.data,urlString:R.urlString,headers:(0,o.X$)({},R.headers),timeout:R.timeout,disableXhrSync:R.disableXhrSync,disableFetchKeepAlive:R.disableFetchKeepAlive},r=!1;(0,ae.r2)(p,(function(){return"HttpManager:_doPayloadSend.sendHook"}),(function(){try{e.sendHook(n,(function(e){r=!0,P||e._thePayload||(e._thePayload=e._thePayload||R._thePayload,e._sendReason=e._sendReason||R._sendReason),w(e)}),t.isSync||t.isTeardown)}catch(e){r||w(R)}}))}else w(R)}))}),(function(){return{thePayload:t,serializationStart:n,serializationCompleted:i,sendReason:a}}),t.isSync)}t.sizeExceed&&t.sizeExceed.length>0&&X(t.sizeExceed,8003,t.sendType),t.failedEvts&&t.failedEvts.length>0&&X(t.failedEvts,8002,t.sendType)}function Y(e,t,n){t?e():c.set(e,n)}function Z(t){var n=e._responseHandlers;try{for(var r=0;r<n.length;r++)try{n[r](t)}catch(e){(0,oe.ZP)(u,1,519,"Response handler failed: "+e)}if(t){var i=JSON.parse(t);(0,o.yD)(i.webResult)&&(0,o.yD)(i.webResult[Ne])&&h.set("MSFPC",i.webResult[Ne],31536e3)}}catch(e){}}function X(e,t,n,r){if(e&&e.length>0&&a){var i=a[function(e){var t=$e[e];(0,o.yD)(t)||(t="oth",e>=9e3&&e<=9999?t=ve:e>=8e3&&e<=8999?t=me:e>=1e3&&e<=1999&&(t=_e));return t}(t)];if(i){var s=0!==n;(0,ae.r2)(p,(function(){return"HttpManager:_sendBatchesNotification"}),(function(){Y((function(){try{i.call(a,e,t,s,n)}catch(e){(0,oe.ZP)(u,1,74,"send request notification failed: "+e)}}),r||s,0)}),(function(){return{batches:q(e),reason:t,isSync:s,sendSync:r,sendType:n}}),!s)}}}e.initialize=function(e,t,n,r,o){var a;o||(o={}),v=e+v,N=!!(0,s.b0)(o.avoidOptions)||!o.avoidOptions,p=t,h=t.getCookieMgr(),D=!p.config.disableEventTimings;var c=!!p.config.enableCompoundKey;u=(l=n).diagLog();var S=o.valueSanitizer,C=o.stringifyObjects;(0,s.b0)(o.enableCompoundKey)||(c=!!o.enableCompoundKey),g=o.xhrTimeout,f=!!o.disableXhrSync,m=!!o.disableFetchKeepAlive,y=!1!==o.addNoResponse,T=!(0,b.lV)(),w=new Qe(p,S,C,c),(0,s.hX)(o.useSendBeacon)||(T=!!o.useSendBeacon);var E=r,I=o.alwaysUseXhrOverride?r:null,O=o.alwaysUseXhrOverride?r:null,A=[3,2];if(!r){P=!1;var R=(0,b.g$)();R&&R.protocol&&"file:"===R.protocol.toLowerCase()&&(i=!1);var L=[];(0,b.lV)()?(L=[2,1],A=[2,1,3]):L=[1,2,3],(r=M(L=at(L,o.transports),!1))||(0,oe.OG)(u,"No available transport to send events"),E=M(L,!0)}I||(I=M(A=at(A,o.unloadTransports),!0)),_=!P&&(T&&(0,b.Uf)()||!m&&(0,b.R7)(!0)),(a={})[0]=r,a[1]=E||M([1,2,3],!0),a[2]=I||E||M([1],!0),a[3]=O||M([2,3],!0)||E||M([1],!0),d=a},e._getDbgPlgTargets=function(){return[d[0],S,w,d]},e.addQueryStringParameter=function(e,t){for(var n=0;n<O.length;n++)if(O[n].name===e)return void(O[n].value=t);O.push({name:e,value:t})},e.addHeader=function(e,t){A[e]=t},e.canSendRequest=function(){return B()&&E.allowRequestSending()},e.sendQueuedRequests=function(e,t){(0,s.b0)(e)&&(e=0),L&&(e=V(e),t=2),W(R,e,0)&&K(G(),0,!1,e,t||0)},e.isCompletelyIdle=function(){return!C&&0===I&&0===R.length},e.setUnloading=function(e){L=e},e.addBatch=function(e){if(e&&e.count()>0){if(S.isTenantKilled(e.iKey()))return!1;R.push(e)}return!0},e.teardown=function(){R.length>0&&K(G(),0,!0,2,2)},e.pause=function(){C=!0},e.resume=function(){C=!1,e.sendQueuedRequests(0,4)},e.sendSynchronousBatch=function(e,t,n){e&&e.count()>0&&((0,s.hX)(t)&&(t=1),L&&(t=V(t),n=2),K([e],0,!1,t,n||0))}}))}return e.__ieDyn=1,e}();function ct(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout(e,t,n)}function lt(e){clearTimeout(e)}function ut(e,t){return{set:e||ct,clear:t||lt}}var dt,pt="eventsDiscarded",ht="overrideInstrumentationKey",gt="maxEventRetryAttempts",ft="maxUnloadEventRetryAttempts",mt=function(e){function t(){var n,r=e.call(this)||this;r.identifier="PostChannel",r.priority=1011,r.version="3.2.17";var a,c,l,u,d,p,h,g=!1,f=[],m=null,_=!1,y=0,v=500,S=0,C=1e4,E={},T=de,I=null,P=null,O=0,A=0,R={},w=-1,D=!0,L=!1,N=6,M=2;return(0,i.A)(t,r,(function(e,t){function r(e){"beforeunload"!==(e||(0,b.zk)().event).type&&(L=!0,c.setUnloading(L)),B(2,2)}function i(e){L=!1,c.setUnloading(L)}function k(e,t){if(e.sendAttempt||(e.sendAttempt=0),e.latency||(e.latency=1),e.ext&&e.ext[Me]&&delete e.ext[Me],e.ext&&e.ext[ke]&&e.ext[ke].id&&delete e.ext[ke].id,D&&(o.u9,e.ext=(0,s.hW)(e.ext),e.baseData&&(e.baseData=(0,s.hW)(e.baseData)),e.data&&(e.data=(0,s.hW)(e.data))),e.sync)if(O||_)e.latency=3,e.sync=!1;else if(c)return D&&(e=(0,s.hW)(e)),void c.sendSynchronousBatch(je.create(e.iKey,[e]),!0===e.sync?1:e.sync,3);var n=e.latency,r=S,i=C;4===n&&(r=y,i=v);var a=!1;if(r<i)a=!q(e,t);else{var l=1,u=20;4===n&&(l=4,u=1),a=!0,function(e,t,n,r){for(;n<=t;){var i=G(e,t,!0);if(i&&i.count()>0){var o=i.split(0,r),a=o.count();if(a>0)return 4===n?y-=a:S-=a,ee(pt,[o],ue.x.QueueFull),!0}n++}return K(),!1}(e.iKey,e.latency,l,u)&&(a=!q(e,t))}a&&$(pt,[e],ue.x.QueueFull)}function F(e,t,n){var r=J(e,t,n);return c.sendQueuedRequests(t,n),r}function x(){return S>0}function j(){if(w>=0&&J(w,0,d)&&c.sendQueuedRequests(0,d),y>0&&!P&&!_){var e=E[T][2];e>=0&&(P=U((function(){P=null,F(4,0,1),j()}),e))}var t=E[T][1];!I&&!m&&t>=0&&!_&&(x()?I=U((function(){I=null,F(0===A?3:1,0,1),A++,A%=2,j()}),t):A=0)}function H(){n=null,g=!1,f=[],m=null,_=!1,y=0,v=500,S=0,C=1e4,E={},T=de,I=null,P=null,O=0,A=0,a=null,R={},l=void 0,u=0,w=-1,d=null,D=!0,L=!1,N=6,M=2,p=null,h=ut(),c=new st(500,2,1,{requeue:Z,send:te,sent:ne,drop:re,rspFail:ie,oth:se},h),Y(),R[4]={batches:[],iKeyMap:{}},R[3]={batches:[],iKeyMap:{}},R[2]={batches:[],iKeyMap:{}},R[1]={batches:[],iKeyMap:{}},ge()}function U(e,t){0===t&&O&&(t=1);var n=1e3;return O&&(n=Be(O-1)),h.set(e,t*n)}function V(){return null!==I&&(h.clear(I),I=null,A=0,!0)}function B(e,t){V(),m&&(h.clear(m),m=null),_||F(1,e,t)}function G(e,t,n){var r=R[t];r||(r=R[t=1]);var i=r.iKeyMap[e];return!i&&n&&(i=je.create(e),r.batches.push(i),r.iKeyMap[e]=i),i}function W(t,n){c.canSendRequest()&&!O&&(l>0&&S>l&&(n=!0),n&&null==m&&e.flush(t,null,20))}function q(e,t){D&&(e=(0,s.hW)(e));var n=e.latency,r=G(e.iKey,n,!0);return!!r.addEvent(e)&&(4!==n?(S++,t&&0===e.sendAttempt&&W(!e.sync,u>0&&r.count()>=u)):y++,!0)}function K(){for(var e=0,t=0,n=function(n){var r=R[n];r&&r.batches&&(0,s.Iu)(r.batches,(function(r){4===n?e+=r.count():t+=r.count()}))},r=1;r<=4;r++)n(r);S=t,y=e}function J(t,n,r){var i=!1,o=0===n;return!o||c.canSendRequest()?(0,ae.r2)(e.core,(function(){return"PostChannel._queueBatches"}),(function(){for(var e=[],n=4;n>=t;){var r=R[n];r&&r.batches&&r.batches.length>0&&((0,s.Iu)(r.batches,(function(t){c.addBatch(t)?i=i||t&&t.count()>0:e=e.concat(t.events()),4===n?y-=t.count():S-=t.count()})),r.batches=[],r.iKeyMap={}),n--}e.length>0&&$(pt,e,ue.x.KillSwitch),i&&w>=t&&(w=-1,d=0)}),(function(){return{latency:t,sendType:n,sendReason:r}}),!o):(w=w>=0?Math.min(w,t):t,d=Math.max(d,r)),i}function z(e,t){F(1,0,t),K(),Q((function(){e&&e(),f.length>0?m=U((function(){m=null,z(f.shift(),t)}),0):(m=null,j())}))}function Q(e){c.isCompletelyIdle()?e():m=U((function(){m=null,Q(e)}),.25)}function Y(){(E={})[de]=[2,1,0],E[pe]=[6,3,0],E[he]=[18,9,0]}function Z(t,n){var r=[],i=N;L&&(i=M),(0,s.Iu)(t,(function(t){t&&t.count()>0&&(0,s.Iu)(t.events(),(function(t){t&&(t.sync&&(t.latency=4,t.sync=!1),t.sendAttempt<i?((0,o.u9)(t,e.identifier),k(t,!1)):r.push(t))}))})),r.length>0&&$(pt,r,ue.x.NonRetryableStatus),L&&B(2,2)}function X(t,n){var r=e._notificationManager||{},i=r[t];if(i)try{i.apply(r,n)}catch(n){(0,oe.ZP)(e.diagLog(),1,74,t+" notification failed: "+n)}}function $(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t&&t.length>0&&X(e,[t].concat(n))}function ee(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t&&t.length>0&&(0,s.Iu)(t,(function(t){t&&t.count()>0&&X(e,[t.events()].concat(n))}))}function te(e,t,n){e&&e.length>0&&X("eventsSendRequest",[t>=1e3&&t<=1999?t-1e3:0,!0!==n])}function ne(e,t){ee("eventsSent",e,t),j()}function re(e,t){ee(pt,e,t>=8e3&&t<=8999?t-8e3:ue.x.Unknown)}function ie(e){ee(pt,e,ue.x.NonRetryableStatus),j()}function se(e,t){ee(pt,e,ue.x.Unknown),j()}function ge(){u=n&&n.disableAutoBatchFlushLimit?0:Math.max(1500,C/6)}H(),e._getDbgPlgTargets=function(){return[c]},e.initialize=function(u,d,g){(0,ae.r2)(d,(function(){return"PostChannel:initialize"}),(function(){var f=d;t.initialize(u,d,g);try{d.addUnloadCb;p=(0,ce.Hm)((0,le.Z)(e.identifier),d.evtNamespace&&d.evtNamespace());var m=e._getTelCtx();u.extensionConfig[e.identifier]=u.extensionConfig[e.identifier]||{},n=m.getExtCfg(e.identifier),h=ut(n.setTimeoutOverride,n.clearTimeoutOverride),D=!n.disableOptimizeObj&&(0,o.F2)(),function(e){var t=e.getWParam;e.getWParam=function(){var e=0;return n.ignoreMc1Ms0CookieProcessing&&(e|=2),e|t()}}(f),n.eventsLimitInMem>0&&(C=n.eventsLimitInMem),n.immediateEventLimit>0&&(v=n.immediateEventLimit),n.autoFlushEventsLimit>0&&(l=n.autoFlushEventsLimit),(0,s.Et)(n[gt])&&(N=n[gt]),(0,s.Et)(n[ft])&&(M=n[ft]),ge(),n.httpXHROverride&&n.httpXHROverride.sendPOST&&(a=n.httpXHROverride),(0,o.yD)(u.anonCookieName)&&c.addQueryStringParameter("anoncknm",u.anonCookieName),c.sendHook=n.payloadPreprocessor,c.sendListener=n.payloadListener;var _=n.overrideEndpointUrl?n.overrideEndpointUrl:u.endpointUrl;e._notificationManager=d.getNotifyMgr(),c.initialize(_,e.core,e,a,n);var y=u.disablePageUnloadEvents||[];(0,ce.ee)(r,y,p),(0,ce.Fc)(r,y,p),(0,ce.oS)(i,u.disablePageShowEvents,p)}catch(t){throw e.setInitialized(!1),t}}),(function(){return{coreConfig:u,core:d,extensions:g}}))},e.processTelemetry=function(t,r){(0,o.u9)(t,e.identifier);var i=(r=e._getTelCtx(r)).getExtCfg(e.identifier),a=!!n.disableTelemetry;i&&(a=a||!!i.disableTelemetry);var s=t;a||g||(n[ht]&&(s.iKey=n[ht]),i&&i[ht]&&(s.iKey=i[ht]),k(s,!0),L?B(2,2):j()),e.processNext(s,r)},e._doTeardown=function(e,t){B(2,2),g=!0,c.teardown(),(0,ce.Ds)(null,p),(0,ce.sq)(null,p),(0,ce.vF)(null,p),H()},e.setEventQueueLimits=function(e,t){C=e>0?e:1e4,l=t>0?t:0,ge();var n=S>e;if(!n&&u>0)for(var r=1;!n&&r<=3;r++){var i=R[r];i&&i.batches&&(0,s.Iu)(i.batches,(function(e){e&&e.count()>=u&&(n=!0)}))}W(!0,n)},e.pause=function(){V(),_=!0,c.pause()},e.resume=function(){_=!1,c.resume(),j()},e.addResponseHandler=function(e){c._responseHandlers.push(e)},e._loadTransmitProfiles=function(e){V(),Y(),T=de,j(),(0,s.z)(e,(function(e,t){var n=t.length;if(n>=2){var r=n>2?t[2]:0;if(t.splice(0,n-2),t[1]<0&&(t[0]=-1),t[1]>0&&t[0]>0){var i=t[0]/t[1];t[0]=Math.ceil(i)*t[1]}r>=0&&t[1]>=0&&r>t[1]&&(r=t[1]),t.push(r),E[e]=t}}))},e.flush=function(e,t,n){if(void 0===e&&(e=!0),!_)if(n=n||1,e)null==m?(V(),J(1,0,n),m=U((function(){m=null,z(t,n)}),0)):f.push(t);else{var r=V();F(1,1,n),null!=t&&t(),r&&j()}},e.setMsaAuthTicket=function(e){c.addHeader(De,e)},e.hasEvents=x,e._setTransmitProfile=function(e){T!==e&&void 0!==E[e]&&(V(),T=e,j())},e._backOffTransmission=function(){O<4&&(O++,V(),j())},e._clearBackOff=function(){O&&(O=0,V(),j())},(0,s.r)(e,"_setTimeoutOverride",(function(){return h.set}),(function(e){h=ut(e,h.clear)})),(0,s.r)(e,"_clearTimeoutOverride",(function(){return h.clear}),(function(e){h=ut(h.set,e)}))})),r}return(0,r.qU)(t,e),t.__ieDyn=1,t}(a.s),_t=mt,yt=n(4074),vt=n(9021),St=n(6570);function Ct(){return void 0===dt&&(dt=!!Tt(0)),dt}function Et(){return Ct()?Tt(0):null}function Tt(e){var t,n,r=null;try{var i=(0,St.mS)();if(!i)return null;n=new Date,(r=0===e?i.localStorage:i.sessionStorage)&&(0,s.Tn)(r.setItem)&&(r.setItem(n,n),t=r.getItem(n)!==n,r.removeItem(n),t&&(r=null))}catch(e){r=null}return r}function It(){return this.getId()}function Pt(e){this.setId(e)}var Ot=function(){function e(){(0,i.A)(e,this,(function(e){e.setId=function(t){e.customId=t},e.getId=function(){return(0,s.Kg)(e.customId)?e.customId:e.automaticId}}))}return e._staticInit=void(0,s.r)(e.prototype,"id",It,Pt),e}(),bt="ai_session",At=function(){function e(t,n){var r,a,c=(0,oe.y0)(t),l=(0,O.um)(t);(0,i.A)(e,this,(function(t){var i,u={sessionRenewalMs:(i=n).sessionRenewalMs&&function(){return i.sessionRenewalMs},sessionExpirationMs:i.sessionExpirationMs&&function(){return i.sessionExpirationMs},cookieDomain:i.cookieDomain&&function(){return i.cookieDomain},namePrefix:i.namePrefix&&function(){return i.namePrefix},sessionAsGuid:function(){return i.sessionAsGuid},idLength:function(){return i.idLength?i.idLength:22}};function d(e){var n=t.automaticSession,r=e.split("|");r.length>0&&n.setId(r[0]);try{if(r.length>1){var i=+r[1];n.acquisitionDate=+new Date(i),n.acquisitionDate=n.acquisitionDate>0?n.acquisitionDate:0}if(r.length>2){var o=+r[2];n.renewalDate=+new Date(o),n.renewalDate=n.renewalDate>0?n.renewalDate:0}}catch(e){(0,oe.ZP)(c,1,510,"Error parsing ai_session cookie, session will be reset: "+e)}0===n.renewalDate&&(0,oe.ZP)(c,2,517,"AI session renewal date is 0, session will be reset.")}function p(){var e=t.automaticSession,n=(new Date).getTime(),r=t.config.sessionAsGuid();!(0,s.b0)(r)&&r?(0,s.Lm)(r)?e.setId((0,o.gj)()):e.setId((0,o.gj)(r)):e.setId((0,vt.Si)(u&&u.idLength?u.idLength():22)),e.acquisitionDate=n,e.renewalDate=n,h(e.getId(),e.acquisitionDate,e.renewalDate),Ct()||(0,oe.ZP)(c,2,505,"Browser does not support local storage. Session durations will be inaccurate.")}function h(e,n,i){var o=n+t.config.sessionExpirationMs(),s=i+t.config.sessionRenewalMs(),c=new Date,u=[e,n,i];o<s?c.setTime(o):c.setTime(s);var d=t.config.cookieDomain?t.config.cookieDomain():null;l.set(a(),u.join("|")+";expires="+c.toUTCString(),null,d),r=(new Date).getTime()}(0,s.Tn)(n.sessionExpirationMs)||(u.sessionExpirationMs=function(){return e.acquisitionSpan}),(0,s.Tn)(n.sessionRenewalMs)||(u.sessionRenewalMs=function(){return e.renewalSpan}),t.config=u,a=function(){return t.config.namePrefix&&t.config.namePrefix()?bt+t.config.namePrefix():bt},t.automaticSession=new Ot,t.update=function(){t.automaticSession.getId()||function(){var e=l.get(a());if(e&&(0,s.Tn)(e.split))d(e);else{var n=function(e,t){var n=Et();if(null!==n)try{return n.getItem(t)}catch(t){dt=!1,(0,oe.ZP)(e,1,503,"Browser failed read of local storage. "+t)}return null}(c,a());n&&d(n)}t.automaticSession.getId()||p()}();var n=t.automaticSession,i=t.config,o=(new Date).getTime(),u=o-n.acquisitionDate>i.sessionExpirationMs(),g=o-n.renewalDate>i.sessionRenewalMs();if(u||g)p();else{(!r||o-r>e.cookieUpdateInterval)&&(n.renewalDate=o,h(n.getId(),n.acquisitionDate,n.renewalDate))}},t.backup=function(){var e,n,r,i=t.automaticSession;e=i.getId(),n=i.acquisitionDate,r=i.renewalDate,function(e,t,n){var r=Et();if(null!==r)try{return r.setItem(t,n),!0}catch(t){dt=!1,(0,oe.ZP)(e,1,504,"Browser failed write to local storage. "+t)}}(c,a(),[e,n,r].join("|"))}}))}return e.acquisitionSpan=864e5,e.renewalSpan=18e5,e.cookieUpdateInterval=6e4,e}(),Rt=function(){},wt=function(){};function Dt(){return this.getMsfpc()}function Lt(){return this.getAnid()}var Nt=function(){function e(t,n){var r=(0,O.um)(n);(0,i.A)(e,this,(function(e){t.serviceName&&(e.serviceName=t.serviceName),e.getMsfpc=function(){return(0,o.UM)(r,"MSFPC")},e.getAnid=function(){return(0,o.UM)(r,"ANON").slice(0,34)}}))}var t;return e._staticInit=(t=e.prototype,(0,s.r)(t,"msfpc",Dt),void(0,s.r)(t,"anid",Lt)),e}(),Mt=function(){var e=(new Date).getTimezoneOffset(),t=e%60,n=(e-t)/60,r="+";n>0&&(r="-"),n=Math.abs(n),t=Math.abs(t),this.tz=r+(n<10?"0"+n:n.toString())+":"+(t<10?"0"+t:t.toString())},kt=n(5372),Ft="MicrosoftApplicationsTelemetryDeviceId";var xt=function(){function e(t,n){var r=0;(0,i.A)(e,this,(function(e){var i=t.propertyStorageOverride;e.seq=r,e.epoch=(0,vt.VN)(!1).toString();var a=(0,O.um)(n,t);if(a.isEnabled()||i){var s=function(e,t,n){return t?t.getProperty(n)||"":(0,o.UM)(e,n)}(a,i,Ft);s||(s=(0,kt.aq)()),function(e,t,n,r){t?t.setProperty(n,r):e.set(n,r,31536e3)}(a,i,Ft,s),e.installId=s}else a.purge(Ft);e.getSequenceId=function(){return++r}}))}return e.__ieDyn=1,e}(),jt=function(e,t,n,r){var i=this;if(i.traceId=t||(0,kt.cL)(),e.enableDistributedTracing&&!n&&(n=(0,kt.cL)().substring(0,16)),i.parentId=n,e.enableApplicationInsightsTrace){i.name=r;var o=(0,b.g$)();o&&o.pathname&&(i.name=o.pathname)}},Ht="setLocalId";function Ut(){return this.getLocalId()}function Vt(e){this[Ht](e)}var Bt=function(){function e(t,n,r){var a,c=n,l=(0,O.um)(r,t);(0,i.A)(e,this,(function(n){if(l&&l.isEnabled()&&(g(),c.enableApplicationInsightsUser)){var r=(0,o.UM)(l,e.userCookieName);if(r){var i=r.split(e.cookieSeparator);i.length>0&&(n.id=i[0])}if(!n.id){n.id=(0,vt.Si)(t&&!(0,s.b0)(t.idLength)?t.idLength:22);var u=(0,s._u)(new Date);n.accountAcquisitionDate=u;var d=[n.id,u],p=c.cookieDomain?c.cookieDomain:void 0;l.set(e.userCookieName,d.join(e.cookieSeparator),31536e3,p)}}if("undefined"!=typeof navigator){var h=navigator;n.locale=h.userLanguage||h.language}function g(){if(!c.hashIdentifiers&&!c.dropIdentifiers){var e=(0,o.UM)(l,"MUID");e&&(a="t:"+e)}return a}n.getLocalId=function(){return a||g()},n[Ht]=function(e){a=e}}))}return e.cookieSeparator="|",e.userCookieName="ai_user",e._staticInit=void(0,s.r)(e.prototype,"localId",Ut,Vt),e}(),Gt=function(e){var t=this;t.popSample=100,t.eventFlags=0,e.hashIdentifiers&&(t.eventFlags=1048576|t.eventFlags),e.dropIdentifiers&&(t.eventFlags=2097152|t.eventFlags),e.scrubIpOnly&&(t.eventFlags=4194304|t.eventFlags)},Wt=["Required","Analytics","SocialMedia","Advertising"],qt="([\\d,.]+)",Kt="Unknown",Jt="Edg/",zt=[{ua:"OPR/",b:"Opera"},{ua:"PhantomJS",b:"PhantomJS"},{ua:"Edge",b:"Edge"},{ua:Jt,b:"Edge"},{ua:"Electron",b:"Electron"},{ua:"Chrome",b:"Chrome"},{ua:"Trident",b:"MSIE"},{ua:"MSIE ",b:"MSIE"},{ua:"Firefox",b:"Firefox"},{ua:"Safari",b:"Safari"},{ua:"SkypeShell",b:"SkypeShell"}],Qt=[{br:"Microsoft Edge",b:"Edge"},{br:"Google Chrome",b:"Chrome"},{br:"Opera",b:"Opera"}];function Yt(e,t){return t.indexOf(e)>-1}function Zt(e,t){for(var n=0;n<t.length;n++)if(e==t[n].brand)return t[n].version;return null}function Xt(e,t){return"MSIE"===t?function(e){var t=e.match(new RegExp("MSIE "+qt));if(t)return t[1];var n=e.match(new RegExp("rv:"+qt));if(n)return n[1]}(e):function(e,t){"Safari"===e?e="Version":"Edge"===e&&Yt(Jt,t)&&(e="Edg");var n=t.match(new RegExp(e+"/"+qt));if(n)return n[1];if("Opera"===e&&(n=t.match(new RegExp("OPR/"+qt))))return n[1];return Kt}(t,e)}function $t(){return this.getUserConsent()}var en=function(){function e(t,n){var r=(0,O.um)(n),a=t||{};(0,i.A)(e,this,(function(e){var t=(0,b.g$)();if(t){var n=t.hostname;n&&(e.domain="file:"===t.protocol?"local":n)}if(a.populateBrowserInfo){var i=a.userAgent,c=(a.userAgentData||{}).brands,l=(0,b.w3)();l&&(i=i||l.userAgent||"",c=c||(l.userAgentData||{}).brands),function(t,n){if((0,s.cy)(n))try{for(var r=0;r<Qt.length;r++){var i=Zt(Qt[r].br,n);if(i)return e.browser=Qt[r].b,void(e.browserVer=i)}}catch(e){}if(t){var o=function(e){if(e)for(var t=0;t<zt.length;t++)if(Yt(zt[t].ua,e))return zt[t].b;return Kt}(t);e.browser=o,e.browserVer=Xt(t,o)}}(i,c);var u=function(){var e={h:0,w:0},t=(0,b.zk)();return t&&t.screen&&(e.h=screen.height,e.w=screen.width),e}();e.screenRes=u.w+"X"+u.h}(0,s.b0)(a.gpcDataSharingOptIn)?e.gpcDataSharingOptIn=null:e.gpcDataSharingOptIn=a.gpcDataSharingOptIn,e.getUserConsent=function(){return a.userConsented||!!(0,o.UM)(r,a.userConsentCookieName||"MSCC")},e.getUserConsentDetails=function(){var t=null;try{var n=a.callback;if(n&&n.userConsentDetails){var r=n.userConsentDetails();if(r){t=a.disableConsentDetailsSanitize?r:{};for(var i=0;i<Wt.length;i++){var o=Wt[i];t[o]=r[o]||!1}}}var s=e.gpcDataSharingOptIn;return null!==s&&((t=t||{}).GPC_DataSharingOptIn=!!s),t?JSON.stringify(t):null}catch(e){}},(0,s.r)(e,"userConsent",e.getUserConsent)}))}return e._staticInit=void(0,s.r)(e.prototype,"userConsent",$t),e}();function tn(e,t,n,r,i){var o=t.ext[p[e]];if(o)try{(0,s.z)(r,(function(e,t){if((0,s.Kg)(t)||(0,s.Et)(t)||(0,s.Lm)(t)){var r=o[n[e]];!i&&(r||(0,s.Kg)(r)||(0,s.Et)(r)||(0,s.Lm)(r))&&(t=r),o[n[e]]=t}}))}catch(e){}return o}var nn=function(){function e(t,n,r){(0,i.A)(e,this,(function(e){e.app=new L(n,r),e.cloud=new Rt,e.user=new Bt(t,n,r),e.os=new z(n),e.web=new en(n,r);var i=new xt(t,r),o=new Nt(n,r),a=new Gt(n);e.loc=new Mt,e.device=new wt;var c=new At(r,n);e.session=new Ot;var l,u,d,p=(l=new jt(n),u=A(),d=l||{},{getName:function(){return d.name},setName:function(e){u&&u.setName(e),d.name=e},getTraceId:function(){return d.traceId},setTraceId:function(e){u&&u.setTraceId(e),(0,yt.hX)(e)&&(d.traceId=e)},getSpanId:function(){return d.parentId},setSpanId:function(e){u&&u.setSpanId(e),(0,yt.wN)(e)&&(d.parentId=e)},getTraceFlags:function(){return d.traceFlags},setTraceFlags:function(e){u&&u.setTraceFlags(e),d.traceFlags=e}}),O=!(n||{}).eventContainExtFields;function b(){var t=e.session;if(t&&(0,s.Kg)(t.customId))return t.customId;c.update();var n=c.automaticSession;if(n){var r=n.getId();r&&(0,s.Kg)(r)&&(t.automaticId=r)}return t.automaticId}function A(){var e=p;return r&&r.getTraceCtx&&(e=r.getTraceCtx(!1)||p),e}e.getTraceCtx=function(){return p},e.getSessionId=b,e.applyApplicationContext=function(t){var n,r=e.app;tn(4,t,h,((n={})[0]=r.id,n[1]=r.ver,n[2]=r.name,n[3]=r.locale,n[4]=r.getExpId(),n[5]=r.env,n),O)},e.applyUserContext=function(t){var n,r=e.user;tn(0,t,f,((n={})[1]=r.getLocalId(),n[0]=r.locale,n[2]=r.id,n),O)},e.applyWebContext=function(t){var n,r=e.web;tn(3,t,g,((n={})[0]=r.domain,n[1]=r.browser,n[2]=r.browserVer,n[3]=r.screenRes,n[5]=r.getUserConsentDetails(),n[4]=r.getUserConsent(),n),O)},e.applyOsContext=function(t){var n,r=e.os;tn(5,t,m,((n={})[0]=r.name,n[1]=r.ver,n),O)},e.applySdkContext=function(e){var t;tn(6,e,_,((t={})[2]=i.installId,t[1]=i.getSequenceId(),t[3]=i.epoch,t),O)},e.applyIntWebContext=function(e){var t;tn(7,e,y,((t={})[0]=o.getMsfpc(),t[1]=o.getAnid(),t[2]=o.serviceName,t),O)},e.applyUtcContext=function(e){var t,n=((t={})[0]=a.popSample,t);a.eventFlags>0&&(n[1]=a.eventFlags),tn(8,e,v,n,O)},e.applyLocContext=function(t){var n;tn(9,t,S,((n={})[0]=e.loc.tz,n),O)},e.applySessionContext=function(e){var t;tn(4,e,C,((t={})[0]=b(),t),O)},e.applyDeviceContext=function(t){var n,r=e.device;tn(1,t,E,((n={})[0]=r.localId,n[2]=r.make,n[3]=r.model,n[1]=r.deviceClass,n),O)},e.applyCloudContext=function(t){var n,r=e.cloud;tn(10,t,T,((n={})[0]=r.role,n[1]=r.roleInstance,n[2]=r.roleVer,n),O)},e.applyAITraceContext=function(e){var t;if(n.enableApplicationInsightsTrace){var r=A();r&&tn(2,e,I,((t={})[0]=r.getTraceId(),t[1]=r.getName(),t[2]=r.getSpanId(),t),!1)}},e.applyDistributedTraceContext=function(e){var t,n=A();if(n){var r=((t={})[0]=n.getTraceId(),t[1]=n.getSpanId(),t),i=n.getTraceFlags();(0,s.hX)(i)||(r[2]=i),tn(11,e,P,r,!1)}}}))}return e.__ieDyn=1,e}();var rn=[p[4],p[0],p[3],p[5],p[6],p[7],p[8],p[9],p[1],p[2],p[11],p[10]],on=function(e){function t(){var n,r,a,c=e.call(this)||this;return c.identifier="SystemPropertiesCollector",c.priority=3,c.version="3.2.17",(0,i.A)(t,c,(function(e,t){function i(){n=null,r={}}i(),e.initialize=function(r,i,o){t.initialize(r,i,o),a=e._getTelCtx().getExtCfg(e.identifier),n=new nn(r,a,i),i&&i.setTraceCtx&&i.setTraceCtx(n.getTraceCtx())},e.processTelemetry=function(t,i){(0,o.u9)(t,e.identifier),i=e._getTelCtx(i);var c,l,u=t.ext=t.ext?t.ext:{};t.data=t.data?t.data:{},(0,s.Iu)(rn,(function(e){u[e]=u[e]||{}})),n&&(n.applyUtcContext(t),n.applyApplicationContext(t),n.applyUserContext(t),n.applyWebContext(t),n.applyOsContext(t),n.applySdkContext(t),n.applyIntWebContext(t),n.applyLocContext(t),n.applySessionContext(t),n.applyDeviceContext(t),a.enableApplicationInsightsTrace&&n.applyAITraceContext(t),a.enableDistributedTracing&&n.applyDistributedTraceContext(t),n.applyCloudContext(t)),(0,s.Iu)((0,s.cG)(u),(function(e){0===(0,s.cG)(u[e]).length&&delete u[e]})),c=r,l=t.data,c&&(0,s.z)(c,(function(e,t){l[e]||(l[e]=t)})),e.processNext(t,i)},e.getPropertiesContext=function(){return n},e.setProperty=function(e,t){r[e]=t},e._doTeardown=function(e,t){var r=(e||{}).core();if(r&&r.getTraceCtx&&n){var o=r.getTraceCtx(!1);o&&o===n.getTraceCtx()&&r.setTraceCtx(null)}i()}})),c}return(0,r.qU)(t,e),t.__ieDyn=1,t}(a.s),an="_dropInst";function sn(e,t){if(t)for(var n=(0,s.cG)(t),r=0;r<n.length;r++){var i=n[r];(0,s.mQ)(e,i)||(e[i]=t[i])}}function cn(e,t){var n=null;if(t){t.endpointUrl&&(n=t.endpointUrl);var r=(t.extensionConfig||{})[e]||{};r.overrideEndpointUrl&&(n=r.overrideEndpointUrl)}return n}var ln=function(e){function t(n,r){var o=e.call(this)||this;return(0,i.A)(t,o,(function(e,t){function i(e){var t=[];return e&&(0,s.Iu)(e,(function(e){e.iKey===n&&t.push(e)})),t}function o(t){if(e[t]&&e.listeners)for(var n=0;n<e.listeners.length;n++){var r=e.listeners[n];if(r&&r[t])return!0}return!1}var a={eventsSent:function(t){if(o("eventsSent")){var n=i(t);n.length>0&&e.eventsSent(n)}},eventsDiscarded:function(t,n){if(o("eventsDiscarded")){var r=i(t);r.length>0&&e.eventsDiscarded(r,n)}},eventsSendRequest:function(t,n){o("eventsSendRequest")&&e.eventsSendRequest(t,n)},perfEvent:function(t){o("perfEvent")&&e.perfEvent(t)}};r.addNotificationListener(a)})),o}return(0,r.qU)(t,e),t.__ieDyn=1,t}(ie.h),un=function(){function e(){var t,n,r,o,a,c,l,u,d,p,h,g,f,m,_=null,y=null;(0,i.A)(e,this,(function(e){function i(){t={},n=[],r=null,o=null,a=[],c=[],l={},u=null,d=null,p=null,h=null,g=null,f=null,m=!1}function v(e,n){if(void 0===n&&(n=null),e){var r=function(e){return e.pause&&e.teardown&&e.flush}(e)?c:a;r.push(e);var i=e.identifier;t.extensionConfig[i]=t.extensionConfig[i]||{},sn(t.extensionConfig[i],n)}return e}function S(i){if(!r){m||(0,oe.ZP)(e.diagLog(),2,520,"The Shared Manager is not yet created, the returned shared instance will be overwritten");var a=C(i||t.instrumentationKey||"_not_defined_",{});o=new ie.h,(r=new pn(e,e.diagLog(),o)).initialize(a,n),r.isInitialized()&&d&&(p=cn(d.identifier,a)),_&&r.setCookieMgr(_)}}function C(e,n){var r={};return r.instrumentationKey=e,r.channels=function(e){var n=[[]];t.channels&&(0,s.Iu)(t.channels,(function(e,t){(0,s.Tn)(e)||(n[t]=n[t]||[],n[t]=n[t].concat(e))}));e&&e.channels&&(0,s.Iu)(e.channels,(function(e,t){(0,s.Tn)(e)||(n[t]=n[t]||[],n[t]=n[t].concat(e))}));return n}(n),function(e){var n=[];t.extensions&&t.extensions.length>0&&(n=n.concat(t.extensions));e&&e.extensions&&e.extensions.length>0&&(n=n.concat(e.extensions));n.length>0&&(e.extensions=n);e.extensionConfig=e.extensionConfig||{},sn(e.extensionConfig,t.extensionConfig)}(r),sn(r,n),sn(r,t),r}i(),e.diagLog=function(){return h||(h=new oe.wq(t)),h},e.getCookieMgr=function(){return S(),_||r.getCookieMgr()},e.setCookieMgr=function(e){_=e,r&&r.setCookieMgr(e)},e.getPerfMgr=function(){return f||t&&t.enablePerfMgr&&(f=y||new ae.NS(e.getNotifyMgr())),f},e.setPerfMgr=function(e){y=e,f=e},e.create=function(i,o){var a,c,l,h;m?(0,oe.ZP)(e.diagLog(),2,514,"Shared Manager has already been initialized."):(r=null,a=(t=i||{}).channels||[[]],c=new _t,l=c.identifier,h=!1,d=null,p=null,(0,s.Iu)(a,(function(e){(0,s.Iu)(e,(function(e){(0,s.Tn)(e)||(v(e),e.identifier===l&&(h=!0,d=e))}))})),h||(a[0].push(c),d=v(c,t.channelConfiguration)),t.channels=a,function(e){n=[],u=v(new on,t.propertyConfiguration),n.push(u),t.extensions&&(0,s.Iu)(t.extensions,(function(e){(0,s.Tn)(e)||v(e)})),e&&(0,s.Iu)(e,(function(e){e&&!(0,s.Tn)(e)&&n.push(v(e))}))}(o),m=!0)},e.getInst=function(e){return(l[e]||{}).inst},e.newInst=function(t,i,a){var s=e.getInst(t);if(s)return(0,oe.ZP)(e.diagLog(),2,514,"Instance already exists for ["+t+"]"),s;if(S(t),r.isInitialized()){var c=C(t,i);if(d){var u=cn(d.identifier,c);p&&u&&p!==u&&(0,oe.ZP)(e.diagLog(),2,511,"The endpointUrl mismatch, shared Url ["+p+"] is different from configured ["+u+"] shared will be used!")}var h=new ln(t,o);s=new pn(e,e.diagLog(),h),l[t]={iKey:t,inst:s,notifyMgr:h},s.setPerfMgr(e.getPerfMgr()),s.initialize(c,function(e){var t=[];return n&&n.length>0&&(t=t.concat(n)),e&&e.length>0&&(t=t.concat(e)),t}(a)),s.isInitialized()||((0,oe.ZP)(e.diagLog(),2,520,"Failed to initialize new instance!"),s=null,delete l[t])}return s},e.getSharedPlugin=function(e){S();var t=null,n=r.getPlugin(e);return n&&(t=n.plugin),t},e.getPropertyManager=function(){return S(),u},e.getPostChannel=function(){return S(),d},e.getNotifyMgr=function(){return g||(g=new ie.h),g},e.unload=function(e,t,n){var o=(0,s.cG)(l),a=o.length+1,c={reason:50,isAsync:e,flushComplete:!1};function u(e,n){0===--a&&(i(),t&&t(n))}r&&((0,s.Iu)(o,(function(t){!function(e,t,n,r){var i=l[e];i&&(i.inst&&i.inst.isInitialized()?i.inst.unload(t,(function(t){n&&n(e,t)}),r):n&&n(e,{reason:50,isAsync:t,flushComplete:!1}))}(t,e,(function(e,t){u(0,t)}),n)})),r.isInitialized()&&(r.unload(e,(function(e){u(0,c=e)}),n),r=null)),u(0,c)},e[an]=function(e){e&&l.iKey&&delete l[e]}}))}return e.__ieDyn=1,e}(),dn=un,pn=function(e){function t(n,r,o){var a,s=e.call(this)||this,c=n;return(0,i.A)(t,s,(function(e,t){e.getSharedPropertyManager=function(){return c.getPropertyManager()},e.getSharedPostChannel=function(){return c.getPostChannel()},e.getOverridePropertyManager=function(){return a},e.initialize=function(n,i){(0,ae.r2)(e,(function(){return"ApplicationInsights:initialize"}),(function(){var s=[a=new re];i&&(s=s.concat(i)),n.extensionConfig=n.extensionConfig||[];var c=n.propertyConfiguration||{};n.propertyConfiguration&&delete n.propertyConfiguration,n.extensionConfig[a.identifier]=c;try{t.initialize(n,s,r,o)}catch(t){(0,oe.ZP)(e.logger,1,514,"Failed to initialize SDK."+(0,b.mm)(t))}}),(function(){return{config:n,extensions:i}}))},e.unload=function(n,r,i){c[an]&&c[an]((e.config||{}).instrumentationKey),t.unload(n,r,i)}})),s}return(0,r.qU)(t,e),t.__ieDyn=1,t}(se.A),hn=n(2353),gn=n(6586),fn=n(9844),mn=n(5391)},3296:function(e,t,n){"use strict";n.d(t,{Hj:function(){return i},oP:function(){return o}});var r=n(7895);function i(e){var t={};return(0,r.z)(e,(function(e,n){t[e]=n,t[n]=e})),(0,r.ol)(t)}function o(e){var t={};return(0,r.z)(e,(function(e,n){t[e]=n[1],t[n[0]]=n[1]})),(0,r.ol)(t)}},1628:function(e,t,n){"use strict";n.d(t,{x:function(){return r}});var r=(0,n(3296).Hj)({Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5})},5391:function(e,t,n){"use strict";n.d(t,{$:function(){return C},b:function(){return S}});var r,i=n(3296),o="Failed",a=o+"MonitorAjax",s="Track",c="Start",l="Stop",u="Event",d="AuthContext",p="Exception",h="Local",g="Session",f="Storage",m="Browser",_="Cannot",y="Buffer",v="InstrumentationKey",S=(0,i.Hj)({CRITICAL:1,WARNING:2}),C=(0,i.Hj)(((r={})[m+"DoesNotSupport"+h+f]=0,r[m+_+"Read"+h+f]=1,r[m+_+"Read"+g+f]=2,r[m+_+"Write"+h+f]=3,r[m+_+"Write"+g+f]=4,r[m+o+"RemovalFrom"+h+f]=5,r[m+o+"RemovalFrom"+g+f]=6,r[_+"SendEmptyTelemetry"]=7,r.ClientPerformanceMathError=8,r["ErrorParsingAI"+g+"Cookie"]=9,r.ErrorPVCalc=10,r[p+"WhileLoggingError"]=11,r[o+"AddingTelemetryTo"+y]=12,r[a+"Abort"]=13,r[a+"Dur"]=14,r[a+"Open"]=15,r[a+"RSC"]=16,r[a+"Send"]=17,r[a+"GetCorrelationHeader"]=18,r[o+"ToAddHandlerForOnBeforeUnload"]=19,r[o+"ToSendQueuedTelemetry"]=20,r[o+"ToReportDataLoss"]=21,r["Flush"+o]=22,r.MessageLimitPerPVExceeded=23,r.MissingRequiredFieldSpecification=24,r.NavigationTimingNotSupported=25,r.OnError=26,r[g+"RenewalDateIsZero"]=27,r.SenderNotInitialized=28,r[c+s+u+o]=29,r[l+s+u+o]=30,r[c+s+o]=31,r[l+s+o]=32,r.TelemetrySampledAndNotSent=33,r[s+u+o]=34,r[s+p+o]=35,r[s+"Metric"+o]=36,r[s+"PV"+o]=37,r[s+"PV"+o+"Calc"]=38,r[s+"Trace"+o]=39,r["Transmission"+o]=40,r[o+"ToSet"+f+y]=41,r[o+"ToRestore"+f+y]=42,r.InvalidBackendResponse=43,r[o+"ToFixDepricatedValues"]=44,r.InvalidDurationValue=45,r.TelemetryEnvelopeInvalid=46,r.CreateEnvelopeError=47,r[_+"SerializeObject"]=48,r[_+"SerializeObjectNonSerializable"]=49,r.CircularReferenceDetected=50,r["Clear"+d+o]=51,r[p+"Truncated"]=52,r.IllegalCharsInName=53,r.ItemNotInArray=54,r.MaxAjaxPerPVExceeded=55,r.MessageTruncated=56,r.NameTooLong=57,r.SampleRateOutOfRange=58,r["Set"+d+o]=59,r["Set"+d+o+"AccountName"]=60,r.StringValueTooLong=61,r.StartCalledMoreThanOnce=62,r.StopCalledWithoutStart=63,r["TelemetryInitializer"+o]=64,r.TrackArgumentsNotSpecified=65,r.UrlTooLong=66,r[g+f+y+"Full"]=67,r[_+"AccessCookie"]=68,r.IdTooLong=69,r.InvalidEvent=70,r[a+"SetRequestHeader"]=71,r["Send"+m+"InfoOnUserInit"]=72,r["Plugin"+p]=73,r["Notification"+p]=74,r.SnippetScriptLoadFailure=99,r["Invalid"+v]=100,r[_+"ParseAiBlobValue"]=101,r.InvalidContentBlob=102,r[s+"PageAction"+u+o]=103,r[o+"AddingCustomDefinedRequestContext"]=104,r["InMemory"+f+y+"Full"]=105,r[v+"Deprecation"]=106,r))},9844:function(e,t,n){"use strict";n.d(t,{T:function(){return r}});var r=100},2353:function(e,t,n){"use strict";n.d(t,{_:function(){return p}});var r=n(4661),i=n(3919),o=n(2980),a=n(699),s=n(3377),c=n(7895),l=n(6642),u=n(3394),d=n(5778),p=function(e){function t(){var n=e.call(this)||this;return(0,i.A)(t,n,(function(e,t){function n(t){var n=e[o.RF]();n&&n[l.Yp]([t],2)}e[o.mE]=function(e,n,r,i){t[o.mE](e,n,r||new s.wq(e),i||new u.h(e))},e.track=function(r){(0,d.r2)(e[l.kI](),(function(){return"AppInsightsCore:track"}),(function(){null===r&&(n(r),(0,c.$8)("Invalid telemetry item")),function(e){(0,c.hX)(e[o.RS])&&(n(e),(0,c.$8)("telemetry name required"))}(r),t.track(r)}),(function(){return{item:r}}),!r.sync)}})),n}return(0,r.qU)(t,e),t.__ieDyn=1,t}(a.F)},699:function(e,t,n){"use strict";n.d(t,{F:function(){return R}});var r=n(4661),i=n(3919),o=n(6570),a=n(2980),s=n(7895),c=n(6642),l=n(4963),u=n(9710),d=500,p="Channel has invalid priority - ";function h(e,t,n){t&&(0,s.cy)(t)&&t[a.oI]>0&&(t=t.sort((function(e,t){return e[c.Vo]-t[c.Vo]})),(0,s.Iu)(t,(function(e){e[c.Vo]<d&&(0,s.$8)(p+e[a.Ju])})),e[a.y5]({queue:(0,s.N6)(t),chain:(0,l.PV)(t,n[a.GA],n)}))}var g=n(8388),f=n(8106),m=n(4633),_=n(3377),y=n(5778),v=n(4111),S=n(7494),C=function(e){function t(){var n,r,o=e.call(this)||this;function l(){n=0,r=[]}return o.identifier="TelemetryInitializerPlugin",o.priority=199,l(),(0,i.A)(t,o,(function(e,t){e.addTelemetryInitializer=function(e){var t={id:n++,fn:e};return r[a.y5](t),{remove:function(){(0,s.Iu)(r,(function(e,n){if(e.id===t.id)return r[a.Ic](n,1),-1}))}}},e[c.qT]=function(t,n){for(var i=!1,o=r[a.oI],c=0;c<o;++c){var l=r[c];if(l)try{if(!1===l.fn[a.y9](null,[t])){i=!0;break}}catch(e){(0,_.ZP)(n[a.e4](),1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+(0,s.lL)(e),{exception:(0,S.mm)(e)},!0)}}i||e[a.$5](t,n)},e[a.tn]=function(){l()}})),o}return(0,r.qU)(t,e),t.__ieDyn=1,t}(v.s),E=n(2190),T="Plugins must provide initialize method",I="_notificationManager",P="SDK is still unloading...",O={loggingLevelConsole:1};function b(e,t){return new y.NS(t)}function A(e,t){var n=!1;return(0,s.Iu)(t,(function(t){if(t===e)return n=!0,-1})),n}var R=function(){function e(){var t,n,p,v,S,R,w,D,L,N,M,k,F,x,j,H,U,V,B,G,W=0,q=!1;(0,i.A)(e,this,(function(e){function i(n){if(!W&&!q&&(n||e[a.Uw]&&e[a.Uw].queue[a.oI]>0)){var r=(0,s.SA)(t.diagnosticLogInterval);r&&r>0||(r=1e4),W=setInterval((function(){clearInterval(W),W=0,X()}),r)}return W}function K(){n=!1,t=(0,s.CP)(!0,{},O),e[a.GA]=t,e[a.Uw]=new _.wq(t),e[a.H7]=[],j=new C,p=[],v=null,S=null,R=null,w=null,D=null,N=null,L=[],M=null,k=null,F=null,x=!1,H=null,U=(0,f.Z)("AIBaseCore",!0),V=(0,E.P)(),G=null}function J(){var n=(0,l.i8)(Y(),t,e);return n[a.by](i),n}function z(n){var r=function(e,t,n){var r,i=[],o={};return(0,s.Iu)(n,(function(n){((0,s.hX)(n)||(0,s.hX)(n[a.mE]))&&(0,s.$8)(T);var r=n[c.Vo],l=n[a.Ju];n&&r&&((0,s.hX)(o[r])?o[r]=l:(0,_.OG)(e,"Two extensions have same priority #"+r+" - "+o[r]+", "+l)),(!r||r<t)&&i[a.y5](n)})),(r={all:n})[c.eT]=i,r}(e[a.Uw],d,L);N=r[c.eT],D=null;var o=r.all;if(F=(0,s.N6)(function(e,t,n){var r=[];if(e&&(0,s.Iu)(e,(function(e){return h(r,e,n)})),t){var i=[];(0,s.Iu)(t,(function(e){e[c.Vo]>d&&i[a.y5](e)})),h(r,i,n)}return r}(k,o,e)),M){var p=(0,s.rD)(o,M);-1!==p&&o[a.Ic](p,1),-1!==(p=(0,s.rD)(N,M))&&N[a.Ic](p,1),M._setQueue(F)}else M=function(e,t){function n(){return(0,l.i8)(null,t[a.GA],t,null)}function r(e,t,n,r){var i=e?e[a.oI]+1:1;function o(){0==--i&&(r&&r(),r=null)}i>0&&(0,s.Iu)(e,(function(e){if(e&&e.queue[a.oI]>0){var r=e.chain,s=t[a.$o](r);s[a.by](o),n(s)}else i--})),o()}var i=!1,o={identifier:"ChannelControllerPlugin",priority:d,initialize:function(t,n,r,o){i=!0,(0,s.Iu)(e,(function(e){e&&e.queue[a.oI]>0&&(0,u.pI)((0,l.i8)(e.chain,t,n),r)}))},isInitialized:function(){return i},processTelemetry:function(t,i){r(e,i||n(),(function(e){e[a.$5](t)}),(function(){i[a.$5](t)}))},update:function(t,n){var i=n||{reason:0};return r(e,t,(function(e){e[a.$5](i)}),(function(){t[a.$5](i)})),!0},pause:function(){r(e,n(),(function(e){e.iterate((function(e){e.pause&&e.pause()}))}),null)},resume:function(){r(e,n(),(function(e){e.iterate((function(e){e.resume&&e.resume()}))}),null)},teardown:function(t,n){var o=n||{reason:0,isAsync:!1};return r(e,t,(function(e){e[a.$5](o)}),(function(){t[a.$5](o),i=!1})),!0},getChannel:function(t){var n=null;return e&&e[a.oI]>0&&(0,s.Iu)(e,(function(e){if(e&&e.queue[a.oI]>0&&((0,s.Iu)(e.queue,(function(e){if(e[a.Ju]===t)return n=e,-1})),n))return-1})),n},flush:function(t,i,o,s){var c=1,l=!1,u=null;function d(){c--,l&&0===c&&(u&&(clearTimeout(u),u=null),i&&i(l),i=null)}return s=s||5e3,r(e,n(),(function(e){e.iterate((function(e){if(e[a.EX]){c++;var n=!1;e[a.EX](t,(function(){n=!0,d()}),o)||n||(t&&null==u?u=setTimeout((function(){u=null,d()}),s):d())}}))}),(function(){l=!0,d()})),!0},_setQueue:function(t){e=t}};return o}(F,e);o[a.y5](M),N[a.y5](M),e[a.H7]=(0,u.Xc)(o),M[a.mE](t,e,o);var g=J();(0,u.pI)(g,o),e[a.H7]=(0,s.N6)((0,u.Xc)(N||[])).slice(),n&&function(t){var n=(0,l.nU)(Y(),e);n[a.by](i),e._updateHook&&!0===e._updateHook(n,t)||n[a.$5](t)}(n)}function Q(t){var n,r=null,i=null;return(0,s.Iu)(e[a.H7],(function(e){if(e[a.Ju]===t&&e!==M&&e!==j)return i=e,-1})),!i&&M&&(i=M.getChannel(t)),i&&((n={plugin:i})[a.kt]=function(e){(0,u.Cr)(i)[c.Hr]=!e},n.isEnabled=function(){var e=(0,u.Cr)(i);return!e[a.Ik]&&!e[c.Hr]},n.remove=function(e,t){var n;void 0===e&&(e=!0);var r=[i],o=((n={reason:1})[a.tI]=e,n);Z(r,o,(function(e){e&&z({reason:32,removed:r}),t&&t(e)}))},r=n),r}function Y(){if(!D){var n=(N||[]).slice();-1===(0,s.rD)(n,j)&&n[a.y5](j),D=(0,l.PV)((0,u.Xc)(n),t,e)}return D}function Z(n,r,o){if(n&&n[a.oI]>0){var c=(0,l.PV)(n,t,e),u=(0,l.tS)(c,e);u[a.by]((function(){var e=!1,t=[];(0,s.Iu)(L,(function(r,i){A(r,n)?e=!0:t[a.y5](r)})),L=t;var r=[];k&&((0,s.Iu)(k,(function(t,i){var o=[];(0,s.Iu)(t,(function(t){A(t,n)?e=!0:o[a.y5](t)})),r[a.y5](o)})),k=r),o&&o(e),i()})),u[a.$5](r)}else o(!1)}function X(){if(e[a.Uw]&&e[a.Uw].queue){var n=e[a.Uw].queue.slice(0);e[a.Uw].queue[a.oI]=0,(0,s.Iu)(n,(function(n){var r,i=((r={})[a.RS]=H||"InternalMessageId: "+n[a.JR],r.iKey=(0,s.SA)(t[a.sl]),r.time=(0,s._u)(new Date),r.baseType=_.WD.dataType,r.baseData={message:n[a.pM]},r);e.track(i)}))}}function $(e,t,n,r){return M?M[a.EX](e,t,n||6,r):(t&&t(!1),!0)}function ee(t){var n=e[a.Uw];n?((0,_.ZP)(n,2,73,t),i()):(0,s.$8)(t)}K(),e[a.tZ]=function(){return n},e[a.mE]=function(i,o,l,u){x&&(0,s.$8)(P),e[a.tZ]()&&(0,s.$8)("Core should not be initialized more than once"),t=i||{},e[a.GA]=t,(0,s.hX)(i[a.sl])&&(0,s.$8)("Please provide instrumentation key"),v=u,e[I]=u,function(){var e=(0,s.SA)(t.disableDbgExt);!0===e&&B&&(v[a.TP](B),B=null);v&&!B&&!0!==e&&(B=(0,m.M)(t),v[a.vR](B))}(),function(){var e=(0,s.SA)(t.enablePerfMgr);!e&&R&&(R=null);e&&(0,s.c2)(t,c.Yd,b)}(),(0,s.c2)(t,c.Bw,{}).NotificationManager=v,l&&(e[a.Uw]=l);var d=(0,s.c2)(t,c.jy,[]);(L=[])[a.y5].apply(L,(0,r.vz)((0,r.vz)([],o,!1),d,!1)),k=(0,s.c2)(t,c.LZ,[]),z(null),F&&0!==F[a.oI]||(0,s.$8)("No "+c.LZ+" available"),n=!0,e.releaseQueue()},e.getTransmissionControls=function(){var e=[];return F&&(0,s.Iu)(F,(function(t){e[a.y5](t.queue)})),(0,s.N6)(e)},e.track=function(n){n.iKey=n.iKey||t[a.sl],n[a.fA]=n[a.fA]||(0,s._u)(new Date),n.ver=n.ver||"4.0",!x&&e[a.tZ]()?J()[a.$5](n):p[a.y5](n)},e[a.ps]=J,e[a.RF]=function(){var t;return v||(v=(0,o.AQ)(((t={})[a.vR]=function(e){},t[a.TP]=function(e){},t[c.fc]=function(e){},t[c.Yp]=function(e,t){},t[c.dI]=function(e,t){},t)),e[I]=v),v},e[a.vR]=function(e){v&&v[a.vR](e)},e[a.TP]=function(e){v&&v[a.TP](e)},e.getCookieMgr=function(){return w||(w=(0,g.xN)(t,e[a.Uw])),w},e.setCookieMgr=function(e){w=e},e[c.kI]=function(){if(!S&&!R&&(0,s.SA)(t.enablePerfMgr)){var n=(0,s.SA)(t[c.Yd]);(0,s.Tn)(n)&&(R=n(e,e[a.RF]()))}return S||R||(0,y.Z4)()},e.setPerfMgr=function(e){S=e},e.eventCnt=function(){return p[a.oI]},e.releaseQueue=function(){if(n&&p[a.oI]>0){var e=p;p=[],(0,s.Iu)(e,(function(e){J()[a.$5](e)}))}},e.pollInternalLogs=function(e){return H=e||null,q=!1,W&&(clearInterval(W),W=null),i(!0)},e[a.Di]=function(){q=!0,W&&(clearInterval(W),W=0,X())},(0,s.o$)(e,(function(){return j}),["addTelemetryInitializer"]),e.unload=function(t,r,i){var o;void 0===t&&(t=!0),n||(0,s.$8)("SDK is not initialized"),x&&(0,s.$8)(P);var c=((o={reason:50})[a.tI]=t,o.flushComplete=!1,o),u=(0,l.tS)(Y(),e);function d(t){c.flushComplete=t,x=!0,V.run(u,c),e[a.Di](),u[a.$5](c)}u[a.by]((function(){K(),r&&r(c)}),e),X(),$(t,d,6,i)||d(!1)},e[a.AP]=Q,e.addPlugin=function(e,t,n,r){if(!e)return r&&r(!1),void ee(T);var i=Q(e[a.Ju]);if(i&&!t)return r&&r(!1),void ee("Plugin ["+e[a.Ju]+"] is already loaded!");var o={reason:16};function s(t){L[a.y5](e),o.added=[e],z(o),r&&r(!0)}if(i){var c=[i.plugin];Z(c,{reason:2,isAsync:!!n},(function(e){e?(o.removed=c,o.reason|=32,s()):r&&r(!1)}))}else s()},e.evtNamespace=function(){return U},e[a.EX]=$,e.getTraceCtx=function(e){return G||(G=(0,u.u7)()),G},e.setTraceCtx=function(e){G=e||null},(0,s.RF)(e,"addUnloadCb",(function(){return V}),"add")}))}return e.__ieDyn=1,e}()},4111:function(e,t,n){"use strict";n.d(t,{s:function(){return u}});var r=n(3919),i=n(2980),o=n(7895),a=n(6642),s=n(4963),c=n(2190),l="getPlugin",u=function(){function e(){var t,n,u,d,p,h=this;function g(e){void 0===e&&(e=null);var t=e;if(!t){var r=n||(0,s.i8)(null,{},h[a.eT]);t=u&&u[l]?r[i.$o](null,u[l]):r[i.$o](null,u)}return t}function f(e,t,r){e&&(0,o.KY)(e,a.Bw,[],null,o.hX),!r&&t&&(r=t[i.ps]()[i.uR]());var c=u;u&&u[l]&&(c=u[l]()),h[a.eT]=t,n=(0,s.i8)(r,e,t,c)}function m(){t=!1,h[a.eT]=null,n=null,u=null,p=[],d=(0,c.P)()}m(),(0,r.A)(e,h,(function(e){e[i.mE]=function(e,n,r,i){f(e,n,i),t=!0},e[i.Ik]=function(t,n){var r,c=e[a.eT];if(c&&(!t||c===t[a.eT]())){var h,g=!1,f=t||(0,s.tS)(null,c,u&&u[l]?u[l]():u),_=n||((r={reason:0})[i.tI]=!1,r);return e[i.tn]&&!0===e[i.tn](f,_,y)?h=!0:y(),h}function y(){if(!g){g=!0,d.run(f,n);var e=p;p=[],(0,o.Iu)(e,(function(e){e.rm()})),!0===h&&f[i.$5](_),m()}}},e[i.HC]=function(t,n){var r=e[a.eT];if(r&&(!t||r===t[a.eT]())){var o,c=!1,d=t||(0,s.nU)(null,r,u&&u[l]?u[l]():u),p=n||{reason:0};return e._doUpdate&&!0===e._doUpdate(d,p,h)?o=!0:h(),o}function h(){c||(c=!0,f(d.getCfg(),d.core(),d[i.uR]()))}},e._addHook=function(e){e&&((0,o.cy)(e)?p=p.concat(e):p[i.y5](e))},(0,o.RF)(e,"_addUnloadCb",(function(){return d}),"add")})),h[i.e4]=function(e){return g(e)[i.e4]()},h[i.tZ]=function(){return t},h.setInitialized=function(e){t=e},h[i.YH]=function(e){u=e},h[i.$5]=function(e,t){t?t[i.$5](e):u&&(0,o.Tn)(u[a.qT])&&u[a.qT](e,null)},h._getTelCtx=g}return e.__ieDyn=1,e}()},8388:function(e,t,n){"use strict";n.d(t,{It:function(){return N},d5:function(){return E},gi:function(){return b},um:function(){return P},xN:function(){return O}});var r=n(2980),i=n(3377),o=n(7494),a=n(7895),s=n(6642),c="toGMTString",l="toUTCString",u="cookie",d="expires",p="enabled",h="isCookieUseDisabled",g="disableCookiesUsage",f="_ckMgr",m=null,_=null,y=null,v=(0,o.YE)(),S={},C={};function E(e,t){var n=O[f]||C[f];return n||(n=O[f]=O(e,t),C[f]=n),n}function T(e){return!e||e.isEnabled()}function I(e,t){return!!(t&&e&&(0,a.cy)(e.ignoreCookies))&&-1!==e.ignoreCookies[r.Sj](t)}function P(e,t){var n;if(e)n=e.getCookieMgr();else if(t){var i=t[r.lK];n=i[f]?i[f]:O(t)}return n||(n=E(t,(e||{})[r.Uw])),n}function O(e,t){var n,i=function(e){var t=e[r.lK]=e[r.lK]||{};if((0,a.KY)(t,"domain",e.cookieDomain,a.Gh,a.hX),(0,a.KY)(t,"path",e.cookiePath||"/",null,a.hX),(0,a.hX)(t[p])){var n=void 0;(0,a.b0)(e[h])||(n=!e[h]),(0,a.b0)(e[g])||(n=!e[g]),t[p]=n}return t}(e||C),u=i.path||"/",m=i.domain,y=!1!==i[p],v=((n={isEnabled:function(){var e=y&&b(t),n=C[f];return e&&n&&v!==n&&(e=T(n)),e}})[r.kt]=function(e){y=!1!==e},n.set=function(e,t,n,p,h){var g=!1;if(T(v)&&!function(e,t){return!!(t&&e&&(0,a.cy)(e.blockedCookies)&&-1!==e.blockedCookies[r.Sj](t))||I(e,t)}(i,e)){var f={},y=(0,a.EH)(t||s.m5),S=y[r.Sj](";");if(-1!==S&&(y=(0,a.EH)(t[r.Re](0,S)),f=A(t[r.Re](S+1))),(0,a.KY)(f,"domain",p||m,a.zz,a.b0),!(0,a.hX)(n)){var C=(0,o.lT)();if((0,a.b0)(f[d])){var E=(0,a.x3)()+1e3*n;if(E>0){var P=new Date;P.setTime(E),(0,a.KY)(f,d,R(P,C?c:l)||R(P,C?c:l)||s.m5,a.zz)}}C||(0,a.KY)(f,"max-age",s.m5+n,null,a.b0)}var O=(0,o.g$)();O&&"https:"===O.protocol&&((0,a.KY)(f,"secure",null,null,a.b0),null===_&&(_=!N(((0,o.w3)()||{})[r.tX])),_&&(0,a.KY)(f,"SameSite","None",null,a.b0)),(0,a.KY)(f,"path",h||u,null,a.b0),(i.setCookie||L)(e,w(y,f)),g=!0}return g},n.get=function(e){var t=s.m5;return T(v)&&!I(i,e)&&(t=(i.getCookie||D)(e)),t},n.del=function(e,t){var n=!1;return T(v)&&(n=v.purge(e,t)),n},n.purge=function(e,n){var r,a=!1;if(b(t)){var c=((r={}).path=n||"/",r[d]="Thu, 01 Jan 1970 00:00:01 GMT",r);(0,o.lT)()||(c["max-age"]="0"),(i.delCookie||L)(e,w(s.m5,c)),a=!0}return a},n);return v[f]=v,v}function b(e){if(null===m){m=!1;try{m=void 0!==(v||{})[u]}catch(t){(0,i.ZP)(e,2,68,"Cannot access document.cookie - "+(0,a.lL)(t),{exception:(0,o.mm)(t)})}}return m}function A(e){var t={};if(e&&e[r.oI]){var n=(0,a.EH)(e)[r.sY](";");(0,a.Iu)(n,(function(e){if(e=(0,a.EH)(e||s.m5)){var n=e[r.Sj]("=");-1===n?t[e]=null:t[(0,a.EH)(e[r.Re](0,n))]=(0,a.EH)(e[r.Re](n+1))}}))}return t}function R(e,t){return(0,a.Tn)(e[t])?e[t]():null}function w(e,t){var n=e||s.m5;return(0,a.z)(t,(function(e,t){n+="; "+e+((0,a.hX)(t)?s.m5:"="+t)})),n}function D(e){var t=s.m5;if(v){var n=v[u]||s.m5;y!==n&&(S=A(n),y=n),t=(0,a.EH)(S[e]||s.m5)}return t}function L(e,t){v&&(v[u]=e+"="+t)}function N(e){return!!(0,a.Kg)(e)&&(!(!(0,a.Ju)(e,"CPU iPhone OS 12")&&!(0,a.Ju)(e,"iPad; CPU OS 12"))||(!!((0,a.Ju)(e,"Macintosh; Intel Mac OS X 10_14")&&(0,a.Ju)(e,"Version/")&&(0,a.Ju)(e,"Safari"))||(!(!(0,a.Ju)(e,"Macintosh; Intel Mac OS X 10_14")||!(0,a.Cv)(e,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))||(!(!(0,a.Ju)(e,"Chrome/5")&&!(0,a.Ju)(e,"Chrome/6"))||(!(!(0,a.Ju)(e,"UnrealEngine")||(0,a.Ju)(e,"Chrome"))||!(!(0,a.Ju)(e,"UCBrowser/12")&&!(0,a.Ju)(e,"UCBrowser/11")))))))}},5372:function(e,t,n){"use strict";n.d(t,{UU:function(){return g},aq:function(){return h},cL:function(){return f},fs:function(){return _}});var r,i=n(6570),o=n(2980),a=n(8388),s=n(7494),c=n(6611),l=n(7895),u=n(6642),d=n(9021),p=null;function h(){var e=f();return e[o.Re](0,8)+"-"+e[o.Re](8,12)+"-"+e[o.Re](12,16)+"-"+e[o.Re](16,20)+"-"+e[o.Re](20)}function g(){var e=(0,s.FJ)();return e&&e.now?e.now():(0,l.x3)()}function f(){for(var e,t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=u.m5,r=0;r<4;r++)n+=t[15&(e=(0,d.VN)())]+t[e>>4&15]+t[e>>8&15]+t[e>>12&15]+t[e>>16&15]+t[e>>20&15]+t[e>>24&15]+t[e>>28&15];var i=t[8+(3&(0,d.VN)())|0];return n[o.$4](0,8)+n[o.$4](9,4)+"4"+n[o.$4](13,3)+i+n[o.$4](16,3)+n[o.$4](19,12)}var m={_canUseCookies:void 0,isTypeof:l.Ed,isUndefined:l.b0,isNullOrUndefined:l.hX,hasOwnProperty:l.mQ,isFunction:l.Tn,isObject:l.Gv,isDate:l.$P,isArray:l.cy,isError:l.bJ,isString:l.Kg,isNumber:l.Et,isBoolean:l.Lm,toISOString:l._u,arrForEach:l.Iu,arrIndexOf:l.rD,arrMap:l.W$,arrReduce:l.KT,strTrim:l.EH,objCreate:i.AQ,objKeys:l.cG,objDefineAccessors:l.r,addEventHandler:c.So,dateNow:l.x3,isIE:s.lT,disableCookies:function(){y()[o.kt](!1)},newGuid:h,perfNow:g,newId:d.Si,randomValue:d.Z1,random32:d.VN,mwcRandomSeed:d.yc,mwcRandom32:d.k5,generateW3CId:f},_={Attach:c.Q3,AttachEvent:c.Q3,Detach:c.Ym,DetachEvent:c.Ym};function y(e,t){var n=(0,a.d5)(e,t),i=m._canUseCookies;return null===p&&(p=[],r=i,(0,l.r)(m,"_canUseCookies",(function(){return r}),(function(e){r=e,(0,l.Iu)(p,(function(t){t[o.kt](e)}))}))),-1===(0,l.rD)(p,n)&&p[o.y5](n),(0,l.Lm)(i)&&n[o.kt](i),(0,l.Lm)(r)&&n[o.kt](r),n}},8106:function(e,t,n){"use strict";n.d(t,{T:function(){return f},Z:function(){return g}});var r=n(9166),i=n(2980),o=n(7895),a=n(6642),s=n(9021),c=r.KU,l="2.8.18",u="."+(0,s.Si)(6),d=0;function p(e){return 1===e[i.re]||9===e[i.re]||!+e[i.re]}function h(e,t){var n=t[e.id];if(!n){n={};try{p(t)&&(function(e,t,n){if(c)try{return c(e,t,{value:n,enumerable:!1,configurable:!0}),!0}catch(e){}return!1}(t,e.id,n)||(t[e.id]=n))}catch(e){}}return n}function g(e,t){return void 0===t&&(t=!1),(0,o.cH)(e+d+++(t?"."+l:a.m5)+u)}function f(e){var t={id:g("_aiData-"+(e||a.m5)+"."+l),accept:function(e){return p(e)},get:function(e,n,r,i){var a=e[t.id];return a?a[(0,o.cH)(n)]:(i&&((a=h(t,e))[(0,o.cH)(n)]=r),r)},kill:function(e,t){if(e&&e[t])try{delete e[t]}catch(e){}}};return t}},4633:function(e,t,n){"use strict";n.d(t,{$:function(){return l},M:function(){return u}});var r,i=n(2980),o=n(7494),a=["eventsSent","eventsDiscarded","eventsSendRequest","perfEvent"],s=null;function c(e,t){return function(){var n=arguments,r=l(t);if(r){var o=r.listener;o&&o[e]&&o[e][i.y9](o,n)}}}function l(e){var t,n=s;return n||!0===e.disableDbgExt||(n=s||((t=(0,o.EH)("Microsoft"))&&(s=t.ApplicationInsights),s)),n?n.ChromeDbgExt:null}function u(e){if(!r){r={};for(var t=0;t<a[i.oI];t++)r[a[t]]=c(a[t],e)}return r}},3377:function(e,t,n){"use strict";n.d(t,{OG:function(){return m},Oc:function(){return _},WD:function(){return d},ZP:function(){return f},wq:function(){return h},y0:function(){return p}});var r=n(3919),i=n(2980),o=n(4633),a=n(7494),s=n(7895),c=n(6642);function l(e){return e?'"'+e[i.W7](/\"/g,c.m5)+'"':c.m5}function u(e,t){var n=(0,a.U5)();if(n){var r="log";n[e]&&(r=e),(0,s.Tn)(n[r])&&n[r](t)}}var d=function(){function e(e,t,n,r){void 0===n&&(n=!1);var o=this;o[i.JR]=e,o[i.pM]=(n?"AI: ":"AI (Internal): ")+e;var s=c.m5;(0,a.Z)()&&(s=(0,a.hm)().stringify(r));var u=(t?" message:"+l(t):c.m5)+(r?" props:"+l(s):c.m5);o[i.pM]+=u}return e.dataType="MessageData",e}();function p(e,t){return(e||{})[i.Uw]||new h(t)}var h=function(){function e(t){this.identifier="DiagnosticLogger",this.queue=[];var n,l,p,h,g=0,f={};(0,r.A)(e,this,(function(e){function r(t,n){if(!(g>=p)){var r=!0,o="AITR_"+n[i.JR];if(f[o]?r=!1:f[o]=!0,r&&(t<=l&&(e.queue[i.y5](n),g++,m(1===t?"error":"warn",n)),g===p)){var a="Internal events throttle limit per PageView reached for this app.",s=new d(23,a,!1);e.queue[i.y5](s),1===t?e[c.Zi](a):e[c.Tj](a)}}}function m(e,n){var r=(0,o.$)(t||{});r&&r[i.e4]&&r[i.e4](e,n)}!function(e){n=(0,s.SA)(e.loggingLevelConsole,0),l=(0,s.SA)(e.loggingLevelTelemetry,1),p=(0,s.SA)(e.maxMessageLimit,25),h=(0,s.SA)(e.enableDebug,(0,s.SA)(e[i.a$],!1))}(t||{}),e.consoleLoggingLevel=function(){return n},e.telemetryLoggingLevel=function(){return l},e.maxInternalMessageLimit=function(){return p},e[i.a$]=function(){return h},e.throwInternal=function(t,o,l,u,p){void 0===p&&(p=!1);var g=new d(o,l,p,u);if(h)throw(0,a.mm)(g);var _=1===t?c.Zi:c.Tj;if((0,s.b0)(g[i.pM]))m("throw"+(1===t?"Critical":"Warning"),g);else{if(p){var y=+g[i.JR];!f[y]&&n>=t&&(e[_](g[i.pM]),f[y]=!0)}else n>=t&&e[_](g[i.pM]);r(t,g)}},e[c.Tj]=function(e){u("warn",e),m("warning",e)},e[c.Zi]=function(e){u("error",e),m("error",e)},e.resetInternalMessageCount=function(){g=0,f={}},e[i.sx]=r}))}return e.__ieDyn=1,e}();function g(e){return e||new h}function f(e,t,n,r,i,o){void 0===o&&(o=!1),g(e).throwInternal(t,n,r,i,o)}function m(e,t){g(e)[c.Tj](t)}function _(e,t,n){g(e)[i.sx](t,n)}},7494:function(e,t,n){"use strict";n.d(t,{$Z:function(){return te},EH:function(){return w},FJ:function(){return V},Iu:function(){return ne},JK:function(){return j},L0:function(){return z},MY:function(){return W},PV:function(){return X},R7:function(){return Z},U5:function(){return U},Uf:function(){return Y},Vd:function(){return D},Wt:function(){return N},YE:function(){return M},Z:function(){return B},cU:function(){return R},g$:function(){return H},hm:function(){return G},iN:function(){return q},lT:function(){return J},lV:function(){return K},mm:function(){return Q},tw:function(){return x},w3:function(){return F},w9:function(){return k},xk:function(){return $},zk:function(){return L}});var r=n(9166),i=n(6570),o=n(2980),a=n(7895),s=n(6642),c="window",l="document",u="documentMode",d="navigator",p="history",h="location",g="console",f="performance",m="JSON",_="crypto",y="msCrypto",v="ReactNative",S="msie",C="trident/",E="XMLHttpRequest",T=null,I=null,P=!1,O=null,b=null;function A(e,t){var n=!1;if(e){try{if(!(n=t in e)){var i=e[r.vR];i&&(n=t in i)}}catch(e){}if(!n)try{var o=new e;n=!(0,a.b0)(o[t])}catch(e){}}return n}function R(e){P=e}function w(e){var t=(0,i.mS)();return t&&t[e]?t[e]:e===c&&D()?window:null}function D(){return Boolean(typeof window===r._1&&window)}function L(){return D()?window:w(c)}function N(){return Boolean(typeof document===r._1&&document)}function M(){return N()?document:w(l)}function k(){return Boolean(typeof navigator===r._1&&navigator)}function F(){return k()?navigator:w(d)}function x(){return Boolean(typeof history===r._1&&history)}function j(){return x()?history:w(p)}function H(e){if(e&&P){var t=w("__mockLocation");if(t)return t}return typeof location===r._1&&location?location:w(h)}function U(){return typeof console!==r.bA?console:w(g)}function V(){return w(f)}function B(){return Boolean(typeof JSON===r._1&&JSON||null!==w(m))}function G(){return B()?JSON||w(m):null}function W(){return w(_)}function q(){return w(y)}function K(){var e=F();return!(!e||!e.product)&&e.product===v}function J(){var e=F();if(e&&(e[o.tX]!==I||null===T)){var t=((I=e[o.tX])||s.m5)[o.OL]();T=(0,a.Ju)(t,S)||(0,a.Ju)(t,C)}return T}function z(e){if(void 0===e&&(e=null),!e){var t=F()||{};e=t?(t[o.tX]||s.m5)[o.OL]():s.m5}var n=(e||s.m5)[o.OL]();if((0,a.Ju)(n,S)){var r=M()||{};return Math.max(parseInt(n[o.sY](S)[1]),r[u]||0)}if((0,a.Ju)(n,C)){var i=parseInt(n[o.sY](C)[1]);if(i)return i+4}return null}function Q(e){var t=Object[r.vR].toString[o.Ek](e),n=s.m5;return"[object Error]"===t?n="{ stack: '"+e.stack+"', message: '"+e.message+"', name: '"+e[o.RS]+"'":B()&&(n=G().stringify(e)),t+n}function Y(){return null===b&&(b=k()&&Boolean(F().sendBeacon)),b}function Z(e){var t=!1;try{t=!!w("fetch");var n=w("Request");t&&e&&n&&(t=A(n,"keepalive"))}catch(e){}return t}function X(){return null===O&&(O=typeof XDomainRequest!==r.bA)&&$()&&(O=O&&!A(w(E),"withCredentials")),O}function $(){var e=!1;try{e=!!w(E)}catch(e){}return e}function ee(e,t){if(e)for(var n=0;n<e[o.oI];n++){var r=e[n];if(r[o.RS]&&r[o.RS]===t)return r}return{}}function te(e){var t=M();return t&&e?ee(t.querySelectorAll("meta"),e).content:null}function ne(e){var t,n=V();if(n){var r=n.getEntriesByType("navigation")||[];t=ee((r[o.oI]>0?r[0]:{}).serverTiming,e).description}return t}},6611:function(e,t,n){"use strict";n.d(t,{Ds:function(){return G},El:function(){return A},Fc:function(){return W},Hm:function(){return L},ML:function(){return M},Q3:function(){return k},So:function(){return x},Wg:function(){return V},Ym:function(){return F},ee:function(){return B},lQ:function(){return U},mB:function(){return N},oS:function(){return K},sq:function(){return q},vF:function(){return J},zh:function(){return j}});var r=n(2980),i=n(8106),o=n(7494),a=n(7895),s=n(6642),c="on",l="attachEvent",u="addEventListener",d="detachEvent",p="removeEventListener",h="events",g="visibilitychange",f="pagehide",m="pageshow",_="unload",y="beforeunload",v=(0,i.Z)("aiEvtPageHide"),S=(0,i.Z)("aiEvtPageShow"),C=/\.[\.]+/g,E=/[\.]+$/,T=1,I=(0,i.T)("events"),P=/^([^.]*)(?:\.(.+)|)/;function O(e){return e&&e[r.W7]?e[r.W7](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,s.m5):e}function b(e,t){var n;if(t){var i=s.m5;(0,a.cy)(t)?(i=s.m5,(0,a.Iu)(t,(function(e){(e=O(e))&&("."!==e[0]&&(e="."+e),i+=e)}))):i=O(t),i&&("."!==i[0]&&(i="."+i),e=(e||s.m5)+i)}var o=P.exec(e||s.m5)||[];return(n={})[r.QM]=o[1],n.ns=(o[2]||s.m5).replace(C,".").replace(E,s.m5)[r.sY](".").sort().join("."),n}function A(e,t,n){var i=[],o=I.get(e,h,{},!1),c=b(t,n);return(0,a.z)(o,(function(e,t){(0,a.Iu)(t,(function(e){var t;c[r.QM]&&c[r.QM]!==e.evtName[r.QM]||c.ns&&c.ns!=c.ns||i[r.y5](((t={})[r.RS]=e.evtName[r.QM]+(e.evtName.ns?"."+e.evtName.ns:s.m5),t.handler=e[r.Yo],t))}))})),i}function R(e,t,n){void 0===n&&(n=!0);var r=I.get(e,h,{},n),i=r[t];return i||(i=r[t]=[]),i}function w(e,t,n,i){e&&t&&t[r.QM]&&(e[p]?e[p](t[r.QM],n,i):e[d]&&e[d](c+t[r.QM],n))}function D(e,t,n,i){for(var o=t[r.oI];o--;){var a=t[o];a&&(n.ns&&n.ns!==a.evtName.ns||i&&!i(a)||(w(e,a.evtName,a[r.Yo],a.capture),t[r.Ic](o,1)))}}function L(e,t){return t?b("xx",(0,a.cy)(t)?[e].concat(t):[e,t]).ns[r.sY]("."):e}function N(e,t,n,i,o){var a;void 0===o&&(o=!1);var s=!1;if(e)try{var d=b(t,i);if(s=function(e,t,n,i){var o=!1;return e&&t&&t[r.QM]&&n&&(e[u]?(e[u](t[r.QM],n,i),o=!0):e[l]&&(e[l](c+t[r.QM],n),o=!0)),o}(e,d,n,o),s&&I.accept(e)){var p=((a={guid:T++,evtName:d})[r.Yo]=n,a.capture=o,a);R(e,d.type)[r.y5](p)}}catch(e){}return s}function M(e,t,n,i,o){if(void 0===o&&(o=!1),e)try{var s=b(t,i),c=!1;!function(e,t,n){if(t[r.QM])D(e,R(e,t[r.QM]),t,n);else{var i=I.get(e,h,{});(0,a.z)(i,(function(r,i){D(e,i,t,n)})),0===(0,a.cG)(i)[r.oI]&&I.kill(e,h)}}(e,s,(function(e){return!((!s.ns||n)&&e[r.Yo]!==n)&&(c=!0,!0)})),c||w(e,s,n,o)}catch(e){}}function k(e,t,n,r){return void 0===r&&(r=!1),N(e,t,n,null,r)}function F(e,t,n,r){void 0===r&&(r=!1),M(e,t,n,null,r)}function x(e,t,n){var r=!1,i=(0,o.zk)();i&&(r=N(i,e,t,n),r=N(i.body,e,t,n)||r);var a=(0,o.YE)();return a&&(r=N(a,e,t,n)||r),r}function j(e,t,n){var r=(0,o.zk)();r&&(M(r,e,t,n),M(r.body,e,t,n));var i=(0,o.YE)();i&&M(i,e,t,n)}function H(e,t,n,i){var o=!1;return t&&e&&e[r.oI]>0&&(0,a.Iu)(e,(function(e){e&&(n&&-1!==(0,a.rD)(n,e)||(o=x(e,t,i)||o))})),o}function U(e,t,n,i){var o=!1;return t&&e&&(0,a.cy)(e)&&!(o=H(e,t,n,i))&&n&&n[r.oI]>0&&(o=H(e,t,null,i)),o}function V(e,t,n){e&&(0,a.cy)(e)&&(0,a.Iu)(e,(function(e){e&&j(e,t,n)}))}function B(e,t,n){return U([y,_,f],e,t,n)}function G(e,t){V([y,_,f],e,t)}function W(e,t,n){var r=L(v,n),i=H([f],e,t,r);return t&&-1!==(0,a.rD)(t,g)||(i=H([g],(function(t){var n=(0,o.YE)();e&&n&&"hidden"===n.visibilityState&&e(t)}),t,r)||i),!i&&t&&(i=W(e,null,n)),i}function q(e,t){var n=L(v,t);V([f],e,n),V([g],null,n)}function K(e,t,n){var r=L(S,n),i=H([m],e,t,r);return!(i=H([g],(function(t){var n=(0,o.YE)();e&&n&&"visible"===n.visibilityState&&e(t)}),t,r)||i)&&t&&(i=K(e,null,n)),i}function J(e,t){var n=L(S,t);V([m],e,n),V([g],null,n)}},7895:function(e,t,n){"use strict";n.d(t,{$8:function(){return Se},$P:function(){return K},CP:function(){return Oe},Cv:function(){return G},EH:function(){return ie},Ed:function(){return M},Et:function(){return Y},Gh:function(){return x},Gv:function(){return H},Iu:function(){return ee},Ju:function(){return q},KT:function(){return re},KY:function(){return fe},Kg:function(){return Q},Lm:function(){return Z},N6:function(){return de},RF:function(){return Te},SA:function(){return _e},Tn:function(){return U},W$:function(){return ne},_u:function(){return $},b0:function(){return k},bJ:function(){return z},c2:function(){return me},cG:function(){return se},cH:function(){return V},cy:function(){return J},hW:function(){return Pe},hX:function(){return F},js:function(){return pe},lL:function(){return ge},mQ:function(){return j},o$:function(){return Ie},ol:function(){return ue},qz:function(){return Ee},r:function(){return ce},rD:function(){return te},tG:function(){return W},wo:function(){return ye},x3:function(){return he},z:function(){return B},zz:function(){return ve}});var r=n(9166),i=n(6570),o=n(2980),a=n(6642),s="toISOString",c="endsWith",l="startsWith",u="indexOf",d="map",p="reduce",h="trim",g="toString",f="__proto__",m="constructor",_=r.KU,y=r.s6.freeze,v=r.s6.seal,S=r.s6.keys,C=String[r.vR],E=C[h],T=C[c],I=C[l],P=Date[r.vR][s],O=Array.isArray,b=r.Wy[g],A=r.J$[g],R=A[o.Ek](r.s6),w=/-([a-z])/g,D=/([^\w\d_$])/g,L=/^(\d+[\w\d_$])/,N=Object.getPrototypeOf;function M(e,t){return typeof e===t}function k(e){return void 0===e||typeof e===r.bA}function F(e){return null===e||k(e)}function x(e){return!F(e)}function j(e,t){return!(!e||!r.J$[o.Ek](e,t))}function H(e){return!(!e||typeof e!==r._1)}function U(e){return!(!e||typeof e!==r.hW)}function V(e){var t=e;return t&&Q(t)&&(t=(t=(t=t[o.W7](w,(function(e,t){return t.toUpperCase()})))[o.W7](D,"_"))[o.W7](L,(function(e,t){return"_"+t}))),t}function B(e,t){if(e)for(var n in e)r.J$[o.Ek](e,n)&&t[o.Ek](e,n,e[n])}function G(e,t){var n=!1;return e&&t&&!(n=e===t)&&(n=T?e[c](t):function(e,t){var n=!1,r=t?t[o.oI]:0,i=e?e[o.oI]:0;if(r&&i&&i>=r&&!(n=e===t)){for(var a=i-1,s=r-1;s>=0;s--){if(e[a]!=t[s])return!1;a--}n=!0}return n}(e,t)),n}function W(e,t){var n=!1;return e&&t&&!(n=e===t)&&(n=I?e[l](t):function(e,t){var n=!1,r=t?t[o.oI]:0;if(e&&r&&e[o.oI]>=r&&!(n=e===t)){for(var i=0;i<r;i++)if(e[i]!==t[i])return!1;n=!0}return n}(e,t)),n}function q(e,t){return!(!e||!t)&&-1!==e[o.Sj](t)}function K(e){return!(!e||"[object Date]"!==b[o.Ek](e))}var J=O||function(e){return!(!e||"[object Array]"!==b[o.Ek](e))};function z(e){return!(!e||"[object Error]"!==b[o.Ek](e))}function Q(e){return"string"==typeof e}function Y(e){return"number"==typeof e}function Z(e){return"boolean"==typeof e}function X(e){var t=!1;if(e&&"object"==typeof e){var n=N?N(e):function(e){if(e){if(N)return N(e);var t=e[f]||e[r.vR]||e[m];if(t)return t}return null}(e);n?(n[m]&&r.J$[o.Ek](n,m)&&(n=n[m]),t=typeof n===r.hW&&A[o.Ek](n)===R):t=!0}return t}function $(e){if(e)return P?e[s]():function(e){if(e&&e.getUTCFullYear){var t=function(e){var t=String(e);return 1===t[o.oI]&&(t="0"+t),t};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(e)}function ee(e,t,n){var r=e[o.oI];try{for(var i=0;i<r&&(!(i in e)||-1!==t[o.Ek](n||e,e[i],i,e));i++);}catch(e){}}function te(e,t,n){if(e){if(e[u])return e[u](t,n);var r=e[o.oI],i=n||0;try{for(var a=Math.max(i>=0?i:r-Math.abs(i),0);a<r;a++)if(a in e&&e[a]===t)return a}catch(e){}}return-1}function ne(e,t,n){var r;if(e){if(e[d])return e[d](t,n);var i=e[o.oI],a=n||e;r=new Array(i);try{for(var s=0;s<i;s++)s in e&&(r[s]=t[o.Ek](a,e[s],e))}catch(e){}}return r}function re(e,t,n){var r;if(e){if(e[p])return e[p](t,n);var i=e[o.oI],a=0;if(arguments[o.oI]>=3)r=arguments[2];else{for(;a<i&&!(a in e);)a++;r=e[a++]}for(;a<i;)a in e&&(r=t(r,e[a],a,e)),a++}return r}function ie(e){return e&&(e=E&&e[h]?e[h]():e[o.W7]?e[o.W7](/^\s+|(?=\s)\s+$/g,a.m5):e),e}var oe=!{toString:null}.propertyIsEnumerable("toString"),ae=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];function se(e){var t=typeof e;if(t===r.hW||t===r._1&&null!==e||(0,i.zk)("objKeys called on non-object"),!oe&&S)return S(e);var n=[];for(var a in e)e&&r.J$[o.Ek](e,a)&&n[o.y5](a);if(oe)for(var s=ae[o.oI],c=0;c<s;c++)e&&r.J$[o.Ek](e,ae[c])&&n[o.y5](ae[c]);return n}function ce(e,t,n,r){if(_)try{var i={enumerable:!0,configurable:!0};return n&&(i.get=n),r&&(i.set=r),_(e,t,i),!0}catch(e){}return!1}function le(e){return e}function ue(e){return y&&B(e,(function(e,t){(J(t)||H(t))&&y(t)})),de(e)}var de=y||le,pe=v||le;function he(){var e=Date;return e.now?e.now():(new e).getTime()}function ge(e){return z(e)?e[o.RS]:a.m5}function fe(e,t,n,r,i){var o=n;return e&&((o=e[t])===n||i&&!i(o)||r&&!r(n)||(o=n,e[t]=o)),o}function me(e,t,n){var r;return e?!(r=e[t])&&F(r)&&(r=k(n)?{}:n,e[t]=r):r=k(n)?{}:n,r}function _e(e,t){return F(e)?t:e}function ye(e){return!e}function ve(e){return!!e}function Se(e){throw new Error(e)}function Ce(e,t){var n=null,r=null;return U(e)?n=e:r=e,function(){var e=arguments;if(n&&(r=n()),r)return r[t][o.y9](r,e)}}function Ee(e,t,n){if(e&&t&&H(e)&&H(t)){var r=function(r){if(Q(r)){var i=t[r];U(i)?n&&!n(r,!0,t,e)||(e[r]=Ce(t,r)):n&&!n(r,!1,t,e)||(j(e,r)&&delete e[r],ce(e,r,(function(){return t[r]}),(function(e){t[r]=e}))||(e[r]=i))}};for(var i in t)r(i)}return e}function Te(e,t,n,r,i){e&&t&&n&&(!1!==i||k(e[t]))&&(e[t]=Ce(n,r))}function Ie(e,t,n,r){return e&&t&&H(e)&&J(n)&&ee(n,(function(n){Q(n)&&Te(e,n,t,n,r)})),e}function Pe(e){return e&&r.zi&&(e=(0,r.s6)((0,r.zi)({},e))),e}function Oe(e,t,n,i,a,s){var c=arguments,l=c[0]||{},u=c[o.oI],d=!1,p=1;for(u>0&&Z(l)&&(d=l,l=c[p]||{},p++),H(l)||(l={});p<u;p++){var h=c[p],g=J(h),f=H(h);for(var m in h){if(g&&m in h||f&&r.J$[o.Ek](h,m)){var _=h[m],y=void 0;if(d&&_&&((y=J(_))||X(_))){var v=l[m];y?J(v)||(v=[]):X(v)||(v={}),_=Oe(d,v,_)}void 0!==_&&(l[m]=_)}}}return l}},6642:function(e,t,n){"use strict";n.d(t,{Bw:function(){return c},Hr:function(){return s},LZ:function(){return i},Tj:function(){return _},Vo:function(){return d},Yd:function(){return a},Yp:function(){return h},Zi:function(){return m},dI:function(){return g},eT:function(){return o},fc:function(){return p},jy:function(){return l},kI:function(){return y},l0:function(){return f},m5:function(){return r},qT:function(){return u}});var r="",i="channels",o="core",a="createPerfMgr",s="disabled",c="extensionConfig",l="extensions",u="processTelemetry",d="priority",p="eventsSent",h="eventsDiscarded",g="eventsSendRequest",f="perfEvent",m="errorToConsole",_="warnToConsole",y="getPerfMgr"},3394:function(e,t,n){"use strict";n.d(t,{h:function(){return c}});var r=n(3919),i=n(2980),o=n(7895),a=n(6642);function s(e,t,n,r){(0,o.Iu)(e,(function(e){if(e&&e[t])if(n)setTimeout((function(){return r(e)}),0);else try{r(e)}catch(e){}}))}var c=function(){function e(t){this.listeners=[];var n=!!(t||{}).perfEvtsSendAll;(0,r.A)(e,this,(function(e){e[i.vR]=function(t){e.listeners[i.y5](t)},e[i.TP]=function(t){for(var n=(0,o.rD)(e[i.lJ],t);n>-1;)e.listeners[i.Ic](n,1),n=(0,o.rD)(e[i.lJ],t)},e[a.fc]=function(t){s(e[i.lJ],a.fc,!0,(function(e){e[a.fc](t)}))},e[a.Yp]=function(t,n){s(e[i.lJ],a.Yp,!0,(function(e){e[a.Yp](t,n)}))},e[a.dI]=function(t,n){s(e[i.lJ],a.dI,n,(function(e){e[a.dI](t,n)}))},e[a.l0]=function(t){t&&(!n&&t[i.Zu]()||s(e[i.lJ],a.l0,!1,(function(e){t[i.tI]?setTimeout((function(){return e[a.l0](t)}),0):e[a.l0](t)})))}}))}return e.__ieDyn=1,e}()},5778:function(e,t,n){"use strict";n.d(t,{NS:function(){return p},Q6:function(){return d},Z4:function(){return f},r2:function(){return g}});var r=n(3919),i=n(2980),o=n(7895),a=n(6642),s="ctx",c="ParentContextKey",l="ChildrenContextKey",u=null,d=function(){function e(t,n,r){var a,u=this,d=!1;(u.start=(0,o.x3)(),u[i.RS]=t,u[i.tI]=r,u[i.Zu]=function(){return!1},(0,o.Tn)(n))&&(d=(0,o.r)(u,"payload",(function(){return!a&&(0,o.Tn)(n)&&(a=n(),n=null),a})));u[i.O_]=function(t){return t?t===e[c]||t===e[l]?u[t]:(u[s]||{})[t]:null},u[i.e_]=function(t,n){if(t)if(t===e[c])u[t]||(u[i.Zu]=function(){return!0}),u[t]=n;else if(t===e[l])u[t]=n;else{(u[s]=u[s]||{})[t]=n}},u[i.Ru]=function(){var t=0,r=u[i.O_](e[l]);if((0,o.cy)(r))for(var a=0;a<r[i.oI];a++){var s=r[a];s&&(t+=s[i.fA])}u[i.fA]=(0,o.x3)()-u.start,u.exTime=u[i.fA]-t,u[i.Ru]=function(){},!d&&(0,o.Tn)(n)&&(u.payload=n())}}return e.ParentContextKey="parent",e.ChildrenContextKey="childEvts",e}(),p=function(){function e(t){this.ctx={},(0,r.A)(e,this,(function(e){e.create=function(e,t,n){return new d(e,t,n)},e.fire=function(e){e&&(e[i.Ru](),t&&(0,o.Tn)(t[a.l0])&&t[a.l0](e))},e[i.e_]=function(t,n){t&&((e[s]=e[s]||{})[t]=n)},e[i.O_]=function(t){return(e[s]||{})[t]}}))}return e.__ieDyn=1,e}(),h="CoreUtils.doPerf";function g(e,t,n,r,o){if(e){var s=e;if(s[a.kI]&&(s=s[a.kI]()),s){var u=void 0,p=s[i.O_](h);try{if(u=s.create(t(),r,o)){if(p&&u[i.e_]&&(u[i.e_](d[c],p),p[i.O_]&&p[i.e_])){var g=p[i.O_](d[l]);g||(g=[],p[i.e_](d[l],g)),g[i.y5](u)}return s[i.e_](h,u),n(u)}}catch(e){u&&u[i.e_]&&u[i.e_]("exception",e)}finally{u&&s.fire(u),s[i.e_](h,p)}}}return n()}function f(){return u}},4963:function(e,t,n){"use strict";n.d(t,{PV:function(){return y},W0:function(){return v},i8:function(){return f},nU:function(){return _},tS:function(){return m}});var r=n(2980),i=n(3377),o=n(7494),a=n(7895),s=n(6642),c=n(5778),l=n(9710),u="TelemetryPluginChain",d="_hasRun",p="_getTelCtx",h=0;function g(e,t,n,c){var l=null,u=[];null!==c&&(l=c?function(e,t,n){for(;e;){if(e[r.AP]()===n)return e;e=e[r.uR]()}return y([n],t[r.GA]||{},t)}(e,n,c):e);var d={_next:function(){var e=l;if(l=e?e[r.uR]():null,!e){var t=u;t&&t[r.oI]>0&&((0,a.Iu)(t,(function(e){try{e.func[r.Ek](e.self,e.args)}catch(e){(0,i.ZP)(n[r.Uw],2,73,"Unexpected Exception during onComplete - "+(0,o.mm)(e))}})),u=[])}return e},ctx:{core:function(){return n},diagLog:function(){return(0,i.y0)(n,t)},getCfg:function(){return t},getExtCfg:p,getConfig:function(e,n,r){void 0===r&&(r=!1);var i,o=p(e,null);o&&!(0,a.hX)(o[n])?i=o[n]:t&&!(0,a.hX)(t[n])&&(i=t[n]);return(0,a.hX)(i)?r:i},hasNext:function(){return!!l},getNext:function(){return l},setNext:function(e){l=e},iterate:function(e){var t;for(;t=d._next();){var n=t[r.AP]();n&&e(n)}},onComplete:function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];e&&u[r.y5]({func:e,self:(0,a.b0)(t)?d.ctx:t,args:n})}}};function p(e,n,r){var i;if(void 0===n&&(n={}),void 0===r&&(r=0),t){var o=t[s.Bw];o&&e&&(i=o[e])}if(i){if((0,a.Gv)(n)&&0!==r){var c=(0,a.CP)(!0,n,i);t&&2===r&&(0,a.z)(n,(function(e){if((0,a.hX)(c[e])){var n=t[e];(0,a.hX)(n)||(c[e]=n)}})),i=c}}else i=n;return i}return d}function f(e,t,n,i){var o=g(e,t,n,i),c=o.ctx;return c[r.$5]=function(e){var t=o._next();return t&&t[s.qT](e,c),!t},c[r.$o]=function(e,i){return void 0===e&&(e=null),(0,a.cy)(e)&&(e=y(e,t,n,i)),f(e||c[r.uR](),t,n,i)},c}function m(e,t,n){var i=t[r.GA]||{},o=g(e,i,t,n),s=o.ctx;return s[r.$5]=function(e){var t=o._next();return t&&t.unload(s,e),!t},s[r.$o]=function(e,n){return void 0===e&&(e=null),(0,a.cy)(e)&&(e=y(e,i,t,n)),m(e||s[r.uR](),t,n)},s}function _(e,t,n){var i=t[r.GA]||{},o=g(e,i,t,n).ctx;return o[r.$5]=function(e){return o.iterate((function(t){(0,a.Tn)(t[r.HC])&&t[r.HC](o,e)}))},o[r.$o]=function(e,n){return void 0===e&&(e=null),(0,a.cy)(e)&&(e=y(e,i,t,n)),_(e||o[r.uR](),t,n)},o}function y(e,t,n,g){var m=null,_=!g;if((0,a.cy)(e)&&e[r.oI]>0){var v=null;(0,a.Iu)(e,(function(e){if(_||g!==e||(_=!0),_&&e&&(0,a.Tn)(e[s.qT])){var y=function(e,t,n){var g,m=null,_=(0,a.Tn)(e[s.qT]),y=(0,a.Tn)(e[r.YH]);g=e?e[r.Ju]+"-"+e[s.Vo]+"-"+h++:"Unknown-0-"+h++;var v={getPlugin:function(){return e},getNext:function(){return m},processTelemetry:E,unload:T,update:I,_id:g,_setNext:function(e){m=e}};function S(){var r;return e&&(0,a.Tn)(e[p])&&(r=e[p]()),r||(r=f(v,t,n)),r}function C(t,n,a,l,p){var h=!1,f=e?e[r.Ju]:u,_=t[d];return _||(_=t[d]={}),t.setNext(m),e&&(0,c.r2)(t[s.eT](),(function(){return f+":"+a}),(function(){_[g]=!0;try{var e=m?m._id:s.m5;e&&(_[e]=!1),h=n(t)}catch(e){var c=!m||_[m._id];c&&(h=!0),m&&c||(0,i.ZP)(t[r.e4](),1,73,"Plugin ["+f+"] failed during "+a+" - "+(0,o.mm)(e)+", run flags: "+(0,o.mm)(_))}}),l,p),h}function E(t,n){function i(n){if(!e||!_)return!1;var i=(0,l.Cr)(e);return!i[r.Ik]&&!i[s.Hr]&&(y&&e[r.YH](m),e[s.qT](t,n),!0)}C(n=n||S(),i,"processTelemetry",(function(){return{item:t}}),!t.sync)||n[r.$5](t)}function T(t,n){function i(){var i=!1;if(e){var o=(0,l.Cr)(e),a=e[s.eT]||o[s.eT];!e||a&&a!==t.core()||o[r.Ik]||(o[s.eT]=null,o[r.Ik]=!0,o[r.tZ]=!1,e[r.Ik]&&!0===e[r.Ik](t,n)&&(i=!0))}return i}C(t,i,"unload",(function(){}),n[r.tI])||t[r.$5](n)}function I(t,n){function i(){var i=!1;if(e){var o=(0,l.Cr)(e),a=e[s.eT]||o[s.eT];!e||a&&a!==t.core()||o[r.Ik]||e[r.HC]&&!0===e[r.HC](t,n)&&(i=!0)}return i}C(t,i,"update",(function(){}),!1)||t[r.$5](n)}return(0,a.N6)(v)}(e,t,n);m||(m=y),v&&v._setNext(y),v=y}}))}return g&&!m?y([g],t,n):m}var v=function(e,t,n,r){var i=f(e,t,n,r);(0,a.o$)(this,i,(0,a.cG)(i))}},9021:function(e,t,n){"use strict";n.d(t,{Si:function(){return y},VN:function(){return f},Z1:function(){return g},k5:function(){return _},yc:function(){return m}});var r=n(2980),i=n(7494),o=n(7895),a=n(6642),s=4294967296,c=4294967295,l=!1,u=123456789,d=987654321;function p(e){e<0&&(e>>>=0),u=123456789+e&c,d=987654321-e&c,l=!0}function h(){try{var e=2147483647&(0,o.x3)();p((Math.random()*s^e)+e)}catch(e){}}function g(e){return e>0?Math.floor(f()/c*(e+1))>>>0:0}function f(e){var t=0,n=(0,i.MY)()||(0,i.iN)();return n&&n.getRandomValues&&(t=n.getRandomValues(new Uint32Array(1))[0]&c),0===t&&(0,i.lT)()&&(l||h(),t=_()&c),0===t&&(t=Math.floor(s*Math.random()|0)),e||(t>>>=0),t}function m(e){e?p(e):h()}function _(e){var t=((d=36969*(65535&d)+(d>>16)&c)<<16)+(65535&(u=18e3*(65535&u)+(u>>16)&c))>>>0&c;return e||(t>>>=0),t}function y(e){void 0===e&&(e=22);for(var t=f()>>>0,n=0,i=a.m5;i[r.oI]<e;)n++,i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&t),t>>>=6,5===n&&(t=(f()<<2&4294967295|3&t)>>>0,n=0);return i}},9710:function(e,t,n){"use strict";n.d(t,{Cr:function(){return l},Xc:function(){return d},pI:function(){return u},u7:function(){return p}});var r=n(2980),i=n(8106),o=n(7895),a=n(6642),s=n(4074),c=(0,i.T)("plugin");function l(e){return c.get(e,"state",{},!0)}function u(e,t){for(var n,i=[],s=null,c=e[r.uR]();c;){var u=c[r.AP]();if(u){s&&(0,o.Tn)(s[r.YH])&&(0,o.Tn)(u[a.qT])&&s[r.YH](u);((0,o.Tn)(u[r.tZ])?u[r.tZ]():(n=l(u))[r.tZ])||i[r.y5](u),s=u,c=c[r.uR]()}}(0,o.Iu)(i,(function(i){var o=e[a.eT]();i[r.mE](e.getCfg(),o,t,e[r.uR]()),n=l(i),i[a.eT]||n[a.eT]||(n[a.eT]=o),n[r.tZ]=!0,delete n[r.Ik]}))}function d(e){return e.sort((function(e,t){var n=0;if(t){var r=(0,o.Tn)(t[a.qT]);(0,o.Tn)(e[a.qT])?n=r?e[a.Vo]-t[a.Vo]:1:r&&(n=-1)}else n=e?1:-1;return n}))}function p(e){var t={};return{getName:function(){return t[r.RS]},setName:function(n){e&&e.setName(n),t[r.RS]=n},getTraceId:function(){return t[r.P5]},setTraceId:function(n){e&&e.setTraceId(n),(0,s.hX)(n)&&(t[r.P5]=n)},getSpanId:function(){return t[r.wi]},setSpanId:function(n){e&&e.setSpanId(n),(0,s.wN)(n)&&(t[r.wi]=n)},getTraceFlags:function(){return t[r.Rr]},setTraceFlags:function(n){e&&e.setTraceFlags(n),t[r.Rr]=n}}}},2190:function(e,t,n){"use strict";n.d(t,{P:function(){return s}});var r=n(2980),i=n(3377),o=n(7494),a=n(7895);function s(){var e=[];return{add:function(t){t&&e[r.y5](t)},run:function(t,n){(0,a.Iu)(e,(function(e){try{e(t,n)}catch(e){(0,i.ZP)(t[r.e4](),2,73,"Unexpected error calling unload handler - "+(0,o.mm)(e))}})),e=[]}}}},4074:function(e,t,n){"use strict";n.d(t,{L0:function(){return T},N7:function(){return E},ZI:function(){return y},ef:function(){return I},hX:function(){return v},mJ:function(){return C},wN:function(){return S},wk:function(){return _}});var r=n(2980),i=n(5372),o=n(7494),a=n(7895),s=n(6642),c=/^([\da-f]{2})-([\da-f]{32})-([\da-f]{16})-([\da-f]{2})(-[^\s]{1,64})?$/i,l="00",u="ff",d="00000000000000000000000000000000",p="0000000000000000",h=1;function g(e,t,n){return!(!e||e[r.oI]!==t||e===n)&&!!e.match(/^[\da-f]*$/i)}function f(e,t,n){return g(e,t)?e:n}function m(e){(isNaN(e)||e<0||e>255)&&(e=1);for(var t=e.toString(16);t[r.oI]<2;)t="0"+t;return t}function _(e,t,n,o){var a;return(a={})[r.s]=g(o,2,u)?o:l,a[r.P5]=v(e)?e:(0,i.cL)(),a.spanId=S(t)?t:(0,i.cL)()[r.$4](0,16),a.traceFlags=n>=0&&n<=255?n:1,a}function y(e,t){var n;if(!e)return null;if((0,a.cy)(e)&&(e=e[0]||""),!e||!(0,a.Kg)(e)||e[r.oI]>8192)return null;if(-1!==e[r.Sj](",")){var i=e[r.sY](",");e=i[t>0&&i[r.oI]>t?t:0]}var o=c.exec((0,a.EH)(e));return o&&o[1]!==u&&o[2]!==d&&o[3]!==p?((n={version:(o[1]||s.m5)[r.OL](),traceId:(o[2]||s.m5)[r.OL](),spanId:(o[3]||s.m5)[r.OL]()})[r.Rr]=parseInt(o[4],16),n):null}function v(e){return g(e,32,d)}function S(e){return g(e,16,p)}function C(e){return!!(e&&g(e[r.s],2,u)&&g(e[r.P5],32,d)&&g(e[r.wi],16,p)&&g(m(e[r.Rr]),2))}function E(e){return!!C(e)&&(e[r.Rr]&h)===h}function T(e){if(e){var t=m(e[r.Rr]);g(t,2)||(t="01");var n=e[r.s]||l;return"00"!==n&&"ff"!==n&&(n=l),"".concat(n.toLowerCase(),"-").concat(f(e.traceId,32,d).toLowerCase(),"-").concat(f(e.spanId,16,p).toLowerCase(),"-").concat(t.toLowerCase())}return""}function I(e){var t="traceparent",n=y((0,o.$Z)(t),e);return n||(n=y((0,o.Iu)(t),e)),n}},2980:function(e,t,n){"use strict";n.d(t,{$4:function(){return U},$5:function(){return g},$o:function(){return N},AP:function(){return S},Di:function(){return y},EX:function(){return C},Ek:function(){return J},GA:function(){return l},H7:function(){return E},HC:function(){return R},Ic:function(){return T},Ik:function(){return I},JR:function(){return P},Ju:function(){return a},OL:function(){return K},O_:function(){return X},P5:function(){return te},QM:function(){return z},RF:function(){return o},RS:function(){return i},Re:function(){return F},Rr:function(){return re},Ru:function(){return ee},Sj:function(){return k},TP:function(){return _},Uw:function(){return d},W7:function(){return G},YH:function(){return L},Yo:function(){return Q},Zu:function(){return Z},a$:function(){return W},by:function(){return v},e4:function(){return D},e_:function(){return $},fA:function(){return h},kt:function(){return H},lJ:function(){return Y},lK:function(){return M},mE:function(){return r},oI:function(){return p},pM:function(){return O},ps:function(){return f},re:function(){return V},s:function(){return ie},sY:function(){return j},sl:function(){return u},sx:function(){return q},tI:function(){return b},tX:function(){return x},tZ:function(){return c},tn:function(){return A},uR:function(){return w},vR:function(){return m},wi:function(){return ne},y5:function(){return s},y9:function(){return B}});var r="initialize",i="name",o="getNotifyMgr",a="identifier",s="push",c="isInitialized",l="config",u="instrumentationKey",d="logger",p="length",h="time",g="processNext",f="getProcessTelContext",m="addNotificationListener",_="removeNotificationListener",y="stopPollingInternalLogs",v="onComplete",S="getPlugin",C="flush",E="_extensions",T="splice",I="teardown",P="messageId",O="message",b="isAsync",A="_doTeardown",R="update",w="getNext",D="diagLog",L="setNextPlugin",N="createNew",M="cookieCfg",k="indexOf",F="substring",x="userAgent",j="split",H="setEnabled",U="substr",V="nodeType",B="apply",G="replace",W="enableDebugExceptions",q="logInternalMessage",K="toLowerCase",J="call",z="type",Q="handler",Y="listeners",Z="isChildEvt",X="getCtx",$="setCtx",ee="complete",te="traceId",ne="spanId",re="traceFlags",ie="version"},9166:function(e,t,n){"use strict";n.d(t,{J$:function(){return h},KU:function(){return p},OR:function(){return d},QV:function(){return s},Wy:function(){return l},_1:function(){return i},bA:function(){return o},hW:function(){return r},s6:function(){return c},vR:function(){return a},zi:function(){return u}});var r="function",i="object",o="undefined",a="prototype",s="hasOwnProperty",c=Object,l=c[a],u=c.assign,d=c.create,p=c.defineProperty,h=l[s]},6570:function(e,t,n){"use strict";n.d(t,{AQ:function(){return s},mS:function(){return o},zk:function(){return a}});var r=n(9166),i=null;function o(e){void 0===e&&(e=!0);var t=!1===e?null:i;return t||(typeof globalThis!==r.bA&&(t=globalThis),t||typeof self===r.bA||(t=self),t||typeof window===r.bA||(t=window),t||typeof n.g===r.bA||(t=n.g),i=t),t}function a(e){throw new TypeError(e)}function s(e){var t=r.OR;if(t)return t(e);if(null==e)return{};var n=typeof e;function i(){}return n!==r._1&&n!==r.hW&&a("Object prototype may only be an Object:"+e),i[r.vR]=e,new i}},4661:function(e,t,n){"use strict";n.d(t,{Im:function(){return o},qU:function(){return s},vz:function(){return c}});var r=n(9166),i=n(6570),o=(((0,i.mS)()||{}).Symbol,((0,i.mS)()||{}).Reflect,r.zi||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])r.Wy[r.QV].call(t,o)&&(e[o]=t[o]);return e}),a=function(e,t){return a=r.s6.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t[r.QV](n)&&(e[n]=t[n])},a(e,t)};function s(e,t){function n(){this.constructor=e}typeof t!==r.hW&&null!==t&&(0,i.zk)("Class extends value "+String(t)+" is not a constructor or null"),a(e,t),e[r.vR]=null===t?(0,i.AQ)(t):(n[r.vR]=t[r.vR],new n)}function c(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}},3919:function(e,t,n){"use strict";var r;n.d(t,{A:function(){return H}});var i="undefined",o="constructor",a="prototype",s="function",c="_dynInstFuncs",l="_isDynProxy",u="_dynClass",d="_dynCls$",p="_dynInstChk",h=p,g="_dfOpts",f="_unknown_",m="__proto__",_="_dyn"+m,y="__dynProto$Gbl",v="_dynInstProto",S="useBaseInst",C="setInstFuncs",E=Object,T=E.getPrototypeOf,I=E.getOwnPropertyNames;var P,O=(typeof globalThis!==i&&(P=globalThis),P||typeof self===i||(P=self),P||typeof window===i||(P=window),P||typeof n.g===i||(P=n.g),P||{}),b=O[y]||(O[y]={o:(r={},r[C]=!0,r[S]=!0,r),n:1e3});function A(e,t){return e&&E[a].hasOwnProperty.call(e,t)}function R(e){return e&&(e===E[a]||e===Array[a])}function w(e){return R(e)||e===Function[a]}function D(e){var t;if(e){if(T)return T(e);var n=e[m]||e[a]||(e[o]?e[o][a]:null);t=e[_]||n,A(e,_)||(delete e[v],t=e[_]=e[v]||e[_],e[v]=n)}return t}function L(e,t){var n=[];if(I)n=I(e);else for(var r in e)"string"==typeof r&&A(e,r)&&n.push(r);if(n&&n.length>0)for(var i=0;i<n.length;i++)t(n[i])}function N(e,t,n){return t!==o&&typeof e[t]===s&&(n||A(e,t))&&t!==m&&t!==a}function M(e){throw new TypeError("DynamicProto: "+e)}function k(){return Object.create?(e=null,(t=Object.create)?t(e):{}):{};var e,t}function F(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t)return!0;return!1}function x(e,t,n,r,i){function o(e,t){var n=function(){var r=function(e,t,n,r){var i=null;if(e&&A(n,u)){var o=e[c]||k();if((i=(o[n[u]]||k())[t])||M("Missing ["+t+"] "+s),!i[p]&&!1!==o[h]){for(var a=!A(e,t),l=D(e),d=[];a&&l&&!w(l)&&!F(d,l);){var g=l[t];if(g){a=g===r;break}d.push(l),l=D(l)}try{a&&(e[t]=i),i[p]=1}catch(e){o[h]=!1}}}return i}(this,t,e,n)||function(e,t,n){var r=t[e];return r===n&&(r=D(t)[e]),typeof r!==s&&M("["+e+"] is not a "+s),r}(t,e,n);return r.apply(this,arguments)};return n[l]=1,n}if(!R(e)){var a=n[c]=n[c]||k();if(!R(a)){var d=a[t]=a[t]||k();!1!==a[h]&&(a[h]=!!i),R(d)||L(n,(function(t){N(n,t,!1)&&n[t]!==r[t]&&(d[t]=n[t],delete n[t],(!A(e,t)||e[t]&&!e[t][l])&&(e[t]=o(e,t)))}))}}}function j(e,t){return A(e,a)?e.name||t||f:((e||{})[o]||{}).name||t||f}function H(e,t,n,r){A(e,a)||M("theClass is an invalid class definition.");var i=e[a];(function(e,t){if(T){for(var n=[],r=D(t);r&&!w(r)&&!F(n,r);){if(r===e)return!0;n.push(r),r=D(r)}return!1}return!0})(i,t)||M("["+j(e)+"] not in hierarchy of ["+j(t)+"]");var o=null;A(i,u)?o=i[u]:(o=d+j(e,"_")+"$"+b.n,b.n++,i[u]=o);var s=H[g],p=!!s[S];p&&r&&void 0!==r[S]&&(p=!!r[S]);var f=function(e){var t=k();return L(e,(function(n){!t[n]&&N(e,n,!1)&&(t[n]=e[n])})),t}(t),m=function(e,t,n,r){function i(e,t,n){var i=t[n];if(i[l]&&r){var o=e[c]||{};!1!==o[h]&&(i=(o[t[u]]||{})[n]||i)}return function(){return i.apply(e,arguments)}}var o=k();L(n,(function(e){o[e]=i(t,n,e)}));for(var a=D(e),s=[];a&&!w(a)&&!F(s,a);)L(a,(function(e){!o[e]&&N(a,e,!T)&&(o[e]=i(t,a,e))})),s.push(a),a=D(a);return o}(i,t,f,p);n(t,m);var _=!!T&&!!s[C];_&&r&&(_=!!r[C]),x(i,o,t,f,!1!==_)}H[g]=b.o},5826:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4148),i=function(){function e(){this._isAllowed=!1}return e.prototype.putBackgroundFetchAllowed=function(e){if(this._isAllowed=e,this.isBackgroundFetchAllowed()&&this._isAllowedDeferral){var t=this._isAllowedDeferral;this._isAllowedDeferral=void 0,t.resolve(void 0)}},e.prototype.isBackgroundFetchAllowed=function(){return this._isAllowed},e.prototype.waitForBackgroundFetchAllowed=function(){return this.isBackgroundFetchAllowed()?r.Resolved():(this._isAllowedDeferral||(this._isAllowedDeferral=r.Defer()),this._isAllowedDeferral.promise())},e}();t.default=i},8996:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4148),i=function(){function e(){this._isActive=!1}return e.prototype.putAppActive=function(e){if(this._isActive=e,this.isAppActive()&&this._appActiveDeferral){var t=this._appActiveDeferral;this._appActiveDeferral=void 0,t.resolve(void 0)}},e.prototype.isAppActive=function(){return this._isActive},e.prototype.waitForAppActive=function(){return this.isAppActive()?r.Resolved():(this._appActiveDeferral||(this._appActiveDeferral=r.Defer()),this._appActiveDeferral.promise())},e}();t.default=i},6819:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3149),i=n(4148),o=n(1023),a=function(){function e(e){this._config=e,this.configUpdated=new r.default,this._cachedConfigs={}}return e.prototype.initialize=function(){return this.updateConfigsToFetch()},e.prototype.updateConfigsToFetch=function(){var e=this,t=this._config.getConfig(),n=t.databaseInterface,r=t.configsToFetch;if(!n)return i.Resolved();for(var o=[],a=function(t){if(s._cachedConfigs[t])return"continue";o.push(n.getData(t).then((function(n){n&&(e._cachedConfigs[t]=n)})).catch((function(){return i.Resolved()})))},s=this,c=0,l=r;c<l.length;c++){a(l[c])}return i.all(o).then((function(){o.length>0&&e.configUpdated.fire()}))},e.prototype.getEcsConfig=function(){return this._cachedConfigs[o.EcsConfigType.User]||this._cachedConfigs[o.EcsConfigType.Default]},e.prototype.getEcsConfigByType=function(e){return this._cachedConfigs[e]},e.prototype.putConfig=function(e){var t=this.getEcsConfig();this._cachedConfigs[e.configType]=e;var n=this.getEcsConfig();(n&&n.configType===e.configType||t&&n&&t.configType!==n.configType)&&this.configUpdated.fire();var r=this._config.getConfig().databaseInterface;return r?r.putData(e.configType,e):i.Resolved()},e}();t.default=a},1975:function(e,t){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.initialize=function(e){if(this._config)throw new Error("ECS Configuration already initialized");this._config=e},e.prototype.getConfig=function(){if(!this._config)throw new Error("ECS Configuration not yet initialized");return this._config},e.prototype.setConfigsToFetch=function(e){if(!this._config)throw new Error("ECS Configuration not yet initialized");this._config=n(n({},this._config),{configsToFetch:e})},e.prototype.setFetchTimeout=function(e){if(!this._config)throw new Error("ECS Configuration not yet initialized");this._config=n(n({},this._config),{fetchTimeout:e})},e}();t.default=r},1759:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5826),i=n(8996),o=n(6819),a=n(1975),s=n(1023);t.Models=s;var c=n(6e3),l=n(4702),u=n(6491),d=function(){function e(){this._allowBackgroundFetchData=new r.default,this._appActiveData=new i.default,this._config=new a.default,this._cache=new o.default(this._config),this._skypeTokenData=new l.default,this._telemetryManager=new u.default(this._cache),this._scheduler=new c.default(this._config,this._skypeTokenData,this._cache,this._appActiveData,this._allowBackgroundFetchData,this._telemetryManager),this.telemetryEventAdded=this._telemetryManager.telemetryEventAdded,this.configUpdated=this._cache.configUpdated}return e.prototype.initialize=function(e){var t=this;return this._config.initialize(e),this._skypeTokenData.putSkypeTokenData(e.initialSkypeTokenData),this._appActiveData.putAppActive(e.initialAppActiveState),this._cache.initialize().then((function(){t._scheduler.initialize()}))},e.prototype.dispose=function(){var e;(null===(e=this._config.getConfig().Killswitches)||void 0===e?void 0:e.isSkypeTokenDataLeakFixEnabled)&&this._scheduler.dispose()},e.prototype.getConfig=function(){return this._cache.getEcsConfig()},e.prototype.getConfigType=function(){var e=this._cache.getEcsConfig();if(e)return e.configType},e.prototype.requestUpdate=function(){this._scheduler.requestUpdate()},e.prototype.pause=function(){this._scheduler.pause()},e.prototype.resume=function(){this._scheduler.resume()},e.prototype.setAllowBackgroundFetch=function(e){this._allowBackgroundFetchData.putBackgroundFetchAllowed(e)},e.prototype.useSkypeToken=function(e,t){this._skypeTokenData.putSkypeTokenData({skypeToken:e,skypeTokenExpiration:t})},e.prototype.setAppActive=function(e){this._appActiveData.putAppActive(e)},e.prototype.setConfigsToFetch=function(e){var t=this;return this._config.setConfigsToFetch(e),this._cache.updateConfigsToFetch().then((function(){t._scheduler.updateConfigsToFetch()}))},e.prototype.setFetchTimeout=function(e){this._config.setFetchTimeout(e)},e}();t.default=d},1023:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Default=0]="Default",e[e.User=1]="User"}(t.EcsConfigType||(t.EcsConfigType={}))},8688:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a,s,c=n(6125),l=n(4148),u=n(1023),d=n(1763),p=function(e){function t(t,n,r,i,o,a,s,c){var l=e.call(this,t)||this;l._config=n,l._skypeTokenData=r,l._appActiveData=i,l._allowBackgroundFetchData=o,l._etag=a,l._getUserConfig=s;var u=l._config.getConfig();if(l._apiPath=u.clientTeam?"/config/v1/"+u.clientName+"/"+u.clientVersion+"/"+u.clientTeam:"/config/v1/"+u.clientName+"/"+u.clientVersion,c){var d=Object.keys(c).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(c[e].toString())}));d&&(l._apiPath+="?"+d.join("&"))}return l}return i(t,e),t.prototype._blockRequestUntil=function(e){var t=this;if(this._getUserConfig&&!this._skypeTokenData.isSkypeTokenValid()&&console.log("ECS - Delaying User config fetch until we have a valid SkypeToken"),!this._appActiveData.isAppActive()&&!this._allowBackgroundFetchData.isBackgroundFetchAllowed()){var n=this._getUserConfig?"User config":"config";console.log("ECS - Delaying "+n+" fetch until the app is active (or background fetch is allowed)")}return l.race([this._appActiveData.waitForAppActive(),this._allowBackgroundFetchData.waitForBackgroundFetchAllowed()]).then((function(){if(t._getUserConfig)return t._skypeTokenData.waitForValidSkypeToken()})).then((function(){s=Date.now()}))},t.prototype._getHeaders=function(){var e={};return this._etag&&(e["If-None-Match"]=this._etag),this._getUserConfig&&(e.Authorization=this._skypeTokenData.getSkypeToken()),e},t.prototype.getConfig=function(){var t=this._config.getConfig().fetchTimeout;return void 0!==t&&(t<0?t=0:t>0&&t<3e4&&(t=3e4)),e.prototype.performApiGetDetailed.call(this,this._apiPath,{timeout:t})},t}(c.GenericRestClient),h=function(){function e(e,t,n,r,i){this._config=e,this._skypeTokenData=t,this._appActiveData=n,this._allowBackgroundFetchData=r,this._telemetryManager=i,this._ecsFailureBackoffTimer=new c.ExponentialTime(1e3,3e5),this._cacheMaxAgeRegex=/.*max-age=(\d+).*/gi,this._serverIndex=NaN}return e.prototype.getConfig=function(e,t,n){var r=this,i=this._config.getConfig().hosts;if((isNaN(this._serverIndex)||this._serverIndex>i.length-1)&&(this._serverIndex=Math.floor(Math.random()*i.length)),!i||!i.length)return l.Rejected(new Error("no configuration service endpoint"));var a=l.Defer(),c=0,h=function(){var g=e&&e.eTag?e.eTag:void 0,f=new p(i[r._serverIndex],r._config,r._skypeTokenData,r._appActiveData,r._allowBackgroundFetchData,g,t,n);c++,f.getConfig().then((function(n){var p=n.headers.etag,h=n.headers.expires;n.body&&n.body.Headers&&(p||(p=n.body.Headers.ETag),h||(h=n.body.Headers.Expires));var f=r._calculateResponseTimeInfo(e);if(!p||!h)return console.warn("ECS - Service returned an empty ETag or Expiration header: "+JSON.stringify(n)),l.Rejected({timedOut:!1,responseParsingException:new Error("ECS Service returned empty ETag or Expiration header"),responseCode:n.statusCode});var m,_=new Date(r._calculateExpirationDate(n.headers)).getTime();if(304===n.statusCode&&e)(m=o({},e)).configType=t?u.EcsConfigType.User:u.EcsConfigType.Default,m.eTag=p,m.expiration=_,m.cacheUpdateTime=f.lastResponseTime,m.lastFetchTokenHash=r._skypeTokenData.getSkypeTokenHash(n.requestHeaders.Authorization);else{if("object"!=typeof n.body)return console.warn("ECS - Service returned invalid response "+JSON.stringify(n)),l.Rejected({timedOut:!1,responseParsingException:new Error("ECS Service returned invalid response body"),responseCode:n.statusCode});m={config:n.body,configType:t?u.EcsConfigType.User:u.EcsConfigType.Default,eTag:p,expiration:_,cacheUpdateTime:s,lastFetchTokenHash:r._skypeTokenData.getSkypeTokenHash(n.requestHeaders.Authorization),appVersion:r._config.getConfig().clientVersion}}r._telemetryManager.sendTelemetryEvent(new d.EcsConfigFetchResponse(f.fetchDelayMs,n.statusCode,c,r._skypeTokenData.isSkypeTokenValid(),i[r._serverIndex],f.fetchDurationValid,!!g,JSON.stringify(n).length,f.cacheAge,!(e&&e.expiration-Date.now()>0),s,f.lastResponseTime,t,p)),r._ecsFailureBackoffTimer.reset(),a.resolve(m)})).catch((function(n){var o={timedOut:n&&n.timedOut||!1,responseParseError:n&&n.responseParsingException,responseCode:n&&n.statusCode||0,message:r._getErrorMessage(n)};console.error("ECS - Service request failed to return a response (timedOut: "+o.timedOut+", responseParseError: "+o.responseParseError+")");var a=r._calculateResponseTimeInfo(e);r._telemetryManager.sendTelemetryEvent(new d.EcsConfigFetchResponse(a.fetchDelayMs,o.responseCode,c,r._skypeTokenData.isSkypeTokenValid(),i[r._serverIndex],a.fetchDurationValid,!!g,0,a.cacheAge,!(e&&e.expiration-Date.now()>0),s,a.lastResponseTime,t,void 0,o.timedOut,o.responseParseError,o.message));var l=r._config.getConfig().fetchAttemptMax;l&&c>l||setTimeout((function(){h()}),r._ecsFailureBackoffTimer.getTimeAndCalculateNext())}))};return h(),a.promise()},e.prototype._calculateExpirationDate=function(e){var t=Date.now()+1728e5;if(e.date&&e.expires){var n=new Date(e.date).getTime(),r=Date.now()-n,i=new Date(e.expires).getTime();return isNaN(i)?t:Math.min(t,i+r)}var o=this._cacheMaxAgeRegex.exec(e["cache-control"]);return this._cacheMaxAgeRegex.lastIndex=0,o&&2===o.length?Math.min(t,Date.now()+1e3*Number(o[1])):Date.now()+18e5},e.prototype._calculateResponseTimeInfo=function(e){var t=(a=Date.now())-s;return{lastResponseTime:a,fetchDelayMs:t,fetchDurationValid:!(t<0||t>31536e6),cacheAge:e?a-e.cacheUpdateTime:0}},e.prototype._getErrorMessage=function(e){if(e)return"string"==typeof e?e:"object"==typeof e&&(e.statusText||e.message)?e.statusText||e.message:void 0},e}();t.default=h},6e3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1023),i=n(8688),o=function(){function e(e,t,n,o,a,s){var c=this;this._config=e,this._skypeTokenData=t,this._cache=n,this._isFetchingSettings={},this._pendingFetch={},this._pendingTimers={},this._subscriptionToken=null,this._paused=!1,this._fetchEcsSettingsIfNeeded=function(e){var t,n=c._config.getConfig(),i=c._cache.getEcsConfigByType(e);if(-1!==n.configsToFetch.indexOf(e)&&!c._isFetchingSettings[e])if(i||!c._pendingFetch[e]){var o=i?i.expiration-Date.now():-1;o<=0||i&&e===r.EcsConfigType.User&&c._skypeTokenData.isSkypeTokenValid()&&i.lastFetchTokenHash!==c._skypeTokenData.getSkypeTokenHash(c._skypeTokenData.getSkypeToken())?c._fetchSkypeEcsSettings(e):(null===(t=n.Killswitches)||void 0===t?void 0:t.isSkypeTokenDataLeakFixEnabled)?(c._pendingTimers[e]>0&&clearTimeout(c._pendingTimers[e]),c._pendingTimers[e]=window.setTimeout((function(){return c._fetchEcsSettingsIfNeeded(e)}),o)):window.setTimeout((function(){return c._fetchEcsSettingsIfNeeded(e)}),o)}else c._fetchSkypeEcsSettings(e)},this._fetchSkypeEcsSettings=function(e,t){(void 0===t&&(t=!1),c._isFetchingSettings[e]||c._paused&&!t)?c._pendingFetch[e]=!0:(c._pendingFetch[e]=!1,c._isFetchingSettings[e]=!0,c._config.getConfig().getEcsParameters().catch((function(){return console.warn("ECS - Failed to fetch ECS fetching parameters"),{}})).then((function(t){return c._ecsClient.getConfig(c._cache.getEcsConfig(),e===r.EcsConfigType.User,t)})).then((function(t){console.log("ECS - Config fetch complete"),c._isFetchingSettings[e]=!1,c._cache.putConfig(t),c._fetchEcsSettingsIfNeeded(e)})))},this._ecsClient=new i.default(this._config,this._skypeTokenData,o,a,s)}return e.prototype.initialize=function(){var e=this;this.updateConfigsToFetch(),this._subscriptionToken=this._skypeTokenData.skypeTokenChanged.subscribe((function(){return e._fetchEcsSettingsIfNeeded(r.EcsConfigType.User)}))},e.prototype.dispose=function(){var e,t,n=this._config.getConfig();if(null===(e=n.Killswitches)||void 0===e?void 0:e.isSkypeTokenDataLeakFixEnabled){for(var r=0,i=n.configsToFetch;r<i.length;r++){var o=i[r];clearTimeout(this._pendingTimers[o]),this._pendingTimers[o]=0}null===(t=this._subscriptionToken)||void 0===t||t.unsubscribe(),this._subscriptionToken=null,this._skypeTokenData.skypeTokenChanged.dispose()}},e.prototype.updateConfigsToFetch=function(){for(var e=this._config.getConfig(),t=0,n=e.configsToFetch;t<n.length;t++){(o=n[t])in this._isFetchingSettings||(this._isFetchingSettings[o]=!1),o in this._isFetchingSettings||(this._pendingFetch[o]=!1)}for(var r=0,i=e.configsToFetch;r<i.length;r++){var o=i[r],a=this._cache.getEcsConfigByType(o);!a||a.appVersion&&a.appVersion!==e.clientVersion?this._fetchSkypeEcsSettings(o,!0):this._fetchEcsSettingsIfNeeded(o)}},e.prototype.requestUpdate=function(){for(var e=0,t=this._config.getConfig().configsToFetch;e<t.length;e++){var n=t[e];this._fetchSkypeEcsSettings(n)}},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){this._paused=!1;for(var e=0,t=this._config.getConfig().configsToFetch;e<t.length;e++){var n=t[e];this._fetchEcsSettingsIfNeeded(n)}},e}();t.default=o},4702:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3149),i=n(4148),o=function(){function e(){this.skypeTokenChanged=new r.default}return e.prototype.putSkypeTokenData=function(e){if(this._data=e,this.isSkypeTokenValid()&&this.skypeTokenChanged.fire(),this.isSkypeTokenValid()&&this._validSkypeTokenDeferral){var t=this._validSkypeTokenDeferral;this._validSkypeTokenDeferral=void 0,t.resolve(void 0)}},e.prototype.isSkypeTokenValid=function(){var e=this._data;return!!e&&!!e.skypeToken&&e.skypeTokenExpiration>Date.now()},e.prototype.getSkypeToken=function(){var e=this._data;if(!e||!e.skypeToken)throw new Error("No Skype Token provided");return e.skypeToken},e.prototype.getSkypeTokenHash=function(e){return void 0===e?0:e.split("").reduce((function(e,t){return(101*e+t.charCodeAt(0))%999727999}),e.length)},e.prototype.waitForValidSkypeToken=function(){return this.isSkypeTokenValid()?i.Resolved():(this._validSkypeTokenDeferral||(this._validSkypeTokenDeferral=i.Defer()),this._validSkypeTokenDeferral.promise())},e}();t.default=o},1005:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.getAttributes=function(){return{Source:"ecs_client"}},e}();t.TelemetryEventBase=n},1763:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,r,i,o,a,s,c,l,u,d,p,h,g,f,m,_){var y=e.call(this)||this;return y._responseTime=t,y._responseCode=n,y._fetchAttempts=r,y._hasValidToken=i,y._serverEndpoint=o,y._fetchDurationValid=a,y._cacheAvailable=s,y._responseSize=c,y._configAge=l,y._configExpired=u,y._fetchStart=d,y._fetchEnd=p,y._isUserConfig=h,y._etag=g,y._timedOut=f,y._responseParsingException=m,y._errorMessage=_,y}return i(t,e),t.prototype.getEventName=function(){return"ecs_tsclient_fetch_config"},t.prototype.getAttributes=function(){var t=e.prototype.getAttributes.call(this);return t.fetch_delay_ms=this._responseTime,t.fetch_response_code=this._responseCode,t.fetch_attempts=this._fetchAttempts,t.authenticated_user=this._hasValidToken,t.url=this._serverEndpoint,t.fetch_duration_valid=this._fetchDurationValid,t.cache_available=this._cacheAvailable,t.response_size=this._responseSize,t.config_age=this._configAge,t.config_expired=this._configExpired,t.fetch_start=this._fetchStart,t.fetch_end=this._fetchEnd,t.is_user_config=this._isUserConfig,this._etag&&(t.fetched_etag=this._etag),void 0!==this._timedOut&&(t.fetch_timed_out=this._timedOut),this._responseParsingException&&(t.fetch_response_parsing_error=this._responseParsingException.message),this._errorMessage&&(t.fetch_error_message=this._errorMessage),t},t}(n(1005).TelemetryEventBase);t.EcsConfigFetchResponse=o},6491:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3149),i=function(){function e(e){this._cache=e,this.telemetryEventAdded=new r.default}return e.prototype.sendTelemetryEvent=function(t){var n=t.getEventName(),r=t.getAttributes(),i=!1,o=this._cache.getEcsConfig();if(o){if(e._containsEcsClientTelemetryConfig(o.config)){var a=o.config.ECSCONFIG;a&&a.ecsClientTelemetry&&(i=!!a.ecsClientTelemetry[n])}}else console.warn("No previously cached ECS telemetry config exists - fallback to sending event"),i=!0;i&&this.telemetryEventAdded.fire(n,r)},e._containsEcsClientTelemetryConfig=function(e){return!!e&&!!e.ECSCONFIG&&!!e.ECSCONFIG.ecsClientTelemetry},e}();t.default=i},6789:function(e){e.exports=function(){"use strict";var e={103:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defer=void 0,t.defer=function(){var e,t;return{promise:new Promise((function(n,r){e=n,t=r})),resolve:e,reject:t}}},10:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},42:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Spinner=void 0;var n=function(){function e(e){this.container=e,this.spinnerId="hydra-player-spinner",this.firstSpinnerShowTimestamp=null,this.firstSpinnerHideTimestamp=null,this.spinnerInfoHistory=[],this.maxTimestampHistorySize=100;var t=this.container.ownerDocument.getElementById(this.spinnerId);if(t)return this.spinner=t,void this.show();var n=this.container.ownerDocument.createElement("style");n.textContent="\n            .ml-player-spinner-container {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                position: absolute;\n                pointer-events: none;\n            }\n            .ml-player-spinner {\n                width: 3.6rem;\n                height: 3.6rem;\n                display: block;\n                overflow-clip-margin: content-box;\n                overflow: hidden;\n                animation: ml-player-spinner-outer-rotate 3s linear infinite;\n            }\n            .ml-player-spinner-dark-wheel {\n                fill: none;\n                r: 45%;\n                cx: 50%;\n                cy: 50%;\n                stroke: rgb(68, 71, 145);\n                stroke-width: 8px;\n            }\n            .ml-player-spinner-light-wheel {\n                fill: none;\n                r: 45%;\n                cx: 50%;\n                cy: 50%;\n                stroke: rgb(127, 133, 245);\n                stroke-width: 8px;\n                stroke-dasharray: 283;\n                stroke-dashoffset: 280;\n                stroke-linecap: round;\n                transform-origin: 50% 50%;\n                animation: ml-player-spinner-inner-rotate 1.5s cubic-bezier(0.33, 0, 0.67, 1) infinite;\n            }\n            @keyframes ml-player-spinner-outer-rotate {\n                0% {\n                    transform: rotate(0deg);\n                }\n                100% {\n                    transform: rotate(360deg);\n                }\n            }\n            @keyframes ml-player-spinner-inner-rotate {\n                0% {\n                    stroke-dashoffset: 283;\n                    transform: rotate(0deg);\n                }\n                25% {\n                    stroke-dashoffset: 283;\n                    transform: rotate(0deg);\n                }\n                50% {\n                    stroke-dashoffset: 75;\n                    transform: rotate(45deg);\n                }\n                75% {\n                    stroke-dashoffset: 75;\n                    transform: rotate(45deg);\n                }\n                100% {\n                    stroke-dashoffset: 283;\n                    transform: rotate(360deg);\n                }\n            }\n        ",this.container.ownerDocument.head.appendChild(n),this.container.style.position="relative";var r=this.container.ownerDocument.createElement("div");r.classList.add("ml-player-spinner-container"),this.container.appendChild(r),this.spinner=this.container.ownerDocument.createElementNS("http://www.w3.org/2000/svg","svg"),this.spinner.style.position="absolute",this.spinner.setAttribute("viewBox","0 0 100 100"),this.spinner.classList.add("ml-player-spinner"),this.spinner.id=this.spinnerId,r.appendChild(this.spinner);var i=this.container.ownerDocument.createElementNS("http://www.w3.org/2000/svg","circle");i.classList.add("ml-player-spinner-dark-wheel"),this.spinner.appendChild(i);var o=this.container.ownerDocument.createElementNS("http://www.w3.org/2000/svg","circle");o.classList.add("ml-player-spinner-light-wheel"),this.spinner.appendChild(o),this.show()}return Object.defineProperty(e.prototype,"firstShowTimestamp",{get:function(){return this.firstSpinnerShowTimestamp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstHideTimestamp",{get:function(){return this.firstSpinnerHideTimestamp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstSpinnerDuration",{get:function(){return this.firstSpinnerShowTimestamp?this.firstSpinnerHideTimestamp?this.firstSpinnerHideTimestamp-this.firstSpinnerShowTimestamp:Date.now()-this.firstSpinnerShowTimestamp:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibilityHistory",{get:function(){if(this.spinnerInfoHistory.length>0){var e=this.spinnerInfoHistory[this.spinnerInfoHistory.length-1];e.hideTimestamp||(e.displayDuration=Date.now()-e.showTimestamp)}return this.spinnerInfoHistory},enumerable:!1,configurable:!0}),e.prototype.show=function(){var e=Date.now();this.firstSpinnerShowTimestamp||(this.firstSpinnerShowTimestamp=e),(0===this.spinnerInfoHistory.length||this.spinnerInfoHistory[this.spinnerInfoHistory.length-1].hideTimestamp)&&(this.spinnerInfoHistory.push({showTimestamp:e,displayDuration:0}),this.spinnerInfoHistory.length>this.maxTimestampHistorySize&&this.spinnerInfoHistory.splice(0,1)),this.spinner.style.display="block"},e.prototype.hide=function(){var e=Date.now();if(this.firstSpinnerHideTimestamp||(this.firstSpinnerHideTimestamp=e),this.spinnerInfoHistory.length>0){var t=this.spinnerInfoHistory[this.spinnerInfoHistory.length-1];t.hideTimestamp||(t.hideTimestamp=e,t.displayDuration=e-t.showTimestamp)}this.spinner.style.display="none"},e.prototype.isVisible=function(){return"none"!==this.spinner.style.display},e}();t.Spinner=n},534:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TimeRanges=t.NO_OP_BUFFERED=t.createVideoElement=t.createVideoElementDiv=t.showPlayerControls=t.getSdnStats=t.repeatUntilCancel=t.wait=t.stringifyError=t.stringifyObject=t.getRandomHexString=t.getPlayerSetting=t.getECSSetting=t.retry=t.createIFrame=t.getMajorFromVersion=void 0;var o=n(798),a=n(34);function s(e,t,n,o,a){return r(this,void 0,void 0,(function(){var s,c,u,d,h=this;return i(this,(function(g){switch(g.label){case 0:return s=100,c=Date.now(),[4,l(n,u={trackingRef:"",timeTakenToDownloadScript:-1},a).catch((function(e){return r(h,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return t="Failed to get IFrame source: ".concat(p(e)),o.push({success:!1,url:n,startTime:c,duration:Date.now()-c,trackingReference:u.trackingRef,timeTakenToDownloadScript:u.timeTakenToDownloadScript,errorMsg:t}),o.length>s&&o.shift(),[4,Promise.reject(new Error(t))];case 1:return[2,r.sent()]}}))}))}))];case 1:return d=g.sent(),t.srcdoc=d,e.appendChild(t),[4,new Promise((function(e,r){t.onload=function(){o.push({success:!0,url:n,startTime:c,duration:Date.now()-c,trackingReference:u.trackingRef,timeTakenToDownloadScript:u.timeTakenToDownloadScript}),o.length>s&&o.shift(),e()},t.onerror=function(e){var t="Failed to load HydraPlayer IFrame: ".concat(p(e));o.push({success:!1,url:n,startTime:c,duration:Date.now()-c,trackingReference:u.trackingRef,timeTakenToDownloadScript:u.timeTakenToDownloadScript,errorMsg:t}),o.length>s&&o.shift(),r(new Error(t))}}))];case 2:return g.sent(),[2]}}))}))}function c(e){return r(this,arguments,void 0,(function(e,t,n){var o=this;return void 0===t&&(t=5),void 0===n&&(n=200),i(this,(function(a){switch(a.label){case 0:return[4,e(t).catch((function(a){return r(o,void 0,void 0,(function(){var o=this;return i(this,(function(s){switch(s.label){case 0:return 0!=--t?[3,2]:[4,Promise.reject(new Error("[retry] retries exhausted: ".concat(h(a))))];case 1:case 3:return[2,s.sent()];case 2:return[4,new Promise((function(s){return setTimeout((function(){s(c(e,t,n).catch((function(e){return r(o,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,Promise.reject(new Error("".concat(a).concat(", ",e)))];case 1:return[2,t.sent()]}}))}))})))}),n)}))]}}))}))}))];case 1:return[2,a.sent()]}}))}))}function l(e,t,n){return r(this,void 0,void 0,(function(){var o,a,s,c=this;return i(this,(function(l){switch(l.label){case 0:return o=Date.now(),[4,u(e,t,n).catch((function(e){return r(c,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,Promise.reject(e)];case 1:return[2,t.sent()]}}))}))}))];case 1:return a=l.sent(),s="<script> ".concat(a,"<\/script>"),t.timeTakenToDownloadScript=Date.now()-o,[2,"\n        <html class style='height: 100%; width: 100%; overflow: hidden'>\n        <head></head>\n        <body class style='height: 100%; width: 100%; margin: 0px'>\n            ".concat(s,"\n        </body>\n        </html>\n    ")]}}))}))}function u(e,t,n){return r(this,void 0,void 0,(function(){var o,a,s,c=this;return i(this,(function(l){switch(l.label){case 0:return o=function(e,t){var n,r;return t.includes("vz")?null!==(r=e.headers.get("uuid"))&&void 0!==r?r:"":null!==(n=e.headers.get("X-Azure-Ref"))&&void 0!==n?n:""},n?(a=new AbortController,s=setTimeout((function(){a.abort()}),n),[4,fetch(e,{signal:a.signal,cache:"no-cache"}).then((function(n){return r(c,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return clearTimeout(s),n.ok?[3,2]:[4,Promise.reject(new Error("".concat(n.status)))];case 1:return[2,r.sent()];case 2:return t.trackingRef=o(n,e),[2,n]}}))}))})).then((function(t){return r(c,void 0,void 0,(function(){var n=this;return i(this,(function(o){switch(o.label){case 0:return[4,t.text().then((function(o){return r(n,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return o?[2,o]:[3,1];case 1:return[4,Promise.reject(new Error("".concat(t.status,", script ").concat(e," contents are null")))];case 2:return[2,n.sent()]}}))}))}))];case 1:return[2,o.sent()]}}))}))})).catch((function(e){return r(c,void 0,void 0,(function(){return i(this,(function(t){throw clearTimeout(s),e}))}))}))]):[3,2];case 1:case 3:return[2,l.sent()];case 2:return[4,fetch(e,{cache:"no-cache"}).then((function(n){return r(c,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return n.ok?[3,2]:[4,Promise.reject(new Error("".concat(n.status)))];case 1:return[2,r.sent()];case 2:return t.trackingRef=o(n,e),[2,n]}}))}))})).then((function(t){return r(c,void 0,void 0,(function(){var n=this;return i(this,(function(o){switch(o.label){case 0:return[4,t.text().then((function(o){return r(n,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return o?[2,o]:[3,1];case 1:return[4,Promise.reject(new Error("".concat(t.status,", script ").concat(e," contents are null")))];case 2:return[2,n.sent()]}}))}))}))];case 1:return[2,o.sent()]}}))}))}))]}}))}))}function d(e,t,n){var r,i=n,o=null===(r=e.ecsSettings)||void 0===r?void 0:r[t];return typeof o==typeof i&&(i=o),i}function p(e){try{if(!e)return"".concat(e);if(e instanceof Map)return function(e){var t={};return e.forEach((function(e,n){t[n.toString()]=e})),JSON.stringify(t)}(e);var t=e.toString();return t.endsWith("[object Object]")?JSON.stringify(e):t}catch(e){return""}}function h(e){return e instanceof Error?e.message:p(e)}function g(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:return t.sent(),[2]}}))}))}t.getMajorFromVersion=function(e){var t=e.match(/^(\d+)\.\d+\.\d+(-.*)?$/);return t?t[1]:null},t.createIFrame=function(e,t,n){return r(this,void 0,void 0,(function(){var o,a,l,u,h,g,f,m,_=this;return i(this,(function(y){switch(y.label){case 0:return o=d(n,"allowSameOrigin",!1),a=n.maxRetryCountForLoadingResources,l=n.disableSandbox,u=n.hydraRuntimeFetchTimeout,h=[],g=Date.now(),(f=e.ownerDocument.createElement("iframe")).id="player-iframe",l||(o?f.sandbox.add("allow-scripts","allow-same-origin"):f.sandbox.add("allow-scripts")),f.allowFullscreen=!0,f.allow="camera; microphone; autoplay",f.style.height="100%",f.style.width="100%",f.style.border="none",m=function(e){return t[e%t.length]},[4,c((function(t){return r(_,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=m(t),[4,s(e,f,n,h,u)];case 1:return r.sent(),[2]}}))}))}),a).then((function(){return{iframe:f,initResult:{initSucceeded:!0,initStartTime:g,initDuration:Date.now()-g,runtimeDownloadResults:h}}})).catch((function(e){return r(_,void 0,void 0,(function(){var n;return i(this,(function(r){return n="Failed to load Hydra player runtime scripts, src: ",t.forEach((function(e){return n=n.concat(e,", ")})),n+="errors: ".concat(p(e)),[2,{initResult:{initSucceeded:!1,initStartTime:g,initDuration:Date.now()-g,runtimeDownloadResults:h,errorMsg:n}}]}))}))}))];case 1:return[2,y.sent()]}}))}))},t.retry=c,t.getECSSetting=d,t.getPlayerSetting=function(e,t){var n;return void 0!==(null===(n=e.ecsSettings)||void 0===n?void 0:n[t])?e.ecsSettings[t]:e[t]},t.getRandomHexString=function(e){return Array.from(Array(e)).map((function(){return Math.floor(16*Math.random()).toString(16)})).join("")},t.stringifyObject=p,t.stringifyError=h,t.wait=g,t.repeatUntilCancel=function(e,t,n,o){var a=!1,s=o||console.log;return s("RepeatUntilCancel starting task: ".concat(e)),r(this,void 0,void 0,(function(){var r,o,c,l;return i(this,(function(i){switch(i.label){case 0:return a?[3,2]:(r=new Date,t(),o=new Date,c=o.getTime()-r.getTime(),(l=n-c)<0&&(l=n+l%n,s("Skipping execution for ".concat(e,", last execution took: ").concat(c," ms, delayMs: ").concat(n),"warn")),[4,g(l)]);case 1:return i.sent(),[3,0];case 2:return[2]}}))})),function(){s("RepeatUntilCancel stopping task: ".concat(e)),a=!0}},t.getSdnStats=function(e,t){(null==e?void 0:e.peer5)&&(t.sdnName=e.peer5?a.HydraSupportedSDN.Microsoft:"",t.sdnVersion=e.peer5?e.peer5.version:"","function"==typeof e.peer5.getStats&&(t.sdnStats=e.peer5.getStats(),t.isP2PSdnUsed=e.peer5.getStats().numOfPeers>0))},t.showPlayerControls=function(e){return void 0!==e.allowPlayerControls?e.allowPlayerControls:e.streamingEventType===o.HydraStreamingEventType.TLE},t.createVideoElementDiv=function(e,t,n){n("createVideoElementDiv started");var r=t.ownerDocument.createElement("div");return r.id=e,r.style.position="relative",r.style.width="100%",r.style.height="100%",t.appendChild(r),n("createVideoElementDiv done"),r},t.createVideoElement=function(e,t,n,r,i){i("createVideoElement started");var o=t.ownerDocument.createElement("video");o.controls=r,o.id=e,o.setAttribute("playsinline","");var a=n.videoLang;a&&(o.setAttribute("lang",a),i("createVideoElement: language set to ".concat(a)));for(var s=n.videoElementStyles,c=0;c<s.length;c++)o.classList.add(s[c]);return o.style.width="100%",o.style.height="100%",o.style.position="absolute",o.muted=n.muteVideo,o.addEventListener("contextmenu",(function(e){e.preventDefault()})),["play","pause","stop","seekbackward","seekforward","seekto","previoustrack","nexttrack"].forEach((function(e){try{navigator.mediaSession.setActionHandler(e,(function(){}))}catch(e){}})),t.appendChild(o),i("createVideoElement done"),o},t.NO_OP_BUFFERED={length:0,start:function(){return 0},end:function(){return 0}},t.TimeRanges={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="[".concat(e.start(r).toFixed(3),"-").concat(e.end(r).toFixed(3),"]");return t},range:function(e){return e&&0!==e.length?[e.start(e.length-1),e.end(e.length-1)]:[0,0]},prevRange:function(e){if(e&&2===e.length)return[e.start(e.length-2),e.end(e.length-2)]}}},382:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamStatistic=void 0;var o=n(798),a=n(137),s=n(534);function c(e,t,n){if(void 0===n&&(n=!1),!e){if(!n)throw new Error("Error".concat(void 0!==t?": ".concat(t):""));console.error("Error".concat(void 0!==t?": ".concat(t):""))}}var l=function(){function e(e,t,n){this.name=e,this.stopCrash=t,this.start(n)}return e.prototype.complete=function(){try{c(this.startTime,"not started",this.stopCrash),c(void 0===this.duration,"already completed",this.stopCrash)}catch(e){if(this.name!==a.PlayerScenarioType.LoadHlsFirstFragment&&this.name!==a.PlayerScenarioType.HlsKeyLoad)throw e}this.duration=Date.now()-this.startTime},e.prototype.fail=function(e){this.failReason=e,this.complete()},e.prototype.setDetail=function(e){this.details=e},e.prototype.getTelemetryEvent=function(){c(this.startTime,"not started",this.stopCrash);var e={name:this.name,startTime:this.startTime,duration:this.duration};return this.failReason&&(e.failReason=this.failReason),this.details&&(e.details=this.details),e},e.prototype.getName=function(){return this.name},e.prototype.getDuration=function(){var e;return null!==(e=this.duration)&&void 0!==e?e:0},e.prototype.getFailReason=function(){return this.failReason},e.prototype.getDetails=function(){return this.details},e.prototype.start=function(e){c(!this.startTime,"already started",this.stopCrash),this.startTime=Date.now(),e&&(this.details=e)},e.prototype.updateDetails=function(e,t){if(this.details&&"object"==typeof this.details)for(var n=0;n<e.length;n++)this.details[e[n]]=t[n]},e}(),u=function(){function e(e,t,n,r,i){this.config=e,this.logFn=t,this.playerDiagnosticsLog=n,this.playerMetadata=r,this.hydraInitResult=i,this.currentScenarioMap=new Map,this.playerEvents=[],this.playbackEvents=[],this.ecdnPluginEvents=[],this.experimentalEvents=[],this.userInitiatedSeekEvents=[],this.callSetupSucceeded=!1,this.callDropped=!1,this.clientNetworkType=void 0,this.maxPlayerPlaybackEventCount=e.maxPlayerPlaybackEventCount||5,this.maxPlayerDiagnosticsCount=e.maxPlayerDiagnosticsCount||5,this.maxPlayerMemoryTraceLogCount=e.maxPlayerMemoryTraceLogCount||100,this.maxPlayerExperimentalEvents=e.maxPlayerExperimentalEvents||100,this.maxUserInitiatedSeekEventCount=s.getECSSetting(this.config,"maxUserInitiatedSeekEventCount",100),s.getECSSetting(this.config,"stopCrash",!1)?this.stopCrash=!1:this.stopCrash=!0,this.config.debugLogging&&(this.playerDiagnosticsLog.memoryLog=[]),this.addNetworkTypeEventListener()}return e.prototype.getPlayerDiagnosticSnapshot=function(){return this.currentPlayerDiagnosticSnapshot},e.prototype.registerStatsUpdated=function(e){var t=this;this.currentPlayerDiagnosticSnapshot=e,Object.keys(this.playerDiagnosticsLog).forEach((function(n){var r,i=n,o=null!==(r=t.playerDiagnosticsLog[n])&&void 0!==r?r:[];if(Array.isArray(o)){o.push(e[i]);var a="memoryLog"===i&&o.length>t.maxPlayerMemoryTraceLogCount,s="memoryLog"!==i&&o.length>t.maxPlayerDiagnosticsCount;(a||s)&&o.splice(0,1)}else t.playerDiagnosticsLog[n]=e[i]}))},e.prototype.registerEventLoadAttempt=function(e,t){this.registerScenario(e,t)},e.prototype.registerEventLoadFailed=function(e,t){this.completeScenario(e,t)},e.prototype.registerEventLoadSucceeded=function(e,t){this.completeScenario(e,void 0,t),e===a.PlayerScenarioType.LoadPlayer&&(this.callSetupSucceeded=!0)},e.prototype.registerSdnPluginLoadAttempt=function(e){this.registerScenario(a.PlayerScenarioType.SdnPluginLoad,e)},e.prototype.registerSdnPluginLoadFailed=function(e){this.completeScenario(a.PlayerScenarioType.SdnPluginLoad,e)},e.prototype.registerSdnPluginLoadSucceeded=function(e){this.completeScenario(a.PlayerScenarioType.SdnPluginLoad,void 0,e)},e.prototype.registerSdnPluginInitializeAttempt=function(e){this.registerScenario(a.PlayerScenarioType.SdnPluginInitialize,e)},e.prototype.registerSdnPluginInitializeFailed=function(e){this.completeScenario(a.PlayerScenarioType.SdnPluginInitialize,e)},e.prototype.registerSdnPluginInitializeSucceeded=function(e){this.completeScenario(a.PlayerScenarioType.SdnPluginInitialize,void 0,e)},e.prototype.registerSdnPluginSetSourceAttempt=function(e){this.registerScenario(a.PlayerScenarioType.SdnPluginSetSource,e)},e.prototype.registerSdnPluginSetSourceFailed=function(e){this.completeScenario(a.PlayerScenarioType.SdnPluginSetSource,e)},e.prototype.registerSdnPluginSetSourceSucceeded=function(e){this.completeScenario(a.PlayerScenarioType.SdnPluginSetSource,void 0,e)},e.prototype.registerStreamConnectionAttempt=function(e){this.registerScenario(a.PlayerScenarioType.StreamConnection,{streamUrl:e})},e.prototype.registerStreamConnectionSucceeded=function(e){var t=this.getScenario(a.PlayerScenarioType.StreamConnection);null==t||t.updateDetails(["results"],[s.stringifyObject(e)]),this.completeScenario(a.PlayerScenarioType.StreamConnection)},e.prototype.registerStreamConnectionFailed=function(e,t){var n=this.getScenario(a.PlayerScenarioType.StreamConnection);null==n||n.updateDetails(["results"],[s.stringifyObject(t)]),this.completeScenario(a.PlayerScenarioType.StreamConnection,e)},e.prototype.registerSetSourceAttempt=function(e,t,n){var r=e||"";n&&(r={src:e||"",isPrimary:s.stringifyObject(t),reason:n}),this.registerScenario(a.PlayerScenarioType.SetSource,r)},e.prototype.registerSetSourceSucceeded=function(e,t,n,r,i){var o=this.getScenario(a.PlayerScenarioType.SetSource);c(o,"no SetSource scenario to update details",this.stopCrash),null==o||o.updateDetails(["src","isPrimary","SwitchingDiagnostics","StepDuration","initialSeekToLiveEdge"],[e,s.stringifyObject(t),s.stringifyObject(n),s.stringifyObject(r),s.stringifyObject(i)]),this.completeScenario(a.PlayerScenarioType.SetSource)},e.prototype.registerSetSourceFailed=function(e,t,n,r,i){var o=null!=t?t:"Failed to find stream url",l=this.getScenario(a.PlayerScenarioType.SetSource);c(l,"no SetSource scenario to update details",this.stopCrash),null==l||l.updateDetails(["src","isPrimary","SwitchingDiagnostics","stepDuration"],[o,s.stringifyObject(n),s.stringifyObject(r),s.stringifyObject(i)]),this.completeScenario(a.PlayerScenarioType.SetSource,e)},e.prototype.registerPlayerDestroyed=function(e){this.registerScenario(a.PlayerScenarioType.Destroyed,e),this.completeScenario(a.PlayerScenarioType.Destroyed)},e.prototype.registerPlaybackStateChanged=function(e){var t,n;if(e!==o.HydraPlayerPlaybackState.CanPlayThrough||this.firstReadyStateTimestamp){if(e===o.HydraPlayerPlaybackState.Playing&&(this.firstPlayingStateTimestamp||(this.firstPlayingStateTimestamp=Date.now()),this.userInitiatedSeekEvents.length>0)){var r=this.userInitiatedSeekEvents[this.userInitiatedSeekEvents.length-1];this.modifyTelemetryEventPayload(r,{playingPosition:null!==(n=null===(t=this.currentPlayerDiagnosticSnapshot)||void 0===t?void 0:t.currentPlayPosition)&&void 0!==n?n:-1,playingTimestamp:Date.now()},!1)}}else this.firstReadyStateTimestamp=Date.now();this.registerPlaybackEvent(a.TelemetryEventType.StateChanged,e)},e.prototype.registerHydraInputStateChanged=function(e,t){this.registerPlaybackEvent(a.TelemetryEventType.HydraInputStateChanged,e,t)},e.prototype.registerHydraOutputStateChanged=function(e,t){this.registerPlaybackEvent(a.TelemetryEventType.HydraOutputStateChanged,e,t)},e.prototype.registerPlaybackBuffering=function(e){this.registerPlaybackEvent(a.TelemetryEventType.Buffering,e)},e.prototype.registerSdnPluginEvent=function(e){var t=this.createTelemetryEvent(a.TelemetryEventType.EcdnPluginEvents,e);this.ecdnPluginEvents.push(t),this.ecdnPluginEvents.length>this.maxPlayerPlaybackEventCount&&this.ecdnPluginEvents.splice(0,1),this.logTelemetryEvent(t)},e.prototype.registerPlaybackError=function(e,t,n){this.registerPlaybackEvent(a.TelemetryEventType.Error,{errorType:e,details:t,errorSource:n})},e.prototype.registerIgnoredPlaybackError=function(e){this.registerPlaybackEvent(a.TelemetryEventType.IgnoredError,e)},e.prototype.registerDownloadBitrateChanged=function(e){this.registerPlaybackEvent(a.TelemetryEventType.BitrateChangedDownload,e)},e.prototype.registerStreamOptionsConfigured=function(e,t){this.registerPlaybackEvent(a.TelemetryEventType.StreamOptionsConfigured,e,t)},e.prototype.registerPlaybackBitrateChanged=function(e){this.registerPlaybackEvent(a.TelemetryEventType.BitrateChangedPlayback,e)},e.prototype.registerVolumeChange=function(e){this.registerPlaybackEvent(a.TelemetryEventType.Volume,e)},e.prototype.getSnapshotReport=function(){var e,t,n=[this.getTotalLoadEvent(),this.getHydraLoadEvent()].concat(this.playerEvents.map((function(e){return e.getTelemetryEvent()}))),i=this.playbackEvents,o={};return this.currentPlayerDiagnosticSnapshot&&(o=this.filterAndPrepareTelemetry()),r(r(r(r(r(r(r(r(r(r(r(r(r(r({isFullReport:!1,configIds:this.config.configIds||"",eTag:this.config.eTag||""},this.getPlayerMetadataReport()),{isIframe:!0,isFullscreenButtonDisabled:!1,telemetryTickMs:null!==(t=null===(e=this.currentPlayerDiagnosticSnapshot)||void 0===e?void 0:e.statsInterval)&&void 0!==t?t:-1}),this.getHydraInitializationReport()),this.getPlayerInitializationReport(n,i)),this.getHydraInternalReport(i)),this.getPlaybackReport(i)),this.getBitrateReport(i)),this.getStreamConnectionReport(n)),this.getSdnReport(n)),this.getSetSourceReport(n)),this.getExperimentalEvents()),this.getUserInitiatedSeekEvents()),{networkType:this.getClientNetworkType(),callSetupSucceeded:this.callSetupSucceeded,callDropped:this.callDropped}),o)},e.prototype.getReport=function(){var e,t,n,i,o=[this.getTotalLoadEvent(),this.getHydraLoadEvent()].concat(this.playerEvents.map((function(e){return e.getTelemetryEvent()}))),a=this.playbackEvents;return r(r(r(r(r(r(r(r(r(r(r(r(r(r(r({isFullReport:!0,configIds:this.config.configIds||"",eTag:this.config.eTag||""},this.getPlayerMetadataReport()),{isIframe:!0,isFullscreenButtonDisabled:!1,telemetryTickMs:null!==(t=null===(e=this.currentPlayerDiagnosticSnapshot)||void 0===e?void 0:e.statsInterval)&&void 0!==t?t:-1}),this.getHydraInitializationReport()),this.getPlayerInitializationReport(o,a)),this.getHydraInternalReport(a)),this.getPlaybackReport(a)),this.getBitrateReport(a)),this.getStreamConnectionReport(o)),this.getSdnReport(o)),this.getSetSourceReport(o)),this.getExperimentalEvents()),this.getUserInitiatedSeekEvents()),{networkType:this.getClientNetworkType(),callSetupSucceeded:this.callSetupSucceeded,callDropped:this.callDropped}),this.getPlayerDiagnosticLog()),{eventId:(null===(n=this.currentPlayerDiagnosticSnapshot)||void 0===n?void 0:n.eventId)||"",templateId:(null===(i=this.currentPlayerDiagnosticSnapshot)||void 0===i?void 0:i.templateId)||""})},e.prototype.getHydraLoadEvent=function(){var e,t,n,r={name:a.PlayerScenarioType.LoadHydra,startTime:(null===(e=this.hydraInitResult)||void 0===e?void 0:e.initStartTime)||-1,duration:(null===(t=this.hydraInitResult)||void 0===t?void 0:t.initDuration)||0};(null===(n=this.hydraInitResult)||void 0===n?void 0:n.errorMsg)&&(r.failReason=this.hydraInitResult.errorMsg);var i=this.getHydraRuntimeDownloadDetails();return i&&(r.details=i),r},e.prototype.getHydraRuntimeDownloadDetails=function(){if(this.hydraInitResult){for(var e=[],t=0,n=this.hydraInitResult.runtimeDownloadResults;t<n.length;t++){var r=n[t],i={success:r.success,url:r.url,startTime:r.startTime,duration:r.duration,trackingReference:r.trackingReference,timeTakenToDownloadScript:r.timeTakenToDownloadScript};r.errorMsg&&(i.errorMsg=r.errorMsg),e.push(i)}return s.stringifyObject(e)}return null},e.prototype.getTotalLoadEvent=function(){var e,t,n,r=this.playerEvents.find((function(e){return e.getName()===a.PlayerScenarioType.LoadPlayer})),i=(null===(e=this.hydraInitResult)||void 0===e?void 0:e.initDuration)||0,o=(null==r?void 0:r.getDuration())||0,s=null==r?void 0:r.getFailReason(),c={name:a.PlayerScenarioType.Load,startTime:(null===(t=this.hydraInitResult)||void 0===t?void 0:t.initStartTime)||-1,duration:i+o};return(null===(n=this.hydraInitResult)||void 0===n?void 0:n.errorMsg)?c.failReason=this.hydraInitResult.errorMsg:s&&(c.failReason=s),c},e.prototype.getPlayerMetadataReport=function(){return{playerId:this.playerMetadata.playerId||"",traceId:this.playerMetadata.playerId?this.playerMetadata.playerId.replace(/-/g,""):"",hydraPlayerRuntimeVersion:this.playerMetadata.hydraPlayerRuntimeVersion||"",hydraPlayerSdkVersion:this.playerMetadata.hydraPlayerSdkVersion,player_playerType:this.playerMetadata.hydraPlayerType}},e.prototype.registerPlaybackEvent=function(e,t,n){var r=this.createTelemetryEvent(e,t,n);e===a.TelemetryEventType.Error&&(null==t?void 0:t.errorType)!==o.HydraPlayerPlaybackErrorType.PlaybackRetried&&(r.fatal=!0,this.callDropped=!0),this.playbackEvents.push(r),this.playbackEvents.length>this.maxPlayerPlaybackEventCount&&this.playbackEvents.splice(0,1),this.logTelemetryEvent(r)},e.prototype.getPlayerDiagnosticLog=function(){var e=this;if(!this.currentPlayerDiagnosticSnapshot)return{};var t=this.currentPlayerDiagnosticSnapshot,n=this.playerDiagnosticsLog,i=r(r({},t),n),o={};return Object.keys(i).forEach((function(t){o["player_".concat(t)]=e.prepareForTelemetry(i[t])})),o},e.prototype.getHydraInitializationReport=function(){var e,t,n,r;return{hydraInit_succeeded:(null===(e=this.hydraInitResult)||void 0===e?void 0:e.initSucceeded)||!1,hydraInit_startTime:(null===(t=this.hydraInitResult)||void 0===t?void 0:t.initStartTime)||-1,hydraInit_errorMessage:(null===(n=this.hydraInitResult)||void 0===n?void 0:n.errorMsg)||"",hydraInit_duration:(null===(r=this.hydraInitResult)||void 0===r?void 0:r.initDuration)||0}},e.prototype.getPlayerInitializationReport=function(e,t){var n=e.find((function(e){return e.name===a.PlayerScenarioType.Load}));return{init_timeLoadToStreamConnectionEstablished:(null!=n&&this.initialStreamConnectionEstablishedTimestamp?this.initialStreamConnectionEstablishedTimestamp-n.startTime:-1)||-1,init_timeLoadToReady:(null!=n&&this.firstReadyStateTimestamp?this.firstReadyStateTimestamp-n.startTime:-1)||-1,init_timeLoadToPlaying:(null!=n&&this.firstPlayingStateTimestamp?this.firstPlayingStateTimestamp-n.startTime:-1)||-1,init_allEvents:this.prepareForTelemetry(e)}},e.prototype.getHydraInternalReport=function(e){var t=e.filter((function(e){return e.eventType===a.TelemetryEventType.HydraInputStateChanged})),n=e.filter((function(e){return e.eventType===a.TelemetryEventType.HydraOutputStateChanged}));return{hydra_inputStateChangeEvents:this.prepareForTelemetry(t),hydra_outputStateChangeEvents:this.prepareForTelemetry(n)}},e.prototype.getPlaybackReport=function(e){var t=e.filter((function(e){return e.eventType===a.TelemetryEventType.StateChanged})),n=t.find((function(e){return e.payload===o.HydraPlayerPlaybackState.CanPlayThrough})),r=t.find((function(e){return e.payload===o.HydraPlayerPlaybackState.Play})),i=t.find((function(e){return e.payload===o.HydraPlayerPlaybackState.Start})),s=t.find((function(e){return e.payload===o.HydraPlayerPlaybackState.Playing})),c=null!=n&&null!=r?r.timestamp-n.timestamp:-1,l=null!=r&&null!=i?i.timestamp-r.timestamp:-1,u=null!=i&&null!=s?s.timestamp-i.timestamp:-1,d=t.filter((function(e){return e.payload===o.HydraPlayerPlaybackState.Seeked})),p=t.filter((function(e){return e.payload===o.HydraPlayerPlaybackState.Seeking})),h=t.filter((function(e){return e.payload===o.HydraPlayerPlaybackState.Pause})),g=t.filter((function(e){return e.payload===o.HydraPlayerPlaybackState.Waiting})),f=[a.TelemetryEventType.BitrateChangedDownload,a.TelemetryEventType.BitrateChangedPlayback,a.TelemetryEventType.Error,a.TelemetryEventType.Mute,a.TelemetryEventType.StateChanged,a.TelemetryEventType.Volume,a.TelemetryEventType.StreamOptionsConfigured,a.TelemetryEventType.IgnoredError],m=e.filter((function(e){return e.eventType===a.TelemetryEventType.Error})),_=e.filter((function(e){return e.eventType===a.TelemetryEventType.IgnoredError})),y=e.filter((function(e){return e.eventType===a.TelemetryEventType.Volume||e.eventType===a.TelemetryEventType.Mute})),v=e.filter((function(e){return e.eventType===a.TelemetryEventType.StreamOptionsConfigured})),S=e.filter((function(e){return!f.includes(e.eventType)}));return{playback_timeReadyToPlay:c,playback_timePlayToStart:l,playback_timeStartToPlaying:u,playback_bufferingEvents:this.prepareForTelemetry(g),playback_errorEvents:this.prepareForTelemetry(m),playback_ignoredErrorEvents:this.prepareForTelemetry(_),playback_pauseEvents:this.prepareForTelemetry(h),playback_otherEvents:this.prepareForTelemetry(S),playback_seekedEvents:this.prepareForTelemetry(d),playback_seekingEvents:this.prepareForTelemetry(p),playback_stateChangeEvents:this.prepareForTelemetry(t),playback_volumeEvents:this.prepareForTelemetry(y),playback_streamOptionsConfiguredEvents:this.prepareForTelemetry(v)}},e.prototype.getBitrateReport=function(e){var t,n,i,o,s=e.filter((function(e){return e.eventType===a.TelemetryEventType.BitrateChangedDownload})),c=s.sort((function(e){return Number(e.payload)})),l=s.length>0?{bitrate_downloadChanges:this.prepareForTelemetry(s),bitrate_downloadChangeCount:s.length>0||-1,bitrate_downloadMin:(null===(t=c[0])||void 0===t?void 0:t.payload)||-1,bitrate_downloadMax:(null===(n=c[c.length-1])||void 0===n?void 0:n.payload)||-1}:{},u=e.filter((function(e){return e.eventType===a.TelemetryEventType.BitrateChangedPlayback})),d=u.sort((function(e){return Number(e.payload)})),p=u.length>0?{bitrate_playbackChanges:this.prepareForTelemetry(u),bitrate_playbackChangeCount:u.length>0||-1,bitrate_playbackMin:(null===(i=d[0])||void 0===i?void 0:i.payload)||-1,bitrate_playbackMax:(null===(o=d[d.length-1])||void 0===o?void 0:o.payload)||-1}:{};return r(r({},l),p)},e.prototype.addNetworkTypeEventListener=function(){var e,t,n,r,i=this;(null===(t=null===(e=window.navigator)||void 0===e?void 0:e.connection)||void 0===t?void 0:t.type)&&(null===(r=null===(n=window.navigator)||void 0===n?void 0:n.connection)||void 0===r||r.addEventListener("change",(function(){i.updateClientNetworkType()})))},e.prototype.updateClientNetworkType=function(){this.clientNetworkType=void 0,this.getClientNetworkType()},e.prototype.getClientNetworkType=function(){var e,t,n,r;if(void 0===this.clientNetworkType){var i="Unknown";if(null===(t=null===(e=window.navigator)||void 0===e?void 0:e.connection)||void 0===t?void 0:t.type)switch(null===(r=null===(n=window.navigator)||void 0===n?void 0:n.connection)||void 0===r?void 0:r.type){case"cellular":i="WWAN";break;case"ethernet":i="Wired";break;case"wifi":i="Wireless";break;default:i="Unknown"}this.clientNetworkType=i}return this.clientNetworkType},e.prototype.getSdnReport=function(e){var t,n=e.filter((function(e){return[a.PlayerScenarioType.SdnPluginLoad,a.PlayerScenarioType.SdnPluginInitialize,a.PlayerScenarioType.SdnPluginSetSource].includes(e.name)})),r=i(i([],n,!0),this.ecdnPluginEvents,!0),o=n.filter((function(e){return void 0!==e.failReason})),s=n.filter((function(e){return e.name===a.PlayerScenarioType.SdnPluginLoad})).sort((function(e,t){return t.startTime-e.startTime}))[0];return{sdn_loaded:!(null==s||void 0!==s.failReason),sdn_details:null!==(t=null==s?void 0:s.details)&&void 0!==t?t:"",sdn_error:o.length>0&&o[o.length-1].failReason||"",sdn_events:this.prepareForTelemetry(r)}},e.prototype.getStreamConnectionReport=function(e){var t=e.filter((function(e){return e.name===a.PlayerScenarioType.StreamConnection}));return{stream_connection_events:this.prepareForTelemetry(t)}},e.prototype.getSetSourceReport=function(e){var t=e.filter((function(e){return e.name===a.PlayerScenarioType.SetSource}));return{set_source_events:this.prepareForTelemetry(t)}},e.prototype.registerScenario=function(e,t){var n=this.currentScenarioMap.get(e),r=new l(e,this.stopCrash,t);try{c(null==n,"previous scenario:".concat(s.stringifyObject(n)," is not completed, new scenario:").concat(s.stringifyObject(r)),this.stopCrash)}catch(t){if(e!==a.PlayerScenarioType.LoadHlsFirstFragment&&e!==a.PlayerScenarioType.HlsKeyLoad)throw t}this.currentScenarioMap.set(e,r),this.playerEvents.push(r)},e.prototype.completeScenario=function(e,t,n){var r=this.currentScenarioMap.get(e);try{c(r,"no scenario to complete",this.stopCrash)}catch(t){if(e!==a.PlayerScenarioType.LoadHlsFirstFragment&&e!==a.PlayerScenarioType.HlsKeyLoad)throw t}t?null==r||r.fail(t):(e!==a.PlayerScenarioType.StreamConnection||this.initialStreamConnectionEstablishedTimestamp||(this.initialStreamConnectionEstablishedTimestamp=Date.now()),n&&(null==r||r.setDetail(n)),null==r||r.complete()),this.currentScenarioMap.delete(e)},e.prototype.logTelemetryEvent=function(e){this.config.debugLogging&&(this.logFn("debug","PlayerTelemetryEvent: ".concat(JSON.stringify(e))),this.logFn("debug","PlayerDiagnosticData: ".concat(JSON.stringify(this.currentPlayerDiagnosticSnapshot))))},e.prototype.filterAndPrepareTelemetry=function(){var e=this,t=new Set;t.add("serviceLatencyCdg"),t.add("endToEndLatencyCdg"),t.add("videoEdgeLatencyCdg"),t.add("eventId"),t.add("templateId");var n={};return Object.keys(this.currentPlayerDiagnosticSnapshot).forEach((function(r){t.has(r)||(n["player_".concat(r)]=e.prepareForTelemetry(e.currentPlayerDiagnosticSnapshot[r]))})),n},e.prototype.prepareForTelemetry=function(e){return"boolean"==typeof e?e:"string"==typeof e||void 0===e?e||"":"number"==typeof e?null!=e?e:-1:JSON.stringify(e)},e.prototype.getScenario=function(e){return this.currentScenarioMap.get(e)},e.prototype.createTelemetryEvent=function(e,t,n){var r,i,o={eventType:e,timestamp:Date.now(),currentPlayPosition:null!==(i=null===(r=this.currentPlayerDiagnosticSnapshot)||void 0===r?void 0:r.currentPlayPosition)&&void 0!==i?i:-1};return void 0!==t&&(o.payload=this.prepareForTelemetry(t)),o.message=n,o},e.prototype.modifyTelemetryEventPayload=function(e,t,n){if(e.payload)try{var i=JSON.parse(e.payload);i=n?r(r({},i),t):r(r({},t),i),e.payload=this.prepareForTelemetry(i)}catch(t){this.logFn("error","Failed to parse payload for event: ".concat(s.stringifyObject(e),", error: ").concat(t))}},e.prototype.registerExperimentalEvent=function(e,t,n){var r=this.createTelemetryEvent(e,t,n);this.experimentalEvents.push(r),this.experimentalEvents.length>this.maxPlayerExperimentalEvents&&this.experimentalEvents.splice(0,1),this.logTelemetryEvent(r)},e.prototype.getExperimentalEvents=function(){return{playback_experimentalEvents:this.prepareForTelemetry(this.experimentalEvents)}},e.prototype.registerUserInitiatedSeek=function(e){var t,n,r={newCurrentPlayPosition:e,seekForward:(null!==(n=null===(t=this.currentPlayerDiagnosticSnapshot)||void 0===t?void 0:t.currentPlayPosition)&&void 0!==n?n:-1)<e},i=this.createTelemetryEvent(a.TelemetryEventType.UserInitiatedSeek,r);this.userInitiatedSeekEvents.push(i),this.userInitiatedSeekEvents.length>this.maxUserInitiatedSeekEventCount&&this.userInitiatedSeekEvents.splice(0,1)},e.prototype.getUserInitiatedSeekEvents=function(){return{playback_userInitiatedSeekEvents:this.prepareForTelemetry(this.userInitiatedSeekEvents)}},e}();t.LiveStreamStatistic=u},154:function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageType=void 0,function(e){e.Command="Command",e.CommandSuccessResult="CommandSuccessResult",e.CommandFailureResult="CommandFailureResult",e.PlayerEvent="PlayerEvent",e.InternalPlayerEvent="InternalPlayerEvent"}(n||(t.MessageType=n={}))},34:function(e,t){var n,r,i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.HydraSupportedSDN=t.HydraPlayerDestroyedReason=t.HydraOutputState=t.HydraInputState=t.HydraPlayerPlaybackErrorSource=void 0,function(e){e.Stream="Stream",e.HydraPipeline="HydraPipeline",e.VideoPlayer="VideoPlayer"}(n||(t.HydraPlayerPlaybackErrorSource=n={})),function(e){e.Idle="Idle",e.Started="Started",e.BufferReceived="BufferReceived",e.Ended="Ended",e.Stopped="Stopped",e.Destroyed="Destroyed"}(r||(t.HydraInputState=r={})),function(e){e.Idle="Idle",e.Attached="Attached",e.Starting="Starting",e.Started="Started",e.BufferReceived="BufferReceived",e.BufferAppended="BufferAppended",e.Stopped="Stopped",e.Destroyed="Destroyed"}(i||(t.HydraOutputState=i={})),function(e){e.PlayerStopped="PlayerStopped",e.PlaybackError="PlaybackError"}(o||(t.HydraPlayerDestroyedReason=o={})),function(e){e.Hive="hive",e.Kollective="kollective",e.Ramp="ramp",e.Peer5="peer5",e.Microsoft="microsoft"}(a||(t.HydraSupportedSDN=a={}))},137:function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerScenarioType=t.TelemetryEventType=void 0,function(e){e.BitrateChangedDownload="BitrateChangedDownload",e.StreamOptionsConfigured="StreamOptionsConfigured",e.BitrateChangedPlayback="BitrateChangedPlayback",e.CaptionsToggled="CaptionsToggled",e.Error="Error",e.IgnoredError="IgnoredError",e.FullscreenChanged="FullscreenChanged",e.Mute="Mute",e.PotentialMediaFreeze="PotentialMediaFreeze",e.StateChanged="StateChanged",e.HydraInputStateChanged="HydraInputStateChanged",e.HydraOutputStateChanged="HydraOutputStateChanged",e.Volume="Volume",e.Buffering="Buffering",e.Online="Online",e.Offline="Offline",e.NetworkChange="NetworkChange",e.HlsEvents="HlsEvents",e.EcdnPluginEvents="EcdnPluginEvents",e.UserInitiatedSeek="UserInitiatedSeek"}(n||(t.TelemetryEventType=n={})),function(e){e.LoadHydra="LoadHydra",e.LoadHlsScript="LoadHlsScript",e.LoadPlayer="LoadPlayer",e.Load="Load",e.LoadHlsAuthCookie="LoadHlsAuthCookie",e.HlsManifestLoad="HlsManifestLoad",e.HlsKeyLoad="HlsKeyLoad",e.LoadHlsFirstFragment="LoadHlsFirstFragment",e.SetSource="SetSource",e.SdnPluginLoad="SdnPluginLoad",e.ThaPluginLoad="ThaPluginLoad",e.HydraPipelineInitialization="HydraPipelineInitialization",e.Destroyed="Destroyed",e.Setup="Setup",e.StreamConnection="StreamConnection",e.SdnPluginInitialize="SdnPluginInitialize",e.SdnPluginSetSource="SdnPluginSetSource"}(r||(t.PlayerScenarioType=r={}))},564:function(e,t){var n,r,i,o,a,s,c,l;Object.defineProperty(t,"__esModule",{value:!0}),t.UmsModality=t.IframeMessages=t.HydraPlayerPlaybackErrorType=t.HydraPlayerPlaybackState=t.HydraPlayerSetupErrorType=t.HydraStreamDeliveryPipeline=t.HydraPlayerType=t.HydraStreamingEventType=void 0,function(e){e.TLE="TLE",e.Overflow="Overflow",e.TownHallBasic="TownHall_Basic",e.TownHallPremium="TownHall_Premium",e.TownHall="TownHall"}(n||(t.HydraStreamingEventType=n={})),function(e){e[e.Hls=1]="Hls",e[e.Ums=2]="Ums"}(r||(t.HydraPlayerType=r={})),function(e){e.AMS="AMS",e.HLS="MiddleLaneHttpLiveStreaming",e.Ums="MiddleLaneUltraLowLatency"}(i||(t.HydraStreamDeliveryPipeline=i={})),function(e){e.MultiplePlayerLoad="MultiplePlayerLoad",e.PlayerInitializationFailed="PlayerInitializationFailed",e.InvalidStream="InvalidStream",e.SetSourceFailed="SetSourceFailed"}(o||(t.HydraPlayerSetupErrorType=o={})),function(e){e.LoadStart="loadstart",e.LoadedData="loadeddata",e.LoadedMetadata="loadedmetadata",e.Start="start",e.CanPlayThrough="canplaythrough",e.Play="play",e.Playing="playing",e.Pause="pause",e.Waiting="waiting",e.Seeking="seeking",e.Seeked="seeked",e.Ended="ended",e.Error="error",e.Destroyed="destroyed",e.Initialized="initialized",e.Stalled="stalled",e.VolumeChange="volumechange",e.PlaybackBitrateChanged="playbackbitratechanged",e.DownloadBitrateChanged="downloadbitratechanged",e.TimeUpdate="timeupdate",e.DurationChange="durationchange",e.HlsKeyLoading="hlsKeyLoading",e.HlsKeyLoaded="hlsKeyLoaded",e.HlsKeyLoadedFailed="hlsKeyLoadedFailed",e.HlsManifestLoading="hlsManifestLoading",e.HlsManifestLoaded="hlsManifestLoaded",e.HlsManifestLoadedFailed="hlsManifestLoadedFailed",e.HlsFirstFragmentLoading="hlsFragLoading",e.HlsFirstFragmentBuffered="hlsFragBuffered",e.HlsFirstFragmentLoadFailed="hlsFirstFragmentLoadFailed",e.Online="online",e.Offline="offline",e.NetworkChange="networkChange"}(a||(t.HydraPlayerPlaybackState=a={})),function(e){e.UnsupportedPlatform="UnsupportedPlatform",e.NetworkError="NetworkError",e.PlaybackRetried="PlaybackRetried",e.PlaybackError="PlaybackError",e.Unknown="Unknown"}(s||(t.HydraPlayerPlaybackErrorType=s={})),function(e){e.RequestIceCandidates="RequestIceCandidates"}(c||(t.IframeMessages=c={})),function(e){e.audio="Audio",e.video="Video",e.text="Text"}(l||(t.UmsModality=l={}))},521:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.HydraPlayer=t.getSdkVersion=void 0;var o=n(798),a=n(154),s=n(715),c=n(357),l=n(534),u=n(42),d=n(103),p=n(282),h=n(10);t.getSdkVersion=function(){return"4.24151.3"};var g=function(){function e(e,t){this.playerSettings=e,this.eventHandler=t,this.spinner=null,this.telemetryReportHandler=null,this.playerInternalEventHandler=null,this.playerRuntimeUrls=[],this.commandResultsMap=new Map,this.iframeCommunicationHandler=null,this.MAX_COMMAND_RESULTS_MAP_SIZE=1e4}return e.prototype.dispose=function(){var e;null===(e=this.telemetryReportHandler)||void 0===e||e.addDisposeTelemetry(),this.isIFrameCommunicationActive()&&this.callPlayerApi("disposeHydraPlayer")},e.prototype.release=function(){var e;null===(e=this.spinner)||void 0===e||e.hide(),this.contextWindow&&this.contextWindow.removeEventListener("message",this.onMessage.bind(this)),this.iframeCommunicationHandler&&this.iframeCommunicationHandler.dispose(),this.iframe&&this.container&&this.container.hasChildNodes()&&this.container.removeChild(this.iframe)},e.prototype.setup=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=!1,this.container=e,this.spinner=new u.Spinner(this.container),[4,this.initializeIFrame()];case 1:if(n=i.sent(),this.telemetryReportHandler=new c.TelemetryReportHandler(this.playerSettings,this.eventHandler.log.bind(this.eventHandler),n,this.spinner),this.playerInternalEventHandler=new s.HydraPlayerInternalEventHandler(this.spinner,this.telemetryReportHandler),!n.initSucceeded)return[3,9];i.label=2;case 2:return i.trys.push([2,4,,9]),[4,this.callPlayerApi("createHydraPlayer",this.playerSettings,n)];case 3:return i.sent(),t=!0,[3,9];case 4:return r=i.sent(),this.eventHandler.log("warn","Failed to create HydraPlayer: ".concat(r)),this.playerSettings.playerType!==o.HydraPlayerType.Hls?[3,6]:[4,this.callPlayerApi("createHlsHydraPlayer",this.playerSettings,n)];case 5:return i.sent(),t=!0,[3,8];case 6:return this.playerSettings.playerType!==o.HydraPlayerType.Ums?[3,8]:[4,this.callPlayerApi("createUmsHydraPlayer",this.playerSettings,n)];case 7:i.sent(),t=!0,i.label=8;case 8:return[3,9];case 9:return t||(this.eventHandler.log("error","Failed to setup HydraPlayer: ".concat(null==n?void 0:n.errorMsg)),this.spinner.hide()),[2,t]}}))}))},e.prototype.getFullTelemetryReport=function(){var e;return(null===(e=this.telemetryReportHandler)||void 0===e?void 0:e.getFullTelemetryReport())||{}},e.prototype.getSnapshotTelemetryReport=function(){var e;return(null===(e=this.telemetryReportHandler)||void 0===e?void 0:e.getSnapshotTelemetryReport())||{}},e.prototype.callPlayerApi=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r(this,void 0,void 0,(function(){var n,r,o,s,c;return i(this,(function(i){switch(i.label){case 0:return this.iframe?[3,2]:[4,Promise.reject(new Error("Hydra IFrame not initialized yet"))];case 1:case 3:return[2,i.sent()];case 2:if(n=(0,h.default)(),r={msgType:a.MessageType.Command,id:n,name:e,args:t},!this.isIFrameCommunicationActive())throw new Error("IFrame MessageAPI communication not active");if(this.commandResultsMap.size>=this.MAX_COMMAND_RESULTS_MAP_SIZE)throw new Error("Too many Hydra player API commands in progress - skipping this player API call");return o=d.defer(),s={name:e,id:n},this.commandResultsMap.set(s,o),null===(c=this.iframe.contentWindow)||void 0===c||c.postMessage(r,"*"),[4,o.promise]}}))}))},Object.defineProperty(e.prototype,"contextWindow",{get:function(){var e;return null===(e=this.container)||void 0===e?void 0:e.ownerDocument.defaultView},enumerable:!1,configurable:!0}),e.prototype.isIFrameCommunicationActive=function(){var e;return!!(null===(e=this.iframe)||void 0===e?void 0:e.contentWindow)&&!!this.contextWindow},e.prototype.getRuntimeUrls=function(e){if(!Array.isArray(this.playerSettings.playerRuntimeJsUrls)){var t=(0,l.getMajorFromVersion)(e);return t&&this.playerSettings.playerRuntimeJsUrls[t]||[]}return this.playerSettings.playerRuntimeJsUrls},e.prototype.initializeIFrame=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.playerSettings.hydraPlayerSdkVersion="4.24151.3",this.playerRuntimeUrls=this.getRuntimeUrls(this.playerSettings.hydraPlayerSdkVersion),0!==this.playerRuntimeUrls.length&&this.container?[4,(0,l.createIFrame)(this.container,this.playerRuntimeUrls,this.playerSettings)]:[2,{initSucceeded:!1,initStartTime:Date.now(),initDuration:0,runtimeDownloadResults:[],errorMsg:"No compatible runtime URLs provided for HydraPlayer SDK version: ".concat(this.playerSettings.hydraPlayerSdkVersion,",\n                    URLs: ").concat((0,l.stringifyObject)(this.playerSettings.playerRuntimeJsUrls))}];case 1:return(e=t.sent()).initResult.initSucceeded&&e.iframe&&(this.iframe=e.iframe,this.iframeCommunicationHandler=new p.IframeCommunicationHandler(this.iframe,this.playerSettings,this.eventHandler.log),this.contextWindow.addEventListener("message",this.onMessage.bind(this))),[2,e.initResult]}}))}))},e.prototype.onMessage=function(e){switch(e.data.msgType){case a.MessageType.PlayerEvent:this.processPlayerEvent(e.data);break;case a.MessageType.InternalPlayerEvent:this.processInternalPlayerEvent(e.data);break;case a.MessageType.CommandSuccessResult:this.processCommandSuccessResult(e.data);break;case a.MessageType.CommandFailureResult:this.processCommandFailureResult(e.data)}},e.prototype.processCommandSuccessResult=function(e){var t=this;this.eventHandler.log("debug","HydraPlayer command succeeded for ".concat(e.name," - result: ").concat((0,l.stringifyObject)(e.result))),this.getMapCommandResults(e).forEach((function(n){n[1].resolve(e.result),t.commandResultsMap.delete(n[0])}))},e.prototype.processCommandFailureResult=function(e){var t=this;this.eventHandler.log("debug","HydraPlayer command failed for ".concat(e.name," - error: ").concat(e.error.message)),this.getMapCommandResults(e).forEach((function(n){n[1].reject(e.error),t.commandResultsMap.delete(n[0])}))},e.prototype.getMapCommandResults=function(e){var t=Array.from(this.commandResultsMap.entries()),n=[];return e.id?n=t.filter((function(t){return t[0].id===e.id})):e.name&&(n=t.filter((function(t){return t[0].name===e.name}))),n},e.prototype.processPlayerEvent=function(e){var t;null===(t=this.eventHandler[e.name])||void 0===t||t.apply(this.eventHandler,e.args)},e.prototype.processInternalPlayerEvent=function(e){this.playerInternalEventHandler&&this.playerInternalEventHandler[e.name].apply(this,e.args)},e}();t.HydraPlayer=g},282:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.IframeCommunicationHandler=void 0;var r=n(798),i=n(735),o=function(){function e(e,t,n){var r=this;this.iframe=e,this.playerSettings=t,this.logger=n,this.setupMessageListener(),this.candidatesCollector=new i.WebRtcIceCandidateCollector(this.playerSettings),this.candidatesCollector.startCandidatesCollection().catch((function(e){r.logger("warn","Failed to start collecting ICE candidates ".concat(e))}))}return e.prototype.setupMessageListener=function(){var e;null===(e=this.iframe.ownerDocument.defaultView)||void 0===e||e.addEventListener("message",this.processMessage.bind(this))},e.prototype.postMessageToIframe=function(e){var t;null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(e,"*")},e.prototype.dispose=function(){var e;null===(e=this.iframe.ownerDocument.defaultView)||void 0===e||e.removeEventListener("message",this.processMessage.bind(this)),this.candidatesCollector&&this.candidatesCollector.destroy()},e.prototype.processMessage=function(e){var t=this;e.data===r.IframeMessages.RequestIceCandidates&&void 0===e.data.candidates&&this.candidatesCollector.getCandidates().then((function(e){var n=JSON.stringify(e.map((function(e){return JSON.stringify(e)})));t.postMessageToIframe({topic:r.IframeMessages.RequestIceCandidates,candidates:n})})).catch((function(){t.postMessageToIframe({topic:r.IframeMessages.RequestIceCandidates,candidates:[]})}))},e}();t.IframeCommunicationHandler=o},260:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(521),t),i(n(564),t)},715:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HydraPlayerInternalEventHandler=void 0;var n=function(){function e(e,t){this.spinner=e,this.telemetryReportHandler=t}return e.prototype.firstPlayerLoadAttemptDone=function(){this.spinner.hide()},e.prototype.fullTelemetryReportUpdated=function(e){this.telemetryReportHandler.setFullTelemetryReport(e)},e.prototype.snapshotTelemetryReportUpdated=function(e){this.telemetryReportHandler.setSnapshotTelemetryReport(e)},e}();t.HydraPlayerInternalEventHandler=n},357:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryReportHandler=void 0;var i=n(798),o=n(34),a=n(137),s=n(382),c=n(534),l=function(){function e(e,t,n,r){var o=this;this.logFn=t,this.spinner=r;var a=new s.LiveStreamStatistic(e,(function(e,t){o.logFn(e,t)}),{videoBufferLength:[],videoCachedLength:[],videoEdgeLatency:[],playerHeight:[],playerWidth:[],mediaHeight:[],mediaWidth:[],windowHeight:[],windowWidth:[],playbackRate:[],currentPlayPosition:[],statsInterval:[]},{hydraPlayerSdkVersion:e.hydraPlayerSdkVersion||"Unknown",hydraPlayerType:i.HydraPlayerType.Hls},n);this.fullTelemetryReport=a.getReport(),this.snapshotTelemetryReport=a.getSnapshotReport()}return e.prototype.getFullTelemetryReport=function(){return this.fullTelemetryReport},e.prototype.getSnapshotTelemetryReport=function(){return this.snapshotTelemetryReport},e.prototype.setFullTelemetryReport=function(e){this.fullTelemetryReport=r({},e)},e.prototype.setSnapshotTelemetryReport=function(e){var t,n,i;this.snapshotTelemetryReport=r(r({},e),{init_spinnerShowTimestamp:null!==(t=this.spinner.firstShowTimestamp)&&void 0!==t?t:-1,init_spinnerHideTimestamp:null!==(n=this.spinner.firstHideTimestamp)&&void 0!==n?n:-1,init_spinnerDuration:null!==(i=this.spinner.firstSpinnerDuration)&&void 0!==i?i:-1,init_spinnerVisible:this.spinner.isVisible()})},e.prototype.addDisposeTelemetry=function(){var e=Date.now();this.updateInitEventsWithDisposeEvent(this.fullTelemetryReport,e,"full"),this.updateInitEventsWithDisposeEvent(this.snapshotTelemetryReport,e,"snapshot"),this.updateStateChangeEventsWithDisposeEvent(this.fullTelemetryReport,e,"full"),this.updateStateChangeEventsWithDisposeEvent(this.snapshotTelemetryReport,e,"snapshot")},e.prototype.updateInitEventsWithDisposeEvent=function(e,t,n){try{var r=e.init_allEvents,i=JSON.parse(r);i[i.length-1].name!==a.PlayerScenarioType.Destroyed&&i.push({name:a.PlayerScenarioType.Destroyed,startTime:t,duration:0,details:o.HydraPlayerDestroyedReason.PlayerStopped}),e.init_allEvents=(0,c.stringifyObject)(i)}catch(e){this.logFn("warn","Failed to add player destroyed information to init_allEvents telemetry field in ".concat(n," telemetry report."))}},e.prototype.updateStateChangeEventsWithDisposeEvent=function(e,t,n){try{var r=e.playback_stateChangeEvents,o=JSON.parse(r);o[o.length-1].name!==i.HydraPlayerPlaybackState.Destroyed&&o.push({eventType:a.TelemetryEventType.StateChanged,timestamp:t,currentPlayPosition:-1,payload:i.HydraPlayerPlaybackState.Destroyed}),e.playback_stateChangeEvents=(0,c.stringifyObject)(o)}catch(e){this.logFn("warn","Failed to add player destroyed information to playback_stateChangeEvents telemetry field in ".concat(n," telemetry report."))}},e}();t.TelemetryReportHandler=l},735:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRtcIceCandidateCollector=void 0;var a=n(103),s=n(534),c=function(){function e(e){this.playerSettings=e,this.latestCandidates=[],this.newCandidates=[],this.peerConnection=null,this.timeoutId=void 0,this.candidatesCollectionDefer=null,this.delayAfterComplete=(0,s.getECSSetting)(this.playerSettings,"WebRtcIceCandidateCollectorDelayAfterCompleteMs",2500),this.delayAfterError=(0,s.getECSSetting)(this.playerSettings,"WebRtcIceCandidateCollectorDelayAfterErrorMs",1e3),this.maxRetries=(0,s.getECSSetting)(this.playerSettings,"WebRtcIceCandidateCollectorMaxRetriesMs",5),this.retryDelay=(0,s.getECSSetting)(this.playerSettings,"WebRtcIceCandidateCollectorRetryDelayMs",100),this.maxCollectionTime=(0,s.getECSSetting)(this.playerSettings,"WebRtcIceCandidateCollectorMaxCollectionTimeMs",6e4),this.disabledCollection=(0,s.getECSSetting)(this.playerSettings,"WebRtcIceCandidateCollectorDisableCollection",!1)}return e.prototype.handleIceCandidate=function(e){e.candidate&&this.newCandidates.push(e.candidate)},e.prototype.handleIceGatheringStateChange=function(){var e,t;"complete"===(null===(e=this.peerConnection)||void 0===e?void 0:e.iceGatheringState)&&(this.latestCandidates=o([],this.newCandidates,!0),this.newCandidates=[],null===(t=this.candidatesCollectionDefer)||void 0===t||t.resolve(),this.candidatesCollectionDefer=null,this.destroyConnection(),this.clearCollectionTimeout(),this.startCandidatesCollection(this.delayAfterComplete))},e.prototype.setUpPeerConnection=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),this.peerConnection=new RTCPeerConnection,this.peerConnection.createDataChannel("local-ip-hydra-player-ice-candidates"),this.peerConnection.addEventListener("icecandidate",this.handleIceCandidate.bind(this)),this.peerConnection.addEventListener("icegatheringstatechange",this.handleIceGatheringStateChange.bind(this)),[4,null===(n=this.peerConnection)||void 0===n?void 0:n.createOffer()];case 1:return e=i.sent(),[4,null===(r=this.peerConnection)||void 0===r?void 0:r.setLocalDescription(e)];case 2:return i.sent(),[3,4];case 3:throw t=i.sent(),this.destroyConnection(),new Error("Failure starting collection: ".concat((0,s.stringifyError)(t)));case 4:return[2]}}))}))},e.prototype.destroyConnection=function(){this.peerConnection&&(this.peerConnection.removeEventListener("icecandidate",this.handleIceCandidate.bind(this)),this.peerConnection.removeEventListener("icegatheringstatechange",this.handleIceGatheringStateChange.bind(this)),this.peerConnection.close(),this.peerConnection=null)},e.prototype.clearCollectionTimeout=function(){void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0)},e.prototype.destroy=function(){this.disabledCollection=!0,this.destroyConnection(),this.clearCollectionTimeout(),this.candidatesCollectionDefer&&(this.candidatesCollectionDefer.reject(new Error("Collection aborted due to destroy")),this.candidatesCollectionDefer=null)},e.prototype.startCandidatesCollection=function(){return r(this,arguments,void 0,(function(e){var t,n=this;return void 0===e&&(e=0),i(this,(function(o){switch(o.label){case 0:return this.candidatesCollectionDefer||this.disabledCollection?[2]:e>0?[4,new Promise((function(t){return setTimeout(t,e)}))]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.candidatesCollectionDefer=(0,a.defer)(),this.candidatesCollectionDefer.promise.catch((function(){})),t=this.setUpPeerConnection.bind(this),[4,(0,s.retry)(t,this.maxRetries,this.retryDelay).then((function(){n.timeoutId=setTimeout((function(){var e;null===(e=n.candidatesCollectionDefer)||void 0===e||e.reject(new Error("Collection timed out")),n.candidatesCollectionDefer=null,n.destroyConnection(),n.startCandidatesCollection(n.delayAfterError)}),n.maxCollectionTime)})).catch((function(e){return r(n,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t="Failed to start collection ".concat((0,s.stringifyError)(e)),null===(n=this.candidatesCollectionDefer)||void 0===n||n.reject(new Error(t)),this.candidatesCollectionDefer=null,[4,Promise.reject(new Error(t))];case 1:return r.sent(),this.startCandidatesCollection(this.delayAfterError),[2]}}))}))}))];case 3:return o.sent(),[2]}}))}))},e.prototype.getCandidates=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return 0===this.latestCandidates.length&&this.candidatesCollectionDefer?[4,this.candidatesCollectionDefer.promise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2,this.latestCandidates]}}))}))},e}();t.WebRtcIceCandidateCollector=c},798:function(e,t){var n,r,i,o,a,s,c;Object.defineProperty(t,"__esModule",{value:!0}),t.IframeMessages=t.HydraPlayerPlaybackErrorType=t.HydraPlayerPlaybackState=t.HydraPlayerSetupErrorType=t.HydraStreamDeliveryPipeline=t.HydraPlayerType=t.HydraStreamingEventType=void 0,function(e){e.TLE="TLE",e.Overflow="Overflow",e.TownHallBasic="TownHall_Basic",e.TownHallPremium="TownHall_Premium",e.TownHall="TownHall"}(n||(t.HydraStreamingEventType=n={})),function(e){e[e.Hls=1]="Hls",e[e.Ums=2]="Ums"}(r||(t.HydraPlayerType=r={})),function(e){e.AMS="AMS",e.HLS="MiddleLaneHttpLiveStreaming",e.Ums="MiddleLaneUltraLowLatency"}(i||(t.HydraStreamDeliveryPipeline=i={})),function(e){e.MultiplePlayerLoad="MultiplePlayerLoad",e.PlayerInitializationFailed="PlayerInitializationFailed",e.InvalidStream="InvalidStream",e.SetSourceFailed="SetSourceFailed"}(o||(t.HydraPlayerSetupErrorType=o={})),function(e){e.LoadStart="loadstart",e.LoadedData="loadeddata",e.LoadedMetadata="loadedmetadata",e.Start="start",e.CanPlayThrough="canplaythrough",e.Play="play",e.Playing="playing",e.Pause="pause",e.Waiting="waiting",e.Seeking="seeking",e.Seeked="seeked",e.Ended="ended",e.Error="error",e.Destroyed="destroyed",e.Initialized="initialized",e.Stalled="stalled",e.VolumeChange="volumechange",e.PlaybackBitrateChanged="playbackbitratechanged",e.DownloadBitrateChanged="downloadbitratechanged",e.TimeUpdate="timeupdate",e.DurationChange="durationchange",e.HlsKeyLoading="hlsKeyLoading",e.HlsKeyLoaded="hlsKeyLoaded",e.HlsKeyLoadedFailed="hlsKeyLoadedFailed",e.HlsManifestLoading="hlsManifestLoading",e.HlsManifestLoaded="hlsManifestLoaded",e.HlsManifestLoadedFailed="hlsManifestLoadedFailed",e.HlsFirstFragmentLoading="hlsFragLoading",e.HlsFirstFragmentBuffered="hlsFragBuffered",e.HlsFirstFragmentLoadFailed="hlsFirstFragmentLoadFailed",e.Online="online",e.Offline="offline",e.NetworkChange="networkChange"}(a||(t.HydraPlayerPlaybackState=a={})),function(e){e.UnsupportedPlatform="UnsupportedPlatform",e.NetworkError="NetworkError",e.PlaybackRetried="PlaybackRetried",e.PlaybackError="PlaybackError",e.Unknown="Unknown"}(s||(t.HydraPlayerPlaybackErrorType=s={})),function(e){e.RequestIceCandidates="RequestIceCandidates"}(c||(t.IframeMessages=c={}))}},t={};return function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(260)}()},1808:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4567);t.DEFAULT_TIME_GROW_FACTOR=2.718281828459045,t.DEFAULT_TIME_JITTER=.11962656472;var i=function(){function e(e,n,i,o){void 0===i&&(i=t.DEFAULT_TIME_GROW_FACTOR),void 0===o&&(o=t.DEFAULT_TIME_JITTER),this._initialTime=e,this._maxTime=n,this._growFactor=i,this._jitterFactor=o,r.assert(this._initialTime>0,"Initial delay must be positive"),r.assert(this._maxTime>0,"Delay upper bound must be positive"),r.assert(this._growFactor>=0,"Ratio must be non-negative"),r.assert(this._jitterFactor>=0,"Jitter factor must be non-negative"),this.reset()}return e.prototype.reset=function(){this._incrementCount=0,this._currentTime=Math.round(this._initialTime*(1+Math.random()*this._jitterFactor))},e.prototype.getTime=function(){return this._currentTime},e.prototype.getIncrementCount=function(){return this._incrementCount},e.prototype.calculateNext=function(){var e=this._currentTime*this._growFactor;return e>this._maxTime&&(e=this._maxTime),this._jitterFactor<1e-5?this._currentTime=e:this._currentTime=Math.round(Math.random()*e*this._jitterFactor+e),this._currentTime<this._initialTime&&(this._currentTime=this._initialTime),this._currentTime>this._maxTime&&(this._currentTime=this._maxTime),this._incrementCount++,this._currentTime},e.prototype.getTimeAndCalculateNext=function(){var e=this.getTime();return this.calculateNext(),e},e}();t.ExponentialTime=i},3334:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4567),o=n(4009),a=function(){function e(e){this._defaultOptions={excludeEndpointUrl:!1,withCredentials:!1,retries:0},this._endpointUrl=e}return e.prototype._performApiCall=function(e,t,n,a){var s=this;void 0===a&&(a={});var c=r(r({},this._defaultOptions),a);n&&(c.sendData=n),c.eTag&&(c.augmentHeaders||(c.augmentHeaders={}),c.augmentHeaders["If-None-Match"]=c.eTag),c.contentType||(c.contentType=i.isString(c.sendData)?"form":"json");var l=c.excludeEndpointUrl?e:this._endpointUrl+e;return new o.SimpleWebRequest(t,l,c,(function(){return s._getHeaders(c)}),(function(){return s._blockRequestUntil(c)})).start().then((function(e){return s._processSuccessResponse(e),e}))},e.prototype._getHeaders=function(e){return{}},e.prototype._blockRequestUntil=function(e){},e.prototype._processSuccessResponse=function(e){},e.prototype.performApiGet=function(e,t){return this.performApiGetDetailed(e,t).then((function(e){return e.body}))},e.prototype.performApiGetDetailed=function(e,t){return this._performApiCall(e,"GET",void 0,t)},e.prototype.performApiPost=function(e,t,n){return this.performApiPostDetailed(e,t,n).then((function(e){return e.body}))},e.prototype.performApiPostDetailed=function(e,t,n){return this._performApiCall(e,"POST",t,n)},e.prototype.performApiPatch=function(e,t,n){return this.performApiPatchDetailed(e,t,n).then((function(e){return e.body}))},e.prototype.performApiPatchDetailed=function(e,t,n){return this._performApiCall(e,"PATCH",t,n)},e.prototype.performApiPut=function(e,t,n){return this.performApiPutDetailed(e,t,n).then((function(e){return e.body}))},e.prototype.performApiPutDetailed=function(e,t,n){return this._performApiCall(e,"PUT",t,n)},e.prototype.performApiDelete=function(e,t,n){return this.performApiDeleteDetailed(e,t,n).then((function(e){return e.body}))},e.prototype.performApiDeleteDetailed=function(e,t,n){return this._performApiCall(e,"DELETE",t,n)},e}();t.GenericRestClient=a},2394:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(1808)),r(n(3334)),r(n(4009))},4009:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a,s,c=n(4148),l=n(4567),u=n(1808);function d(e){return!!e&&0===e.indexOf("application/json")}function p(e,t){return t.canceled||!t.statusCode||t.statusCode>=400&&t.statusCode<600?s.DoNotRetry:s.RetryCountedWithBackoff}!function(e){e[e.DontCare=0]="DontCare",e[e.Low=1]="Low",e[e.Normal=2]="Normal",e[e.High=3]="High",e[e.Critical=4]="Critical"}(a=t.WebRequestPriority||(t.WebRequestPriority={})),function(e){e[e.DoNotRetry=0]="DoNotRetry",e[e.RetryUncountedImmediately=1]="RetryUncountedImmediately",e[e.RetryUncountedWithBackoff=2]="RetryUncountedWithBackoff",e[e.RetryCountedWithBackoff=3]="RetryCountedWithBackoff",e[e.PauseUntilResumed=4]="PauseUntilResumed"}(s=t.ErrorHandlingType||(t.ErrorHandlingType={})),t.DefaultOptions={priority:a.Normal},t.SimpleWebRequestOptions={MaxSimultaneousRequests:5,HungRequestCleanupIntervalMs:1e4,setTimeout:function(e,t){return setTimeout(e,t)},clearTimeout:function(e){return clearTimeout(e)}},t.DefaultErrorHandler=p;var h,g=[],f=[],m=[],_=0,y=0,v=function(){function e(e,n,r,i,a){this._action=e,this._url=n,this.options=r,this._getHeaders=i,this._blockRequestUntil=a,this._aborted=!1,this._timedOut=!1,this._paused=!1,this._created=Date.now(),this._finishHandled=!1,this._retryExponentialTime=new u.ExponentialTime(1e3,3e5),this._options=o(o({},t.DefaultOptions),r)}return e.prototype.getPriority=function(){return this._options.priority||a.DontCare},e.checkQueueProcessing=function(){for(var e=function(){var e=g.shift();f.push(e),(e._blockRequestUntil&&e._blockRequestUntil()||c.Resolved()).finally((function(){l.remove(f,e)})).then((function(){m.length<t.SimpleWebRequestOptions.MaxSimultaneousRequests&&!e._aborted?(m.push(e),S._scheduleHungRequestCleanupIfNeeded(),e._fire()):e._enqueue()}),(function(t){e._respond("_blockRequestUntil rejected: "+t)}))};g.length>0&&m.length<t.SimpleWebRequestOptions.MaxSimultaneousRequests;)e()},e._scheduleHungRequestCleanupIfNeeded=function(){m.length>0&&void 0===h?h=t.SimpleWebRequestOptions.setTimeout(this._hungRequestCleanupTimerCallback,t.SimpleWebRequestOptions.HungRequestCleanupIntervalMs):0===m.length&&h&&(t.SimpleWebRequestOptions.clearTimeout(h),h=void 0)},e.prototype._removeFromQueue=function(){l.remove(m,this),l.remove(g,this)},e.prototype._assertAndClean=function(e,t){e||(this._removeFromQueue(),console.error(t),l.assert(e,t))},e.prototype._fire=function(){var n=this;this._xhr=new XMLHttpRequest,this._xhrRequestHeaders={};var r=l.attempt((function(){n._xhr.open(n._action,n._url,!0)}));if(r)this._respond(r.toString());else{if(this._options.timeout){var i=y;3!==i&&(this._assertAndClean(!this._requestTimeoutTimer,"Double-fired requestTimeoutTimer"),this._requestTimeoutTimer=t.SimpleWebRequestOptions.setTimeout((function(){n._requestTimeoutTimer=void 0,n._timedOut=!0,n.abort()}),this._options.timeout)),(3===i||i<=1)&&(this._xhr.timeout=this._options.timeout,this._xhr.ontimeout=function(){y=3,3===i&&(n._timedOut=!0,n._aborted=!0,n._respond("TimedOut"))})}var o=_;3!==o?(0===o&&(_=1),this._xhr.onreadystatechange=function(){n._xhr&&(3!==n._xhr.readyState||!n._options.streamingDownloadProgress||n._aborted?4===n._xhr.readyState&&(0===o&&1===_&&t.SimpleWebRequestOptions.setTimeout((function(){3!==_&&(_=2)}),1e4),n._respond()):n._options.streamingDownloadProgress(n._xhr.responseText))}):this._options.streamingDownloadProgress&&(this._xhr.onreadystatechange=function(){n._xhr&&3===n._xhr.readyState&&n._options.streamingDownloadProgress&&!n._aborted&&n._options.streamingDownloadProgress(n._xhr.responseText)}),2!==o&&(this._xhr.onload=function(){_=3,3===o&&n._respond()},this._xhr.onerror=function(){_=3,3===o&&n._respond()}),this._xhr.onabort=function(){n._aborted=!0,n._respond("Aborted")},this._xhr.upload&&this._options.onProgress&&(this._xhr.upload.onprogress=this._options.onProgress);var a=this._options.acceptType||"json",s=this._options.customResponseType||e._getResponseType(a),c=l.attempt((function(){n._xhr.responseType=s}));if(c&&"json"!==s)throw c;S._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Accept",e.mapContentType(a)),this._xhr.withCredentials=!!this._options.withCredentials;var u=this.getRequestHeaders(),d={};if(Object.keys(u).forEach((function(e){var t=u[e],r=e.toLowerCase();"content-type"!==r?"accept"!==r?(n._assertAndClean(!d[r],"Setting duplicate header key: "+d[r]+" and "+e),null!=t?(d[r]=!0,S._setRequestHeader(n._xhr,n._xhrRequestHeaders,e,t)):console.warn('Tried to set header "'+e+'" on request with "'+t+'" value, header will be dropped')):n._assertAndClean(!1,"Don't set Accept with options.headers -- use it with the options.acceptType property"):n._assertAndClean(!1,"Don't set Content-Type with options.headers -- use it with the options.contentType property")})),this._options.sendData){var p=e.mapContentType(this._options.contentType||"json");S._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Content-Type",p);var h=e.mapBody(this._options.sendData,p);this._xhr.send(h)}else this._xhr.send()}},e._setRequestHeader=function(e,t,n,r){e.setRequestHeader(n,r),t[n]=r},e.mapContentType=function(e){return"json"===e?"application/json":"form"===e?"application/x-www-form-urlencoded":e},e.mapBody=function(e,t){if(d(t)){if(!l.isString(e))return JSON.stringify(e)}else if((o=t)&&0===o.indexOf("application/x-www-form-urlencoded")){if(!l.isString(e)&&l.isObject(e)){var n=e;return Object.keys(n).map((function(e){return encodeURIComponent(e)+(n[e]?"="+encodeURIComponent(n[e].toString()):"")})).join("&")}}else if(function(e){return!!e&&0===e.indexOf("multipart/form-data")}(t)){if(l.isObject(e)){var r=new FormData,i=e;return Object.keys(i).forEach((function(e){return r.append(e,i[e])})),r}l.assert(!1,"contentType multipart/form-data must include an object as sendData")}var o;return e},e.prototype.setUrl=function(e){this._url=e},e.prototype.setHeader=function(e,t){this._options.augmentHeaders||(this._options.augmentHeaders={}),t?this._options.augmentHeaders[e]=t:delete this._options.augmentHeaders[e]},e.prototype.getRequestHeaders=function(){var e={};return!this._getHeaders||this._options.overrideGetHeaders||this._options.headers||(e=o(o({},e),this._getHeaders())),this._options.overrideGetHeaders&&(e=o(o({},e),this._options.overrideGetHeaders)),this._options.headers&&(e=o(o({},e),this._options.headers)),this._options.augmentHeaders&&(e=o(o({},e),this._options.augmentHeaders)),e},e.prototype.getOptions=function(){return l.clone(this._options)},e.prototype.setPriority=function(e){this._options.priority!==e&&(this._options.priority=e,this._paused||this._xhr||(l.remove(g,this),this._enqueue()))},e.prototype.resumeRetrying=function(){this._paused?(this._paused=!1,this._enqueue()):l.assert(!1,"resumeRetrying() called but not paused!")},e.prototype._enqueue=function(){var t=this;if(!this._aborted&&!(m.indexOf(this)>=0||f.indexOf(this)>=0||g.indexOf(this)>=0)){var n=g.findIndex((function(e){return e.getPriority()===t.getPriority()&&e._created>t._created||e.getPriority()<t.getPriority()}));n>-1?g.splice(n,0,this):g.push(this),e.checkQueueProcessing()}},e._getResponseType=function(e){return"blob"===e?"arraybuffer":"text/xml"===e||"application/xml"===e?"document":"text/plain"===e?"text":"json"},e._hungRequestCleanupTimerCallback=function(){h=void 0,m.filter((function(e){return!(!e._xhr||4!==e._xhr.readyState)&&(console.warn("SimpleWebRequests found a completed XHR that hasn't invoked it's callback functions, manually responding"),!0)})).forEach((function(e){e._respond()})),S._scheduleHungRequestCleanupIfNeeded()},e}();t.SimpleWebRequestBase=v;var S=function(e){function n(t,n,r,i,o){return e.call(this,t,n,r,i,o)||this}return i(n,e),n.prototype.abort=function(){this._aborted?l.assert(!1,"Already aborted "+this._action+" request to "+this._url):(this._aborted=!0,this._retryTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._deferred?(this._respond("Aborted"),this._xhr&&this._xhr.abort()):l.assert(!1,"Haven't even fired start() yet -- can't abort"))},n.prototype.start=function(){var e=this;return this._deferred?(l.assert(!1,"WebRequest already started"),c.Rejected("WebRequest already started")):(this._deferred=c.Defer(),this._deferred.onCancel((function(){e.abort()})),this._enqueue(),this._deferred.promise())},n.prototype._respond=function(e){var n=this;if(!this._finishHandled){this._finishHandled=!0,this._removeFromQueue(),this._retryTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0);var r,i=0;if(this._xhr)try{i=this._xhr.status,r=this._xhr.statusText||e}catch(e){}else r=e||"Browser Error - Possible CORS or Connectivity Issue";var o,a,c={};if(this._xhr){if((this._xhr.getAllResponseHeaders()||"").split(/\r?\n/).forEach((function(e){if(0!==e.length){var t=e.indexOf(":");-1===t?c[e]="":c[e.substr(0,t).toLowerCase()]=e.substr(t+1).trim()}})),!c["content-type"]){var u=this._xhr.getResponseHeader("content-type");u&&(c["content-type"]=u)}if(o=this._xhr.response,c["content-type"]&&d(c["content-type"])&&(!o||!l.isObject(o))&&("text"===this._xhr.responseType||""===this._xhr.responseType)&&this._xhr.responseText)try{o=JSON.parse(this._xhr.responseText)}catch(e){a=e,console.warn("Failed to parse XHR JSON response")}}if(this._xhr&&4===this._xhr.readyState&&(i>=200&&i<300||304===i)){var h={url:this._xhr.responseURL||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:i,statusText:r,headers:c,body:o,responseParsingException:a};this._deferred.resolve(h)}else{var g={url:(this._xhr?this._xhr.responseURL:void 0)||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:i,statusText:r,headers:c,body:o,canceled:this._aborted,timedOut:this._timedOut,responseParsingException:a};this._options.augmentErrorResponse&&this._options.augmentErrorResponse(g);var f=this._options.customErrorHandler?this._options.customErrorHandler(this,g):p(0,g);f!==s.DoNotRetry&&(this._options.retries&&this._options.retries>0||f===s.PauseUntilResumed||f===s.RetryUncountedImmediately||f===s.RetryUncountedWithBackoff)?(f===s.RetryCountedWithBackoff&&this._options.retries--,this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._aborted=!1,this._timedOut=!1,this._finishHandled=!1,this._xhr&&(this._xhr.onabort=null,this._xhr.onerror=null,this._xhr.onload=null,this._xhr.onprogress=null,this._xhr.onreadystatechange=null,this._xhr.ontimeout=null,this._xhr=void 0,this._xhrRequestHeaders=void 0),f===s.PauseUntilResumed?this._paused=!0:f===s.RetryUncountedImmediately?this._enqueue():this._retryTimer=t.SimpleWebRequestOptions.setTimeout((function(){n._retryTimer=void 0,n._enqueue()}),this._retryExponentialTime.getTimeAndCalculateNext())):this._deferred.reject(g)}v.checkQueueProcessing()}},n}(v);t.SimpleWebRequest=S},4567:function(e,t){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error(t)},t.isObject=function(e){return null!==e&&"object"==typeof e},t.isString=function(e){return"string"==typeof e},t.attempt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];try{return e.apply(void 0,t)}catch(e){return new Error(e)}},t.remove=function(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)},t.clone=function(e){return Array.isArray(e)?e.map(t.clone):t.isObject(e)?Object.keys(e).reduce((function(r,i){var o;return n(n({},r),((o={})[i]=t.clone(e[i]),o))}),{}):e}},6125:function(e,t,n){e.exports=n(2394)},3149:function(e,t,n){"use strict";n.r(t),n.d(t,{SubscriptionToken:function(){return r}});var r=function(){function e(e,t){this._event=e,this._callback=t}return e.prototype.unsubscribe=function(){this._event.unsubscribe(this._callback)},e}(),i=function(){function e(e){void 0===e&&(e=!1);var t=this;this._allowStopPropagation=e,this.fire=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=t._subscribers,i=r.length-1;i>=0;i--){var o=r[i].apply(null,e);if(t._allowStopPropagation&&o)return!0}return!1},this._subscribers=[]}return e.prototype.dispose=function(){this._subscribers=[]},e.prototype.subscribe=function(e){return this._subscribers=this._subscribers.concat(e),new r(this,e)},e.prototype.unsubscribe=function(e){this._subscribers=this._subscribers.filter((function(t){return t!==e}))},e}();t.default=i},4148:function(e,t){"use strict";function n(e){return null!=e&&"function"==typeof e.then}function r(e){return null!=e&&"function"==typeof e.cancel}function i(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then((function(e){t.resolve(e)}),(function(e){t.reject(e)})),t.promise().thenAsync((function(e){return e}))};var o,a=[],s="undefined"!=typeof setImmediate;function c(e){a.push(e),1===a.length&&(s?setImmediate(l):setTimeout(l,0))}function l(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function d(e){return(new o.SyncTask).resolve(e).promise()}function p(e){var t=u(),i=!1;return t.onCancel((function(t){e.forEach((function(e){r(e)&&o.SyncTask.cancelOtherInternal(e,t)}))})),e.forEach((function(e){n(e)?e.then((function(e){i||(i=!0,t.resolve(e))}),(function(e){i||(i=!0,t.reject(e))})):i||(i=!0,t.resolve(e))})),t.promise()}t.asyncCallback=c,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var r=this,i=new e;return i.onCancel((function(e){t.wasCanceled=!0,t.cancelContext=e,r._cancelInternal(e)})),t.task=i,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:i._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),i.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout((function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach((function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)}))}),0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach((function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)}))}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach((function(t){t.asyncCallback?c((function(){return e._resolveSuccessCallback(t)})):e._resolveSuccessCallback(t)}))}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?i((function(){var i=t.successFunc(o._storedResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel((function(t){return e.cancelOtherInternal(i,t)}))),n(i)?i.then((function(e){t.task.resolve(e)}),(function(e){t.task.reject(e)})):t.task.resolve(i)}),(function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)})):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach((function(t){t.asyncCallback?c((function(){return e._resolveFailureCallback(t)})):e._resolveFailureCallback(t)}))}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?i((function(){var i=t.failFunc(o._storedErrResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel((function(t){return e.cancelOtherInternal(i,t)}))),n(i)?i.then((function(e){t.task.resolve(e)}),(function(e){t.task.reject(e)})):t.task.resolve(i)}),(function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)})):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise((function(t,n){return e.then(t,n)}))},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return d([]);var t,i=u(),a=e.length,s=Array(e.length);i.onCancel((function(t){e.forEach((function(e){r(e)&&o.SyncTask.cancelOtherInternal(e,t)}))}));var c=function(){0==--a&&(void 0!==t?i.reject(t):i.resolve(s))};return e.forEach((function(e,r){n(e)?e.then((function(e){s[r]=e,c()}),(function(e){void 0===t&&(t=void 0===e||e),c()})):(s[r]=e,c())})),i.promise()},t.Defer=u,t.Resolved=d,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=p,t.raceTimer=function(e,t){var n=u(),r=setTimeout((function(){n.resolve({timedOut:!0})}),t);return p([e.then((function(e){return clearTimeout(r),{timedOut:!1,result:e}})),n.promise()])}},2227:function(e,t,n){var r;r=(e,t)=>{var r,i={},o={exports:i},a=Object.defineProperty,s=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,l=Object.prototype.hasOwnProperty,u={};((e,t)=>{for(var n in t)a(e,n,{get:t[n],enumerable:!0})})(u,{SlimCoreElectronControlCapturer:()=>y}),o.exports=(r=u,((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of c(t))l.call(e,i)||i===n||a(e,i,{get:()=>t[i],enumerable:!(r=s(t,i))||r.enumerable});return e})(a({},"__esModule",{value:!0}),r));var d=n(6773);function p(e){if(!e)return`${e}`;if(e instanceof Map)return function(e){const t={};return e.forEach(((e,n)=>{t[n.toString()]=e})),JSON.stringify(t)}(e);const t=e.toString();return t.endsWith("[object Object]")?JSON.stringify(e):t}var h,g,f=class{constructor(e){this.eventLogger=e,this.subscriptions=[]}subscribe(e){return new m(this.subscriptions,e)}dispose(e){this.subscriptions=[]}raiseEvents(e){this.subscriptions.slice().forEach((t=>{try{void 0!==t.eventHandler&&e(t.eventHandler)}catch(e){this.eventLogger?.warn?.("Event handler exception caught!",p(e))}}))}},m=class{constructor(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}dispose(){(0,d.remove)(this.subscriptions,(e=>e===this)),this.eventHandler=void 0}},_=class extends f{constructor(e){super(e)}changed(e,t){return this.subscribe({changed:{skipEventConfig:t,handler:e},on:void 0})}on(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})}once(e,t,n){let r;return r=this.on(e,this._fromEventCallback(((...e)=>{r.dispose(n),this._toEventCallback(t)(...e)}))),r}raiseChanged(e){this.raiseEvents((t=>{if(!t.changed)return;const{skipEventConfig:n,handler:r}=t.changed;!this.getShouldSkipChangedEvent(e,n)&&r()}))}event(e){return{raise:this._fromEventCallback(((...t)=>this._raiseEventImpl(String(e),...t)))}}_raiseEventImpl(e,...t){this.raiseEvents((n=>n.on&&n.on.name===e&&n.on.handler(...t)))}_toEventCallback(e){return e}_fromEventCallback(e){return e}getShouldSkipChangedEvent(e,t){return e?.skipDominantSpeakerUpdatesOnCall?!!t?.skipDominantSpeakerUpdatesOnCall:!!e?.skipParticipantsUpdatesOnCall&&!!t?.skipParticipantsUpdatesOnCall}};(g=h||(h={})).encodeMouseEvent=function(e){if(!e)return new Uint8Array(0);e.buttonType||(e.buttonType=0),e.xPos||(e.xPos=0),e.yPos||(e.yPos=0),e.wheelRotation||(e.wheelRotation=0);const t=new ArrayBuffer(7),n=new DataView(t),r=3&e.type,i=(7&e.buttonType)<<2,o=(e.buttonDown?1:0)<<5,a=(e.wheelButtonDown?1:0)<<6;return n.setUint8(0,1),n.setUint8(1,r|i|o|a),n.setUint16(2,e.xPos,!0),n.setUint16(4,e.yPos,!0),n.setUint8(6,e.wheelRotation),new Uint8Array(t)},g.encodeKeyboardEvent=function(e){const t=new ArrayBuffer(3),n=new DataView(t),r=3&e.codeType,i=(e.keyUp?1:0)<<4,o=(e.repeat?1:0)<<5;return n.setUint8(0,0),n.setUint8(1,r|i|o),n.setUint8(2,e.code),new Uint8Array(t)},g.decodeEventType=function(e){return e[0]},g.decodeMouseEvent=function(e){if(1!==e[0]||7!==e.length)return null;const t=new DataView(e.buffer),n=t.getUint8(1);return{type:3&n,buttonType:n>>2&7,buttonDown:!!(n>>5&1),wheelButtonDown:!!(n>>6&1),xPos:t.getUint16(2,!0),yPos:t.getUint16(4,!0),wheelRotation:t.getUint8(6)}},g.decodeKeyboardEvent=function(e){if(0!==e[0]||3!==e.length)return null;const t=new DataView(e.buffer),n=t.getUint8(1);return{codeType:3&n,code:t.getUint8(2),repeat:!!(n>>5&1),keyUp:!!(n>>4&1)}};var y=class extends _{constructor(e,t,n=!0,r=1){super(),this._logger=e,this._element=t,this._captureRegionPreserveAspectRatio=n,this._mouseMoveCount=0,this._mouseMoveStartTime=0,this._isMouseDown=!1,this._isMouseOnRenderer=!1,this._captureMode=0,this._pollTimerID=0,this._resizeTimerID=0,this._mouseMoveThrottlingEnabled=!1,this._handleResizeEvents=()=>{clearTimeout(this._resizeTimerID),this._resizeTimerID=window.setTimeout((()=>{this.updateCaptureRegion()}),250)},this._handleMouseLeave=e=>{!this._isOnScreenContent(e)&&this._isMouseOnRenderer&&(this._raiseCaptureEvent(2),this._logger.info("Mouse leaving render region")),this._isMouseOnRenderer=!1},this._handleMouseEnter=e=>{this._isOnScreenContent(e)&&(this._isMouseOnRenderer=!0,this._raiseCaptureEvent(1),this._logger.info("Mouse entering render region"))},this._handleLosingFocus=()=>{this._syncKeyStates(!0)},this._handleClick=e=>{this._isOnScreenContent(e)&&(this._raiseCaptureEvent(0),this._logger.info("Mouse clicked"))},this._handleMouseMove=e=>{if(!this._isOnScreenContent(e)&&this._isMouseOnRenderer)return this._raiseCaptureEvent(2),this._isMouseOnRenderer=!1,void this._logger.info("Mouse leaving render region");if(this._isOnScreenContent(e)&&!this._isMouseOnRenderer&&(this._raiseCaptureEvent(1),this._isMouseOnRenderer=!0,this._logger.info("Mouse entering render region")),2!==this._captureMode&&3!==this._captureMode)return;if(this._mouseMoveCount++,this._mouseMoveThrottlingEnabled){if(!this._isOnScreenContent(e)||!this._shouldMoveMouse())return}else if(!this._isOnScreenContent(e)||this._mouseMoveCount%2==0)return;const t={type:0};this._normalizeMousePosition(e,t),this._raiseMouseEvent(t)},this._handleMouseDown=e=>{if(2!==this._captureMode&&3!==this._captureMode)return;if(!this._isOnScreenContent(e))return;const t={type:2,buttonType:v(e.button),buttonDown:!0};this._isMouseDown=!0,this._normalizeMousePosition(e,t),this._raiseMouseEvent(t)},this._handleMouseUp=e=>{if(2!==this._captureMode&&3!==this._captureMode)return;if(!this._isOnScreenContent(e))return;const t={type:2,buttonType:v(e.button),buttonDown:!1};this._isMouseDown=!1,this._normalizeMousePosition(e,t),this._raiseMouseEvent(t)},this._handleKeyDown=e=>{this._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!1}),e.stopPropagation(),e.preventDefault()},this._handleKeyUp=e=>{this._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!0}),e.stopPropagation(),e.preventDefault()},this._handleWheel=e=>{this._raiseMouseEvent({type:1,wheelRotation:e.deltaY>0?-120:120})},this._handleContextMenu=e=>{e.preventDefault()},this._ensureCanReceiveKeyboardInput(),this._element.ownerDocument?.defaultView?.addEventListener("resize",this._handleResizeEvents,!1),this._captureRegion={left:0,top:0,width:this._element.clientWidth,height:this._element.clientHeight},this._videoSize={width:Math.floor(t.clientHeight*r),height:t.clientHeight},this._origElementSize={width:0,height:0},this._checkElementSize(),this._mouseMoveStartTime=new Date(0).getTime()}get captureMode(){return this._captureMode}get captureRegion(){return this._captureRegion}setMouseMoveThrottlingFeatureFlag(e){this._mouseMoveThrottlingEnabled=e}dispose(e){this._logger.info(`dispose causeId: ${e}`),window.clearTimeout(this._pollTimerID),this._element.ownerDocument?.defaultView?.removeEventListener("resize",this._handleResizeEvents,!1),super.dispose(e)}updateVideoSize(e,t){this._videoSize.width=e,this._videoSize.height=t,this.updateCaptureRegion()}updateCaptureRegion(){this._captureRegionPreserveAspectRatio?(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientWidth*this._videoSize.height/this._videoSize.width,this._captureRegion.height>this._element.clientHeight?(this._captureRegion.width=this._element.clientHeight*this._videoSize.width/this._videoSize.height,this._captureRegion.height=this._element.clientHeight,this._captureRegion.left=(this._element.clientWidth-this._captureRegion.width)/2,this._captureRegion.top=0):(this._captureRegion.left=0,this._captureRegion.top=(this._element.clientHeight-this._captureRegion.height)/2)):(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientHeight,this._captureRegion.top=0,this._captureRegion.left=0)}setCaptureMode(e){3===this._captureMode&&3!==e&&this._syncKeyStates(!0),this._captureMode=e,0!==e?("none"===this._element.style.pointerEvents&&this._logger.warn("Element pointer-events is 'none', event handlers will not work"),this._element.addEventListener("click",this._handleClick),this._element.addEventListener("pointermove",this._handleMouseMove),this._element.addEventListener("pointerdown",this._handleMouseDown),this._element.addEventListener("pointerup",this._handleMouseUp),this._element.addEventListener("pointerenter",this._handleMouseEnter),this._element.addEventListener("pointerleave",this._handleMouseLeave),3===e?(this._element.addEventListener("wheel",this._handleWheel),this._element.addEventListener("keydown",this._handleKeyDown),this._element.addEventListener("keyup",this._handleKeyUp),this._element.addEventListener("contextmenu",this._handleContextMenu),this._element.addEventListener("blur",this._handleLosingFocus)):(this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))):(this._element.removeEventListener("pointermove",this._handleMouseMove),this._element.removeEventListener("pointerdown",this._handleMouseDown),this._element.removeEventListener("pointerup",this._handleMouseUp),this._element.removeEventListener("pointerenter",this._handleMouseEnter),this._element.removeEventListener("pointerleave",this._handleMouseLeave),this._element.removeEventListener("click",this._handleClick),this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))}_ensureCanReceiveKeyboardInput(){this._element.tabIndex=this._element.tabIndex}_checkElementSize(){this._origElementSize.width===this._element.clientWidth&&this._origElementSize.height===this._element.clientHeight||(this.updateCaptureRegion(),this._origElementSize.width=this._element.clientWidth,this._origElementSize.height=this._element.clientHeight),this._pollTimerID=window.setTimeout((()=>{this._checkElementSize()}),3e3)}_raiseMouseEvent(e){this.event("mouseControlEvent").raise(e)}_raiseKeyboardEvent(e){this.event("keyboardControlEvent").raise(e)}_raiseCaptureEvent(e){this.event("ctrlCaptureEvent").raise(e)}_normalizeMousePosition(e,t){t.xPos=(e.offsetX-this._captureRegion.left)/this._captureRegion.width*65535,t.yPos=(e.offsetY-this._captureRegion.top)/this._captureRegion.height*65535}_isOnScreenContent(e){const t=this._captureRegion.left,n=this._captureRegion.left+this._captureRegion.width,r=this._captureRegion.top,i=this._captureRegion.top+this._captureRegion.height;return t<=e.offsetX&&e.offsetX<n&&r<=e.offsetY&&e.offsetY<i}_shouldMoveMouse(){if(this._mouseMoveStartTime){const e=(new Date).getTime(),t=e-this._mouseMoveStartTime;if(this._isMouseDown&&t>=30||!this._isMouseDown&&t>=50)return this._mouseMoveStartTime=e,!0}else this._mouseMoveStartTime=(new Date).getTime();return!1}_syncKeyStates(e){this._raiseKeyboardEvent({codeType:1,code:17,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:16,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:18,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:91,repeat:!1,keyUp:e}),this._logger.info("Synced Key states.")}static formatMouseEvent(e){return h.encodeMouseEvent(e)}static formatKeyboardEvent(e){return h.encodeKeyboardEvent(e)}};function v(e){switch(e){case 0:return 0;case 2:return 1;case 1:return 2;default:return}}return"object"==typeof o.exports&&"object"==typeof i&&(o.exports=((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of Object.getOwnPropertyNames(t))Object.prototype.hasOwnProperty.call(e,i)||i===n||Object.defineProperty(e,i,{get:()=>t[i],enumerable:!(r=Object.getOwnPropertyDescriptor(t,i))||r.enumerable});return e})(o.exports,i)),o.exports},e.exports=r(n(4132),n(6773))},5442:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=t.TimerFactory=t.delay=t.deferWithTimeout=t.Deferred=t.asap=void 0,t.asap=function(e){return new Promise((function(t){t(e())}))};var n=function(){function e(){var e=this;this.isPendingInt=!0,this.promiseInt=new Promise((function(t,n){e.resolveInt=t,e.rejectInt=n}))}return Object.defineProperty(e.prototype,"resolve",{get:function(){var e=this;return function(t){e.isPendingInt=!1,e.resolveInt(t),e.clearTimeout()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){var e=this;return function(t){e.isPendingInt=!1,e.rejectInt(t),e.clearTimeout()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this.promiseInt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPending",{get:function(){return this.isPendingInt},enumerable:!1,configurable:!0}),e.prototype.setTimeout=function(e,t){var n=this;void 0===t&&(t="deferred timed out after ".concat(e,"ms")),this.isPendingInt&&(this.timeoutId=setTimeout((function(){n.reject(t)}),e))},e.prototype.clearTimeout=function(){this.timeoutId&&clearTimeout(this.timeoutId)},e}();t.Deferred=n,t.deferWithTimeout=function(e,t){void 0===t&&(t="deferred timed out after ".concat(e,"ms"));var r=new n;return r.setTimeout(e,t),r},t.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))};var r=function(){function e(){}return e.build=function(e,t){return new i(e,t)},e}();t.TimerFactory=r;var i=function(){function e(e,t){this.ontimeout=e,this.name=t}return e.prototype.start=function(e){var t=this;if(void 0!==this.timeoutId)throw new Error("Timer ".concat(this.name," already started"));return this.timeoutId=window.setTimeout((function(){return t.ontimeout()}),e),this},e.prototype.stop=function(){if(void 0===this.timeoutId)throw new Error("Timer ".concat(this.name," is not defined"));clearTimeout(this.timeoutId),this.timeoutId=void 0},e}();t.Timer=i},3077:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6136),i=n(3607),o=n(5442),a=n(7584),s=n(2559),c=function(){function e(e){var t=this;this._disposed=!1,this._logger=e.createChild("[ASYNC]"),this._endOperationDeferred=new o.Deferred,this._endOperationDeferred.promise.catch((function(e){t._logger.info("Rejected all operations")})),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._deferredOperationsWithCauseId={},this._logger=e}return e.prototype.registerPromise=function(e,t){var n=!1,r=function(){n=!0};t.then(r,r);var i=this._endOperationDeferred.promise.catch((function(t){if(!n)throw new Error("Operation ".concat(e," did not complete, reason:").concat(t))}));return Promise.race([i,t])},e.prototype.updateOperationId=function(e,t){var n=this;this._logger.info("updateOperationId ".concat(e," ").concat(t)),Object.keys(this._deferredOperationsWithOperationId).forEach((function(r){r&&n._deferredOperationsWithOperationId[r]&&(n._logger.info("_deferredOperationsWithOperationId ".concat(r)),Object.keys(n._deferredOperationsWithOperationId[r]).forEach((function(i){i&&n._deferredOperationsWithOperationId[r][i]&&(n._logger.info("_deferredOperationsWithOperationId ".concat(i," ").concat(t)),i===e&&(n._deferredOperationsWithOperationId[r][t]=n._deferredOperationsWithOperationId[r][i],delete n._deferredOperationsWithOperationId[r][i]))})))})),Object.keys(this._deferredOperationsWithCauseId).forEach((function(r){r&&n._deferredOperationsWithCauseId[r]&&(n._logger.info("_deferredOperationsWithCauseId ".concat(r)),Object.keys(n._deferredOperationsWithCauseId[r]).forEach((function(i){i&&n._deferredOperationsWithCauseId[r][i]&&(n._logger.info("_deferredOperationsWithCauseId ".concat(i," ").concat(t)),i===e&&(n._deferredOperationsWithOperationId[r][t]=n._deferredOperationsWithOperationId[r][i],delete n._deferredOperationsWithOperationId[r][i]))})))}))},e.prototype.createPendingOperation=function(e,t,n,s){var c=this;void 0===n&&(n=(0,a.generateCauseId)()),void 0===s&&(s={});var l=new o.Deferred;l.promise.catch(r.noop);var u,d=this.getOperationInfoForLogging(n,e,t);if(this._logger.info("".concat(d,"[creating...]")),this._disposed)return this._logger.info("".concat(d,"[create failed, call is disposed]")),Promise.reject(60);if(t){if(this._deferredOperationsWithOperationId[e]||(this._deferredOperationsWithOperationId[e]={}),this._deferredOperationsWithOperationId[e][t])return this._logger.warn("".concat(d," Deferred operation with given name and operation id is already defined")),Promise.reject(new Error("Deferred operation with given name is already defined:".concat(e,"/").concat(i.scrubMriOrOmit(t))));this._deferredOperationsWithOperationId[e][t]={deferred:l,causeId:n},this._deferredOperationsWithCauseId[n]||(this._deferredOperationsWithCauseId[n]={}),this._deferredOperationsWithCauseId[n][t]={deferred:l,options:s,operationName:e},u=this._endOperationDeferred.promise.catch((function(n){if(c.hasPendingOperationWithOperationId(e,t))throw new Error("Operation ".concat(e," ").concat(t," did not complete, reason:").concat(n))}))}else{if(this._deferredOperations[e])return this._logger.warn("".concat(d," Deferred operation with given name is already defined")),Promise.reject(new Error("Deferred operation with given name is already defined:".concat(e)));this._deferredOperationsWithCauseId[n]||(this._deferredOperationsWithCauseId[n]={}),this._deferredOperationsWithCauseId[n][""]={deferred:l,options:s,operationName:e},this._deferredOperations[e]={deferred:l,causeId:n},u=this._endOperationDeferred.promise.catch((function(t){if(c.hasPendingOperation(e))throw new Error("Operation ".concat(e," did not complete, reason:").concat(t))}))}return Promise.race([u,l.promise])},e.prototype.hasPendingOperation=function(e){return!!this._deferredOperations[e]},e.prototype.hasAtleastOneOfPendingOperation=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(this.hasPendingOperation(r))return!0}return!1},e.prototype.hasPendingOperationWithOperationId=function(e,t){return!(!t||!this._deferredOperationsWithOperationId[e])&&!!this._deferredOperationsWithOperationId[e][t]},e.prototype.hasPendingOperationWithCauseId=function(e,t){var n=t||"";return this._deferredOperationsWithCauseId[e]&&!!this._deferredOperationsWithCauseId[e][n]},e.prototype.getPendingOperationWithCauseId=function(e,t){return this.hasPendingOperationWithCauseId(e,t)?this._deferredOperationsWithCauseId[e][t].deferred.promise:Promise.reject("[".concat(e,"][").concat(t,"]: getPendingOperationWithCauseId for given causeId, operationId"))},e.prototype.resolveOperationWithCauseId=function(e,t,n){var r=t||"";if(this.hasPendingOperationWithCauseId(e,r)){var i=this._deferredOperationsWithCauseId[e][r],o=i.deferred.promise;return i.deferred.resolve(n),this._logger.info("[".concat(e,"][").concat(r,"] resolved, result=").concat((0,s.getPrintableObject)(n)||"void")),delete this._deferredOperationsWithCauseId[e][r],o}return Promise.reject("[".concat(e,"][").concat(r,"] resolveOperationWithCauseId failed, operation not found"))},e.prototype.rejectOperationWithCauseId=function(e,t,n){var i=t||"";if(this.hasPendingOperationWithCauseId(e,i)){var o=this._deferredOperationsWithCauseId[e][i],a=o.deferred.promise;return a.catch(r.noop),o.deferred.reject(n),this._logger.info("[".concat(e,"][").concat(i,"] rejected, result=").concat((0,s.getPrintableObject)(n)||"void")),delete this._deferredOperationsWithCauseId[e][i],a}return Promise.reject("[".concat(e,"][").concat(i,"] rejectOperationWithCauseId failed, operation not found"))},e.prototype.maybeResolveOperationWithCauseId=function(e,t,n){var r=this;this.hasPendingOperationWithCauseId(e,t)?this.resolveOperationWithCauseId(e,t,n).catch((function(t){r._logger.info("".concat(e,"maybeResolveOperationWithCauseId failed, reason=").concat((0,s.getPrintableObject)(t)))})):this._logger.info("".concat(e,"maybeResolveOperationWithCauseId ignored, operation does not exist"))},e.prototype.maybeRejectOperationWithCauseId=function(e,t,n){this.hasPendingOperationWithCauseId(e,t)?this.rejectOperationWithCauseId(e,t,n).catch(r.noop):this._logger.info("".concat(e,"maybeRejectOperationWithCauseId ignored, operation does not exist"))},e.prototype.getPendingOperation=function(e,t,n){return void 0===n&&(n=(0,a.generateCauseId)()),!t&&this._deferredOperations[e]?this._deferredOperations[e].deferred.promise:t&&this._deferredOperationsWithOperationId[e]&&this._deferredOperationsWithOperationId[e][t]?this._deferredOperationsWithOperationId[e][t].deferred.promise:Promise.reject("".concat(this.getOperationInfoForLogging(n,e,t),": Deferred operation with given name and operation does not exist"))},e.prototype.waitForOperation=function(e,t,n){return void 0===n&&(n=(0,a.generateCauseId)()),t&&this.hasPendingOperationWithOperationId(e,t)?this._deferredOperationsWithOperationId[e][t].deferred.promise:this.hasPendingOperation(e)?this._deferredOperations[e].deferred.promise:Promise.reject("".concat(this.getOperationInfoForLogging(n,e,t),"failed=wait failed, operation not found"))},e.prototype.resolveOperation=function(e,t,n,r,i){if(void 0===r&&(r=(0,a.generateCauseId)()),void 0===i&&(i=!1),!e)return Promise.reject("Unable to resolve deferred operation with empty name");if(n&&this.hasPendingOperationWithOperationId(e,n)){var o=(c=this._deferredOperationsWithOperationId[e][n]).deferred.promise;return c.deferred.resolve(t),this._logger.info("".concat(this.getOperationInfoForLogging(c.causeId,e,n),"resolved, result=").concat((0,s.getPrintableObject)(t)||"void")),i||delete this._deferredOperationsWithOperationId[e][n],o}if(this.hasPendingOperation(e)){var c=this._deferredOperations[e];o=this._deferredOperations[e].deferred.promise;return this._deferredOperations[e].deferred.resolve(t),this._logger.info("".concat(this.getOperationInfoForLogging(c.causeId,e,n),"resolved, result=").concat((0,s.getPrintableObject)(t)||"void")),i||delete this._deferredOperations[e],o}return Promise.reject("".concat(this.getOperationInfoForLogging(r,e,n),"failed=resolve failed, operation not found"))},e.prototype.rejectOperation=function(e,t,n,i){return void 0===i&&(i=(0,a.generateCauseId)()),e?n&&this.hasPendingOperationWithOperationId(e,n)?((c=(o=this._deferredOperationsWithOperationId[e][n]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info("".concat(this.getOperationInfoForLogging(o.causeId,e,n),"rejected, reason=").concat((0,s.getPrintableObject)(t)||"void")),delete this._deferredOperationsWithOperationId[e][n],c):this.hasPendingOperation(e)?((c=(o=this._deferredOperations[e]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info("".concat(this.getOperationInfoForLogging(o.causeId,e,n),"rejected, reason=").concat((0,s.getPrintableObject)(t)||"void")),delete this._deferredOperations[e],c):Promise.reject("".concat(this.getOperationInfoForLogging(i,e,n),"failed=reject failed, operation not found")):Promise.reject("Unable to reject deferred operation with empty name");var o,c},e.prototype.maybeResolveOperation=function(e,t,n,r){var i=this;void 0===r&&(r=(0,a.generateCauseId)());var o=this.getOperationInfoForLogging(r,e,n);n&&this.hasPendingOperationWithOperationId(e,n)||this.hasPendingOperation(e)?this.resolveOperation(e,t,n,r).catch((function(e){i._logger.info("".concat(o,"maybeResolveOperation failed, reason=").concat((0,s.getPrintableObject)(e)))})):this._logger.info("".concat(o,"maybeResolveOperation ignored, operation does not exist"))},e.prototype.maybeResolveOperations=function(e,t,n,r){void 0===r&&(r=(0,a.generateCauseId)());for(var i=0,o=e;i<o.length;i++){var s=o[i];this.maybeResolveOperation(s,t,n,r)}},e.prototype.maybeRejectOperation=function(e,t,n,i){void 0===i&&(i=(0,a.generateCauseId)());var o=this.getOperationInfoForLogging(i,e,n);n&&this.hasPendingOperationWithOperationId(e,n)||this.hasPendingOperation(e)?this.rejectOperation(e,t,n,i).catch(r.noop):this._logger.info("".concat(o,"maybeRejectOperation ignored, operation does not exist"))},e.prototype.maybeRejectOperations=function(e,t,n,r){void 0===r&&(r=(0,a.generateCauseId)());for(var i=0,o=e;i<o.length;i++){var s=o[i];this.maybeRejectOperation(s,t,n,r)}},e.prototype.rejectPendingOperations=function(e,t){var n=this;void 0===t&&(t=(0,a.generateCauseId)()),this._disposed=!0,this._logger.info("[".concat(t,"]rejectPendingOperations=").concat(JSON.stringify(e))),Object.keys(this._deferredOperations).forEach((function(r){n.maybeRejectOperation(r,e,void 0,t),n._deferredOperationsWithOperationId[t]&&delete n._deferredOperationsWithOperationId[t][""]})),Object.keys(this._deferredOperationsWithOperationId).forEach((function(r){Object.keys(n._deferredOperationsWithOperationId[r]).forEach((function(i){n.maybeRejectOperation(r,e,i,t),n._deferredOperationsWithOperationId[t]&&delete n._deferredOperationsWithOperationId[t][i]}))})),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._endOperationDeferred.reject(e)},e.prototype.maybeRejectPendingOperationsWithPredicate=function(e,t,n){var r=this;void 0===t&&(t=(0,a.generateCauseId)()),this._logger.info("[".concat(t,"]rejectPendingOperationsWithPredicate")),Object.keys(this._deferredOperationsWithCauseId).forEach((function(t){Object.keys(r._deferredOperationsWithCauseId[t]).forEach((function(i){var o=r._deferredOperationsWithCauseId[t][i];o&&n(o.operationName,o.options)&&(r.maybeRejectOperation(o.operationName,e,i),r.maybeRejectOperationWithCauseId(t,i,e))}))}))},e.prototype.getOperationInfoForLogging=function(e,t,n){void 0===n&&(n="");var r=n?"[".concat(i.scrubMriOrOmit(n),"]"):"";return"[".concat(e.substring(0,8),"][").concat(t,"]").concat(r)},e}();t.default=c},6439:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserInfo=void 0;var n="0.0";function r(e,t){var r,i=[];return t.some((function(t){return!!(i=e.match(t))})),!i||i.length<2?n:(null===(r=i[1])||void 0===r?void 0:r.replace(/_/g,"."))||n}function i(e){return"136"===function(){var e="os-sku",t=window.external;if(!(null==t?void 0:t.getHostEnvironmentValue))return"-1";return JSON.parse(t.getHostEnvironmentValue(e))[e]}()?"Hololens":/hostAudio-Processing/i.test(e)?"RoomAudioProcessing":/iPhone|iPad|iPod|Android|Mobi/i.test(e)?"Mobile":"Desktop"}t.getBrowserInfo=function(){var e="((\\d+\\.?){2,4})",t={name:"Unknown",engine:"Unknown",version:n,formFactor:"Unknown"},o=[{name:"WebView2",engine:"Chromium",key:"maglev",masks:[new RegExp("".concat("maglev","/").concat(e))]},{name:"Edge",engine:"Edge",key:"Edge",masks:[new RegExp("".concat("Edge","/").concat(e))]},{name:"EdgeAnaheim",engine:"Chromium",key:"EdgA",masks:[new RegExp("".concat("Chrome","/").concat(e))]},{name:"EdgeAnaheim",engine:"Chromium",key:"Edg",masks:[new RegExp("".concat("Edg","/").concat(e))]},{name:"Chromium",engine:"Chromium",key:"Chromium",masks:[new RegExp("".concat("Chromium","/").concat(e))]},{name:"Opera",engine:"Chromium",key:"OPR",masks:[new RegExp("".concat("Chrome","/").concat(e))]},{name:"YandexBrowser",engine:"Chromium",key:"YaBrowser",masks:[new RegExp("".concat("Chrome","/").concat(e))]},{name:"Electron",engine:"Chromium",key:"Electron",masks:[new RegExp("".concat("Electron","/").concat(e))]},{name:"CiscoOS",engine:"Chromium",key:"Cisco",masks:[new RegExp("".concat("Chrome","/").concat(e))]},{name:"ZoomRoom",engine:"Chromium",key:"ZoomRoom",masks:[new RegExp("".concat("Chrome","/").concat(e))]},{name:"SamsungTV",engine:"Chromium",key:"TeamsSamsungTVBrowser",masks:[new RegExp("".concat("Chrome","/").concat(e))]},{name:"Chrome",engine:"Chromium",key:"Chrome",masks:[new RegExp("".concat("Chrome","/").concat(e))]},{name:"Firefox",engine:"Firefox",key:"Firefox",masks:[new RegExp("".concat("Firefox","/").concat(e))]},{name:"Safari",engine:"Safari",key:"Safari",masks:[new RegExp("Version/".concat(e,".*?").concat("Safari","/"))]},{name:"AppleWebView",engine:"Safari",key:"Mac OS X",masks:[new RegExp("(\\d+_\\d+(_\\d+)?).*".concat("Mac OS X")),new RegExp("(\\d+_\\d+(_\\d+)?).*")]},{name:"MSIE",engine:"MSIE",key:"Trident",masks:[new RegExp("MSIE ".concat(e)),new RegExp("rv:".concat(e))]}],a=navigator.userAgent,s=t;return o.some((function(e){var t;if(-1!==a.indexOf(e.key)){var n=null===(t=window.navigator.mediaDevices)||void 0===t?void 0:t.isRemote;return s={name:e.name,engine:n?"ChromiumAVD":e.engine,version:r(a,e.masks),formFactor:i(a)},!0}return!1})),s}},891:function(e,t){"use strict";var n,r,i,o,a,s,c,l,u,d,p,h,g,f;Object.defineProperty(t,"__esModule",{value:!0}),t.EMPTY_COUNTS=t.TRANSACTION_END_PHRASE=t.TRANSACTION_END_SUBCODE=t.TRANSACTION_END_CODE=t.UNPARK_CODE=t.TELEMETRY_EVENT_NAMES=t.CALL_REGISTRY_OPERATIONS=t.CONTENT_SHARING_OPERATIONS_INTERNAL=t.CONTENT_SHARING_OPERATIONS=t.PARTICIPANT_OPERATIONS_INTERNAL=t.PARTICIPANT_OPERATIONS=t.MEDIA_EVENT=t.PROMOTION_EVENTS=t.OPERATION_VARIANTS=t.CALL_OPERATIONS_INTERNAL=t.OPERATION_TAGS=t.CALL_OPERATIONS=void 0,function(e){e.INITIALIZE="Initialize",e.START_CALL="StartCall",e.START_TRANSFER_TARGET_CALL="StartTransferTargetCall",e.STOP_CALL="StopCall",e.STOP_CALL_WITH_BEACON="StopCallWithBeacon",e.JOIN_CALL="JoinCall",e.JOIN_PREHEATED_CALL="JoinPreheatedCall",e.SUBSCRIBE="Subscribe",e.START_CALL_TO_VOICE_MAIL="StartCallToVoiceMail",e.ACKNOWLEDGE="Acknowledge",e.ACCEPT="Accept",e.REJECT="Reject",e.START_VIDEO="StartVideo",e.STOP_VIDEO="StopVideo",e.LOCAL_HOLD="LocalHold",e.LOCAL_UNHOLD="LocalUnhold",e.HOLD="Hold",e.UNHOLD="Unhold",e.UPDATE_ENDPOINT_METADATA="UpdateEndpointMetadata",e.SEND_DTMF_TONE="SendDtmfTone",e.SET_AUDIO_USAGE="SetAudioUsage",e.DUMP_VIDEO_SOURCE_IMAGES="DumpVideoSourceImages",e.BLIND_TRANSFER="BlindTransfer",e.SAFE_TRANSFER="SafeTransfer",e.TRANSFER_TO_VOICEMAIL="TransferToVoicemail",e.CALL_REDIRECT="CallRedirect",e.CONSULTATIVE_TRANSFER="ConsultativeTransfer",e.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE="ConsultativeTransferWithPickupCode",e.START_SCREEN_SHARING="StartScreenSharing",e.STOP_SCREEN_SHARING="StopScreenSharing",e.START_LOCAL_RECORDING="StartLocalRecording",e.STOP_LOCAL_RECORDING="StopLocalRecording",e.INCLUDE_SYSTEM_AUDIO="IncludeSystemAudioInLocalRecording",e.OVERLAY_WINDOW_IN_LOCAL_RECORDING="OverlayWindowInLocalRecording",e.START_DATA_CHANNEL="StartDataChannel",e.STOP_DATA_CHANNEL="StopDataChannel",e.SHARE_SYSTEM_SOUNDS="ShareSystemSounds",e.START_MULTICHANNEL_AUDIO_DEVICE="StartMultichannelAudioDevice",e.STOP_MULTICHANNEL_AUDIO_DEVICE="StopMultichannelAudioDevice",e.START_FACESTREAM="StartFaceStream",e.STOP_FACESTREAM="StopfaceStream",e.START_INROOM_FACE_ATRRIBUTION="StartInRoomFaceAtrribution",e.STOP_INROOM_FACE_ATRRIBUTION="StopInRoomFaceAtrribution",e.MUTE="Mute",e.UNMUTE="Unmute",e.MUTE_SPEAKER="MuteSpeaker",e.UNMUTE_SPEAKER="UnmuteSpeaker",e.MUTE_PARTICIPANTS="MuteParticipants",e.UPDATE_MEETING_ROLE="UpdateMeetingRole",e.START_AUDIO="StartAudio",e.STOP_AUDIO="StopAudio",e.ASSIMILATE="Assimilate",e.SET_MAX_VIDEO_CHANNELS="SetMaxVideoChannels",e.SET_MAX_VBSS_CHANNELS="SetMaxVbssChannels",e.CREATE_CONTENT_SHARING_SESSION="CreateContentSharingSession",e.START_CALL_WITH_NUDGE="StartCallWithNudge",e.START_CALL_AND_UNPARK="StartCallAndUnpark",e.PARK_CALL="ParkCall",e.UNPARK_CALL="UnparkCall",e.NUDGE_PARTICIPANTS="NudgeParticipants",e.ELECTRON_SHOW_CQF_INFO="ElectronShowCQFInfo",e.ELECTRON_IS_CQF_RENDERED="ElectronIsCQFRendered",e.ELECTRON_PROVIDE_CQF="ElectronProvideCQF",e.MERGE_CALL="MergeCall",e.ADD_GROUP_MODALITY="AddGroupModality",e.MERGE_WITH_PICKUP_CODE="MergeWithPickupCode",e.PUBLISH_STATE="PublishState",e.REMOVE_STATE="RemoveState",e.UPDATE_MEETING_SETTINGS="UpdateMeetingSettings",e.MERGE_PARTICIPANT="MergeParticipant",e.MERGE_PARTICIPANTS="MergeParticipants",e.ADMIT="Admit",e.SEARCH_PARTICIPANTS="SearchParticipants",e.GET_ALL_PARTICIPANTS="GetAllParticipants",e.SET_AUDIO_MIDCALL_CONFIG="SetAudioMidcallConfig",e.SET_PARTICIPANT_SPATIAL_POSITIONS="SetParticipantSpatialAudioPositions",e.START_WITH_MEETING_DATA="StartWithMeetingData",e.JOIN_WITH_MEETING_DATA="JoinWithMeetingData",e.SUBSCRIBE_WITH_MEETING_DATA="SubscribeWithMeetingData",e.SET_AUDIO_MIDCALL_CONFIG_JSON="SetAudioMidcallConfigJon",e.GET_TECHNICAL_INFORMATION_JSON="getTechnicalInformationJson",e.UPDATE_MEETING_GROUPS="UpdateMeetingGroups",e.ADD_BROADCAST_MODALITY="AddBroadcastModality",e.UPDATE_MEETING_LIVE_STATE="UpdateMeetingLiveState",e.UPDATE_MEETING_STATES="UpdateMeetingStates",e.SET_MEETING_LAYOUT="SetMeetingLayout",e.UPDATE_PARTICIPANT_INTERPRETATION_STATE="UpdateParticipantInterpretationState",e.JOIN_MEETING_GROUP="JoinMeetingGroup",e.LEAVE_MEETING_GROUP="LeaveMeetingGroup",e.SEND_MESSAGES="SendMessages",e.SET_VIDEO_MIDCALL_CONFIG_JSON="SetVideoMidcallConfigJson",e.UPDATE_MONITOR_SESSION="UpdateMonitorSession",e.UPDATE_PARTICIPANTS_PROPERTIES="UpdateParticipantsProperties",e.SWITCH_INTERPRETER_GROUP="SwitchInterpreterGroup"}(n||(t.CALL_OPERATIONS=n={})),function(e){e.NOT_SUPPORTED_IN_STREAMING_MODE="NOT_SUPPORTED_IN_STREAMING_MODE",e.NOT_SUPPORTED_IN_E2EE="NOT_SUPPORTED_IN_E2EE"}(r||(t.OPERATION_TAGS=r={})),function(e){e.CALL_START_OR_JOIN_INITIATED="_CallStartOrJoinInitiated",e.INCOMING_INITIALIZE="_IncomingInitialize",e.CALL_ENDED="_CallEnded",e.RECONNECT="_Reconnect",e.RENEGOTIATE="_Renegotiate",e.RENEGOTIATE_OUTGOING="_RenegotiateOutgoing",e.RENEGOTIATE_INCOMING="_RenegotiateIncoming",e.COMPLETE_NEGOTIATION_FAILED="_CompleteNegotiationFailed",e.UPDATE_LOCAL_MEDIA_STATUS="_UpdateLocalMediaStatus",e.START_PREVIEW_VIDEO="_StartPreviewVideo",e.START_LOCAL_VIDEO="_StartLocalVideo",e.SET_LOCAL_VIDEO="_SetLocalVideo",e.SET_LOCAL_AUDIO="_SetLocalAudio",e.CALL_TRANSFER_IN_PROGRESS="_CallTransferInProgress",e.CALL_PARK_V2="CallParkV2",e.CALL_REDIRECT_IN_PROGRESS="_CallRedirectInProgress",e.ON_TRANSFER_REQUESTED="_OnTransferRequested",e.ON_TRANSFER_REQUESTED_INVALID="_OnTransferRequestedInvalid",e.ON_INCOMING_CALL_REPLACEMENT="_onIncomingCallReplacement",e.GET_CALL_REPLACEMENT_DETAILS="_GetCallReplacementDetails",e.SET_CALL_STATE="_SetCallState",e.SET_TRANSFER_STATE="_SetTransferState",e.SET_PARK_STATE="_SetParkState",e.SET_MUTED="_SetMuted",e.SET_MUTED_SPEAKER="_SetMutedSpeaker",e.SET_SCREEN_SHARING="_SetScreenSharing",e.SET_CALL_ORIGIN="_SetCallOrigin",e.SET_FROM_APPLICATION_TYPE="_SetFromApplicationType",e.CONNECT_CALL="_ConnectCall",e.WAIT_FOR_ANSWER="_WaitForAnswer",e.MEDIA_ACKNOWLEDGMENT="_MediaAcknowledgment",e.SIGNALING_STATE_CHANGED="_SignalingStateChanged",e.CALL_TERMINATION_INFO="_CallTerminationInfo",e.MEDIA_WHITELISTING_ISSUE_DETECTED="_MediaWhiteListingIssueDetected",e.CALL_ESCALATED_TO_CONFERENCE="_CallEscalatedToConference",e.WEB_ON_OFFER="_WebOnOffer",e.WEB_ON_ANSWER="_WebOnAnswer",e.WEB_ON_RETARGET_SUCCESS="_WebRetargetSuccess",e.WEB_ON_RETARGET_FAILURE="_WebRetargetFailure",e.WEB_ON_ESCALATION_SUCCESS="_WebOnEscalationSuccess",e.WEB_ON_ESCALATION_FAILURE="_WebOnEscalationFailure",e.CALL_USES_MIXER="_CallUsesMixer",e.ESCALATION_IN_PROGRESS="_EscalationInProgress",e.ESCALATION_COMPLETED="_EscalationCompleted",e.ELECTRON_WAIT_FOR_HANDLE_PUSH="_ElectronWaitForHandlePush",e.ELECTRON_WAIT_FOR_RINGING="_ElectronWaitForRinging",e.ELECTRON_START_SCREEN_SHARING="_ElectronStartScreenSharing",e.ELECTRON_STOP_SCREEN_SHARING="_ElectronStopScreenSharing",e.ELECTRON_SLIMCORE_READY="_ElectronSlimcoreReady",e.ELECTRON_DATA_CHANNEL_CREATED="_ElectronDataChannelCreated",e.ELECTRON_ATTACH_SLIMCORE_CALL="_ElectronAttachSlimcoreCall",e.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED="_ElectronAttachSlimcoreCallFailed",e.ELECTRON_LEAVE_CALL="_ElectronLeaveCall",e.PROCESS_CALL_START_OPTIONS="_ProcessCallStartOptions",e.CALL_MODE_CHANGED="_CallModeChanged",e.UPDATE_MEETING_GROUPS_DETAILS="_UpdateMeetingGroupDetails",e.PROMOTION_TO_REALTIME="_PromotionToRealtime",e.ELECTRON_LOCAL_RECORDING_CREATED="_ElectronLocalRecordingCreated",e.UPDATE_MEDIA_DESCRIPTIONS="_UpdateMediaDescriptions",e.REINVITELESS_CONFIG="_ReinvitelessConfig",e.MEDIA_CLEAN_UP="_MediaCleanUp",e.STOP_LOCAL_RECORDING_START="_StopLocalRecordingStart",e.STOP_LOCAL_RECORDING_END="_StopLocalRecordingEnd",e.RAISE_CALL_STATE_CHANGE_EVENT="_RaiseCallStateChangeEvent",e.JOIN_OR_START_SLIMCORE_CALL="_JoinOrStartSlimcoreCall"}(i||(t.CALL_OPERATIONS_INTERNAL=i={})),function(e){e.CCWM="CCWM",e.ENCRYPTED="Encrypted",e.PREHEAT="Preheat",e.MULTIPLEVIDEOS="MultipleVideos",e.SPECIFIED="Specified",e.ALL="All",e.NONE="None"}(o||(t.OPERATION_VARIANTS=o={})),function(e){e.STARTED="StartPromotion",e.COMPLETED="PromotionCompleted",e.NUDGE_TO_JOIN_REALTIME="NudgeToJoinRealTime"}(a||(t.PROMOTION_EVENTS=a={})),function(e){e.AUDIO_QUALITY_CHANGED="AudioQualityChanged",e.SESSION_ERROR="SessionError",e.NEGOTIATION_REQUIRED="NegotiationRequired",e.OUTGOING_NEGOTIATION_FAILURE="OutgoingNegotiationFailure",e.INCOMING_NEGOTIATION_FAILURE="IncomingNegotiationFailure",e.NEGOTIATION_FATAL_ERROR="NegotiationFatalError",e.NEGOTIATION_COMPLETION="NegotiationCompletion",e.AUDIO_STATE_CHANGED="AudioStateChanged",e.INCOMPATIBLE_OFFER="IncompatibleOffer",e.NEW_OFFER_FAILED="NewOfferFailed",e.CREATING_CONFERENCE="CreatingConference",e.CREATED_CONFERENCE="CreatedConference",e.UPDATE_MEDIA_DESCRIPTIONS="UpdateMediaDescriptions",e.UPDATE_MEDIA_DESCRIPTIONS_COMPLETION="UpdateMediaDescriptionsCompletion",e.UPDATE_MEDIA_DESCRIPTIONS_FAILURE="UpdateMediaDescriptionsFailure"}(s||(t.MEDIA_EVENT=s={})),function(e){e.ADD_PARTICIPANT="AddParticipant",e.REMOVE_PARTICIPANT="RemoveParticipant",e.ADMIT_PARTICIPANT="AdmitParticipant",e.CALL_ME_BACK="CallMeBack",e.ADD_PARTICIPANTS="AddParticipants",e.SEARCH_PARTICIPANTS="SearchParticipants",e.GET_ALL_PARTICIPANTS="GetALLParticipants",e.CANCEL_NUDGE="CancelNudge"}(c||(t.PARTICIPANT_OPERATIONS=c={})),function(e){e.SET_PARTICIPANT_STATE_INVALID="_SetParticipantStateInvalid",e.UPDATE_LOCAL_PARTICIPANT_STREAM="_UpdateLocalParticipantStream",e.PARTICIPANT_JOINED="_ParticipantJoined",e.SELF_PARTICIPANT_UPDATED="_SelfParticipantUpdated"}(l||(t.PARTICIPANT_OPERATIONS_INTERNAL=l={})),function(e){e.START_CONTENT_SHARING="StartContentSharing",e.STOP_CONTENT_SHARING="StopContentSharing",e.JOIN_CONTENT_SHARING="JoinContentSharing",e.TAKE_CONTENT_SHARING_CONTROL="TakeContentSharingControl",e.UPDATE_CONTENT_SHARING_SESSION_STATE="UpdateContentSharingSessionState",e.UPDATE_PARTICIPANT_STATE="UpdateParticipantState"}(u||(t.CONTENT_SHARING_OPERATIONS=u={})),function(e){e.SET_CONTENT_SHARING_STATUS="_SetContentSharingStatus"}(d||(t.CONTENT_SHARING_OPERATIONS_INTERNAL=d={})),function(e){e.INITIALIZE="Initialize",e.LOGOUT="Logout",e.GET_CALL_STATE="GetCallState"}(p||(t.CALL_REGISTRY_OPERATIONS=p={})),t.TELEMETRY_EVENT_NAMES={CALL_SETUP_NATIVE:"skypecosi_concore_native_ts_calling_call_setup_session",CALL_IN_CALL_NATIVE:"skypecosi_concore_native_ts_calling_in_call_session",REGISTRY_WEB:"skypecosi_concore_web_ts_calling_registry",REGISTRY_NATIVE:"skypecosi_concore_native_ts_calling_registry"},t.UNPARK_CODE={PARK:"*11",SHARED_LINE:"*12",SERVER_HOLD:"*13",CALL_PARK:"*14"},function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.INVALID_PARTICIPANT=406]="INVALID_PARTICIPANT",e[e.MEDIA_ERROR=410]="MEDIA_ERROR",e[e.CLIENT_ERROR=499]="CLIENT_ERROR",e[e.SIGNALING_ERROR=599]="SIGNALING_ERROR"}(h||(t.TRANSACTION_END_CODE=h={})),function(e){e[e.LOCAL_REJECT=0]="LOCAL_REJECT",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.UNMUTE_ERROR=3124]="UNMUTE_ERROR",e[e.TRANSACTION_NOT_ALLOWED=3548]="TRANSACTION_NOT_ALLOWED",e[e.INVALID_ARGUMENT=3549]="INVALID_ARGUMENT",e[e.CANNOT_PARSE_RESULT=3550]="CANNOT_PARSE_RESULT",e[e.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE=3551]="TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE",e[e.INVITE_FAILURE=5201]="INVITE_FAILURE",e[e.NOT_IN_LOBBY=3552]="NOT_IN_LOBBY",e[e.LEFT_LOBBY=3553]="LEFT_LOBBY",e[e.DENIED_IN_LOBBY=3554]="DENIED_IN_LOBBY",e[e.TIMED_OUT_IN_LOBBY=3555]="TIMED_OUT_IN_LOBBY",e[e.TRANSACTION_NOT_ALLOWED_FOR_E2EE=3556]="TRANSACTION_NOT_ALLOWED_FOR_E2EE",e[e.GENERIC_MEDIA_NEGOTIATION_FAILURE=3900]="GENERIC_MEDIA_NEGOTIATION_FAILURE"}(g||(t.TRANSACTION_END_SUBCODE=g={})),function(e){e.TRANSACTION_COMPLETE="TransactionComplete",e.TRANSACTION_ALLOWED="TransactionAllowed",e.TRANSACTION_DISALLOWED="TransactionDisallowed",e.UNKNOWN="Unknown",e.STACK_NOT_INTIALIZED="Stack not intialized yet",e.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE="TransactionNotAllowedForStreamMode",e.TRANSACTION_NOT_ALLOWED_FOR_E2EE="TransactionNotAllowedForE2EE",e.NOT_IN_LOBBY="Participant is not in lobby state",e.NOT_IMPLEMENTED="Not implemented",e.MEDIA_FAILURE="Media failure"}(f||(t.TRANSACTION_END_PHRASE=f={})),t.EMPTY_COUNTS={totalParticipants:0,preheatedParticipants:0,lobbyParticipants:0,totalPresenters:0,requestingAttentionPresenters:0,totalAttendees:0,requestingAttentionAttendees:0,overflowAttendees:0}},961:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.calculateJoinedFromForTelemetry=t.getEndpointInformationForTelemetry=t.CallTelemetry=t.CallRegistryTelemetry=t.TelemetryUtilities=t.SELF_PARTICIPANT_ROLE=t.DIRECTION=t.RESULT_VALUE=t.CALL_TERMINATING_END=void 0;var o,a,s=n(4132),c=n(7584),l=n(2559),u=n(3607),d=n(5212);!function(e){e.Pending="Pending",e.Success="Success",e.Failure="Failure",e.Timeout="Timeout"}(o||(o={})),function(e){e.Event="Event",e.Operation="Operation"}(a||(a={}));var p,h,g,f,m,_=function(){function e(e,t,n,r,i){this.eventName=e,this.eventStartTime=t,this.type=n,this.causeId=r,this.status=o.Pending,this.eventStartTimestamp=(new Date).getTime(),this.data=[],this.causeId=null==r?void 0:r.substring(0,8),this.type===a.Event&&delete this.status,i&&this.data.push(i)}return Object.defineProperty(e.prototype,"variant",{set:function(e){this.eventVariant=e},enumerable:!1,configurable:!0}),e.prototype.recordSuccess=function(e,t){this.recordResult(o.Success,e,t)},e.prototype.recordFailure=function(e,t){this.recordResult(o.Failure,e,t)},e.prototype.recordTimeout=function(e,t){this.recordResult(o.Timeout,e,t)},e.prototype.addData=function(e){this.data.push(e)},e.prototype.isPending=function(){return this.status===o.Pending},e.prototype.getEvent=function(){var e,t=this,n={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.result,causeId:this.causeId,resultCauseId:this.resultCauseId,variant:this.eventVariant,data:this.data.map((function(e){return t.prepareData(e,!0)})).filter((function(e){return!!e}))};return this.type===a.Event&&delete n.status,n.data.length||delete n.data,n.causeId||delete n.causeId,n.resultCauseId||delete n.resultCauseId,n.result||delete n.result,n.variant||delete n.variant,(e={})[this.eventName]=n,e},e.prototype.recordResult=function(e,t,n){this.status=e,this.result=this.prepareData(t),this.causeId!==n&&(this.resultCauseId=n),this.duration=(new Date).getTime()-this.eventStartTimestamp},e.prototype.prepareData=function(e,t){if(void 0===t&&(t=!1),null==e)return"";if("string"==typeof e)return(0,u.scrubMriOrOmit)(e);if("number"==typeof e||"boolean"==typeof e)return String(e);if("function"==typeof e)return"";if(e instanceof Error)return e.toString();try{return Object.keys(e).length?t?e:(0,l.getPIISafeObject)(e):""}catch(e){return"invalid"}},e}();!function(e){e.LOCAL="Local",e.REMOTE="Remote"}(p||(t.CALL_TERMINATING_END=p={})),function(e){e.SUCCESS="Success",e.FAILURE="Failure"}(h||(t.RESULT_VALUE=h={})),function(e){e.INCOMING="Incoming",e.OUTGOING="Outgoing"}(g||(t.DIRECTION=g={})),function(e){e.CALLER="caller",e.CALLEE="callee",e.JOIN="join",e.SUBSCRIBE="SUBSCRIBE"}(f||(t.SELF_PARTICIPANT_ROLE=f={})),function(e){e.SUCCESS="Success",e.FAILURE="Failure",e.TIMEOUT="Timeout"}(m||(m={}));var y=function(){function e(e,t,n,r){this.logger=e,this.startTime=t,this.maxEventsExceeded=n,this.perfModule=r,this.recordedEvents=[],this.ipcStats=[],this.ongoingOperations={}}return e.prototype.recordEvent=function(e,t,n){void 0===n&&(n=(0,c.generateCauseId)()),this.logger.debug("Event:",e,s.pii.Omit(t));var r=new _(e,this.getEventStartTime(),a.Event,n,t);return this.pushToRecordedEvents(r),r},e.prototype.recordOperationSuccess=function(e,t,n,r,i){void 0===t&&(t=null),this.logger.info("Event success:",r,e,s.pii.Omit(n),s.pii.Omit(t)),this.recordOperationResult(e,t,m.SUCCESS,n,r,i)},e.prototype.recordOperationFailure=function(e,t,n,r,i){this.logger.info("Event failure:",e,s.pii.Omit(n),t),this.recordOperationResult(e,t,m.FAILURE,n,r,i)},e.prototype.recordOperationTimeout=function(e,t,n,r,i){this.logger.info("Event timeout:",e,s.pii.Omit(n),t),this.recordOperationResult(e,t,m.TIMEOUT,n,r,i)},e.prototype.maybeRecordOperationSuccess=function(e,t,n,r,i){void 0===t&&(t=null),this.hasOngoingEvent(e,n)&&this.recordOperationSuccess(e,t,n,r,i)},e.prototype.maybeRecordOperationFailure=function(e,t,n,r,i){this.hasOngoingEvent(e,n)&&this.recordOperationFailure(e,t,n,r,i)},e.prototype.maybeRecordOperationTimeout=function(e,t,n,r,i){this.hasOngoingEvent(e,n)&&this.recordOperationTimeout(e,t,n,r,i)},e.prototype.recordOperationResult=function(e,t,n,r,i,o){this.hasOngoingEvent(e,r)||this.recordOperation(e,i,r);var a=this.ongoingOperations[e];switch(r&&(a=a[r]),o&&a.addData(o),n){case m.SUCCESS:a.recordSuccess(t,i);break;case m.FAILURE:a.recordFailure(t,i);break;case m.TIMEOUT:a.recordTimeout(t,i);break;default:this.logger.error("Unknown operation record state in record operation result.")}r?delete this.ongoingOperations[e][r]:delete this.ongoingOperations[e]},e.prototype.recordOperation=function(e,t,n,r){this.logger.debug("Event create:",t,e,s.pii.Omit(n),r);var i=new _(e,this.getEventStartTime(),a.Operation,t,r);return this.ongoingOperations[e]||(this.ongoingOperations[e]={}),n?this.ongoingOperations[e][n]=i:this.ongoingOperations[e]=i,this.pushToRecordedEvents(i),i},e.prototype.setOperationVariant=function(e,t,n){var r;(r=n?this.ongoingOperations[e][n]:this.ongoingOperations[e])?r.variant=t:this.logger.error("Could not find operation ".concat(e," to set variant ").concat(t))},e.prototype.updateOperationData=function(e,t,n,r){try{if(!this.ongoingOperations[e])return void this.recordEvent(e,t,n);r?this.ongoingOperations[e][r]&&this.ongoingOperations[e][r].addData(t):this.ongoingOperations[e].addData(t)}catch(t){return void this.logger.info("Unable to update operation: ".concat(e," data"))}},e.prototype.pushToRecordedEvents=function(e){if(this.maxEventsExceeded&&this.maxEventsExceeded()&&this.recordedEvents.shift(),this.recordedEvents.push(e),this.perfModule&&this.ipcStats.length<=30){var t=this.perfModule.getIpcStats();t&&this.ipcStats.push({ingestionTime:this.getEventStartTime(),stats:t})}},e.prototype.hasOngoingEvent=function(e,t){return this.ongoingOperations[e]?!(t&&!this.ongoingOperations[e][t])||(this.logger.warn("Unable to find event for name\\id ".concat(e,"\\").concat(s.pii.Omit(t))),!1):(this.logger.warn("Unable to find event for name ".concat(e)),!1)},e.prototype.getEventStartTime=function(){return(new Date).getTime()-this.startTime},e.prototype.getEventTimestampBag=function(e,t){var n=t?[t.getEvent()]:this.recordedEvents.filter((function(t){return!e||!t.isPending()})).map((function(e){return e.getEvent()})),r=JSON.stringify({eventStart:this.startTime,events:n});return this.logger.info("Call eventTimestampBag ".concat(s.pii.Omit(r))),r},e.prototype.getIPCStats=function(){return 0!==this.ipcStats.length?JSON.stringify(this.ipcStats):""},e.prototype.removeRecordedEvent=function(e){var t=this.recordedEvents.indexOf(e);t>-1&&this.recordedEvents.splice(t,1)},e}();t.TelemetryUtilities=y;var v=function(e){function t(t,n){var r=e.call(this,t,n,(function(){return r.recordedEvents.length>150}))||this;return r.getHostName=function(){try{return"localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost":"<redacted>"}catch(e){return"unknown"}},r.tsCallingVersion=(0,d.getTsCallingVersion)(),r.logger=t.createChild("CallRegistryTelemetry"),r}return i(t,e),t.prototype.setClientType=function(e){this.clientType=e},t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setSkypeId=function(e){this.skypeId=(0,u.scrubMriOrOmit)(e)},t.prototype.setApplicationType=function(e){this.applicationType=e},t.prototype.setRing=function(e){this.ring=e},t.prototype.setTenantId=function(e){this.tenantId=e},t.prototype.setUserHexCID=function(e){this.userHexCID=e},t.prototype.setAcsResourceId=function(e){this.acsResourceId=e},t.prototype.setRegion=function(e){this.region=e},t.prototype.setPartition=function(e){this.partition=e},t.prototype.getEvent=function(e,t){var n=function(e){return void 0===e?"":e};return{EndpointId:n(this.endpointId),SkypeId:n(this.skypeId),ApplicationType:n(this.applicationType),Ring:n(this.ring),TenantId:n(this.tenantId),userHexCID:n(this.userHexCID),AcsResourceId:n(this.acsResourceId),Region:n(this.region),Partition:n(this.partition),TsCallingVersion:n(this.tsCallingVersion),HostName:this.getHostName(),EventTimestampBag:this.getEventTimestampBag(e,t),DiagnosticInfo:this.callEndDiagnosticInfo,ClientType:n(this.clientType)}},t.prototype.removeNonPendingOperations=function(){this.recordedEvents=this.recordedEvents.filter((function(e){return e.isPending()}))},t}(y);t.CallRegistryTelemetry=v;var S=function(e){function t(t,n,r){var i=e.call(this,t,n,(function(){return i.inCallMode&&i.recordedEvents.length>150}),r)||this;return i.inCallMode=!1,i.tsCallingVersion=(0,d.getTsCallingVersion)(),i.logger=t.createChild("CallTelemetry"),i}return i(t,e),t.prototype.setClientType=function(e){this.clientType=e},t.prototype.setCallId=function(e){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=e},t.prototype.setConsultativeCallId=function(e){this.consultativeCallId=e},t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setParticipantId=function(e){this.participantId=e},t.prototype.setPreheatFlags=function(e){this.preheatFlags=e},t.prototype.setCallOrigin=function(e){this.origin=e},t.prototype.setGroupId=function(e){this.groupId=e},t.prototype.setThreadId=function(e){this.threadId=e},t.prototype.setBackroomThreadId=function(e){this.backroomThreadId=e},t.prototype.setComplianceRecordingContentLength=function(e){this.complianceRecordingContentLength=e},t.prototype.setConversationStartTime=function(e){this.conversationStartTime=e},t.prototype.setMessageId=function(e){this.messageId=e},t.prototype.setSkypeId=function(e){this.skypeId=(0,u.scrubMriOrOmit)(e)},t.prototype.setApplicationType=function(e){this.applicationType=e},t.prototype.setRing=function(e){this.ring=e},t.prototype.setTenantId=function(e){this.tenantId=e},t.prototype.setUserHexCID=function(e){this.userHexCID=e},t.prototype.setAcsResourceId=function(e){this.acsResourceId=e},t.prototype.setRegion=function(e){this.region=e},t.prototype.setPartition=function(e){this.partition=e},t.prototype.setFailureType=function(e){this.failureType=e},t.prototype.setIsCast=function(e){this.isCast=e?"True":"False"},t.prototype.setIsHuddleGroupCall=function(e){this.isHuddleGroupCall=e?"True":"False"},t.prototype.setIsEmergency=function(e){this.isEmergency=e?"True":"False"},t.prototype.setRole=function(e){this.isAnonymous="admin"===e?"False":"True"},t.prototype.setCallType=function(e){this.callType=e},t.prototype.setConversationType=function(e){this.conversationType=e},t.prototype.setDirection=function(e){this.direction=e},t.prototype.setSelfParticipantRole=function(e){this.selfParticipantRole=e},t.prototype.setTerminationState=function(e){this.terminationState=e},t.prototype.setTerminationReason=function(e){this.terminationReason=e},t.prototype.setCallEndDiagnosticInfo=function(e){this.callEndDiagnosticInfo=e},t.prototype.setStackConfig=function(e){this.stackConfig=e},t.prototype.setJoinedFrom=function(e){this.joinedFrom=e},t.prototype.setMeetingCode=function(e){this.meetingCode=e},t.prototype.setMeetingUrl=function(e){this.meetingUrl=e},t.prototype.setHasMeetingRegistrationId=function(e){this.hasMeetingRegistrationId=e?"True":"False"},t.prototype.setHasParticipantPin=function(e){this.hasParticipantPin=e?"True":"False"},t.prototype.getEvent=function(e,t){var n=function(e){return void 0===e?"":e};return{CorrelationId:n(this.currentCallId),PreviousCorrelationId:n(this.previousCallId),ConsultativeCallId:n(this.consultativeCallId),EndpointId:n(this.endpointId),SkypeId:n(this.skypeId),ParticipantId:n(this.participantId),PreheatFlags:n(this.preheatFlags),CallType:n(this.callType),ConversationType:n(this.conversationType),Direction:n(this.direction),Origin:n(this.origin),SelfParticipantRole:n(this.selfParticipantRole),IsAnonymous:n(this.isAnonymous),GroupId:(0,u.scrubMriOrOmit)(n(this.groupId)),ThreadId:(0,u.getLoggableThreadId)(n(this.threadId)),MessageId:n(this.messageId),ApplicationType:n(this.applicationType),Ring:n(this.ring),TenantId:n(this.tenantId),userHexCID:n(this.userHexCID),AcsResourceId:n(this.acsResourceId),Region:n(this.region),Partition:n(this.partition),FailureType:n(this.failureType),IsCast:n(this.isCast),IsHuddleGroupCall:n(this.isHuddleGroupCall),IsEmergency:n(this.isEmergency),TsCallingVersion:n(this.tsCallingVersion),TerminationState:n(this.terminationState),TerminationReason:n(this.terminationReason),StackConfig:n(this.stackConfig),EventTimestampBag:this.getEventTimestampBag(e,t),HostName:this.getHostName(),DiagnosticInfo:this.callEndDiagnosticInfo,JoinedFrom:this.joinedFrom,MeetingCode:this.meetingCode,MeetingUrl:this.meetingUrl,HasMeetingRegistrationId:this.hasMeetingRegistrationId,HasParticipantPin:this.hasParticipantPin,IPCStats:this.getIPCStats(),ComplianceRecordingContentLength:n(this.complianceRecordingContentLength),ConversationStartTime:n(this.conversationStartTime),BackroomThreadId:(0,u.getLoggableThreadId)(n(this.backroomThreadId)),ClientType:n(this.clientType)}},t.prototype.switchToInCallTelemetry=function(){this.recordedEvents=this.recordedEvents.filter((function(e){return e.isPending()})),this.inCallMode=!0},t.prototype.getHostName=function(){try{return location.host}catch(e){return"unknown"}},t}(y);t.CallTelemetry=S;t.getEndpointInformationForTelemetry=function(e){return Array.isArray(e)?e.map((function(e){return{endpointId:e.endpointId,participantId:e.participantId}})):null};t.calculateJoinedFromForTelemetry=function(e,t,n,r,i){if(e){if(e.meetingUrl)return"MeetingUrl";if(e.meetingCode)return"MeetingCode"}return t||n?"ThreadContext":r?"GroupId":i?"Awareness":""}},7584:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateCauseId=t.generateCauseId=void 0;t.generateCauseId=function(){for(var e="abcdef0123456789",t="",n=0;n<8;n++)t+=e.charAt(Math.floor(16*Math.random()));return t},t.validateCauseId=function(e){return new RegExp("^[a-f0-9]{8}$").test(e)&&8===e.length}},2321:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6773),i=n(7584),o=n(2559),a=function(){function e(e){this._logger=e,this._promise=Promise.resolve(void 0),this._actionQueue=[]}return e.prototype.chainPromise=function(e,t,n,a){var s=this;void 0===n&&(n=(0,i.generateCauseId)()),void 0===a&&(a=!1);var c=Date.now(),l=(("function"==typeof t?t():t)||"").toString();this._actionQueue.push(l),this._logger.info("[".concat(n,"][").concat(l,"]enqueueing, queue=[").concat(this._actionQueue,"], reset=").concat(a));var u=function(){s._actionQueue=s._actionQueue.filter((function(e){return e!==l}))};return a&&this.reset(n),this._promise=this._promise.catch(r.noop).then((function(){var t=Date.now()-c;return s._logger.info("[".concat(n,"][").concat(l,"]begin, delayMs=").concat(t)),e()})),this._promise.then((function(){u();var e=Date.now()-c;s._logger.info("[".concat(n,"][").concat(l,"]success, durationMs=").concat(e))}),(function(e){u();var t=Date.now()-c;s._logger.warn("[".concat(n,"][").concat(l,"]failed=").concat((0,o.safeJsonStringify)(e),", durationMs=").concat(t))})),this._promise},e.prototype.reset=function(e){this._logger.info("[".concat(e,"] resetting")),this._promise=Promise.resolve(void 0)},e}();t.default=a},6871:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_SOURCE_ID_ANY=t.CONSTANTS=void 0,t.CONSTANTS={CODE:{SUCCESS:0,MEDIA_ERROR:410,CLIENT_ERROR_CODE:499,UNKNOWN_ERROR:497},SUB_CODE:{VDI_DISCONNECTED:3e3,ACTION_NOT_ALLOWED:3548,INVALID_DATA_TYPE:3757,ABANDONED:4990,ENDED_BY_REMOTE_ENDPOINT:5028,BEACON:4521,UNKNOWN_FAILURE:3545,SLIMCORE_CALL_SETUP_FAILURE:3546}},t.DATA_SOURCE_ID_ANY=4294967294},2211:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentSharingSession=void 0;var r=n(6773),i=n(5442),o=n(5025),a={CANCELED_TERMINATION_REASON:{terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Content sharing is disconnected"},ACTION_NOT_ALLOWED:function(e){return{terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:e}}},s=function(){function e(e,t){var n=this;this._platformImpl=e,this._pendingDeferreds=[],this._updateContentSharingSessionStateDeferredPromises={},this.onJoinResultEvent=function(e){if(n._joinContenSharingDeferredPromise)if(n._logger.info("JoinContentSharing completed for: ".concat(n._platformImpl.contentSharingGuid,", status: ").concat(JSON.stringify(e))),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._joinContenSharingDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Join failed with reason ".concat(i);n._logger.error(o),n._rejectDeferred(n._joinContenSharingDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for join. Event data: ".concat(e))},this.onUpdateParticipantStateResultEvent=function(e){if(n._updateParticipantStateDeferredPromise)if(n._logger.info("UpdateContentSharingParticipantStateToViewer completed for: ".concat(n._platformImpl.contentSharingGuid,", status: ").concat(JSON.stringify(e))),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._updateParticipantStateDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Update participant state failed with reason ".concat(i);n._logger.error(o),n._rejectDeferred(n._updateParticipantStateDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for update participant state. Event data: ".concat(e))},this.onSessionStateResultEvent=function(e){if(n._logger.info("UpdateContentSharingSessionState completed for: ".concat(n._platformImpl.contentSharingGuid,", status: ").concat(JSON.stringify(e))),n._updateContentSharingSessionStateDeferredPromises.hasOwnProperty(e.id))if(e.failureReason===n._platformImpl.noFailureReason)n._updateContentSharingSessionStateDeferredPromises[e.id].resolve();else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Update SessionState failed with reason ".concat(i);n._logger.error(o),n._updateContentSharingSessionStateDeferredPromises[e.id].reject({terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}},this.onTakeControlResultEvent=function(e){if(n._takeControlDeferredPromise)if(n._logger.info("TakeContentSharingControl completed for: ".concat(n._platformImpl.contentSharingGuid,", ").concat(JSON.stringify(e))),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._takeControlDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Take content sharing control failed with reason ".concat(i);n._logger.error(o),n._rejectDeferred(n._takeControlDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for take control. Event data: ".concat(e))},this._logger=new o.default(t)}return e.prototype.statusChanged=function(e){if(7===e||8===e){if(this._stopContentSharingDeferredPromise&&this._invokeDeferred(this._stopContentSharingDeferredPromise),this._startContentSharingDeferredPromise){var t=this._platformImpl.contentSharingTerminationReason&&0!==this._platformImpl.contentSharingTerminationReason.terminatedReason?this._platformImpl.contentSharingTerminationReason:a.CANCELED_TERMINATION_REASON;this._rejectDeferred(this._startContentSharingDeferredPromise,t)}this._logger.info("Content sharing is disconnected"),this._rejectPendingPromises(a.CANCELED_TERMINATION_REASON)}else if(2===e||5===e||4===e){if(this._stopContentSharingDeferredPromise){var n="Content sharing cannot be ended when not presenting";t=a.ACTION_NOT_ALLOWED(n);this._logger.error(n),this._rejectDeferred(this._stopContentSharingDeferredPromise,t)}}else 3===e&&(this._startContentSharingDeferredPromise&&this._invokeDeferred(this._startContentSharingDeferredPromise),this._takeControlDeferredPromise&&this._invokeDeferred(this._takeControlDeferredPromise))},e.prototype.startContentSharing=function(e){var t=this,n=this._logger.createFnLogger("startContentSharing",e);if(this._startContentSharingDeferredPromise)return this._startContentSharingDeferredPromise.promise;if(0!==this._platformImpl.contentSharingStatus){var r="Content sharing cannot be started as it is not in the initial state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Start content sharing for : ".concat(this._platformImpl.contentSharingGuid)),this._startContentSharingDeferredPromise=new i.Deferred;var s=function(){t._startContentSharingDeferredPromise=null};return this._startContentSharingDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then((function(){return t._platformImpl.callStartContentSharing()})).then((function(){return t._pendingDeferreds.push(t._startContentSharingDeferredPromise)})).then((function(){return t._startContentSharingDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"startContentSharing",n)}))},e.prototype.joinContentSharing=function(e){var t=this,n=this._logger.createFnLogger("joinContentSharing",e);if(this._joinContenSharingDeferredPromise)return this._joinContenSharingDeferredPromise.promise;if(2!==this._platformImpl.contentSharingStatus){var r="Content sharing cannot be joined as it is not in ringing state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Join content sharing for : ".concat(this._platformImpl.contentSharingGuid)),this._joinContenSharingDeferredPromise=new i.Deferred;var s=function(){t._joinContenSharingDeferredPromise=null};return this._joinContenSharingDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then((function(){return t._platformImpl.callStartContentSharing()})).then((function(){return t._pendingDeferreds.push(t._joinContenSharingDeferredPromise)})).then((function(){return t._joinContenSharingDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"joinContentSharing",n)}))},e.prototype.updateContentSharingParticipantStateToViewer=function(e){var t=this,n=this._logger.createFnLogger("updateContentSharingParticipantStateToViewer",e);if(this._updateParticipantStateDeferredPromise)return this._updateParticipantStateDeferredPromise.promise;if(4!==this._platformImpl.contentSharingStatus){var r="Cannot update participant state as content sharing is not in connected state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Update content sharing participant state for : ".concat(this._platformImpl.contentSharingGuid)),this._updateParticipantStateDeferredPromise=new i.Deferred;var s=function(){t._updateParticipantStateDeferredPromise=null};return this._updateParticipantStateDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then((function(){return t._platformImpl.callUpdateContentSharingParticipantState()})).then((function(){return t._pendingDeferreds.push(t._updateParticipantStateDeferredPromise)})).then((function(){return t._updateParticipantStateDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"joinContentSharing",n)}))},e.prototype.updateContentSharingSessionState=function(e,t,n){var r=this,o=this._logger.createFnLogger("updateContentSharingSessionState",n);if(this._updateContentSharingSessionStateDeferredPromises[e])return this._updateContentSharingSessionStateDeferredPromises[e].promise;if(3!==this._platformImpl.contentSharingStatus){var s="Cannot update session state as content sharing is not in presenting state",c=a.ACTION_NOT_ALLOWED(s);return o.logFailure(s),Promise.reject(c)}var l=new i.Deferred;this._updateContentSharingSessionStateDeferredPromises[e]=l;var u=function(){delete r._updateContentSharingSessionStateDeferredPromises[e]};return this._updateContentSharingSessionStateDeferredPromises[e].promise.then(u,u),o.info("Update content sharing session state for : ".concat(this._platformImpl.contentSharingGuid)),Promise.resolve(void 0).then((function(){return r._platformImpl.callUpdateContentSharingSessionState(e,t)})).then((function(){return r._updateContentSharingSessionStateDeferredPromises[e].promise})).catch((function(e){r.handleContentSharingOperationError(e,"updateContentSharingSessionState",o)}))},e.prototype.takeContentSharingControl=function(e){var t=this,n=this._logger.createFnLogger("takeContentSharingControl",e);if(this._takeControlDeferredPromise)return this._takeControlDeferredPromise.promise;if(5!==this._platformImpl.contentSharingStatus){var r="Cannot take control of content sharing as it is not in viewing state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Taking control of content sharing for : ".concat(this._platformImpl.contentSharingGuid)),this._takeControlDeferredPromise=new i.Deferred;var s=function(){t._takeControlDeferredPromise=null};return this._takeControlDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then((function(){return t._platformImpl.callTakeContentSharingControl()})).then((function(){return t._pendingDeferreds.push(t._takeControlDeferredPromise)})).then((function(){return t._takeControlDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"takeContentSharingControl",n)}))},e.prototype.stopContentSharing=function(e){var t=this,n=this._logger.createFnLogger("stopContentSharing",e);if(this._stopContentSharingDeferredPromise)return this._stopContentSharingDeferredPromise.promise;if(2===this._platformImpl.contentSharingStatus||4===this._platformImpl.contentSharingStatus||5===this._platformImpl.contentSharingStatus){var r="Incoming content sharing cannot be stopped",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}this._stopContentSharingDeferredPromise=new i.Deferred;var s=function(){t._stopContentSharingDeferredPromise=null};return this._stopContentSharingDeferredPromise.promise.then(s,s),n.info("Stop content sharing for : ".concat(this._platformImpl.contentSharingGuid)),Promise.resolve(void 0).then((function(){return t._platformImpl.callStopContentSharing()})).then((function(){return t._pendingDeferreds.push(t._stopContentSharingDeferredPromise)})).then((function(){return t._stopContentSharingDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"stopContentSharing",n)}))},e.prototype.handleContentSharingOperationError=function(e,t,n){var r=e instanceof Error?e.toString():JSON.stringify(e);throw n.logFailure("Error in ".concat(t,"(), contentSharingGuid = ").concat(this._platformImpl.contentSharingGuid,", error = ").concat(r)),(null==e?void 0:e.hasOwnProperty("terminatedReason"))?e:a.ACTION_NOT_ALLOWED(r)},e.prototype._rejectPendingPromises=function(e){this._logger.info("rejectPendingPromises"),this._pendingDeferreds.forEach((function(t){t.reject(e)})),this._pendingDeferreds=[],(0,r.forEach)(this._updateContentSharingSessionStateDeferredPromises,(function(t){t.reject(e)})),this._updateContentSharingSessionStateDeferredPromises={}},e.prototype._invokeDeferred=function(e){this._logger.info("_invokeDeferred"),e&&((0,r.pull)(this._pendingDeferreds,e),e.resolve())},e.prototype._rejectDeferred=function(e,t){this._logger.info("_rejectDeferred"),e&&((0,r.pull)(this._pendingDeferreds,e),e.reject(t))},e}();t.ContentSharingSession=s},2944:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalDeferHandler=t.DeferHandler=void 0;var r=n(7584),i=n(6773),o=n.g.setImmediate?function(e){n.g.setImmediate(e)}:function(e){(0,i.defer)(e)},a=function(){function e(){this.deferredOperations=new Map,this.deferredOperationsNames=[],this.isRunning=!1}return e.prototype.setLogger=function(e){this._logger=e.createChild("[DeferHandler]")},e.prototype.setDeferToQueueMicrotask=function(t){t&&n.g.queueMicrotask?e.defer=function(e){return n.g.queueMicrotask(e)}:e.defer=o},e.prototype.createDeferRunner=function(e){var t=this,n={};return function(r){return t.runDeferred(n,r,e)}},e.prototype.runDeferredWithoutDedup=function(e,t){this.runDeferred({},e,t)},e.prototype.runDeferred=function(t,n,i){var o,a=this;this.deferredOperations.has(t)||(this.deferredOperations.set(t,n),i&&this.deferredOperationsNames.push(" "+i),this.isRunning||(this.isRunning=!0,this._startDeferalTime=Date.now(),this.causeId=(0,r.generateCauseId)(),null===(o=this._logger)||void 0===o||o.info("[".concat(this.causeId,"]Deferring operations")),e.defer((function(){var t;a._timeToRun=Date.now()-a._startDeferalTime,a.deferredOperations.forEach((function(t){e.runWithTryCatch(t)})),a.deferredOperations.clear(),a.isRunning=!1,null===(t=a._logger)||void 0===t||t.info("[".concat(a.causeId,"]Deferred operations ran after ").concat(a._timeToRun,"ms ")+"| Completed after ".concat(Date.now()-a._startDeferalTime,"ms | Operations:").concat(a.deferredOperationsNames)),a.deferredOperationsNames=[]}))))},e.runWithTryCatch=function(e){try{e&&e()}catch(e){}},e.defer=o,e}();t.DeferHandler=a;var s=function(){function e(){}return e.instance=new a,e}();t.GlobalDeferHandler=s},4487:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSuccessTransactionEnd=t.getRejectTransactionEnd=t.isTransactionEnd=void 0;var r=n(891),i=n(2559);function o(e){return!(!e||!e.code)}t.isTransactionEnd=o,t.getRejectTransactionEnd=function(e,t){return o(e)?e:{code:r.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:void 0!==t?t:r.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:"string"==typeof e?e:(0,i.getPrintableObject)(e)}},t.getSuccessTransactionEnd=function(){return{code:r.TRANSACTION_END_CODE.SUCCESS}}},7289:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceImpl=void 0;var r=n(6773),i=n(3907),o=function(){function e(e){this.eventLogger=e,this.subscriptions=[]}return e.prototype.subscribe=function(e){return new a(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this;this.subscriptions.slice().forEach((function(n){var r,o;try{void 0!==n.eventHandler&&e(n.eventHandler)}catch(e){null===(o=null===(r=t.eventLogger)||void 0===r?void 0:r.warn)||void 0===o||o.call(r,"Event handler exception caught!",(0,i.stringifyObject)(e))}}))},e}();t.EventSourceImpl=o;var a=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;(0,r.remove)(this.subscriptions,(function(t){return t===e})),this.eventHandler=void 0},e}()},6136:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=void 0,t.noop=function(){}},4545:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateGuid=void 0,t.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.validateGuid=function(e){return new RegExp("^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$").test(e)&&36===e.length}},6904:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetUmsStreamPlaybackCoordinatesFromStream=t.GetHlsStreamPlaybackCoordinatesFromStream=void 0,t.GetHlsStreamPlaybackCoordinatesFromStream=function(e){if(e.playbackCoordinates)return e.playbackCoordinates;if(!e.url&&!e.hlsUrls)return[];var t=[];return(e.hlsUrls?e.hlsUrls:[e.url]).forEach((function(n){t.push({url:n,ecdnProviderData:e.sdnContext})})),t},t.GetUmsStreamPlaybackCoordinatesFromStream=function(e){return e.url?[{url:e.url,ecdnProviderData:e.sdnContext}]:[]}},3261:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.HlsHydraLiveStreamPlayer=t.HardcodeWebsdkUrls=void 0;var s=n(1566),c=n(6904);t.HardcodeWebsdkUrls=["https://afdhls.playerscript.prod.ml.cdn.office.net/hlsrt2024-226-1/hydra_player_hls_bundle.js","https://vzhls.playerscript.prod.ml.cdn.office.net/hlsrt2024-226-1/hydra_player_hls_bundle.js"];var l=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.createEventHandler=function(){return new d},n.prototype.createHydraPlayerSettings=function(){var e,n,r,i,o,a,s,c,l,u,d,p,h,g;return{playerType:1,hydraRuntimeFetchTimeout:null===(e=this.configProvider.playerConfig)||void 0===e?void 0:e.hydraRuntimeFetchTimeout,capturePlayerLogs:this.configProvider.config.capturePlayerLogs,allowSdnPlugins:this.configProvider.config.allowSdnPlugins,debugLogging:null!==(n=this.configProvider.config.debug)&&void 0!==n&&n,muteVideo:null!==(i=null===(r=this.configProvider.playerConfig)||void 0===r?void 0:r.muteVideo)&&void 0!==i&&i,videoLang:null===(o=this.configProvider.playerConfig)||void 0===o?void 0:o.lang,videoElementStyles:null===(a=this.configProvider.playerConfig)||void 0===a?void 0:a.styles,maxPlayerDiagnosticsCount:this.configProvider.config.maxPlayerDiagnosticsCount,maxPlayerMemoryTraceLogCount:this.configProvider.config.maxPlayerMemoryTraceLogCount,maxPlayerPlaybackEventCount:this.configProvider.config.maxPlayerPlaybackEventCount,maxPlayerExperimentalEvents:this.configProvider.config.hlsSettings.maxPlayerExperimentalEvents,maxRetryCount:this.configProvider.config.maxRetryCount,playerTelemetryTickMs:this.configProvider.config.playerTelemetryTickMs,removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack,maxRetryCountForLoadingResources:this.configProvider.config.maxRetryCountForLoadingResources,maxVideoTrackHistoryLogCount:this.configProvider.config.maxVideoTrackHistoryLogCount,maxStreamConnectionResultsLogCount:this.configProvider.config.hlsSettings.maxStreamConnectionResultsLogCount,maxAbsoluteTimeOffsetEstimationResultsLogCount:this.configProvider.config.hlsSettings.maxAbsoluteTimeOffsetEstimationResultsLogCount,skipNonce:this.configProvider.config.hlsSettings.skipNonce,configIds:this.configProvider.configIds,estimateAbsoluteTime:this.configProvider.config.hlsSettings.estimateAbsoluteTime,playlistInitialSequenceNumber:this.configProvider.config.hlsSettings.playlistInitialSequenceNumber,timeoutForSwitchingUrl:this.configProvider.config.hlsSettings.timeoutForSwitchingUrl,hlsConfig:this.configProvider.config.hlsSettings.hlsConfig,logHlsJsEvents:this.configProvider.config.hlsSettings.logHlsJsEvents,logHlsJsEventsEveryMs:this.configProvider.config.hlsSettings.logHlsJsEventsEveryMs,switchingPolicy:null===(c=null===(s=this.configProvider.config.hydraPlayerHlsSettings)||void 0===s?void 0:s.ecsSettings)||void 0===c?void 0:c.switchingPolicy,enableUuidTrace:this.configProvider.config.hlsSettings.enableUuidTrace,thaScript:this.configProvider.config.hlsSettings.thaScript,enableOffsetComputeBasedOfStreamTime:this.configProvider.config.hlsSettings.enableOffsetComputeBasedOfStreamTime,stopCrash:this.configProvider.config.stopCrash,stopTerminating:this.configProvider.config.hlsSettings.stopTerminating,stallDetectionPolicy:null===(u=null===(l=this.configProvider.config.hydraPlayerHlsSettings)||void 0===l?void 0:l.ecsSettings)||void 0===u?void 0:u.stallDetectionPolicy,playerRuntimeJsUrls:null!==(h=null!==(p=null===(d=this.configProvider.config.hydraPlayerHlsSettings)||void 0===d?void 0:d.runtimeUrls)&&void 0!==p?p:this.configProvider.playerConfig.hydraPlayerWebSdkUrls)&&void 0!==h?h:t.HardcodeWebsdkUrls,disableSandbox:this.configProvider.config.hlsSettings.disableSandbox,ecsSettings:null===(g=this.configProvider.config.hydraPlayerHlsSettings)||void 0===g?void 0:g.ecsSettings}},n.prototype.createHydraStreamOptions=function(){var e,t,n,r,i="TLE";i=this.streamOptions.streamingEventType?this.convertStreamingEventType(this.streamOptions.streamingEventType):this.streamOptions.overflow?"Overflow":"TLE";var o={stream:{playbackCoordinates:(0,c.GetHlsStreamPlaybackCoordinatesFromStream)(this.streamOptions.stream),urls:this.streamOptions.stream.hlsUrls?this.streamOptions.stream.hlsUrls:[this.streamOptions.stream.url],keyAuthorizationToken:this.streamOptions.stream.keyAuthorizationToken,keyDeliveryUrl:this.streamOptions.stream.keyDeliveryUrl,sdnContext:this.streamOptions.stream.sdnContext,streamDeliveryPipeline:this.streamOptions.stream.streamDeliveryPipeline?this.convertStreamDeliveryPipeline(this.streamOptions.stream.streamDeliveryPipeline):void 0},altStream:this.streamOptions.altStream?{playbackCoordinates:(0,c.GetHlsStreamPlaybackCoordinatesFromStream)(this.streamOptions.altStream),urls:this.streamOptions.altStream.hlsUrls?this.streamOptions.altStream.hlsUrls:[this.streamOptions.altStream.url],keyAuthorizationToken:this.streamOptions.altStream.keyAuthorizationToken,keyDeliveryUrl:this.streamOptions.altStream.keyDeliveryUrl,sdnContext:this.streamOptions.altStream.sdnContext,streamDeliveryPipeline:this.streamOptions.altStream.streamDeliveryPipeline?this.convertStreamDeliveryPipeline(this.streamOptions.altStream.streamDeliveryPipeline):void 0}:void 0,supportedSubtitleLanguages:this.streamOptions.supportedSubtitleLanguages,streamingEventType:i,allowPlayerControls:this.streamOptions.allowPlayerControls,sdn:this.streamOptions.sdn?{name:this.streamOptions.sdn.name,url:this.streamOptions.sdn.url,plugin:this.streamOptions.sdn.plugin}:void 0,thaContext:this.streamOptions.thaContext?{eventId:this.streamOptions.thaContext.eventId,organizer:{userId:null===(e=this.streamOptions.thaContext.organizer)||void 0===e?void 0:e.userId,tenantId:null===(t=this.streamOptions.thaContext.organizer)||void 0===t?void 0:t.tenantId},attendee:{userId:null===(n=this.streamOptions.thaContext.attendee)||void 0===n?void 0:n.userId,tenantId:null===(r=this.streamOptions.thaContext.attendee)||void 0===r?void 0:r.tenantId},coOrganizers:this.streamOptions.thaContext.coOrganizers}:void 0};return this.streamOptions.eventId&&(o.eventId=this.streamOptions.eventId),this.streamOptions.templateId&&(o.templateId=this.streamOptions.templateId),this.streamOptions.meetingMetadata&&(o.meetingMetadata=this.streamOptions.meetingMetadata),o},n.prototype.onCaptionsToggled=function(e,t,n){this.captionsControl&&this.captionsControl.toggleCaptions(e,t),this.event("captionsToggled").raise(e,t,n)},n.prototype.getCaptionsControl=function(){var e;if(!this.captionsControl&&this.hydraPlayer){var t=(null===(e=this.streamOptions)||void 0===e?void 0:e.supportedSubtitleLanguages)?this.streamOptions.supportedSubtitleLanguages.map((function(e){return e.culture})):["en","es"];this.captionsControl=new u(this.hydraPlayer,t)}return this.captionsControl},n.prototype.addPlayerEventSubscribers=function(){var t=this;e.prototype.addPlayerEventSubscribers.call(this),this.playerSubs.push(this.eventHandler.on("captionsToggled",(function(e,n,r){t.onCaptionsToggled(e,n,r)})))},n.prototype.releasePlayer=function(){e.prototype.releasePlayer.call(this),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null)},n}(s.HydraLiveStreamPlayer);t.HlsHydraLiveStreamPlayer=l;var u=function(){function e(e,t){this.hydraPlayer=e,this.availableCultures=t,this.selectedCulture=""}return e.prototype.addCues=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return t=this.convertCues(e),[4,this.hydraPlayer.callPlayerApi("addHydraPlayerCues",t)];case 1:return n.sent(),[2]}}))}))},e.prototype.convertCues=function(e){var t=[];return e.forEach((function(e){t.push({start:e.start,end:e.end,text:e.text})})),t},e.prototype.clearCues=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.hydraPlayer.callPlayerApi("clearHydraPlayerCues")];case 1:return e.sent(),[2]}}))}))},e.prototype.showCaptions=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.hydraPlayer.callPlayerApi("showHydraPlayerCaptions",e)];case 1:return t.sent(),[2]}}))}))},e.prototype.getSelectedCulture=function(){return this.selectedCulture},e.prototype.getAvailableCultures=function(){return this.availableCultures},e.prototype.dispose=function(){this.hydraPlayer=null},e.prototype.toggleCaptions=function(e,t){this.selectedCulture=e?t:""},e}(),d=function(e){function t(){return e.call(this)||this}return i(t,e),t.prototype.captionsToggled=function(e,t,n){this.event("captionsToggled").raise(e,t,n)},t}(s.PlayerEventHandler)},1566:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerEventHandler=t.HydraLiveStreamPlayer=void 0;var c=n(6144),l=n(5212),u=n(6789),d=n(3645),p=n(3907),h=function(e){function t(t,n,r){var i=e.call(this)||this;i.logger=t,i.telemetryLogger=r,i.playerLoaded=!1,i.playbackState="Destroyed",i.playerSubs=[],i.isFinalTelemetrySent=!1,i.captionsTimestamp=0,i.configProvider=n;var o=i.createHydraPlayerSettings();return i.eventHandler=i.createEventHandler(),i.addPlayerEventSubscribers(),i.hydraPlayer=new u.HydraPlayer(o,i.eventHandler),i}return i(t,e),t.prototype.configure=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.streamOptions=e,this.threadId=e.threadId,this.playerLoaded?(t=this.createHydraStreamOptions(),[4,this.hydraPlayer.callPlayerApi("configureHydraPlayer",t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.loadPlayer=function(e){return a(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,this.hydraPlayer.setup(e)];case 1:return r.sent()?this.streamOptions?(t=this.createHydraStreamOptions(),[4,this.hydraPlayer.callPlayerApi("configureHydraPlayer",t)]):[3,3]:[2,{setupSucceeded:!1,playerSetupError:{errorType:"HydraRuntimeLoadFailed",errorMessage:"Failed to create IFrame with Hydra runtime script"}}];case 2:return r.sent(),[3,4];case 3:this.logger.warn("No stream options configured before Hydra player loaded"),r.label=4;case 4:return[4,this.hydraPlayer.callPlayerApi("loadHydraPlayer")];case 5:return(n=r.sent()).setupSucceeded&&(this.playerLoaded=!0,this.startTelemetryGathering()),[2,this.getHydraPlayerSetupResult(n)]}}))}))},t.prototype.convertStreamDeliveryPipeline=function(e){switch(e){case"AMS":return"AMS";case"MiddleLaneHttpLiveStreaming":return"MiddleLaneHttpLiveStreaming";case"MiddleLaneUltraLowLatency":return"MiddleLaneUltraLowLatency";default:throw new Error("Unable to convert StreamDeliveryPipeline ".concat(e," to HydraStreamDeliveryPipeline"))}},t.prototype.convertStreamingEventType=function(e){switch(e){case"TLE":return"TLE";case"Overflow":return"Overflow";case"TownHall_Basic":return"TownHall_Basic";case"TownHall_Premium":return"TownHall_Premium";case"TownHall":return"TownHall";default:throw new Error("Unable to convert StreamingEventType ".concat(e," to HydraStreamingEventType"))}},t.prototype.addPlayerEventSubscribers=function(){var e=this;this.playerSubs.push(this.eventHandler.on("playbackStateChanged",(function(t){e.onPlaybackStateChanged(t)}))),this.playerSubs.push(this.eventHandler.on("playbackError",(function(t,n){e.onPlaybackError(t,n)}))),this.playerSubs.push(this.eventHandler.on("playbackSeeked",(function(t){e.onPlaybackSeeked(t)}))),this.playerSubs.push(this.eventHandler.on("urlSwitched",(function(t){e.onUrlSwitched(t)}))),this.playerSubs.push(this.eventHandler.on("sdnPluginLoadSkipped",(function(t){e.onSdnPluginLoadSkipped(t)}))),this.playerSubs.push(this.eventHandler.on("sdnPluginLoadFailed",(function(t){e.onSdnPluginLoadFailed(t)}))),this.playerSubs.push(this.eventHandler.on("playbackStarted",(function(){e.onPlaybackStarted()}))),this.playerSubs.push(this.eventHandler.on("playbackTimeUpdated",(function(t){e.onPlaybackTimeUpdated(t)}))),this.playerSubs.push(this.eventHandler.on("videoTracksUpdated",(function(t){e.onVideoTracksUpdated(t)}))),this.playerSubs.push(this.eventHandler.on("statsUpdated",(function(t){e.onStatsUpdated(t)}))),this.playerSubs.push(this.eventHandler.on("log",(function(t,n){e.onLog(t,n)})))},t.prototype.getTelemetryReport=function(){var e;return null===(e=this.hydraPlayer)||void 0===e?void 0:e.getFullTelemetryReport()},t.prototype.getSnapshotTelemetryReport=function(){var e;return null===(e=this.hydraPlayer)||void 0===e?void 0:e.getSnapshotTelemetryReport()},t.prototype.startTelemetryGathering=function(){var e,t,n,r,i,o,c,l,u,d,p=this;this.statsSub=window.setTimeout((function(){return a(p,void 0,void 0,(function(){return s(this,(function(e){return clearTimeout(this.statsSub),this.logger.debug("initial telemetry report after ".concat(this.configProvider.config.sendInitialTelemetryAfterMs," ms")),this.sendTelemetry(!1),[2]}))}))}),this.configProvider.config.sendInitialTelemetryAfterMs),1===this.configProvider.playerConfig.playerType?(u=(null===(t=null===(e=this.configProvider.config.hydraPlayerHlsSettings)||void 0===e?void 0:e.ecsSettings)||void 0===t?void 0:t.sendSnapshotTelemetry)||this.configProvider.config.sendSnapshotTelemetry,d=(null===(r=null===(n=this.configProvider.config.hydraPlayerHlsSettings)||void 0===n?void 0:n.ecsSettings)||void 0===r?void 0:r.sendSnapshotTelemetryEveryMs)||this.configProvider.config.sendSnapshotTelemetryEveryMs):(u=(null===(o=null===(i=this.configProvider.config.hydraPlayerUmsSettings)||void 0===i?void 0:i.ecsSettings)||void 0===o?void 0:o.sendSnapshotTelemetry)||this.configProvider.config.sendSnapshotTelemetry,d=(null===(l=null===(c=this.configProvider.config.hydraPlayerUmsSettings)||void 0===c?void 0:c.ecsSettings)||void 0===l?void 0:l.sendSnapshotTelemetryEveryMs)||this.configProvider.config.sendSnapshotTelemetryEveryMs),u&&(this.diagSub=window.setInterval((function(){return a(p,void 0,void 0,(function(){return s(this,(function(e){return this.sendSnapshotTelemetry(),[2]}))}))}),d))},t.prototype.getHydraPlayerSetupResult=function(e){return{setupSucceeded:e.setupSucceeded,playerSetupError:e.playerSetupError?{errorType:this.convertHydraPlayerSetupError(e.playerSetupError.errorType),errorMessage:e.playerSetupError.errorMessage}:void 0}},t.prototype.convertHydraPlayerSetupError=function(e){switch(e){case"InvalidStream":return"InvalidStream";case"MultiplePlayerLoad":return"MultiplePlayerLoad";case"PlayerInitializationFailed":return"PlayerInitializationFailed";case"SetSourceFailed":return"SetSourceFailed";default:return}},t.prototype.getRenderer=function(){return!this.renderer&&this.hydraPlayer&&(this.renderer=new d.LiveStreamRenderer(this,this.logger.createChild("LiveStreamRenderer"))),this.renderer},t.prototype.onStatsUpdated=function(e){this.playerStats=e},t.prototype.getStats=function(){return this.playerStats},t.prototype.onLog=function(e,t){this.logger[e](t)},t.prototype.onPlaybackStateChanged=function(e){try{this.playbackState=this.convertHydraPlaybackState(e),this.event("playbackStateChanged").raise()}catch(e){this.logger.warn("Not handling playback state changed event: ".concat((0,p.stringifyObject)(e)))}},t.prototype.convertHydraPlaybackState=function(e){switch(e){case"loadstart":return"LoadStart";case"loadeddata":return"LoadedData";case"loadedmetadata":return"LoadedMetadata";case"start":return"Start";case"canplaythrough":return"Ready";case"play":return"Play";case"playing":return"Playing";case"pause":return"Paused";case"waiting":return"Buffering";case"seeking":return"Seeking";case"seeked":return"Seeked";case"ended":return"Ended";case"error":return"Error";case"destroyed":return"Destroyed";case"initialized":return"Initialized";case"stalled":return"Stalled";default:throw new Error("Unable to convert HydraPlayerPlaybackState ".concat(e," to PlaybackState"))}},t.prototype.onPlaybackError=function(e,t){try{var n=this.convertHydraPlaybackErrorType(e);this.event("playbackError").raise(n,t)}catch(e){this.logger.warn("Not handling playback error event: ".concat((0,p.stringifyObject)(e)))}},t.prototype.convertHydraPlaybackErrorType=function(e){switch(e){case"UnsupportedPlatform":return"UnsupportedPlatform";case"NetworkError":return"NetworkError";case"PlaybackRetried":return"PlaybackRetried";case"PlaybackError":return"PlaybackError";case"Unknown":return"Unknown";default:throw new Error("Unable to convert HydraPlayerPlaybackErrorType ".concat(e," to PlaybackErrorType"))}},t.prototype.seek=function(e){this.hydraPlayer.callPlayerApi("seekHydraPlayer",e)},t.prototype.seekToLiveEdge=function(){this.hydraPlayer.callPlayerApi("seekHydraPlayerToLiveEdge")},t.prototype.play=function(){this.hydraPlayer.callPlayerApi("playHydraPlayer")},t.prototype.pause=function(){this.hydraPlayer.callPlayerApi("pauseHydraPlayer")},t.prototype.setVolume=function(e){this.hydraPlayer.callPlayerApi("setHydraPlayerVolume",e)},t.prototype.selectVideoTrack=function(e){this.hydraPlayer.callPlayerApi("selectHydraPlayerVideoTrack",e)},t.prototype.getStreamSize=function(){return this.playerStats?{width:this.playerStats.mediaWidth,height:this.playerStats.mediaHeight}:{width:0,height:0}},t.prototype.isRendering=function(){var e=this.getStreamSize();return e.width>0&&e.height>0},t.prototype.disposePlayer=function(){var e;null===(e=this.hydraPlayer)||void 0===e||e.dispose()},t.prototype.releasePlayer=function(){this.hydraPlayer&&(this.hydraPlayer.release(),this.hydraPlayer=null)},t.prototype.stop=function(){this.clearPlayerEventSubscribers(),this.destroyPlayer()},t.prototype.destroyPlayer=function(){this.renderer&&(this.renderer.dispose(),this.renderer=null),this.statsSub&&(clearTimeout(this.statsSub),this.statsSub=null),this.diagSub&&(clearInterval(this.diagSub),this.diagSub=null),this.disposePlayer(),this.sendFinalTelemetry(),this.releasePlayer()},t.prototype.getPlaybackState=function(){return this.playbackState},t.prototype.getCaptionsTimestamp=function(){return this.captionsTimestamp},t.prototype.sendFinalTelemetry=function(){this.isFinalTelemetrySent||(this.isFinalTelemetrySent=!0,this.sendTelemetry(!0))},t.prototype.sendTelemetry=function(e){if(this.configProvider.config.sendTelemetry&&this.telemetryLogger){var t=this.getTelemetryReport(),n=o(o({},t),{isFinal:e,threadId:this.threadId,tsCallingVersion:(0,l.getTsCallingVersion)(),correlationId:this.streamOptions.correlationId});this.logger.debug("generated live stream report: ",n),this.telemetryLogger.sendEvent({eventName:"live_events",props:n})}else this.logger.info("telemetry not sent")},t.prototype.sendSnapshotTelemetry=function(){if(this.telemetryLogger){var e=this.getSnapshotTelemetryReport(),t=o(o({},e),{isFinal:!1,threadId:this.threadId,tsCallingVersion:(0,l.getTsCallingVersion)(),correlationId:this.streamOptions.correlationId});this.logger.debug("sending snapshot telemetry: ",t),this.telemetryLogger.sendEvent({eventName:"live_events",props:t})}else this.logger.error("snapshot telemetry not sent, telemetryLogger is not set")},t.prototype.clearPlayerEventSubscribers=function(){for(var e=0,t=this.playerSubs;e<t.length;e++){t[e].dispose()}this.playerSubs=[]},t.prototype.onPlaybackSeeked=function(e){this.captionsTimestamp=e},t.prototype.onUrlSwitched=function(e){this.event("urlSwitched").raise(e)},t.prototype.onSdnPluginLoadSkipped=function(e){this.event("sdnPluginLoadSkipped").raise(e)},t.prototype.onSdnPluginLoadFailed=function(e){this.event("sdnPluginLoadFailed").raise(e)},t.prototype.onPlaybackStarted=function(){this.event("playbackStarted").raise()},t.prototype.onPlaybackTimeUpdated=function(e){this.event("playbackTimeUpdated").raise(e)},t.prototype.onVideoTracksUpdated=function(e){this.event("videoTracksChanged").raise(e)},t}(c.default);t.HydraLiveStreamPlayer=h;var g=function(e){function t(){return e.call(this)||this}return i(t,e),t.prototype.playbackStateChanged=function(e){this.event("playbackStateChanged").raise(e)},t.prototype.playbackSeeked=function(e){this.event("playbackSeeked").raise(e)},t.prototype.log=function(e,t){this.event("log").raise(e,t)},t.prototype.playbackError=function(e,t){this.event("playbackError").raise(e,t)},t.prototype.urlSwitched=function(e){this.event("urlSwitched").raise(e)},t.prototype.sdnPluginLoadSkipped=function(e){this.event("sdnPluginLoadSkipped").raise(e)},t.prototype.sdnPluginLoadFailed=function(e){this.event("sdnPluginLoadFailed").raise(e)},t.prototype.statsUpdated=function(e){this.event("statsUpdated").raise(e)},t.prototype.playbackStarted=function(){this.event("playbackStarted").raise()},t.prototype.playbackTimeUpdated=function(e){this.event("playbackTimeUpdated").raise(e)},t.prototype.videoTracksUpdated=function(e){this.event("videoTracksUpdated").raise(e)},t}(c.default);t.PlayerEventHandler=g},1183:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.UmsHydraLiveStreamPlayer=void 0;var s=n(1566),c=n(3907),l=n(6904),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"tracks",{get:function(){return this.trackInfo},enumerable:!1,configurable:!0}),t.prototype.createEventHandler=function(){return new p},t.prototype.createHydraPlayerSettings=function(){var e,t,n,r,i,o,a,s,c,l,u,d,p;return{playerType:2,hydraRuntimeFetchTimeout:null===(e=this.configProvider.playerConfig)||void 0===e?void 0:e.hydraRuntimeFetchTimeout,allowSdnPlugins:this.configProvider.config.allowSdnPlugins,debugLogging:null!==(t=this.configProvider.config.debug)&&void 0!==t&&t,muteVideo:null!==(r=null===(n=this.configProvider.playerConfig)||void 0===n?void 0:n.muteVideo)&&void 0!==r&&r,videoLang:null===(i=this.configProvider.playerConfig)||void 0===i?void 0:i.lang,videoElementStyles:null===(o=this.configProvider.playerConfig)||void 0===o?void 0:o.styles,maxPlayerDiagnosticsCount:this.configProvider.config.maxPlayerDiagnosticsCount,maxPlayerMemoryTraceLogCount:this.configProvider.config.maxPlayerMemoryTraceLogCount,maxPlayerPlaybackEventCount:this.configProvider.config.maxPlayerPlaybackEventCount,maxPlayerExperimentalEvents:this.configProvider.config.umsSettings.maxPlayerExperimentalEvents,maxRetryCount:this.configProvider.config.maxRetryCount,playerTelemetryTickMs:this.configProvider.config.playerTelemetryTickMs,maxRetryCountForLoadingResources:this.configProvider.config.maxRetryCountForLoadingResources,maxVideoTrackHistoryLogCount:this.configProvider.config.maxVideoTrackHistoryLogCount,maxStreamConnectionResultsLogCount:this.configProvider.config.umsSettings.maxStreamConnectionResultsLogCount,configIds:this.configProvider.configIds,timeoutForSwitchingUrl:this.configProvider.config.umsSettings.timeoutForSwitchingUrl,latencyCompensationThreshold:this.configProvider.config.umsSettings.latencyCompensationThreshold,maxEdgeLatencyHistoryLength:this.configProvider.config.umsSettings.maxEdgeLatencyHistoryLength,switchingPolicy:null===(s=null===(a=this.configProvider.config.hydraPlayerUmsSettings)||void 0===a?void 0:a.ecsSettings)||void 0===s?void 0:s.switchingPolicy,enableUuidTrace:this.configProvider.config.umsSettings.enableUuidTrace,thaScript:this.configProvider.config.umsSettings.thaScript,stopCrash:this.configProvider.config.stopCrash,stopTerminating:this.configProvider.config.umsSettings.stopTerminating,stallDetectionPolicy:null===(l=null===(c=this.configProvider.config.hydraPlayerUmsSettings)||void 0===c?void 0:c.ecsSettings)||void 0===l?void 0:l.stallDetectionPolicy,playerRuntimeJsUrls:null!==(d=null===(u=this.configProvider.config.hydraPlayerUmsSettings)||void 0===u?void 0:u.runtimeUrls)&&void 0!==d?d:this.configProvider.playerConfig.hydraPlayerWebSdkUrls,disableSandbox:this.configProvider.config.umsSettings.disableSandbox,ecsSettings:null===(p=this.configProvider.config.hydraPlayerUmsSettings)||void 0===p?void 0:p.ecsSettings}},t.prototype.createHydraStreamOptions=function(){var e,t,n,r,i="TLE";i=this.streamOptions.streamingEventType?this.convertStreamingEventType(this.streamOptions.streamingEventType):this.streamOptions.overflow?"Overflow":"TLE";var o={stream:{playbackCoordinates:(0,l.GetUmsStreamPlaybackCoordinatesFromStream)(this.streamOptions.stream),urls:[this.streamOptions.stream.url],decryptionKey:this.streamOptions.stream.decryptionKey,sdnContext:this.streamOptions.stream.sdnContext,streamDeliveryPipeline:this.streamOptions.stream.streamDeliveryPipeline?this.convertStreamDeliveryPipeline(this.streamOptions.stream.streamDeliveryPipeline):void 0},altStream:this.streamOptions.altStream?{playbackCoordinates:(0,l.GetUmsStreamPlaybackCoordinatesFromStream)(this.streamOptions.altStream),urls:[this.streamOptions.altStream.url],decryptionKey:this.streamOptions.altStream.decryptionKey,sdnContext:this.streamOptions.altStream.sdnContext,streamDeliveryPipeline:this.streamOptions.altStream.streamDeliveryPipeline?this.convertStreamDeliveryPipeline(this.streamOptions.altStream.streamDeliveryPipeline):void 0}:void 0,streamingEventType:i,allowPlayerControls:this.streamOptions.allowPlayerControls,sdn:this.streamOptions.sdn?{name:this.streamOptions.sdn.name,url:this.streamOptions.sdn.url,plugin:this.streamOptions.sdn.plugin}:void 0,thaContext:this.streamOptions.thaContext?{eventId:this.streamOptions.thaContext.eventId,organizer:{userId:null===(e=this.streamOptions.thaContext.organizer)||void 0===e?void 0:e.userId,tenantId:null===(t=this.streamOptions.thaContext.organizer)||void 0===t?void 0:t.tenantId},attendee:{userId:null===(n=this.streamOptions.thaContext.attendee)||void 0===n?void 0:n.userId,tenantId:null===(r=this.streamOptions.thaContext.attendee)||void 0===r?void 0:r.tenantId},coOrganizers:this.streamOptions.thaContext.coOrganizers}:void 0};return this.streamOptions.eventId&&(o.eventId=this.streamOptions.eventId),this.streamOptions.templateId&&(o.templateId=this.streamOptions.templateId),this.streamOptions.meetingMetadata&&(o.meetingMetadata=this.streamOptions.meetingMetadata),o},t.prototype.addPlayerEventSubscribers=function(){var t=this;e.prototype.addPlayerEventSubscribers.call(this),this.playerSubs.push(this.eventHandler.on("trackListUpdated",(function(e){t.onTrackListUpdated(e)}))),this.playerSubs.push(this.eventHandler.on("trackSelected",(function(e){t.onTrackSelected(e)})))},t.prototype.onTrackListUpdated=function(e){this.trackInfo=e;var t=(0,c.stringifyObject)(e);this.logger.info("[onTrackListUpdated]: Track list updated to: ".concat(t))},t.prototype.onTrackSelected=function(e){var t=(0,c.stringifyObject)(e);this.logger.info("[onTrackSelected]: Track selected: ".concat(t))},t.prototype.getCaptionsControl=function(){return!this.captionsControl&&this.hydraPlayer&&(this.captionsControl=new d(this.hydraPlayer,this.logger.createChild("CaptionsControl"))),this.captionsControl},t.prototype.releasePlayer=function(){e.prototype.releasePlayer.call(this),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null)},t}(s.HydraLiveStreamPlayer);t.UmsHydraLiveStreamPlayer=u;var d=function(){function e(e,t){this.hydraPlayer=e,this.logger=t}return e.prototype.addCues=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.logger.warn("[addCues]: not implemented for UMS player"),[2]}))}))},e.prototype.clearCues=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.logger.warn("[clearCues]: not implemented for UMS player"),[2]}))}))},e.prototype.showCaptions=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.hydraPlayer.callPlayerApi("showHydraPlayerCaptions",e)];case 1:return t.sent(),[2]}}))}))},e.prototype.getSelectedCulture=function(){return this.logger.warn("[getSelectedCulture]: not implemented for UMS player"),""},e.prototype.getAvailableCultures=function(){return this.logger.warn("[getAvailableCultures]: not implemented for UMS player"),[]},e.prototype.dispose=function(){this.hydraPlayer=null},e.prototype.selectTextTrack=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.hydraPlayer.callPlayerApi("selectHydraPlayerTextTrack",e)];case 1:return t.sent(),[2]}}))}))},e}(),p=function(e){function t(){return e.call(this)||this}return i(t,e),t.prototype.trackListUpdated=function(e){this.event("trackListUpdated").raise(e)},t.prototype.trackSelected=function(e){this.event("trackSelected").raise(e)},t}(s.PlayerEventHandler)},5025:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2559),o=function(){function e(e){var t=this;this._callingLogger=e,this._maybeLog=function(e){for(var n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];try{(n=t._callingLogger)[e].apply(n,r)}catch(e){t._callingLogger.info("[failed to log]",(0,i.getPrintableObject)(e))}}}return e.prototype.getPrefix=function(e,t){var n="";return t&&(n+="[".concat(t,"]")),e&&(n+="[".concat(e,"]")),n},e.prototype.createChild=function(t,n){return new e(this._callingLogger.createChild(t,n))},e.prototype.createFnLogger=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e(this._callingLogger.createChild(this.getPrefix(t,n)+r.join(""),!1))},e.prototype.logSuccess=function(e){this._maybeLog("info","success=".concat(e,"}"))},e.prototype.logFailure=function(e){var t=(0,i.getPrintableObject)(e);this._maybeLog("info","failed=".concat(t,"}"))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["log"],e,!1))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["debug"],e,!1))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["info"],e,!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["warn"],e,!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["error"],e,!1))},e}();t.default=o},9199:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AmpLiveStreamPlayer=void 0;var s=n(6773),c=n(6144),l=n(3907),u=n(1374),d=n(3645),p=n(6539),h=n(2010),g=n(4545),f=[2097152,2097552,2097556,2097557,2097564,2097652,2097654,2097655,2097656,2097752,3145728,4194305,4194306,4194307,4194308,4194309,5242880,5242881,5242882,5242884,5242885,5242886],m=2097753,_=function(e){function t(t,n,r){var i=e.call(this)||this;return i.logger=t,i.liveStreamStatistic=n,i.configProvider=r,i.playerState="Destroyed",i.retryCount=0,i.captionsTimestamp=0,i.isSwitchStreamingUrlOngoing=!1,i.streamingUrlSwitchCount=0,i.isPlaybackUnsupported=!1,i.noMediaTimeoutId=-1,i.lastPlaybackError=void 0,i.id=(0,g.default)(),i.logger.info("AmpLiveStreamPlayer created: ID: ".concat(i.id)),i}return i(t,e),Object.defineProperty(t.prototype,"playerId",{get:function(){return this.id},enumerable:!1,configurable:!0}),t.prototype.configure=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(i){switch(i.label){case 0:if(!p.isStreamValid(e.stream)&&!p.isStreamValid(e.altStream))return this.logger.error("Invalid Live Stream configuration provided: no valid primary or alternative stream"),[2];if(this.logger.info("Live Stream configuration provided"),this.liveStreamOptions=e,t=p.isStreamValid(e.stream)?e.stream:e.altStream,!this.playerInstance||this.isPlaybackUnsupported)return this.selectedStreamDetails=t,[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.playerInstance.message("configure").send(e)];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),r=(0,l.stringifyObject)(n),this.logger.error("configure failed: ".concat(r)),[3,4];case 4:return[4,this.handleStreamInfoUpdate(t)];case 5:return i.sent(),[2]}}))}))},t.prototype.loadPlayer=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,o,s,c=this;return a(this,(function(a){switch(a.label){case 0:return this.playerInstance?(this.logger.error("playerLoadFailed: cannot load a player while current one is still active"),[2,{setupSucceeded:!1,playerSetupError:{errorType:"MultiplePlayerLoad",errorMessage:"cannot load a player while current one is still active"}}]):this.liveStreamOptions&&this.selectedStreamDetails&&p.isStreamValid(this.selectedStreamDetails)?(this.playerInstance=new u.PlayerWrapper(this.logger.createChild("AmpPlayerWrapper")),this.playerInstance.on("stateChanged",(function(e,t){return c.ampStateChanged(e,t)})),this.playerInstance.on("captionsToggled",(function(e,t,n){return c.captionsToggled(e,t,n)})),this.playerInstance.on("statsUpdated",(function(e){return c.liveStreamStatistic.registerStatsUpdated(e)})),-1!==(t=this.configProvider.config.ampSettings.noMediaTimeoutMs)&&-1===this.noMediaTimeoutId&&(this.noMediaTimeoutId=self.setTimeout((function(){return c.callDropDueToMediaTimeout()}),t)),[4,this.playerInstance.initialize(e,this.liveStreamOptions,this.configProvider,this.id)]):(this.logger.error("playerLoadFailed: empty/invalid primary and alternate stream info configured"),[2,{setupSucceeded:!1,playerSetupError:{errorType:"InvalidStream",errorMessage:"empty/invalid primary and alternate stream info configured"}}]);case 1:a.sent(),this.liveStreamStatistic.registerPlayerLoadAttempt(),this.loadSucceeded=!1,this.liveStreamStatistic.registerEventLoadAttempt("LoadScript"),this.srcLoadPromise||(this.srcLoadPromise=this.playerInstance.message("loadPlayerScript").send()),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,this.srcLoadPromise];case 3:return n=a.sent(),[3,5];case 4:return r=a.sent(),s=(0,l.stringifyObject)(r),this.logger.error("playerLoadFailed: player scripts load failed: ".concat(s)),this.liveStreamStatistic.registerEventLoadFailed("LoadScript","Load Script failed: ".concat(r)),this.liveStreamStatistic.registerPlayerLoadFailed("script load failed: ".concat(n)),this.srcLoadPromise=null,[2,{setupSucceeded:!1,playerSetupError:{errorType:"PlayerScriptLoadFailed",errorMessage:s}}];case 5:return this.liveStreamStatistic.registerEventLoadSucceeded("LoadScript"),[4,this.tryLoadSdnPlugin()];case 6:a.sent(),this.liveStreamStatistic.registerEventLoadAttempt("CreateAmp"),a.label=7;case 7:return a.trys.push([7,9,,10]),[4,this.playerInstance.message("createAmp").send()];case 8:return a.sent(),[3,10];case 9:return i=a.sent(),s=(0,l.stringifyObject)(i),this.logger.error("playerLoadFailed: createAmp failed: ".concat(s)),this.liveStreamStatistic.registerEventLoadFailed("CreateAmp","createAmp failed: ".concat(i)),this.liveStreamStatistic.registerPlayerLoadFailed("create amp failed ".concat(s,", script load: ").concat(n)),[2,{setupSucceeded:!1,playerSetupError:{errorType:"PlayerInitializationFailed",errorMessage:s}}];case 10:this.liveStreamStatistic.registerEventLoadSucceeded("CreateAmp"),a.label=11;case 11:return a.trys.push([11,13,,14]),[4,this.setPlayerSource(this.selectedStreamDetails)];case 12:return a.sent(),this.loadSucceeded=!0,this.logger.info("loadPlayer succeeded: ".concat(this.loadSucceeded)),this.liveStreamStatistic.registerPlayerLoadSucceeded(n),this.playerState="Initialized",[2,{setupSucceeded:this.loadSucceeded}];case 13:return o=a.sent(),s=(0,l.stringifyObject)(o),this.loadSucceeded=!1,this.logger.error("loadPlayer succeeded: ".concat(this.loadSucceeded,": setSource failed: ").concat(s)),this.liveStreamStatistic.registerPlayerLoadFailed("setPlayerSource failed; script load: ".concat(n)),[2,{setupSucceeded:this.loadSucceeded,playerSetupError:{errorType:"SetSourceFailed",errorMessage:s}}];case 14:return[2]}}))}))},t.prototype.getRenderer=function(){return!this.renderer&&this.playerInstance&&(this.renderer=new d.LiveStreamRenderer(this,this.logger.createChild("LiveStreamRenderer"))),this.renderer},t.prototype.seek=function(e){throw new Error("Method not implemented - cannot perform video seek operation with args: [timestamp: ".concat(e,"]"))},t.prototype.seekToLiveEdge=function(){throw new Error("Method not implemented - cannot perform video seek to live edge operation")},t.prototype.play=function(){throw new Error("Method not implemented - cannot perform video play operation")},t.prototype.pause=function(){throw new Error("Method not implemented - cannot perform video pause operation")},t.prototype.setVolume=function(e){throw new Error("Method not implemented - cannot set video volume with args: [volume: ".concat(e,"]"))},t.prototype.selectVideoTrack=function(e){throw new Error("Method not implemented - cannot select video track with args: [track: ".concat(e,"]"))},t.prototype.stop=function(){this.destroy("PlayerStopped")},t.prototype.getPlaybackState=function(){return this.playerState},t.prototype.getCaptionsTimestamp=function(){return this.captionsTimestamp},t.prototype.getCaptionsControl=function(){if(!this.captionsControl&&this.playerInstance){var e=this.liveStreamOptions.supportedSubtitleLanguages?this.liveStreamOptions.supportedSubtitleLanguages.map((function(e){return e.culture})):[];this.captionsControl=new h.CaptionsControl(this.playerInstance,e)}return this.captionsControl},t.prototype.getStreamSize=function(){var e=this.liveStreamStatistic.getPlayerDiagnosticSnapshot();return e?{width:e.mediaWidth,height:e.mediaHeight}:{width:0,height:0}},t.prototype.isRendering=function(){var e=this.getStreamSize();return e.width>0&&e.height>0},t.prototype.ampStateChanged=function(e,t){switch(e){case"error":return this.handlePlaybackError(t);case"canplaythrough":return this.onCanplaythrough();case"play":return this.onPlay();case"playing":return this.onPlaying();case"pause":return this.onPause();case"resume":return this.onResume();case"start":return this.onStart();case"ended":return this.onEnded();case"seeking":return this.onSeeking();case"seeked":return this.onSeeked(t);case"loadedmetadata":return this.onMetadataLoaded();case"waiting":return this.onWaiting();case"playbackbitratechanged":return this.onPlaybackBitrateChanged(t);case"downloadbitratechanged":return this.onDownloadBitrateChanged(t);case"fullscreenchange":return this.onFullscreenChange(t);case"potentialMediaFreeze":return this.onPotentialMediaFreeze();case"mute":return this.onMute();case"unmute":return this.onUnmute();case"volumechange":return this.onVolumeChange(t);case"loadstart":return this.onLoadStart();case"loadeddata":return this.onLoadedData();case"UserInitiatedSeek":return this.onUserInitiatedSeek(t);default:this.logger.warn("Unknown amp event ".concat(e))}},t.prototype.onUserInitiatedSeek=function(e){this.liveStreamStatistic.registerUserInitiatedSeek(e)},t.prototype.captionsToggled=function(e,t,n){this.event("captionsToggled").raise(e,t,n),this.liveStreamStatistic.registerCaptionToggle(e,t,n)},t.prototype.tryLoadSdnPlugin=function(){return o(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:if(this.sdnPluginLoadPromise)return this.raiseSdnPluginSkippedEvent("SDN plugin already loaded"),[2];if(!this.liveStreamOptions.sdn)return this.raiseSdnPluginSkippedEvent("No SDNs configured in liveStreamOptions"),[2];if(!this.configProvider.config.allowSdnPlugins)return this.raiseSdnPluginSkippedEvent("Client configured to not allow SDN plugins"),[2];switch(this.liveStreamOptions.sdn.name){case"hive":case"kollective":case"ramp":case"peer5":break;default:return this.logger.warn("unsupported SDN provider: ".concat(this.liveStreamOptions.sdn.name)),this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!1,"Unsupported SDN provider: ".concat(this.liveStreamOptions.sdn.name)),[2]}this.liveStreamStatistic.registerEventLoadAttempt("SdnPluginLoad"),n.label=1;case 1:return n.trys.push([1,3,,4]),this.sdnPluginLoadPromise=this.playerInstance.message("tryLoadSdnPlugin").send(),[4,this.sdnPluginLoadPromise];case 2:return n.sent(),this.liveStreamStatistic.registerEventLoadSucceeded("SdnPluginLoad",this.liveStreamOptions.sdn.name),[3,4];case 3:return t=n.sent(),e=(0,l.stringifyObject)(t),this.sdnPluginLoadPromise=void 0,this.logger.error("loadSdnPlugin failed: ".concat(e)),this.liveStreamStatistic.registerEventLoadFailed("SdnPluginLoad",e),this.event("sdnPluginLoadFailed").raise(e),[3,4];case 4:return[2]}}))}))},t.prototype.raiseSdnPluginSkippedEvent=function(e){this.logger.warn("skipping SDN plugin load: ".concat(e)),this.event("sdnPluginLoadSkipped").raise(e)},t.prototype.setPlayerSource=function(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:if(!e)throw this.logger.error("setPlayerSource: streamDetails is undefined"),new Error("setPlayerSource: streamDetails is undefined");if(!this.playerInstance)throw this.logger.error("setPlayerSource: playerInstance is null"),new Error("playerInstance is null");this.logger.info("setPlayerSource: AMP source set to: [".concat(e.url,"]")),this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,r.label=1;case 1:return r.trys.push([1,3,,4]),this.logger.info("setPlayerSource: src changed"),this.selectedStreamDetails=e,this.liveStreamStatistic.registerSetSourceAttempt(e.url),[4,this.playerInstance.message("setSource").send(e)];case 2:return r.sent(),this.liveStreamStatistic.registerSetSourceSucceeded(),[3,4];case 3:throw t=r.sent(),n=(0,l.stringifyObject)(t),this.logger.error("setPlayerSource: failed with error [".concat(n,"]")),this.liveStreamStatistic.registerSetSourcedFailed(n),t;case 4:return[2]}}))}))},t.prototype.handleStreamInfoUpdate=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.loadSucceeded&&e.url!==this.selectedStreamDetails.url?[4,this.setPlayerSource(e)]:[3,2];case 1:return t.sent(),[3,3];case 2:this.loadSucceeded&&this.playerInstance&&this.getCurrentTime()>0&&this.setPlaybackState("Start"),t.label=3;case 3:return[2]}}))}))},t.prototype.switchStreamingUrl=function(e,t){var n;return o(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){return this.streamingUrlSwitchCount>=this.configProvider.config.ampSettings.streamingUrlSwitchMaxCount||!(0,s.includes)(this.configProvider.config.ampSettings.errorCodesEligibleForStreamingUrlSwitch,e)&&!t?[2,!1]:(r=this.selectedStreamDetails.url===(null===(n=this.liveStreamOptions.stream)||void 0===n?void 0:n.url),i=r?this.liveStreamOptions.altStream:this.liveStreamOptions.stream,p.isStreamValid(i)?(this.isSwitchStreamingUrlOngoing=!0,this.streamingUrlSwitchCount++,[2,this.setPlayerSource(i).then((function(){return!0})).catch((function(){return!1}))]):(this.logger.error("Stream to switch (".concat(r?"alternative":"primary",") is not valid")),[2,!1]))}))}))},t.prototype.destroy=function(e){this.srcLoadPromise=null,this.sdnPluginLoadPromise=null,this.renderer&&(this.renderer.dispose(),this.renderer=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.liveStreamStatistic.registerPlayerDestroyed(e),this.playerInstance.dispose(),this.playerInstance=null,this.setPlaybackState("Destroyed"))},t.prototype.getCurrentTime=function(){var e=this.liveStreamStatistic.getPlayerDiagnosticSnapshot();return e&&e.currentPlayPosition||0},t.prototype.onCanplaythrough=function(){this.setPlaybackState("Ready")},t.prototype.onPlay=function(){(this.retryCount>0||this.lastKnownPlayTime)&&(this.logger.info("Playing after retry count ".concat(this.retryCount,", Setting current time to ").concat(this.lastKnownPlayTime)),this.playerInstance.message("setPlayTime").send(this.lastKnownPlayTime),this.retryCount=0,this.lastKnownPlayTime=void 0),this.setPlaybackState("Play")},t.prototype.onPlaying=function(){this.setPlaybackState("Playing")},t.prototype.onPause=function(){this.setPlaybackState("Paused")},t.prototype.onResume=function(){this.setPlaybackState("Resume")},t.prototype.onStart=function(){this.logger.info("Playback started, retry count: ".concat(this.retryCount)),this.setPlaybackState("Start"),this.event("playbackStarted").raise(),self.clearTimeout(this.noMediaTimeoutId),this.isSwitchStreamingUrlOngoing&&(this.logger.info("Playback started, switch count: ".concat(this.streamingUrlSwitchCount)),this.event("urlSwitched").raise(this.selectedStreamDetails===this.liveStreamOptions.altStream),this.isSwitchStreamingUrlOngoing=!1)},t.prototype.onEnded=function(){this.setPlaybackState("Ended")},t.prototype.onSeeking=function(){this.setPlaybackState("Seeking")},t.prototype.onSeeked=function(e){this.captionsTimestamp=e.captionsTimestamp,this.setPlaybackState("Seeked")},t.prototype.onMetadataLoaded=function(){this.setPlaybackState("LoadedMetadata")},t.prototype.onWaiting=function(){this.setPlaybackState("Buffering")},t.prototype.onLoadedData=function(){this.setPlaybackState("LoadedData")},t.prototype.onLoadStart=function(){this.setPlaybackState("LoadStart")},t.prototype.setPlaybackState=function(e){this.playerState=e,this.logger.debug("playback state changed: ".concat(e)),this.liveStreamStatistic.registerPlaybackStateChanged(e),this.event("playbackStateChanged").raise()},t.prototype.onPlaybackBitrateChanged=function(e){this.liveStreamStatistic.registerPlaybackBitratechanged(e.bitrate)},t.prototype.onDownloadBitrateChanged=function(e){this.liveStreamStatistic.registerDownloadBitratechanged(e.bitrate)},t.prototype.onFullscreenChange=function(e){this.logger.debug("fullscreenchange, isFullscreen=".concat(e.isFullscreen)),this.event("fullscreenToggled").raise(e.isFullscreen),this.liveStreamStatistic.registerFullScreenChange(e.isFullscreen)},t.prototype.onPotentialMediaFreeze=function(){this.logger.warn("Player detected a potential media freeze"),this.liveStreamStatistic.registerPotentialMediaFreeze()},t.prototype.onMute=function(){this.liveStreamStatistic.registerMute(!0)},t.prototype.onUnmute=function(){this.liveStreamStatistic.registerMute(!1)},t.prototype.onVolumeChange=function(e){this.liveStreamStatistic.registerVolumeChange(e.value)},t.prototype.stringifyPlayerError=function(e){return JSON.stringify(e,(function(e,t){return"errorCode"===e?t.toString(16):t}))},t.prototype.handlePlaybackError=function(e){var t;return o(this,void 0,void 0,(function(){var n,r,i,c,l=this;return a(this,(function(u){switch(u.label){case 0:return n=4194307,this.playerState="Error",this.lastPlaybackError=e,r=this.stringifyPlayerError(e),this.logger.info("Playback error ".concat(r)),e.errorCode||null!=e.fatal?(e.errorCode&n)===n?(this.isPlaybackUnsupported=!0,this.raisePlaybackError("UnsupportedPlatform",r),this.destroy("PlaybackError"),[2]):(this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,i=e.errorCode,c=268435455&i,this.logger.error("onError: errorCode: 0x".concat(i.toString(16),", errorCodeExcludingTech: 0x").concat(c.toString(16),", message: ").concat(e.message)),this.retryCount<this.configProvider.config.maxRetryCount&&(!1===e.fatal||-1!==(0,s.indexOf)(f,c))?(setTimeout((function(){return o(l,void 0,void 0,(function(){return a(this,(function(e){return this.logger.info("Retry loading stream because of error code: 0x".concat(i.toString(16))),this.retryCount++,this.raisePlaybackError("PlaybackRetried",r),this.setPlayerSource(this.selectedStreamDetails),[2]}))}))}),this.configProvider.config.ampSettings.sourceResetTimeoutInMs),[3,3]):[3,1]):(this.logger.error("onError: error details are not available"),[2]);case 1:return[4,this.switchStreamingUrl(c,e.fatal)];case 2:u.sent()?this.configProvider.config.ampSettings.resetStreamingUrlSwitchCount&&(this.streamingUrlSwitchCount=0):(c===m||(null===(t=e.message)||void 0===t?void 0:t.includes(m.toString(16)))?this.raisePlaybackError("NetworkError",r):this.raisePlaybackError("PlaybackError",r),this.destroy("PlaybackError")),u.label=3;case 3:return[2]}}))}))},t.prototype.raisePlaybackError=function(e,t){this.liveStreamStatistic.registerPlaybackError(e,t),this.event("playbackError").raise(e,t)},t.prototype.callDropDueToMediaTimeout=function(){var e={currentTime:-1,errorCode:0,message:JSON.stringify({state:this.playerState,error:this.stringifyPlayerError(this.lastPlaybackError)}),fatal:!0},t=this.stringifyPlayerError(e);this.raisePlaybackError("MediaTimeout",t),this.destroy("MediaTimeout")},t}(c.default);t.AmpLiveStreamPlayer=_},5049:function(e,t){"use strict";function n(){var e,n=s(),r=c();return function(e){e.CaptionFunctionalityNotSupported="CaptionFunctionalityNotSupported"}(e||(e={})),function(){function i(e,t){this.container=e,this.eventsHandler=t,this.videoElementEvents=[],this.playerEvents=[],this.maxMemoryTraceLogCount=1e4,this.videoSourceType="application/dash+xml",this.sdnPluginLoaded=!1,this.statsTimer=-1,this.statsInterval=1e3,this.videoSourceSetAttemptCount=0,this.totalBufferingTime=0,this.isBuffering=!1,this.totalPlayingTime=0,this.isPlaying=!1,this.videoTrackTotalDurations=[]}return Object.defineProperty(i.prototype,"contextWindow",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),i.prototype.configure=function(e,t,n){this.liveStreamOptions=e,this.playerId=n,t&&(this.configProvider=t,this.statsInterval=t.config.playerTelemetryTickMs||this.statsInterval,this.maxMemoryTraceLogCount=t.config.maxPlayerMemoryTraceLogCount||this.maxMemoryTraceLogCount)},i.prototype.getIceCandidates=function(){var e,t=[];try{var n=this.liveStreamOptions.stream.sdnContext||(null===(e=this.liveStreamOptions.altStream)||void 0===e?void 0:e.sdnContext)||"",r=JSON.parse(n),i=JSON.parse(r.sdnConfig);if(!i.RTCIceCandidates)throw new Error("RTCIceCandidates not present in SDN Context");t=i.RTCIceCandidates}catch(e){this.log("getIceCandidates failed: ".concat(JSON.stringify(e.message)),"error")}return this.log("getIceCandidates: ".concat(JSON.stringify(t)),"debug"),t},i.prototype.loadPlayerScript=function(){for(var e=this,t=Promise.resolve(""),n=this.configProvider.playerConfig.nonce,r=this.configProvider.playerConfig.css,i=function(i){t=t.then((function(){return e.retry((function(){return e.loadCss(e.container.ownerDocument,r[i],n)}))}))},o=0;o<r.length;o++)i(o);return t=t.then((function(){return e.loadAmpScript()}))},i.prototype.loadAmpScript=function(){var e,t,n=this;this.log("loadPlayerScript started");var r=Promise.resolve(""),i=null===(e=this.configProvider.playerConfig)||void 0===e?void 0:e.nonce,o=(null===(t=this.configProvider.playerConfig)||void 0===t?void 0:t.src)||[],a=Math.max(2,this.configProvider.config.maxRetryCountForLoadingResources);if(0===o.length)return Promise.reject("AMP Player Src is empty");for(var s=function(e){r=r.then((function(){return n.loadScriptPromise(o,e,i,a)}))},c=0;c<o.length;++c)s(c);return r},i.prototype.loadScriptPromise=function(e,t,n,r,i){var o=this;return void 0===i&&(i=""),this.retry((function(){return o.setScriptByLoad(o.container.ownerDocument,e[t],n)}),r).then((function(n){return"".concat(e[t],": ").concat(n," ").concat(i)})).catch((function(a){return o.retry((function(){return o.setScriptByBlob(o.container.ownerDocument,e[t],n)}),r).then((function(n){return"".concat(e[t],": ").concat(n).concat(" ".concat(a," ")," ".concat(i," "))})).catch((function(s){return o.retry((function(){return o.setScriptByInnerHtml(o.container.ownerDocument,e[t],n)}),1).then((function(n){return"".concat(e[t],": ").concat(n).concat(" ".concat(a," "),"".concat(s," ")," ".concat(i," "))})).catch((function(o){var a=i;return t<e.length&&(a=(a=a.concat("Failed to load script, nonce: ".concat(n,", src: ").concat(e[t]," index: ").concat(t," "))).concat("".concat(r," attempts LoadFailure "),"".concat(r," attempts BlobFetchFailure: "),s,", 1 attempt InnerHtmlFailure: ","".concat(o," "))),Promise.reject(a)}))}))}))},i.prototype.retry=function(e,t,n,r){var i=this;return void 0===t&&(t=this.configProvider.config.maxRetryCountForLoadingResources),void 0===n&&(n=1),void 0===r&&(r=200),e(t).then((function(e){return"".concat(e,", succeeded on load number: ").concat(n," ")})).catch((function(o){return i.log("Error loading resource: ".concat(o," -- ").concat(t," retriesLeft")),0==--t?Promise.reject("".concat(o)):new Promise((function(a){return setTimeout((function(){return a(i.retry(e,t,n+1).then((function(e){return"string"==typeof e?"".concat(e,", succeeded on load number: ").concat(n):e})).catch((function(e){return Promise.reject("".concat(o).concat(", ",e))})))}),r)}))}))},i.prototype.setScriptByLoad=function(e,t,n){var r=e.createElement("script"),i=this.getElementLoadPromise(r,t);return r.src=t,n&&(r.nonce=n),e.head.appendChild(r),i.then((function(){return Promise.resolve("Success: setScriptByLoad")}))},i.prototype.setScriptByBlob=function(e,t,n){var r=this;return this.safeResponse(t).then((function(t){return t.blob().then((function(i){if(i){var o=URL.createObjectURL(i);return r.setScriptByLoad(e,o,n).then((function(){return Promise.resolve("Success: setScriptByBlob")}))}return Promise.reject("".concat(t.status,", blob is null"))}))}))},i.prototype.setScriptByInnerHtml=function(e,t,n){var r=this;return this.safeResponse(t).then((function(t){return t.text().then((function(i){if(i){var o=document.createElement("script");return o.innerHTML=i,n&&!r.configProvider.config.hlsSettings.skipNonce&&(o.nonce=n),e.head.appendChild(o),Promise.resolve("Success: setScriptByInnerHtml")}return Promise.reject("status code:".concat(t.status,", text is null"))}))}))},i.prototype.safeResponse=function(e){return fetch(e).then((function(e){return e.ok?e:Promise.reject("".concat(e.status))}))},i.prototype.tryLoadSdnPlugin=function(){var e=this;return this.sdnPluginLoaded||!this.liveStreamOptions.sdn?Promise.resolve():this.configProvider.config.allowSdnPlugins?(this.log("tryLoadSdnPlugin started"),this.retry((function(){return e.setScriptByLoad(e.container.ownerDocument,e.liveStreamOptions.sdn.url,e.configProvider.playerConfig.nonce)})).then((function(){e.log("SDN script loaded"),e.sdnPluginLoaded=!0,e.log("tryLoadSdnPlugin done")}))):(this.log("Loading SDN plugins is not allowed"),Promise.reject("Loading SDN plugins is not allowed"))},i.prototype.createAmp=function(){var e,i,o;this.log("createAmp started"),this.createVideoElement();var a=this.getAmpOptions();if(this.playerInstance=this.contextWindow.amp(this.video.id,a),!this.playerInstance)throw this.log("createAmp failed","error"),new Error("playerInstance is null");"html5"===(null===(e=this.playerInstance.currentTechName())||void 0===e?void 0:e.toLowerCase())&&this.configProvider.config.ampSettings.estimateAbsoluteTime&&this.isControlsDisabled()?(this.absoluteTimeOffsetEstimator=new t.HlsAbsoluteTimeOffsetEstimator(this.log.bind(this)),this.diagnosticProvider=new n(this.playerInstance,this.contextWindow,new Date,this.configProvider,this.absoluteTimeOffsetEstimator),this.absoluteTimeOffsetEstimator.setEstimationResultCallback(this.onAbsoluteTimeOffsetEstimation.bind(this))):this.diagnosticProvider=new n(this.playerInstance,this.contextWindow,new Date,this.configProvider);var s={controlsEnabled:!this.isControlsDisabled(),logFn:this.log.bind(this),removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack};this.diagnosticProvider.setValue("streamingEventType",this.liveStreamOptions.streamingEventType),this.diagnosticProvider.setValue("eventId",(null===(i=this.liveStreamOptions)||void 0===i?void 0:i.eventId)||""),this.diagnosticProvider.setValue("templateId",(null===(o=this.liveStreamOptions)||void 0===o?void 0:o.templateId)||""),this.diagnosticProvider.setValue("playerControlsEnabled",!this.isControlsDisabled()),this.captionsControl=new r(this.playerInstance,this,s,this.diagnosticProvider),this.registerPlayerEvents(),this.log("createAmp done")},i.prototype.isControlsDisabled=function(){return void 0!==this.liveStreamOptions.allowPlayerControls?!this.liveStreamOptions.allowPlayerControls:"Overflow"===this.liveStreamOptions.streamingEventType||"TownHall_Basic"===this.liveStreamOptions.streamingEventType||"TownHall_Premium"===this.liveStreamOptions.streamingEventType||"TownHall"===this.liveStreamOptions.streamingEventType},i.prototype.onAbsoluteTimeOffsetEstimation=function(t){if(this.diagnosticProvider.appendAbsoluteTimeOffsetEstimation(t),!t.isSuccess){var n=this.addEvent(e.CaptionFunctionalityNotSupported,{detail:{data:{fatal:!0,details:"absolute time offset estimation failed - captions will fail"}}});this.video.dispatchEvent(n)}},i.prototype.addEvent=function(e,t){var n={};return(null==t?void 0:t.detail)&&(n={detail:t.detail}),new CustomEvent(e,n)},i.prototype.setSource=function(e){if(this.log("setSource started"),!this.playerInstance)throw this.log("setSource failed: playerInstance is null","error"),new Error("playerInstance is null");this.videoSourceSetAttemptCount++,this.videoSourceSetAttemptCount>0&&this.diagnosticProvider.setValue("retryCount",this.videoSourceSetAttemptCount-1);var t={src:e.url,type:this.videoSourceType,protectionInfo:e.decryptionToken?[{type:"AES",authenticationToken:e.decryptionToken}]:null};this.configureSdnSource(t,e),this.diagnosticProvider.setValue("streamUrl",e.url),this.diagnosticProvider.setValue("streamId",this.getStreamIdFromStreamUrl(e.url)),this.diagnosticProvider.setValue("streamDeliveryPipeline",e.streamDeliveryPipeline||""),this.playerInstance.src([t],this.getTextTracks()),this.absoluteTimeOffsetEstimator&&this.absoluteTimeOffsetEstimator.setManifestFileURL(e.url+"(format=m3u8-aapl-v4)"),this.log("setSource done")},i.prototype.getStreamIdFromStreamUrl=function(e){try{var t=new URL(e).pathname;if(t){var n=t.split("/");if((null==n?void 0:n.length)>1)return n[1]}return this.log("unable to parse stream ID from stream URL: ".concat(e),"warn"),""}catch(t){return this.log("cannot parse stream ID from invalid stream URL: ".concat(e),"warn"),""}},i.prototype.setPlayTime=function(e){e&&(this.log("setPlayerTime: ".concat(e)),this.playerInstance.currentTime(e))},i.prototype.dispose=function(){this.log("dispose started"),this.diagnosticProvider&&(this.stopStatsCollection(),this.diagnosticProvider.dispose(),this.diagnosticProvider=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.removePlayerEventListeners(),this.playerInstance.getMemoryLog(!0),this.playerInstance.dispose(),this.playerInstance=null),this.eventsHandler.ampDisposed(),this.video&&(this.removeVideoEventListeners(),this.video.parentNode&&this.video.parentNode.removeChild(this.video),this.video=null),this.absoluteTimeOffsetEstimator&&(this.absoluteTimeOffsetEstimator.stopStreamAbsoluteTimeOffsetRetrieval(),this.absoluteTimeOffsetEstimator=null),this.log("dispose done"),this.eventsHandler=null},i.prototype.updatePlaybackDiagnostics=function(){this.updateTotalPlayingTimeStatistic(),this.updateBufferingRateStatistic(),this.updateVideoTrackHistoryStatistic()},i.prototype.handlePlaybackStopped=function(){this.isBuffering=!1,this.isPlaying=!1,this.currentVideoPlaybackBitrate=null},i.prototype.showCaptions=function(e){this.log("showCaptions: ".concat(e)),this.captionsControl.showCaptions(e)},i.prototype.addCues=function(e){e=e.filter((function(e){return e.text&&0!==e.text.trim().length})),this.captionsControl.addCues(e)},i.prototype.clearCues=function(){this.captionsControl.clearCues()},i.prototype.captionsToggled=function(e,t,n){this.log("captionsToggled: ".concat(e," for culture ").concat(t," at ").concat(n)),this.eventsHandler.message("captionsToggled").send(e,t,n)},i.prototype.createVideoElement=function(){this.log("createVideoElement started"),this.video=this.container.ownerDocument.createElement("video"),this.video.id="amp-player",this.video.setAttribute("playsinline","");var e=this.configProvider.playerConfig.lang;e&&(this.video.setAttribute("lang",e),this.log("createVideoElement: language set to ".concat(e)));for(var t=this.configProvider.playerConfig.styles,n=0;n<t.length;n++)this.video.classList.add(t[n]);this.container.appendChild(this.video),this.log("createVideoElement done")},i.prototype.getAmpOptions=function(){var e,t=[];this.configProvider.config.debug?t.push({target:"memory",maxMemoryTraceCount:this.maxMemoryTraceLogCount}):t.push({target:"console"});var n={TraceTargets:t,maxLogLevel:this.configProvider.config.debug?3:2},r={techOrder:["azureHtml5JS","html5"],nativeControlsForTouch:!1,autoplay:!0,preload:"auto",controls:!this.isControlsDisabled(),logo:{enabled:!1},height:"100%",width:"100%",traceConfig:n,disableFullscreenButton:null===(e=this.configProvider.playerConfig)||void 0===e?void 0:e.disableFullscreenButton,staleDataTimeLimitInSec:30,heuristicProfile:this.contextWindow.amp.Player.HeuristicProfile.HighQuality,customPlayerSettings:{customHeuristicSettings:{bandwidthTestWithTimeThresholdDuringLive:!1,windowSizeHeuristics:this.configProvider.config.ampSettings.useBrowserWindowSizeForBitRate,useBrowserWindowForWindowSizeRule:this.configProvider.config.ampSettings.useBrowserWindowSizeForBitRate,useVariableFragmentSizeMode:!0}},plugins:{}};return this.initializePluginOptions(r),r},i.prototype.isStreamValid=function(e){return e&&!!e.url&&!!e.decryptionToken},i.prototype.initializePluginOptions=function(e){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn){var t=this.isStreamValid(this.liveStreamOptions.stream)?this.liveStreamOptions.stream:this.liveStreamOptions.altStream;this.log("initializePluginOptions, receivedSDNContext: ".concat(JSON.stringify(null==t?void 0:t.sdnContext)),"info");try{switch(this.liveStreamOptions.sdn.name){case"hive":if(e.plugins={hive:{debugLevel:this.configProvider.config.debug?"debug":"notice",telemetryId:this.playerId}},t&&t.sdnContext)try{if((r=JSON.parse(t.sdnContext)).sdnConfig){var n=JSON.parse(r.sdnConfig);n.candidateTopicName="RequestIceCandidates",delete n.RTCIceCandidates,Object.assign(e.plugins.hive,n)}}catch(e){this.log("initializePluginOptions, failed to parse Hive sdnConfig Json from sdnContext Json, error: ".concat(e),"warn")}break;case"kollective":if(t&&t.sdnContext){var r=null,i=null,o=null;try{r=this.parseJson(t.sdnContext,"kollective sdn context")}catch(e){this.log("initializePluginOptions, failed to parse Kollective sdnContext Json, error: ".concat(e),"error")}if(r){try{i=this.parseJson(r.playbackinfo,"kollective sdn playback info")}catch(e){this.log("initializePluginOptions, failed to parse Kollective sdnContext playbackinfo Json, error: ".concat(e),"error")}try{o=this.parseJson(r.sdnConfig,"kollective sdn config")}catch(e){this.log("initializePluginOptions, failed to parse Kollective sdnContext sdnConfig Json, error: ".concat(e),"error")}}e.plugins={kollectiveSDN:{playbackInfo:i,sdnConfig:o,reportSessionId:this.playerId}}}break;case"ramp":t&&t.sdnContext&&(e.plugins={RampMOPlugin:this.parseJson(t.sdnContext,"ramp sdn context")},this.configProvider.config.debug&&(e.plugins.RampMOPlugin.verbose=!0));break;case"peer5":t.sdnContext&&(e.plugins={peer5:this.parseJson(t.sdnContext,"peer5 sdn context")})}}catch(e){this.log("initializePluginOptions failed, error: ".concat(e.message),"error")}this.log("initializePluginOptions, configured plugin options: ".concat(JSON.stringify(e.plugins)),"info")}},i.prototype.getTextTracks=function(){var e=[];if(this.isControlsDisabled())e.push({id:"amp-player_default",kind:"captions",label:"default-text-track",src:"",srclang:"en"});else if(this.liveStreamOptions.supportedSubtitleLanguages)for(var t=this.liveStreamOptions.supportedSubtitleLanguages,n=0;n<t.length;n++)e.push({id:"amp-player_".concat(t[n].culture),kind:this.configProvider.config.textTrackKind,label:t[n].name||t[n].culture,src:"",srclang:t[n].culture.substr(0,2)});return e},i.prototype.configureSdnSource=function(e,t){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn){switch(this.liveStreamOptions.sdn.name){case"hive":if(!t.sdnContext){e.sdnList=[];break}try{(n=JSON.parse(t.sdnContext)).playbackinfo&&(e.sdnList=[{sdnName:"hive",sdnUrl:n.playbackinfo}])}catch(n){e.sdnList=[{sdnName:"hive",sdnUrl:t.sdnContext}]}break;case"kollective":if(!t.sdnContext){e.sdnList=[];break}try{var n=this.parseJson(t.sdnContext,"kollective sdn list context"),r=this.parseJson(n.playbackinfo,"kollective sdn list playback info"),i=this.parseJson(n.sdnConfig,"kollective sdn list sdn config");e.sdnList=[{sdnName:"kollectiveSDN",playbackInfo:r,sdnConfig:i}]}catch(t){return e.sdnList=[],void this.log("configureSdnSource failed, error: ".concat(t),"error")}break;case"ramp":case"peer5":e.sdnList=[];break;default:return}this.log("configureSdnSource, configured source context: ".concat(JSON.stringify(e)),"info")}},i.prototype.registerPlayerEvents=function(){var t=this;this.registerPlayerEvent(this.contextWindow.amp.eventName.error,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.error)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.canplaythrough,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.canplaythrough)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.play,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.play)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.playing,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.playing)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.pause,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.pause)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.resume,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.resume)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.start,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.start)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.ended,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.ended)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeking,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.seeking)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeked,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.seeked)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadedmetadata,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.loadedmetadata)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.waiting,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.waiting)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.playbackbitratechanged,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.playbackbitratechanged)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.downloadbitratechanged,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.downloadbitratechanged)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.fullscreenchange,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.fullscreenchange)})),this.registerPlayerEvent("potentialMediaFreeze",(function(){t.onAmpEvent("potentialMediaFreeze")})),this.registerPlayerEvent(this.contextWindow.amp.eventName.mute,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.mute)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.unmute,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.unmute)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.volumechange,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.volumechange)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadeddata,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.loadeddata)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadstart,(function(){t.onAmpEvent(t.contextWindow.amp.eventName.loadstart)})),Object.values(e).forEach((function(e){t.registerVideoEvent(e,(function(n){t.handleUserExperienceErrorEvent(e,n.detail.data.details,n.detail.data.fatal)}))})),this.configProvider.config.ampSettings.collectUserInitiatedSeekEventsTelemetry&&(this.playerEvents.push("currentTimeChanging"),this.playerInstance.addEventListener("currentTimeChanging",(function(e,n){return t.onAmpCurrentTimeChangingEvent(e,n)})))},i.prototype.onAmpCurrentTimeChangingEvent=function(e,t){if("currentTimeChanging"===e.type&&t.time){var n={newCurrentPlayPosition:t.time};this.eventsHandler.message("stateChanged").send("UserInitiatedSeek",n)}},i.prototype.registerPlayerEvent=function(e,t){this.playerEvents.push(e),this.playerInstance.addEventListener(e,t)},i.prototype.registerVideoEvent=function(e,t){this.videoElementEvents.push({name:e,callback:t}),this.video.addEventListener(e,t)},i.prototype.removePlayerEventListeners=function(){var e=this;this.playerEvents.forEach((function(t){e.playerInstance.removeEventListener(t)}))},i.prototype.removeVideoEventListeners=function(){var e=this;this.videoElementEvents.forEach((function(t){e.video.removeEventListener(t.name,t.callback)}))},i.prototype.onAmpEvent=function(e){var t,n;switch(e){case this.contextWindow.amp.eventName.error:n=this.playerInstance.error(),t={currentTime:this.playerInstance.currentTime(),errorCode:n?n.code:0,message:n?n.message:""};break;case this.contextWindow.amp.eventName.canplaythrough:this.initializeStatsColletion();break;case this.contextWindow.amp.eventName.loadedmetadata:this.captionsControl.initialize(),this.absoluteTimeOffsetEstimator&&this.absoluteTimeOffsetEstimator.restartStreamAbsoluteTimeOffsetRetrieval();break;case this.contextWindow.amp.eventName.fullscreenchange:t={isFullscreen:this.playerInstance.isFullscreen()};break;case this.contextWindow.amp.eventName.playbackbitratechanged:t={bitrate:this.playerInstance.currentPlaybackBitrate()};break;case this.contextWindow.amp.eventName.downloadbitratechanged:t={bitrate:this.playerInstance.currentDownloadBitrate()};break;case this.contextWindow.amp.eventName.seeked:t={captionsTimestamp:this.isControlsDisabled()?this.playerInstance.currentMediaTime():this.playerInstance.currentTime()};break;case this.contextWindow.amp.eventName.volumechange:t={value:this.playerInstance.volume()}}this.updatePlaybackDiagnostics(),this.updatePlayerState(e),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),this.eventsHandler.message("stateChanged").send(e,t)},i.prototype.updatePlayerState=function(e){this.updatePlayingState(e),this.updateBufferingState(e),this.updateCurrentVideoTrackBitrate(e),e!==this.contextWindow.amp.eventName.ended&&e!==this.contextWindow.amp.eventName.error||this.handlePlaybackStopped()},i.prototype.handleUserExperienceErrorEvent=function(e,t,n){var r={currentTime:this.video?this.video.currentTime:0,message:t,type:e,errorCode:0,fatal:n};this.updatePlaybackDiagnostics(),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),this.eventsHandler.message("stateChanged").send(this.contextWindow.amp.eventName.error,r)},i.prototype.updatePlayingState=function(e){this.isPlaying?e!==this.contextWindow.amp.eventName.pause&&e!==this.contextWindow.amp.eventName.seeking&&e!==this.contextWindow.amp.eventName.ended&&e!==this.contextWindow.amp.eventName.error&&e!==this.contextWindow.amp.eventName.waiting||(this.isPlaying=!1):e===this.contextWindow.amp.eventName.playing&&(this.isPlaying=!0)},i.prototype.updateBufferingState=function(e){var t;this.isBuffering?(e===this.contextWindow.amp.eventName.pause&&"html5"===(null===(t=this.playerInstance.currentTechName())||void 0===t?void 0:t.toLowerCase())||e===this.contextWindow.amp.eventName.seeking||e===this.contextWindow.amp.eventName.ended||e===this.contextWindow.amp.eventName.error||e===this.contextWindow.amp.eventName.playing)&&(this.isBuffering=!1):e===this.contextWindow.amp.eventName.waiting&&(this.isBuffering=!0)},i.prototype.updateCurrentVideoTrackBitrate=function(e){e===this.contextWindow.amp.eventName.playbackbitratechanged&&this.playerInstance.currentPlaybackBitrate()!==this.currentVideoPlaybackBitrate&&(this.currentVideoPlaybackBitrate=this.playerInstance.currentPlaybackBitrate(),this.updateVideoTrackHistoryStatistic())},i.prototype.initializeStatsColletion=function(){var e=this;this.diagnosticProvider.initialize(),this.statsTimer=window.setInterval((function(){e.eventsHandler&&(e.updatePlaybackDiagnostics(),e.eventsHandler.message("statsUpdated").send(e.getPlayerDiagnostics()))}),this.statsInterval)},i.prototype.stopStatsCollection=function(){this.updatePlaybackDiagnostics(),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),-1!==this.statsTimer&&window.clearInterval(this.statsTimer),this.statsTimer=-1},i.prototype.updateVideoTrackHistoryStatistic=function(){var e=this,t=new Date;if(this.currentVideoPlaybackBitrate){var n=this.diagnosticProvider.getValue("videoTrackHistory"),r=this.diagnosticProvider.getValue("videoTrackTotalDurations");if(n.length>0&&this.currentVideoPlaybackBitrate===n[n.length-1].trackPlaybackBitrate){if(this.videoTrackHistoryUpdatedTimestamp){this.latestVideoTrackDuration+=(t.getTime()-this.videoTrackHistoryUpdatedTimestamp.getTime())/1e3,n[n.length-1].durationInSeconds=Number(this.latestVideoTrackDuration.toFixed(0));var i=this.videoTrackTotalDurations.find((function(t){return t.trackPlaybackBitrate===e.currentVideoPlaybackBitrate})),o=r.find((function(t){return t.trackPlaybackBitrate===e.currentVideoPlaybackBitrate}));i&&o&&(i.totalDurationInSeconds+=(t.getTime()-this.videoTrackHistoryUpdatedTimestamp.getTime())/1e3,o.totalDurationInSeconds=Number(i.totalDurationInSeconds.toFixed(0)))}}else{var a=this.playerInstance.videoBufferData(),s=null;if(a&&a.perceivedBandwidth&&(s=a.perceivedBandwidth),n.push({trackPlaybackBitrate:this.currentVideoPlaybackBitrate,trackSwitchTimestamp:t.getTime(),trackSwitchMeasuredBandwidth:this.diagnosticProvider?this.diagnosticProvider.getAverageMeasuredBandwidth():null,trackSwitchMeasuredByteSize:this.diagnosticProvider?this.diagnosticProvider.getAverageMeasuredVideoDownloadSize():null,trackSwitchPerceivedBandwidth:s,durationInSeconds:0}),this.latestVideoTrackDuration=0,n.length>this.configProvider.config.maxVideoTrackHistoryLogCount&&n.splice(0,1),!(i=this.videoTrackTotalDurations.find((function(t){return t.trackPlaybackBitrate===e.currentVideoPlaybackBitrate})))){var c={trackPlaybackBitrate:this.currentVideoPlaybackBitrate,totalDurationInSeconds:0},l={trackPlaybackBitrate:this.currentVideoPlaybackBitrate,totalDurationInSeconds:0};this.videoTrackTotalDurations.push(c),r.push(l)}}}this.videoTrackHistoryUpdatedTimestamp=t},i.prototype.updateTotalPlayingTimeStatistic=function(){var e=new Date;this.isPlaying&&this.totalPlayingTimeUpdatedTimestamp&&(this.totalPlayingTime+=e.getTime()-this.totalPlayingTimeUpdatedTimestamp.getTime()),this.totalPlayingTimeUpdatedTimestamp=e,this.diagnosticProvider.setValue("totalPlayingTimeInSeconds",Number((this.totalPlayingTime/1e3).toFixed(0)))},i.prototype.updateBufferingRateStatistic=function(){var e=new Date;this.isBuffering&&this.bufferingRateStatUpdatedTimestamp&&(this.totalBufferingTime+=e.getTime()-this.bufferingRateStatUpdatedTimestamp.getTime()),this.bufferingRateStatUpdatedTimestamp=e;var t=this.totalPlayingTime>0||this.totalBufferingTime>0?this.totalBufferingTime/(this.totalPlayingTime+this.totalBufferingTime):0;this.diagnosticProvider.setValue("bufferingRate",Number(t.toFixed(3)))},i.prototype.getPlayerDiagnostics=function(){var e=this.diagnosticProvider.getPlayerDiagnosticSnapshot();return e.statsInterval=this.statsInterval,this.configProvider.config.debug&&(e.memoryLog=this.playerInstance.getMemoryLog(!0)),e},i.prototype.log=function(e,t){void 0===t&&(t="info");var n="[AmpPlayer".concat(1===this.configProvider.config.loadType?"IFrame":"","]"),r="".concat(n,": ").concat(e);this.configProvider.config.debug&&console.log(r),this.eventsHandler.message("log").send(t,r)},i.prototype.getElementLoadPromise=function(e,t){return new Promise((function(n,r){e.onload=function(){n("Element Load success")},e.onerror=function(){r("Failed to load script: ".concat(t))}}))},i.prototype.loadCss=function(e,t,n){var r=e.createElement("link"),i=this.getElementLoadPromise(r,t);return r.href=t,r.rel="stylesheet",n&&(r.nonce=n),e.head.appendChild(r),i},i.prototype.parseJson=function(e,t){try{return JSON.parse(e)}catch(e){throw this.log("Error parsing JSON for ".concat(t,", error: ").concat(JSON.stringify(e))),e}},i}()}function r(){var e=n();return function(){function t(t,n){this.pipe=t,this.amp=new e(n,this)}return t.prototype.processMessage=function(e){var t=this;"Command"===e.msgType&&Promise.resolve().then((function(){return t.amp[e.cmd].apply(t.amp,e.args)})).then((function(n){t.pipe&&t.pipe.sendMsg({msgType:"CommandResult",cmd:e.cmd,result:JSON.stringify(n)})})).catch((function(n){t.pipe&&t.pipe.sendMsg({msgType:"CommandResult",cmd:e.cmd,error:n})}))},t.prototype.message=function(e){var t=this;return{send:this.fromMessage((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t.sendMessageImpl(e,n)}))}},t.prototype.ampDisposed=function(){this.pipe.dispose(),this.pipe=null,this.amp=null},t.prototype.fromMessage=function(e){return e},t.prototype.sendMessageImpl=function(e,t){this.pipe.sendMsg({msgType:"PlayerNotification",name:e,args:t})},t}()}function i(){function e(e){var t="unknown";try{t="string"==typeof e?e:"toString"in e&&0!==e.toString().indexOf("[object")?e.toString():JSON.stringify(e)}catch(t){console.error("Failed to stringify error",e)}return t}return function(){function t(){this.processMsg=this.processMsg.bind(this),window.addEventListener("message",this.processMsg)}return t.prototype.sendMsg=function(t){try{var n=t;(function(e){return"CommandResult"===e.msgType})(t)&&t.error instanceof Event&&(console.debug("Stringifying error Event before trying to postMessage:",t),n={msgType:t.msgType,cmd:t.cmd,error:"Event: ".concat(e(t.error))}),this.postMessage(n)}catch(n){console.error("Unexpected exception caught from postMessage.\n","message:",t,"\n","exception:",n);var r={msgType:"PlayerNotification",name:"log",args:["error","Unexpected error with postMessage: ".concat(e(n))]};throw this.postMessage(r),n}},t.prototype.registerObserver=function(e){this.observer=e},t.prototype.dispose=function(){window.removeEventListener("message",this.processMsg),this.observer=null},t.prototype.processMsg=function(e){this.observer.processMessage(e.data)},t.prototype.postMessage=function(e){window.parent.postMessage(e,"*")},t}()}function o(){var e=a();return function(){function t(t){this.playlistFileDownloadPromise=Promise.resolve(),this.playlistFileDownloadRetryWaitTime=250,this.playlistFileDownloadMaxRetryCount=20,this.playlistFileDownloadCancellationFlag=!1,this.logFn=function(e,n){return t("[HlsAbsoluteTimeOffsetEstimator]: ".concat(e),n)},this.hlsFileParser=new e(t)}return Object.defineProperty(t.prototype,"absoluteTimeOffset",{get:function(){return this.estimatedAbsoluteTimeOffset},enumerable:!1,configurable:!0}),t.prototype.setEstimationResultCallback=function(e){this.onAbsoluteTimeOffsetEstimation=e},t.prototype.restartStreamAbsoluteTimeOffsetRetrieval=function(){var e=this;this.stopStreamAbsoluteTimeOffsetRetrieval().then((function(){return e.startStreamAbsoluteTimeOffsetRetrieval()}))},t.prototype.setManifestFileURL=function(e){this.cachedManifestUrl=e},t.prototype.startStreamAbsoluteTimeOffsetRetrieval=function(){var e=this;this.playlistFileDownloadPromise=this.retryPlaylistFileDownload((function(){return e.estimateStreamTimeFromPlaylist(e.currentManifestUrl)})).then((function(){e.logFn("Succeeded in downloading playlist files to estimate\n                    absolute stream time offset as: ".concat(e.estimatedAbsoluteTimeOffset))})).catch((function(t){e.logFn("Failed to download playlist files to estimate absolute stream time offset: ".concat(t.message),"error")}))},t.prototype.stopStreamAbsoluteTimeOffsetRetrieval=function(){var e=this;return this.playlistFileDownloadCancellationFlag=!0,this.playlistFileDownloadPromise.then((function(){e.playlistFileDownloadCancellationFlag=!1,e.currentManifestUrl=e.cachedManifestUrl,e.cachedManifestUrl=null}))},t.prototype.retryPlaylistFileDownload=function(e,t){var n=this;void 0===t&&(t=0);Promise.resolve();return e().then((function(){return n.onAbsoluteTimeOffsetEstimation&&n.onAbsoluteTimeOffsetEstimation({timestamp:Date.now(),retries:t,isSuccess:!0,absoluteTimeOffsetEstimation:n.absoluteTimeOffset}),Promise.resolve()})).catch((function(r){return t++,n.logFn("Error loading playlist file: ".concat(r," -- attempt ").concat(t)),n.onAbsoluteTimeOffsetEstimation&&n.onAbsoluteTimeOffsetEstimation({timestamp:Date.now(),retries:t,isSuccess:!1,error:r.message}),t===n.playlistFileDownloadMaxRetryCount?Promise.reject(new Error("".concat(r," after ").concat(t," attempts"))):n.playlistFileDownloadCancellationFlag?Promise.reject(new Error("cancelling playlist file download")):new Promise((function(r){return setTimeout((function(){return r(n.retryPlaylistFileDownload(e,t))}),n.playlistFileDownloadRetryWaitTime)}))}))},t.prototype.estimateStreamTimeFromPlaylist=function(e){var t=this;return this.hlsFileParser.getStreamRenditionsUrlsFromManifest(e).then((function(n){if(0===n.audioRenditions.length&&0===n.videoRenditions.length)throw new Error("Unable to retrieve renditions URLs from manifest: ".concat(e));return Promise.all([n.videoRenditions.length>0?t.hlsFileParser.getTextFileContent(n.videoRenditions[0]):Promise.resolve(null),n.audioRenditions.length>0?t.hlsFileParser.getTextFileContent(n.audioRenditions[0]):Promise.resolve(null)])})).then((function(e){for(var n,r=0;r<e.length;r++){var i=e[r];if(i){t.logFn("Using segment duration and sequence number to calculate absolute time offset","debug");var o=t.hlsFileParser.getHlsFieldByName("SequenceNumber",i);if(0==o.length)throw new Error("Unable to retrieve sequence number from playlist file");var a=t.hlsFileParser.getHlsFieldByName("SegmentDuration",i,10);if(0==a.length)throw new Error("Unable to retrieve segment durations from playlist file");var s=a.map(Number);s.sort((function(e,t){return e-t}));var c=s[Math.floor(s.length/2)],l=Number(o[0])*Number(c);n=n?Math.max(n,l):l}}t.estimatedAbsoluteTimeOffset=n}))},t}()}function a(){return function(){function e(e){this.fieldNameRegexMap={BaseUrl:/(.*)\/.*/,AudioManifestFile:/#EXT-X-MEDIA:TYPE=AUDIO.*URI=\"(.*)\"/,SequenceNumber:/#EXT-X-MEDIA-SEQUENCE:(\d+)/,SegmentDuration:/#EXTINF:(\d+(\.\d+)?)/},this.logFn=function(t,n){return e("[HlsFileParser]: ".concat(t),n)}}return e.prototype.getHlsFieldByName=function(e,t,n){void 0===n&&(n=1);for(var r=[],i=1;i<=n;i++){var o=this.fieldNameRegexMap[e].exec(t);if(!(o&&o.length>0))break;r.push(o[1]),t=t.substring(o.index+o[0].length)}return r},e.prototype.getStreamRenditionsUrlsFromManifest=function(e){var t=this;return e?this.getTextFileContent(e).then((function(n){for(var r={audioRenditions:[],videoRenditions:[]},i=n.split("\n"),o=t.getHlsFieldByName("BaseUrl",e),a=0;a<i.length;a++){if(i[a].includes("#EXT-X-STREAM-INF"))(s=i[a+1]).includes("http")?r.videoRenditions.push(s):o.length>0&&r.videoRenditions.push("".concat(o[0],"/").concat(s));else if(i[a].includes("EXT-X-MEDIA:TYPE")){var s,c=t.getHlsFieldByName("AudioManifestFile",i[a]);if(c.length>0)(s=c[0]).includes("http")?r.audioRenditions.push(s):o.length>0&&r.audioRenditions.push("".concat(o[0],"/").concat(s))}}return r})).catch((function(e){return t.logFn("Failed to extract stream renditions from manifest, error: ".concat(e.message),"error"),{audioRenditions:[],videoRenditions:[]}})):(this.logFn("No manifest URL provided to parse"),Promise.resolve({audioRenditions:[],videoRenditions:[]}))},e.prototype.getTextFileContent=function(e){var t=this;return fetch(e).then((function(t){if(!t.ok)throw new Error("http-error ".concat(t.status," when downloading: ").concat(e));return t.text()})).catch((function(e){return t.logFn("Error downloading resource: ".concat(e),"error"),Promise.reject(e)}))},e}()}function s(){return function(){function e(e,t,n,r,i){this.playerInstance=e,this.contextWindow=t,this.streamingStartedTimestamp=n,this.configProvider=r,this.absoluteTimeOffsetEstimator=i,this.currentDiagnosticSnapshot={playerType:0,currentPlayPosition:null,tech:null,perceivedBandwidth:null,playerHeight:null,playerWidth:null,mediaHeight:null,mediaWidth:null,windowHeight:null,windowWidth:null,videoStream:null,audioStream:null,totalDurationInSeconds:null,avgVideoDownloadLatency:null,avgAudioDownloadLatency:null,avgVideoDownloadBytes:null,avgAudioDownloadBytes:null,avgAudioDownloadBandwidth:null,avgVideoDownloadBandwidth:null,maxVideoDownloadBytes:null,minVideoDownloadBytes:null,videoDownloadSuccessCount:null,audioDownloadSuccessCount:null,videoDownloadFailureCount:null,audioDownloadFailureCount:null,videoBufferLength:null,videoCachedLength:null,audioBufferLength:null,audioCachedLength:null,videoEdgeLatency:null,audioEdgeLatency:null,playbackRate:null,playbackBitrate:null,downloadBitrate:null,audioDownloadBitrate:null,audioPlaybackBitrate:null,isFullscreen:null,streamType:null,playerVersion:null,isP2PSdnUsed:null,sdnName:null,livePosition:null,muted:null,volume:null,errorCode:null,currentMediaTime:null,currentAbsoluteTime:null,absoluteTimeOffsetEstimationResults:null,estimatedAbsoluteTimeOffset:null,videoDownloadFailures:null,audioDownloadFailures:null,heuristicProfile:null,encryption:null,retryFrequency:null,averageDownloadBitrate:null,totalDownloadedBytes:0,streamId:null,streamUrl:null,streamingEventType:null,playerControlsEnabled:null,streamDeliveryPipeline:null,retryCount:0,totalPlayingTimeInSeconds:0,bufferingRate:0,videoTrackHistory:[],videoTrackTotalDurations:[],memoryLog:null,statsInterval:null},this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.audioDownloadBandwidths=[],this.videoDownloadBandwidths=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.audioDownloadFailures=[],this.videoDownloadFailures=[],this.totalDownloadedBytes=0,this.slidingWindowLengthForLatency=5,this.slidingWindowLengthForDownloadBytes=30,this.slidingWindowLengthForDownloadBandwidth=10,this.absoluteTimeOffsetEstimationResults=[],this.downloadFailuresLimit=10,this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this)}return e.prototype.initialize=function(){this.playerVideoBuffer=this.playerInstance.videoBufferData(),this.playerAudioBuffer=this.playerInstance.audioBufferData(),this.registerForPlayerBufferEvents()},e.prototype.setValue=function(e,t){this.currentDiagnosticSnapshot[e]=t},e.prototype.getValue=function(e){return this.currentDiagnosticSnapshot[e]},e.prototype.appendAbsoluteTimeOffsetEstimation=function(e){this.absoluteTimeOffsetEstimationResults.push(e),this.absoluteTimeOffsetEstimationResults.length>this.configProvider.config.ampSettings.maxAbsoluteTimeOffsetEstimationResultsLogCount&&this.absoluteTimeOffsetEstimationResults.splice(0,1)},e.prototype.getPlayerDiagnosticSnapshot=function(){var e,t=this;if(!this.playerInstance)return null;var n=window.screen,r=this.playerInstance.error(),i=function(e){var t=e.slice().sort();return t[Math.floor(t.length/2)]};this.currentDiagnosticSnapshot.errorCode=r&&r.code||0,this.currentDiagnosticSnapshot.currentPlayPosition=this.playerInstance.currentTime(),this.currentDiagnosticSnapshot.currentMediaTime=null!==(e=this.playerInstance.currentMediaTime())&&void 0!==e?e:this.playerInstance.currentTime(),this.currentDiagnosticSnapshot.currentAbsoluteTime=this.getCurrentAbsoluteTime(),this.currentDiagnosticSnapshot.absoluteTimeOffsetEstimationResults=this.absoluteTimeOffsetEstimationResults,this.currentDiagnosticSnapshot.estimatedAbsoluteTimeOffset=this.getCurrentAbsoluteTimeOffset(),this.currentDiagnosticSnapshot.playbackBitrate=this.playerInstance.currentPlaybackBitrate(),this.currentDiagnosticSnapshot.downloadBitrate=this.playerInstance.currentDownloadBitrate(),this.currentDiagnosticSnapshot.audioDownloadBitrate=this.lastAudioDownloadBitrate,this.currentDiagnosticSnapshot.perceivedBandwidth=this.playerVideoBuffer?this.playerVideoBuffer.perceivedBandwidth:0,this.currentDiagnosticSnapshot.tech=this.playerInstance.currentTechName(),this.currentDiagnosticSnapshot.playerVersion=this.playerInstance.getAmpVersion(),this.currentDiagnosticSnapshot.isP2PSdnUsed=this.isP2PSdnUsed(),this.currentDiagnosticSnapshot.sdnName=this.sdnName(),this.currentDiagnosticSnapshot.heuristicProfile=this.playerInstance.currentHeuristicProfile(),this.currentDiagnosticSnapshot.encryption=this.playerInstance.currentProtectionInfo()?this.playerInstance.currentProtectionInfo().type:"",this.currentDiagnosticSnapshot.streamType=this.getStreamType(this.currentDiagnosticSnapshot.streamType),this.currentDiagnosticSnapshot.totalDurationInSeconds=this.getTotalDurationInSeconds(),this.currentDiagnosticSnapshot.audioStream=this.getAudioStreamData(),this.currentDiagnosticSnapshot.videoStream=this.getVideoStreamData(),this.currentDiagnosticSnapshot.muted=this.playerInstance.muted(),this.currentDiagnosticSnapshot.volume=this.playerInstance.volume(),this.currentDiagnosticSnapshot.playbackRate=this.playerInstance.playbackRate();var o=this.getPlayerCachedLength(),a=this.getPlayerEdgeLatency();this.currentDiagnosticSnapshot.audioBufferLength=this.playerAudioBuffer?this.playerAudioBuffer.bufferLevel:0,this.currentDiagnosticSnapshot.audioCachedLength=o,this.currentDiagnosticSnapshot.audioEdgeLatency=a,this.currentDiagnosticSnapshot.videoBufferLength=this.playerVideoBuffer?this.playerVideoBuffer.bufferLevel:0,this.currentDiagnosticSnapshot.videoCachedLength=o,this.currentDiagnosticSnapshot.videoEdgeLatency=a,this.currentDiagnosticSnapshot.livePosition=this.getLivePosition(),this.currentDiagnosticSnapshot.mediaHeight=this.playerInstance.videoHeight(),this.currentDiagnosticSnapshot.mediaWidth=this.playerInstance.videoWidth(),this.currentDiagnosticSnapshot.playerHeight=this.playerInstance.height(),this.currentDiagnosticSnapshot.playerWidth=this.playerInstance.width(),this.currentDiagnosticSnapshot.windowHeight=n?n.height:0,this.currentDiagnosticSnapshot.windowWidth=n?n.width:0,this.currentDiagnosticSnapshot.isFullscreen=this.playerInstance.isFullscreen(),this.currentDiagnosticSnapshot.avgAudioDownloadLatency=i(this.audioDownloadLatencies),this.currentDiagnosticSnapshot.avgVideoDownloadLatency=i(this.videoDownloadLatencies),this.currentDiagnosticSnapshot.avgAudioDownloadBytes=i(this.audioDownloadBytes),this.currentDiagnosticSnapshot.avgVideoDownloadBytes=i(this.videoDownloadBytes),this.currentDiagnosticSnapshot.maxVideoDownloadBytes=Math.max.apply(null,this.videoDownloadBytes),this.currentDiagnosticSnapshot.minVideoDownloadBytes=Math.min.apply(null,this.videoDownloadBytes),this.currentDiagnosticSnapshot.avgAudioDownloadBandwidth=i(this.audioDownloadBandwidths),this.currentDiagnosticSnapshot.avgVideoDownloadBandwidth=i(this.videoDownloadBandwidths),this.currentDiagnosticSnapshot.audioDownloadFailureCount=this.audioDownloadFailureCount,this.currentDiagnosticSnapshot.audioDownloadSuccessCount=this.audioDownloadSuccessCount,this.currentDiagnosticSnapshot.videoDownloadFailureCount=this.videoDownloadFailureCount,this.currentDiagnosticSnapshot.videoDownloadSuccessCount=this.videoDownloadSuccessCount,this.currentDiagnosticSnapshot.audioDownloadFailures=this.audioDownloadFailures,this.currentDiagnosticSnapshot.videoDownloadFailures=this.videoDownloadFailures,this.currentDiagnosticSnapshot.totalDownloadedBytes=this.totalDownloadedBytes,this.currentDiagnosticSnapshot.retryFrequency=this.getRetryFrequency(),this.currentDiagnosticSnapshot.averageDownloadBitrate=this.getAverageDownloadBitrate();var s=this.getDiagnosticWritableField();return Object.keys(s).forEach((function(e){t.currentDiagnosticSnapshot[e]=s[e]})),this.currentDiagnosticSnapshot},e.prototype.getDiagnosticWritableField=function(){return{streamUrl:this.currentDiagnosticSnapshot.streamUrl,streamId:this.currentDiagnosticSnapshot.streamId,streamingEventType:this.currentDiagnosticSnapshot.streamingEventType,playerControlsEnabled:this.currentDiagnosticSnapshot.playerControlsEnabled,streamDeliveryPipeline:this.currentDiagnosticSnapshot.streamDeliveryPipeline,retryCount:this.currentDiagnosticSnapshot.retryCount,totalPlayingTimeInSeconds:this.currentDiagnosticSnapshot.totalPlayingTimeInSeconds,bufferingRate:this.currentDiagnosticSnapshot.bufferingRate,videoTrackHistory:this.currentDiagnosticSnapshot.videoTrackHistory,videoTrackTotalDurations:this.currentDiagnosticSnapshot.videoTrackTotalDurations,eventId:this.currentDiagnosticSnapshot.eventId||"",templateId:this.currentDiagnosticSnapshot.templateId||""}},e.prototype.dispose=function(){this.unsubscribeFromPlayerBufferEvents()},e.prototype.registerForPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},e.prototype.unsubscribeFromPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},e.prototype.isP2PSdnUsed=function(){return!!this.sdnName()},e.prototype.sdnName=function(){var e="options_";return this.playerInstance[e]&&this.playerInstance[e].sdn&&this.playerInstance[e].sdn.name},e.prototype.getStreamType=function(e){var t="";return this.playerInstance&&(t=this.playerInstance.isLive()?"LIVE":"DVR"),""===t||"LIVE"===e&&t!==e?e||"":t},e.prototype.getCurrentAbsoluteTime=function(){var e;return this.absoluteTimeOffsetEstimator?this.absoluteTimeOffsetEstimator.absoluteTimeOffset?this.absoluteTimeOffsetEstimator.absoluteTimeOffset+this.playerInstance.currentTime():this.playerInstance.currentTime():null!==(e=this.playerInstance.currentAbsoluteTime())&&void 0!==e?e:this.playerInstance.currentTime()},e.prototype.getCurrentAbsoluteTimeOffset=function(){return this.getCurrentAbsoluteTime()-this.playerInstance.currentTime()},e.prototype.getTotalDurationInSeconds=function(){var e=((new Date).getTime()-this.streamingStartedTimestamp.getTime())/1e3;return Number(e.toFixed(0))},e.prototype.onVideoDownloadCompleted=function(){this.videoDownloadSuccessCount++,this.addToList(this.videoDownloadLatencies,this.playerVideoBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.videoDownloadBytes,this.playerVideoBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes),this.addToList(this.videoDownloadBandwidths,8*this.playerVideoBuffer.downloadCompleted.totalBytes*1e3/this.playerVideoBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForDownloadBandwidth),this.totalDownloadedBytes+=this.playerVideoBuffer.downloadCompleted.totalBytes},e.prototype.onAudioDownloadCompleted=function(){this.audioDownloadSuccessCount++,this.addToList(this.audioDownloadLatencies,this.playerAudioBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.audioDownloadBytes,this.playerAudioBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes),this.addToList(this.audioDownloadBandwidths,8*this.playerAudioBuffer.downloadCompleted.totalBytes*1e3/this.playerAudioBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForDownloadBandwidth),this.totalDownloadedBytes+=this.playerAudioBuffer.downloadCompleted.totalBytes;var e=this.playerAudioBuffer.downloadCompleted.mediaDownload.bitrate;e!==this.lastAudioDownloadBitrate&&(this.lastAudioDownloadBitrate=e)},e.prototype.addToList=function(e,t,n){e.push(t),e.length>n&&e.shift()},e.prototype.onVideoDownloadError=function(){this.videoDownloadFailureCount++,this.addDownloadFailureInfo(this.playerVideoBuffer.downloadFailed,this.videoDownloadFailures)},e.prototype.onAudioDownloadError=function(){this.audioDownloadFailureCount++,this.addDownloadFailureInfo(this.playerAudioBuffer.downloadFailed,this.audioDownloadFailures)},e.prototype.addDownloadFailureInfo=function(e,t){var n={bitrate:e.mediaDownload.bitrate,errorCode:e.code,mediaTime:e.mediaDownload.mediaTime,message:e.message,timestamp:Date.now()};this.addToList(t,n,this.downloadFailuresLimit)},e.prototype.getAudioStreamData=function(){var e=this.playerInstance.currentAudioStreamList();if(e)try{var t=e.streams[e.enabledIndices[0]];return{bitrate:t.bitrate,codec:t.codec,enabled:t.enabled,name:t.name,language:t.language}}catch(e){return}},e.prototype.getVideoStreamData=function(){var e=this.playerInstance.currentVideoStreamList();if(e)try{var t=e.streams[e.selectedIndex],n=this.playerInstance.currentPlaybackBitrate(),r=t.tracks?t.tracks.map((function(e){return{bitrate:e.bitrate,height:e.height,id:e.id,selectable:e.selectable,width:e.width}})).find((function(e){return e.bitrate===n})):null;return{codec:t.codec,name:t.name,currentTrack:r}}catch(e){return}},e.prototype.getLivePosition=function(){var e=this.playerInstance.buffered();if(0===e.length)return 0;for(var t=e.end(0),n=1;n<e.length;n++)t=Math.max(t,e.end(n));return t},e.prototype.getAverageDownloadBitrate=function(){if(this.streamingStartedTimestamp&&this.totalDownloadedBytes){var e=((new Date).getTime()-this.streamingStartedTimestamp.getTime())/1e3;if(e>0)return 8*this.totalDownloadedBytes/e}return 0},e.prototype.getRetryFrequency=function(){var e=this.currentDiagnosticSnapshot.retryCount;if(this.streamingStartedTimestamp&&e){var t=((new Date).getTime()-this.streamingStartedTimestamp.getTime())/6e4;if(t>0)return e/t}return 0},e.prototype.getAverageMeasuredBandwidth=function(){if(0===this.videoDownloadBandwidths.length)return null;for(var e=0,t=0;t<this.videoDownloadBandwidths.length;t++)e+=this.videoDownloadBandwidths[t];return e/this.videoDownloadBandwidths.length},e.prototype.getAverageMeasuredVideoDownloadSize=function(){if(0===this.videoDownloadBytes.length)return null;for(var e=0,t=0;t<this.videoDownloadBytes.length;t++)e+=this.videoDownloadBytes[t];return e/this.videoDownloadBytes.length},e.prototype.getPlayerCachedLength=function(){for(var e=this.playerInstance.buffered(),t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},e.prototype.getPlayerEdgeLatency=function(){var e=this.playerInstance.buffered();if(0===e.length)return 0;for(var t=e.end(0),n=1;n<e.length;n++)t=Math.max(t,e.end(n));return t-this.playerInstance.currentTime()},e}()}function c(){return function(){function e(e,t,n,r){var i;this.player=e,this.toggleListener=t,this.config=n,this.diagnosticProvider=r,this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.isHtml5Tech="html5"===(null===(i=this.player.currentTechName())||void 0===i?void 0:i.toLowerCase())}return e.prototype.dispose=function(){this.unsubscribeFromTrackEvents(),this.player=null,this.toggleListener=null},e.prototype.initialize=function(){var e=this.getPlayerTextTracksAsArray();if(!this.config.controlsEnabled&&e.length>0)e[0].mode="showing";else for(var t=0;t<e.length;t++)e[t].mode="disabled";this.subscribeOnTrackEvents()},e.prototype.addCues=function(e){var t=this.player.getCurrentTextTrack();if(t)for(var n=this.getCurrentAbsoluteTime()||1,r=this.getCurrentTime(),i=this.config.controlsEnabled?n-r:Math.max(n-r,0),o=this.isHtml5Tech?window.VTTCue:window.vttjs&&window.vttjs.VTTCue||window.VTTCue,a=0;a<e.length;a++){var s=e[a],c=s.start,l=s.end,u=s.text,d=new o(Number((c-i).toFixed(2)),Number((l-i).toFixed(2)),u);d.size=100,!this.containsCue(t,d)&&t.addCue(d)}},e.prototype.clearCues=function(){var e=this.player.getCurrentTextTrack();if(e)try{if(e.activeCues&&e.removeCue)for(;e.activeCues.length>0;)e.removeCue(e.activeCues[0]);var t="setCues_";if(e.cues[t]){e.cues_&&(e.cues_.length=0),e.cues[t]([]);for(var n=Object.getOwnPropertyNames(e.cues),r=0;r<n.length;r++)"length"!==n[r]&&"length_"!==n[r]&&"cues_"!==n[r]&&delete e.cues[n[r]]}}catch(e){this.config.logFn("[clearCues]: ".concat(e),"warn")}},e.prototype.showCaptions=function(e){this.config.logFn("[CaptionsControl]: showCaptions(".concat(e,")")),e?this.show():this.hide()},e.prototype.hide=function(){this.previouslyVisibleTextTrack=this.player.getCurrentTextTrack(),this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="disabled"),this.player.captionToggle&&this.player.captionToggle.hide&&this.player.captionToggle.hide(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.hide&&this.player.MoreOptionscaptionSubtitleButton.hide(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.hide&&this.player.MoreOptionscaptionSettingsButton.hide()},e.prototype.show=function(){this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="showing"),this.player.captionToggle&&this.player.captionToggle.show&&this.player.captionToggle.show(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.show&&this.player.MoreOptionscaptionSubtitleButton.show(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.show&&this.player.MoreOptionscaptionSettingsButton.show()},e.prototype.subscribeOnTrackEvents=function(){var e=this.player.textTracks(),t="addEventListener";e&&e[t]&&(this.config.controlsEnabled&&e[t]("change",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&e[t]("addtrack",this.onAddTrack.bind(this)))},e.prototype.unsubscribeFromTrackEvents=function(){var e=this.player.textTracks(),t="removeEventListener";e&&e[t]&&(this.config.controlsEnabled&&e[t]("change",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&e[t]("addtrack",this.onAddTrack.bind(this)))},e.prototype.onTextTrackChanged=function(){var e=this.player.getCurrentTextTrack();if(!e||!this.currentTextTrack||this.currentTextTrack.label!==e.label||this.currentTextTrack.mode!==e.mode){if(e||this.currentTextTrack){var t=!!e&&"showing"===e.mode,n=this.getCulture(e||this.currentTextTrack),r=this.getCurrentTime();this.toggleListener.captionsToggled(t,n,r),this.config.logFn("[CaptionsControl]: track changed: culture '".concat(n,"', timestamp '").concat(r,"'"))}this.currentTextTrack=e}},e.prototype.onAddTrack=function(e){var t,n,r=null==e?void 0:e.track;"captions"===(null==r?void 0:r.kind)&&!r.label&&!r.id&&(null===(n=null===(t=this.player)||void 0===t?void 0:t.textTracks_)||void 0===n||n.removeTrack_(r),this.config.logFn("[CaptionsControl]: removing default empty text track"))},e.prototype.getCurrentTime=function(){return this.isHtml5Tech?this.player.currentTime():(this.config.controlsEnabled?this.player.currentTime():this.player.currentMediaTime())||1},e.prototype.getCurrentAbsoluteTime=function(){return this.diagnosticProvider.getCurrentAbsoluteTime()},e.prototype.getCulture=function(e){if(!e)return"";if(e.id){var t=e.id.split("_")[1];if(t)return t}return""},e.prototype.getPlayerTextTracksAsArray=function(){var e=this.player.textTracks();return e&&e.tracks_||[]},e.prototype.containsCue=function(e,t){var n=this;return Array.from((null==e?void 0:e.cues)||[]).some((function(e){return n.areCueEquals(e,t)}))},e.prototype.areCueEquals=function(e,t){function n(e){return{start:e.start?e.start:e.startTime,end:e.end?e.end:e.endTime,text:e.text}}var r=n(e),i=n(t);return r.start===i.start&&r.end===i.end&&r.text===i.text},e}()}function l(){var e=i(),t=r(),n=new e,o=new t(n,document.body);n.registerObserver(o)}Object.defineProperty(t,"__esModule",{value:!0}),t.buildAmpEmbeddedSrc=t.CaptionsControlToggleProvider=t.AmpDiagnosticProvider=t.HlsFileParser=t.HlsAbsoluteTimeOffsetEstimator=t.IFrameMessageHandler=t.AmpCommunicationHandler=t.AmpPlayer=void 0,t.AmpPlayer=n(),t.AmpCommunicationHandler=r(),t.IFrameMessageHandler=i(),t.HlsAbsoluteTimeOffsetEstimator=o(),t.HlsFileParser=a(),t.AmpDiagnosticProvider=s(),t.CaptionsControlToggleProvider=c(),t.buildAmpEmbeddedSrc=function(){var e="(".concat(l.toString(),")();");return e+=n.toString()+";",e+=i.toString()+";",e+=r.toString()+";",e+=c.toString()+";",e+=s.toString()+";",e+=o.toString()+";",e+=a.toString()+";",e+="//# sourceURL=TsCallingAmpPlayer.js"}},2010:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptionsControl=void 0;var i=function(){function e(e,t){var n=this;this.player=e,this.availableCultures=t,this.selectedCulture="",this.disposable=this.player.on("captionsToggled",(function(e,t,r){n.selectedCulture=e?t:""}))}return e.prototype.addCues=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.player.message("addCues").send(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.clearCues=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.player.message("clearCues").send()];case 1:return e.sent(),[2]}}))}))},e.prototype.showCaptions=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.player.message("showCaptions").send(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.getSelectedCulture=function(){return this.selectedCulture},e.prototype.getAvailableCultures=function(){return this.availableCultures},e.prototype.dispose=function(){this.disposable.dispose(),this.player=null},e}();t.CaptionsControl=i},8186:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStream=void 0;var s=n(6144),c=n(3342),l=n(9199),u=n(3261),d=n(1183),p=function(e){function t(t,n,r){var i=e.call(this)||this;return i.configProvider=t,i.logger=n,i.getTelemetryLogger=r,i.isAvailable=!0,i._isStreaming=!1,i.playerSubs=[],i.isFinalTelemetrySent=!1,i.telemetryLogger=i.getTelemetryLogger(),1===i.configProvider.playerConfig.playerType?i.player=new u.HlsHydraLiveStreamPlayer(i.logger.createChild("HlsHydraLiveStreamPlayer"),i.configProvider,i.telemetryLogger):2===i.configProvider.playerConfig.playerType?i.player=new d.UmsHydraLiveStreamPlayer(i.logger.createChild("UmsHydraLiveStreamPlayer"),i.configProvider,i.telemetryLogger):(i.initializeAmpTelemetry(),i.player=new l.AmpLiveStreamPlayer(i.logger.createChild("AmpLiveStreamPlayer"),i.liveStreamStatistic,i.configProvider)),i.subscribeForPlayerEvents(),i}return i(t,e),Object.defineProperty(t.prototype,"isStreaming",{get:function(){return this._isStreaming},enumerable:!1,configurable:!0}),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype.start=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i=this;return a(this,(function(o){switch(o.label){case 0:return[4,this.setOptions(t)];case 1:return o.sent(),this.isFinalTelemetrySent=!1,[4,this.player.loadPlayer(e)];case 2:if(!(n=o.sent()).setupSucceeded)throw this.player.stop(),this.logger.error("playerLoadFailed"),r=JSON.stringify(n.playerSetupError),this.sendFinalTelemetry(r),new Error(r);return this._isStreaming=!0,this.liveStreamStatistic&&(this.statsSub=window.setTimeout((function(){clearTimeout(i.statsSub),i.logger.debug("initial telemetry report after ".concat(i.configProvider.config.sendInitialTelemetryAfterMs," ms")),i.sendTelemetry(!1)}),this.configProvider.config.sendInitialTelemetryAfterMs),this.configProvider.config.sendSnapshotTelemetry&&(this.diagSub=window.setInterval((function(){i.sendSnapshotTelemetry()}),this.configProvider.config.sendSnapshotTelemetryEveryMs))),[2,this.player.getRenderer()]}}))}))},t.prototype.initializeAmpTelemetry=function(){this.liveStreamStatistic=new c.LiveStreamStatistic(this.configProvider.config,this.logger.createChild("LiveStreamStatistic"),{perceivedBandwidth:[],videoBufferLength:[],videoCachedLength:[],videoEdgeLatency:[],playerHeight:[],playerWidth:[],mediaHeight:[],mediaWidth:[],windowHeight:[],windowWidth:[],playbackRate:[],currentPlayPosition:[],currentMediaTime:[],statsInterval:[]})},t.prototype.stop=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},t.prototype.setOptions=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return void 0!==e.overflow&&(e.streamingEventType||(e.streamingEventType=e.overflow?"Overflow":"TLE"),delete e.overflow),this.options=e,[2,this.player.configure(e)]}))}))},t.prototype.getStats=function(){var e,t;return this.liveStreamStatistic?this.liveStreamStatistic.getPlayerDiagnosticSnapshot():null===(t=null===(e=this.player)||void 0===e?void 0:e.getStats)||void 0===t?void 0:t.call(e)},t.prototype.dispose=function(){this.unsubscribeFromPlayerEvents(),this.player.stop(),this.statsSub&&(clearTimeout(this.statsSub),this.statsSub=null),this.diagSub&&(clearInterval(this.diagSub),this.diagSub=null),this.logger.debug("stopping live event"),this.sendFinalTelemetry("graceful disposed"),e.prototype.dispose.call(this)},t.prototype.sendFinalTelemetry=function(e){this.isFinalTelemetrySent||(this.isFinalTelemetrySent=!0,this.sendTelemetry(!0,e))},t.prototype.sendTelemetry=function(e,t){var n,r,i;if(this.liveStreamStatistic)if(this.configProvider.config.sendTelemetry&&this.telemetryLogger){var o={configIds:this.configProvider.configIds,playerId:this.player.playerId,correlationId:null===(n=this.options)||void 0===n?void 0:n.correlationId,eTag:this.configProvider.etag,isFinal:e,threadId:null===(r=this.options)||void 0===r?void 0:r.threadId,disableFullscreenButton:this.configProvider.playerConfig.disableFullscreenButton,callendReason:t},a=null===(i=this.liveStreamStatistic)||void 0===i?void 0:i.getReport(o);this.logger.debug("generated live stream report",a),this.telemetryLogger.sendEvent({eventName:"live_events",props:a})}else this.logger.info("telemetry not sent");else this.logger.info("telemetry not tracked in ILiveStream object")},t.prototype.sendSnapshotTelemetry=function(){var e,t;if(this.liveStreamStatistic)if(this.telemetryLogger){var n=this.liveStreamStatistic.getSnapshotReport({configIds:this.configProvider.configIds,playerId:this.player.playerId,correlationId:null===(e=this.options)||void 0===e?void 0:e.correlationId,eTag:this.configProvider.etag,isFinal:!1,threadId:null===(t=this.options)||void 0===t?void 0:t.threadId,disableFullscreenButton:this.configProvider.playerConfig.disableFullscreenButton});this.logger.debug("sending snapshot telemetry: ",n),this.telemetryLogger.sendEvent({eventName:"live_events",props:n})}else this.logger.error("snapshot telemetry not sent, telemetryLogger is not set");else this.logger.info("telemetry not tracked in ILiveStream object")},t.prototype.subscribeForPlayerEvents=function(){var e=this;this.playerSubs.push(this.player.on("playbackStateChanged",(function(){e.onPlaybackStateChanged()}))),this.playerSubs.push(this.player.on("playbackError",(function(t,n){e.onPlaybackError(t,n)}))),this.playerSubs.push(this.player.on("urlSwitched",(function(t){e.onUrlSwitched(t)}))),this.playerSubs.push(this.player.on("sdnPluginLoadSkipped",(function(t){e.onSdnPluginLoadSkipped(t)}))),this.playerSubs.push(this.player.on("sdnPluginLoadFailed",(function(t){e.onSdnPluginLoadFailed(t)}))),this.playerSubs.push(this.player.on("playbackStarted",(function(){e.onPlaybackStarted()})))},t.prototype.unsubscribeFromPlayerEvents=function(){for(var e=0,t=this.playerSubs;e<t.length;e++){t[e].dispose()}this.playerSubs=[]},t.prototype.onPlaybackStarted=function(){this.event("playbackStarted").raise()},t.prototype.onPlaybackStateChanged=function(){var e=this.player.getPlaybackState();switch(e){case"Start":this.event("playbackStarted").raise();break;case"Ended":this.event("playbackNotLive").raise(),this.sendFinalTelemetry("playback ended");break;case"Seeked":this.event("playbackSeeked").raise(this.player.getCaptionsTimestamp());break;default:this.logger.debug("playbackStateChanged: ".concat(e))}this.event("playbackStateChanged").raise(this.player.getPlaybackState())},t.prototype.onPlaybackError=function(e,t){this.event("error").raise(e,t)},t.prototype.onUrlSwitched=function(e){this.event("urlSwitched").raise(e)},t.prototype.onSdnPluginLoadSkipped=function(e){this.event("sdnPluginLoadSkipped").raise(e)},t.prototype.onSdnPluginLoadFailed=function(e){this.event("sdnPluginLoadFailed").raise(e)},t}(s.default);t.LiveStream=p},5045:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamClient=void 0;var o=n(8186),a=n(2137),s=function(){function e(e,t,n){this.ecsConfig=e,this.logger=t,this.getTelemetryLogger=n}return e.prototype.configure=function(e){this.configuration=e},e.prototype.initialize=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o;return i(this,(function(i){e="MDN_MIDDLELANE_TEAMS",t="liveStream",n=this.ecsConfig.getString(e,t),r={};try{r=JSON.parse(n)}catch(n){this.logger.warn("failed to parse ECS configuration for ".concat(e,"/").concat(t))}return o=this.ecsConfig.getString("ConfigIDs",e),this._configProvider=new a.LiveStreamConfigProvider(r,this.configuration,o,this.logger.createChild("LiveStreamConfigProvider")),[2]}))}))},e.prototype.createLiveStream=function(){return new o.LiveStream(this._configProvider,this.logger.createChild("LiveStream"),this.getTelemetryLogger)},e.prototype.dispose=function(){},e}();t.LiveStreamClient=s},2137:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamConfigProvider=void 0;var o=n(6773),a=n(6439),s={src:["//amp.azure.net/libs/amp/2.3.8.4/azuremediaplayer.min.js","https://amsglob0cdnstream13.azureedge.net/1-0-3013-17/bundles/player-skin.min.js"],css:["https://amsglob0cdnstream13.azureedge.net/1-0-3013-17/bundles/player-skin.min.css","https://statics.teams.cdn.office.net/evergreen-assets/broadcast/video-player.css?v=2"],styles:["azuremediaplayer","amp-stream-skin","amp-big-play-centered"],lang:"en-us",disableFullscreenButton:!1,playerType:0},c={src:["https://azuremdncdnhlsendpoint.azureedge.net/hlsjsv115/hls.js","https://vzmdncdnendpoint.azureedge.net/hlsjsv115/hls.js"],css:[],styles:[],lang:"en-us",disableFullscreenButton:!1,muteVideo:!1,playerType:1,hydraPlayerWebSdkUrls:["https://afdhls.playerscript.prod.ml.cdn.office.net/hlsrt2023-1208-2/hydra_player_hls_bundle.js","https://vzhls.playerscript.prod.ml.cdn.office.net/hlsrt2023-1208-2/hydra_player_hls_bundle.js"]},l={src:[],css:[],styles:[],playerType:2,hydraPlayerWebSdkUrls:["https://afdhls.playerscript.prod.ml.cdn.office.net/umsrt2023-1207-3/hydra_player_ums_bundle.js","https://vzhls.playerscript.prod.ml.cdn.office.net/umsrt2023-1207-3/hydra_player_ums_bundle.js"]},u=function(){function e(e,t,n,r){var i;this.configIds=n,this.logger=r,this.defaultSettings=function(){var e;if("Safari"===(0,a.getBrowserInfo)().engine)e=new p;else e=new d;return e.getSettings()}(),this.logger.info("client settings: ".concat(JSON.stringify(t))),this.defaultSettings.debug=(null==t?void 0:t.debug)||!1,this.defaultSettings.playerType=(null===(i=null==t?void 0:t.playerConfig)||void 0===i?void 0:i.playerType)||this.defaultSettings.playerType,(null==t?void 0:t.playerConfig)&&(0===this.defaultSettings.playerType?this.defaultSettings.ampSettings.liveStreamPlayerConfiguration=t.playerConfig:1===this.defaultSettings.playerType?this.defaultSettings.hlsSettings.liveStreamPlayerConfiguration=t.playerConfig:2===this.defaultSettings.playerType&&(this.defaultSettings.umsSettings.liveStreamPlayerConfiguration=t.playerConfig)),(0,o.mergeWith)(this.defaultSettings,e,h),this.logger.info("applied settings: ".concat(JSON.stringify(this.defaultSettings)))}return Object.defineProperty(e.prototype,"playerConfig",{get:function(){return 0===this.defaultSettings.playerType?this.defaultSettings.ampSettings.liveStreamPlayerConfiguration:1===this.defaultSettings.playerType?this.defaultSettings.hlsSettings.liveStreamPlayerConfiguration:2===this.defaultSettings.playerType?this.defaultSettings.umsSettings.liveStreamPlayerConfiguration:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this.defaultSettings},enumerable:!1,configurable:!0}),e}();t.LiveStreamConfigProvider=u;var d=function(){function e(){this.defaultSettings={allowSdnPlugins:!0,capturePlayerLogs:!0,playerType:0,loadType:1,maxPlayerDiagnosticsCount:50,maxPlayerMemoryTraceLogCount:1e3,maxPlayerPlaybackEventCount:50,maxRetryCount:10,playerTelemetryTickMs:1e3,removeEmptyDefaultTextTrack:!0,sendSnapshotTelemetry:!1,sendSnapshotTelemetryEveryMs:1e4,sendInitialTelemetryAfterMs:6e4,sendTelemetry:!0,textTrackKind:"subtitles",maxRetryCountForLoadingResources:5,maxVideoTrackHistoryLogCount:100,ampSettings:{errorCodesEligibleForStreamingUrlSwitch:[4194309,2097564,2097556,2097752,2097753,5242884],liveStreamPlayerConfiguration:s,sourceResetTimeoutInMs:1e3,streamingUrlSwitchMaxCount:2,resetStreamingUrlSwitchCount:!1,useBrowserWindowSizeForBitRate:!0,estimateAbsoluteTime:!0,maxAbsoluteTimeOffsetEstimationResultsLogCount:100,collectUserInitiatedSeekEventsTelemetry:!0,maxUserInitiatedSeekEventCount:100,noMediaTimeoutMs:-1},hlsSettings:{liveStreamPlayerConfiguration:c,timeoutForSwitchingUrl:9e3,estimateAbsoluteTime:!0,maxAbsoluteTimeOffsetEstimationResultsLogCount:100,playlistInitialSequenceNumber:1,skipNonce:!1,maxStreamConnectionResultsLogCount:100,logHlsJsEvents:!1,logHlsJsEventsEveryMs:5e3,maxPlayerExperimentalEvents:100},umsSettings:{liveStreamPlayerConfiguration:l,timeoutForSwitchingUrl:9e3,maxStreamConnectionResultsLogCount:100,minTargetEdgeLatency:.2,maxEdgeLatencyHistoryLength:300,latencyCompensationThreshold:.5,maxPlayerExperimentalEvents:100}}}return e.prototype.getSettings=function(){return this.defaultSettings},e}(),p=function(e){function t(){var t=e.call(this)||this;return t.settings=e.prototype.getSettings.call(t),t.settings.loadType=0,t.settings.allowSdnPlugins=!1,t.settings.umsSettings.minTargetEdgeLatency=.6,t.settings.umsSettings.latencyCompensationThreshold=.9,t}return i(t,e),t.prototype.getSettings=function(){return this.settings},t}(d);function h(e,t){if((0,o.isArray)(e))return t.slice()}},3645:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamRenderer=void 0;var o=function(e){function t(t,n){var r=e.call(this)||this;return r.player=t,r.logger=n,r.playerSubs=[],r.subscribeForPlayerEvents(),r}return i(t,e),Object.defineProperty(t.prototype,"isRendering",{get:function(){return!!this.player&&this.player.isRendering()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"streamSize",{get:function(){return this.player?this.player.getStreamSize():{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendererType",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frameType",{get:function(){return-1},enumerable:!1,configurable:!0}),t.prototype.seek=function(e){this.player.seek(e)},t.prototype.seekToLiveEdge=function(){this.player.seekToLiveEdge()},t.prototype.play=function(){this.player.play()},t.prototype.pause=function(){this.player.pause()},t.prototype.setVolume=function(e){this.player.setVolume(e)},t.prototype.selectVideoTrack=function(e){this.player.selectVideoTrack(e)},t.prototype.dispose=function(){this.stopPlayer(),e.prototype.dispose.call(this)},t.prototype.captions=function(){return this.player.getCaptionsControl()},t.prototype.getStats=function(){throw new Error("Method not implemented.")},t.prototype.setScalingMode=function(e,t){throw new Error("Method not implemented.")},t.prototype.captureFrame=function(e,t){throw new Error("Method not implemented.")},t.prototype.stopPlayer=function(){var e=this.player;this.player=null,e&&(this.logger.info("stopPlayer"),this.unsubscribeFromPlayerEvents(),e.stop())},t.prototype.subscribeForPlayerEvents=function(){var e=this;this.playerSubs.push(this.player.on("fullscreenToggled",(function(t){return e.onFullScreenToggled(t)}))),this.playerSubs.push(this.player.on("captionsToggled",(function(t,n,r){return e.onCaptionsToggled(t,n,r)}))),this.playerSubs.push(this.player.on("playbackTimeUpdated",(function(t){return e.onPlaybackTimeUpdated(t)}))),this.playerSubs.push(this.player.on("videoTracksChanged",(function(t){return e.onVideoTracksChanged(t)})))},t.prototype.unsubscribeFromPlayerEvents=function(){for(var e=0,t=this.playerSubs;e<t.length;e++){t[e].dispose()}this.playerSubs=[]},t.prototype.onFullScreenToggled=function(e){this.event("fullScreenToggled").raise(e)},t.prototype.onCaptionsToggled=function(e,t,n){this.logger.info("Turned captions ".concat(e?"ON":"OFF"," for culture [").concat(t,"] at player time [").concat(n,"]")),this.event("captionsToggled").raise(e,t,n)},t.prototype.onPlaybackTimeUpdated=function(e){this.event("playbackTimeUpdated").raise(e)},t.prototype.onVideoTracksChanged=function(e){this.event("videoTracksUpdated").raise(e)},t}(n(6144).default);t.LiveStreamRenderer=o},6293:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.setupAmpAndBuildPipe=void 0;var o=n(5442),a=n(5049),s=function(){function e(){}return e.prototype.sendMsg=function(e){this.peer.onMsg(e)},e.prototype.registerObserver=function(e){this.observer=e},e.prototype.onMsg=function(e){this.observer&&this.observer.processMessage(e)},e.prototype.connect=function(e){this.peer=e},e.prototype.dispose=function(){this.peer=null,this.observer=null},e}(),c=function(){function e(e){this.container=e}return Object.defineProperty(e.prototype,"contextWindow",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),e.prototype.sendMsg=function(e){var t,n;null===(n=null===(t=this.iframe)||void 0===t?void 0:t.contentWindow)||void 0===n||n.postMessage(e,"*")},e.prototype.registerObserver=function(e){this.observer=e},e.prototype.dispose=function(){this.contextWindow&&this.contextWindow.removeEventListener("message",this.processMsg),this.iframe&&this.container.hasChildNodes()&&this.container.removeChild(this.iframe),this.iframe=null},e.prototype.initializeAmpIframe=function(e){var t=this.initializeIframe();return this.setAmpIframeContent(e),this.finalizeIframe(t)},e.prototype.initializeIframe=function(){var e=new o.Deferred;return this.iframe=this.container.ownerDocument.createElement("iframe"),this.iframe.id="player-iframe",this.iframe.sandbox.add("allow-scripts"),this.iframe.allowFullscreen=!0,this.iframe.allow="camera; microphone; autoplay",this.iframe.style.height="100%",this.iframe.style.width="100%",this.iframe.style.border="none",this.iframe.onload=function(){e.resolve()},this.iframe.onerror=function(){e.reject("iframe load failed")},e},e.prototype.finalizeIframe=function(e){return this.container.appendChild(this.iframe),this.processMsg=this.processMsg.bind(this),this.contextWindow.addEventListener("message",this.processMsg),e.promise},e.prototype.processMsg=function(e){if("null"===e.origin&&e.source===this.iframe.contentWindow&&this.observer)if("RequestIceCandidates"===e.data)this.observer.processMessage({msgType:"Command",cmd:"getIceCandidates",args:[]});else this.observer.processMessage(e.data)},e.prototype.setAmpIframeContent=function(e){var t=(0,a.buildAmpEmbeddedSrc)(),n=e?"<script nonce='".concat(e,"'> ").concat(t,"<\/script>"):"<script> ".concat(t,"<\/script>"),r="\n            <html class style='height: 100%; width: 100%; overflow: hidden'>\n            <head></head>\n            <body class style='height: 100%; width: 100%; margin: 0px'>\n                ".concat(n,"\n            </body>\n            </html>\n        ");this.iframe.srcdoc=r},e}();t.setupAmpAndBuildPipe=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o,l;return i(this,(function(i){switch(i.label){case 0:return 0===t?(r=new s,o=new s,r.connect(o),o.connect(r),o.registerObserver(new a.AmpCommunicationHandler(o,e)),[2,r]):1!==t?[3,2]:[4,(l=new c(e)).initializeAmpIframe(n)];case 1:return i.sent(),[2,l];case 2:throw new Error("Unsupported communication type ".concat(t))}}))}))}},1374:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerWrapper=void 0;var c=n(5442),l=n(6144),u=n(6293),d=function(e){function t(t){var n=e.call(this,t)||this;return n.logger=t,n.resultsMap=new Map,n.on("log",(function(e,t){n.logger[e](t)})),n}return i(t,e),t.prototype.initialize=function(e,t,n,r){var i;return o(this,void 0,void 0,(function(){var o,s,c;return a(this,(function(a){switch(a.label){case 0:return o={config:n.config,playerConfig:n.playerConfig},s=(null===(i=n.playerConfig)||void 0===i?void 0:i.nonce)||"",c=this,[4,(0,u.setupAmpAndBuildPipe)(e,n.config.loadType,s)];case 1:return c.pipe=a.sent(),this.pipe.registerObserver(this),[4,this.message("configure").send(t,o,r)];case 2:return a.sent(),[2]}}))}))},t.prototype.message=function(e){var t=this;return{send:this.fromMessage((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t.sendMessageImpl.apply(t,s([e],n,!1))}))}},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.pipe.sendMsg(this.buildMsg("dispose")),this.pipe.dispose()},t.prototype.processMessage=function(e){var t,n=this;switch(e.msgType){case"CommandResult":(t=this.getDeferred(e.cmd.toString()))&&(e.error?(t.reject(e.error),this.logger.warn("remote command failed: ".concat(String(e.cmd),", ").concat(e.error))):e.result?t.resolve(e.result):t.resolve(),this.processCommandResult(e),this.resultsMap.delete(e.cmd.toString()));break;case"PlayerNotification":var r=this.event(e.name);r.raise.apply(r,e.args);break;case"Command":this.processCommand(e).catch((function(t){return n.logger.warn("error while processing command: ".concat(JSON.stringify(e),": ").concat(t))}));break;default:this.logger.warn("unexpected message received: ".concat(JSON.stringify(e)))}},t.prototype.processCommand=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return"getIceCandidates"===e.cmd.toString()?[3,1]:[3,3];case 1:return[4,this.message("getIceCandidates").send()];case 2:return t.sent(),[3,4];case 3:this.logger.warn("unsupported command received: ".concat(JSON.stringify(e))),t.label=4;case 4:return[2]}}))}))},t.prototype.processCommandResult=function(e){if("getIceCandidates"===e.cmd.toString())this.pipe.sendMsg({topic:"RequestIceCandidates",candidates:e.result});else this.logger.debug("ignoring command result for: ".concat(JSON.stringify(e)))},t.prototype.fromMessage=function(e){return e},t.prototype.sendMessageImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.pipe.sendMsg(this.buildMsg(e,t)),this.waitForCompletion(e.toString())},t.prototype.buildMsg=function(e,t){return{msgType:"Command",cmd:e,args:t}},t.prototype.getDeferred=function(e){return this.resultsMap.get(e)},t.prototype.waitForCompletion=function(e){var t=this.getDeferred(e);t&&t.reject(new Error("function ".concat(e," is invoked again, before previous call is completed")));var n=new c.Deferred;return this.resultsMap.set(e,n),n.promise},t}(l.default);t.PlayerWrapper=d},6539:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=t.isStreamValid=void 0,t.isStreamValid=function(e){return!!e&&!!e.url&&!!e.decryptionToken},t.assert=function(e,t,n){if(!e&&!n)throw new Error("Assert failed".concat(void 0!==t?": ".concat(t):""))}},3342:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamStatistic=void 0;var i=n(5212),o=n(6539),a=n(3907),s=function(){function e(e,t,n){this.name=e,this.stopCrash=t,this.start(n)}return e.prototype.complete=function(){o.assert(this.startTime,"not started",this.stopCrash),o.assert(void 0===this.duration,"already completed",this.stopCrash),this.duration=Date.now()-this.startTime},e.prototype.updateDetails=function(e,t){if(this.details&&"object"==typeof this.details)for(var n=0;n<e.length;n++)this.details[e[n]]=t[n]},e.prototype.fail=function(e){this.failReason=e,this.complete()},Object.defineProperty(e.prototype,"detail",{set:function(e){this.details=e},enumerable:!1,configurable:!0}),e.prototype.getTelemetryEvent=function(){o.assert(this.startTime,"not started",this.stopCrash);try{o.assert(void 0!==this.duration,"not completed",this.stopCrash)}catch(e){if("SetSource"!==this.name&&"Load"!==this.name)throw e}var e={name:this.name,startTime:this.startTime,duration:this.duration};return this.failReason&&(e.failReason=this.failReason),this.details&&(e.details=this.details),e},e.prototype.start=function(e){o.assert(!this.startTime,"already started",this.stopCrash),this.startTime=Date.now(),this.details=e},e}(),c=function(){function e(e,t,n){var r;this.config=e,this.logger=t,this.playerDiagnosticsLog=n,this.currentScenarioMap=new Map,this.playerEvents=[],this.playbackEvents=[],this.userInitiatedSeekEvents=[],this.experimentalEvents=[],this.clientNetworkType=void 0,this.maxPlayerPlaybackEventCount=e.maxPlayerPlaybackEventCount||5,this.maxPlayerDiagnosticsCount=e.maxPlayerDiagnosticsCount||5,this.maxPlayerMemoryTraceLogCount=e.maxPlayerMemoryTraceLogCount||100,this.maxUserInitiatedSeekEventCount=(null===(r=e.ampSettings)||void 0===r?void 0:r.maxUserInitiatedSeekEventCount)||100,this.stopCrash=e.stopCrash||!1,this.config.debug&&(this.playerDiagnosticsLog.memoryLog=[]),this.addNetworkTypeEventListener()}return e.prototype.getPlayerDiagnosticSnapshot=function(){return this.currentPlayerDiagnosticSnapshot},e.prototype.registerStatsUpdated=function(e){var t=this;this.currentPlayerDiagnosticSnapshot=e,Object.keys(this.playerDiagnosticsLog).forEach((function(n){var r=n,i=t.playerDiagnosticsLog[n];if(Array.isArray(i)){i.push(e[r]);var o="memoryLog"===r&&i.length>t.maxPlayerMemoryTraceLogCount,a="memoryLog"!==r&&i.length>t.maxPlayerDiagnosticsCount;(o||a)&&i.splice(0,1)}else t.playerDiagnosticsLog[n]=e[r]}))},e.prototype.registerEventLoadAttempt=function(e,t){this.registerScenario(e,t)},e.prototype.registerEventLoadFailed=function(e,t){this.completeScenario(e,t)},e.prototype.registerEventLoadSucceeded=function(e,t){this.completeScenario(e,void 0,t)},e.prototype.registerPlayerLoadAttempt=function(){this.registerScenario("Load")},e.prototype.registerPlayerLoadSucceeded=function(e){this.completeScenario("Load",void 0,e)},e.prototype.registerPlayerLoadFailed=function(e){this.completeScenario("Load",e)},e.prototype.registerPlayerSetupAttempt=function(){this.registerScenario("Setup")},e.prototype.registerPlayerSetupSucceeded=function(){this.completeScenario("Setup")},e.prototype.registerPlayerSetupFailed=function(e){this.completeScenario("Setup",e)},e.prototype.registerStreamConnectionAttempt=function(e){this.registerScenario("StreamConnection")},e.prototype.registerStreamConnectionSucceeded=function(){this.completeScenario("StreamConnection")},e.prototype.registerStreamConnectionFailed=function(e){this.completeScenario("StreamConnection",e)},e.prototype.registerSetSourceAttempt=function(e,t){var n=e;t&&(n={src:e,reason:t}),this.registerScenario("SetSource",n)},e.prototype.registerSetSourceSucceeded=function(e){this.getScenario("SetSource").updateDetails(["src"],[e]),this.completeScenario("SetSource")},e.prototype.registerSetSourcedFailed=function(e,t){this.getScenario("SetSource").updateDetails(["src"],[t]),this.completeScenario("SetSource",e)},e.prototype.registerSdnPluginLoad=function(e,t,n){this.registerScenario("SdnPluginLoad",e);var r=t?void 0:n;this.completeScenario("SdnPluginLoad",r)},e.prototype.registerPlayerDestroyed=function(e){this.registerScenario("Destroyed",e),this.completeScenario("Destroyed")},e.prototype.registerPlaybackStateChanged=function(e,t){"Ready"!==e||this.firstReadyStateTimestamp?"Playing"!==e||this.firstPlayingStateTimestamp||(this.firstPlayingStateTimestamp=Date.now()):this.firstReadyStateTimestamp=Date.now();var n=void 0;if(t&&"Buffering"===e){t?n=t.message:this.logger.debug("Unexpected buffering payload: ".concat(JSON.stringify(t)))}this.registerPlaybackEvent("StateChanged",e,n)},e.prototype.registerPlaybackError=function(e,t){this.registerPlaybackEvent("Error",{errorType:e,details:t})},e.prototype.registerDownloadBitratechanged=function(e){this.registerPlaybackEvent("BitrateChangedDownload",e)},e.prototype.registerStreamOptionsConfigured=function(e,t){this.registerPlaybackEvent("StreamOptionsConfigured",this.generateCleanedStreamOption(e),t)},e.prototype.registerPlaybackBitratechanged=function(e){this.registerPlaybackEvent("BitrateChangedPlayback",e)},e.prototype.registerPotentialMediaFreeze=function(e){this.registerPlaybackEvent("PotentialMediaFreeze",e)},e.prototype.registerCaptionToggle=function(e,t,n){var r={isEnabled:e,culture:t,playerTime:n};this.registerPlaybackEvent("CaptionsToggled",r)},e.prototype.registerFullScreenChange=function(e){this.registerPlaybackEvent("FullscreenChanged",e)},e.prototype.registerMute=function(e){this.registerPlaybackEvent("Mute",e)},e.prototype.registerVolumeChange=function(e){this.registerPlaybackEvent("Volume",e)},e.prototype.getExperimentalEvents=function(){return{playback_experimentalEvents:this.prepareForTelemetry(this.experimentalEvents)}},e.prototype.getUserInitiatedSeekEvents=function(){return{playback_userInitiatedSeekEvents:this.prepareForTelemetry(this.userInitiatedSeekEvents)}},e.prototype.getSnapshotReport=function(e){var t,n;void 0===e&&(e={});var o=this.playerEvents.map((function(e){return e.getTelemetryEvent()})),a=this.playbackEvents,s={};return this.currentPlayerDiagnosticSnapshot&&(s=this.filterAndPrepareTelemetry()),r(r(r(r(r(r(r(r(r({isFullReport:!1,configIds:e.configIds||"",playerId:e.playerId||"",correlationId:e.correlationId||"",traceId:e.correlationId?e.correlationId.replace(/-/g,""):"",eTag:e.eTag||"",isFinal:null!==(t=e.isFinal)&&void 0!==t&&t,isIframe:1===this.config.loadType,isFullscreenButtonDisabled:null!==(n=e.disableFullscreenButton)&&void 0!==n&&n,threadId:e.threadId||"",telemetryTickMs:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.statsInterval?this.currentPlayerDiagnosticSnapshot.statsInterval:-1,tsCallingVersion:(0,i.getTsCallingVersion)()||""},this.getInitializationReport(o,a)),this.getPlaybackReport(a)),this.getBitrateReport(a)),this.getSdnReport(o)),this.getSetSourceReport(o)),this.getExperimentalEvents()),this.getUserInitiatedSeekEvents()),{networkType:this.getClientNetworkType(),callSetupSucceeded:this.getCallSetupSucceeded(o),callDropped:this.getCallDropped(a)}),s)},e.prototype.getReport=function(e){var t,n;void 0===e&&(e={});var o=this.playerEvents.map((function(e){return e.getTelemetryEvent()})),a=this.playbackEvents;return r(r(r(r(r(r(r(r(r({callendReason:e.callendReason,isFullReport:!0,configIds:e.configIds||"",playerId:e.playerId||"",correlationId:e.correlationId||"",traceId:e.correlationId?e.correlationId.replace(/-/g,""):"",eTag:e.eTag||"",isFinal:null!==(t=e.isFinal)&&void 0!==t&&t,isIframe:1===this.config.loadType,isFullscreenButtonDisabled:null!==(n=e.disableFullscreenButton)&&void 0!==n&&n,threadId:e.threadId||"",telemetryTickMs:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.statsInterval?this.currentPlayerDiagnosticSnapshot.statsInterval:-1,tsCallingVersion:(0,i.getTsCallingVersion)()||""},this.getInitializationReport(o,a)),this.getPlaybackReport(a)),this.getBitrateReport(a)),this.getSdnReport(o)),this.getSetSourceReport(o)),this.getExperimentalEvents()),this.getUserInitiatedSeekEvents()),{networkType:this.getClientNetworkType(),callSetupSucceeded:this.getCallSetupSucceeded(o),callDropped:this.getCallDropped(a)}),this.getPlayerDiagnosticLog())},e.prototype.registerExperimentalEvent=function(e,t,n){var r=this.createTelemetryEvent(e,t,n);this.experimentalEvents.push(r),this.logTelemetryEvent(r)},e.prototype.registerUserInitiatedSeek=function(e){var t,n=((null===(t=this.currentPlayerDiagnosticSnapshot)||void 0===t?void 0:t.currentPlayPosition)?this.currentPlayerDiagnosticSnapshot.currentPlayPosition:-1)<e.newCurrentPlayPosition,i=r(r({},e),{seekForward:n}),o=this.createTelemetryEvent("UserInitiatedSeek",i);this.userInitiatedSeekEvents.push(o),this.userInitiatedSeekEvents.length>this.maxUserInitiatedSeekEventCount&&this.userInitiatedSeekEvents.splice(0,1)},e.prototype.createTelemetryEvent=function(e,t,n){var r={eventType:e,timestamp:Date.now(),currentPlayPosition:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.currentPlayPosition?this.currentPlayerDiagnosticSnapshot.currentPlayPosition:-1};return void 0!==t&&(r.payload=this.prepareForTelemetry(t)),r.message=n,r},e.prototype.registerPlaybackEvent=function(e,t,n){var r=this.createTelemetryEvent(e,t,n);"Error"===e&&"PlaybackRetried"!==(null==t?void 0:t.errorType)&&(r.fatal=!0),this.playbackEvents.push(r),this.playbackEvents.length>this.maxPlayerPlaybackEventCount&&this.playbackEvents.splice(0,1),this.logTelemetryEvent(r)},e.prototype.getPlayerDiagnosticLog=function(){var e=this;if(!this.currentPlayerDiagnosticSnapshot)return{};var t=this.currentPlayerDiagnosticSnapshot,n=this.playerDiagnosticsLog,i=r(r({},t),n),o={};return Object.keys(i).forEach((function(t){o["player_".concat(t)]=e.prepareForTelemetry(i[t])})),o},e.prototype.getCallSetupSucceeded=function(e){var t=e.find((function(e){return"Load"===e.name}));return!!t&&!t.failReason},e.prototype.getCallDropped=function(e){return!!e.filter((function(e){return"Error"===e.eventType})).find((function(e){return e.fatal}))},e.prototype.getInitializationReport=function(e,t){var n=e.find((function(e){return"Load"===e.name}));return{init_timeLoadToStreamConnectionEstablished:(n&&this.initialStreamConnectionEstablishedTimestamp?this.initialStreamConnectionEstablishedTimestamp-n.startTime:-1)||-1,init_timeLoadToReady:(n&&this.firstReadyStateTimestamp?this.firstReadyStateTimestamp-n.startTime:-1)||-1,init_timeLoadToPlaying:(n&&this.firstPlayingStateTimestamp?this.firstPlayingStateTimestamp-n.startTime:-1)||-1,init_allEvents:this.prepareForTelemetry(e)}},e.prototype.getPlaybackReport=function(e){var t=e.filter((function(e){return"StateChanged"===e.eventType})),n=t.find((function(e){return"Ready"===e.payload})),r=t.find((function(e){return"Play"===e.payload})),i=t.find((function(e){return"Start"===e.payload})),o=t.find((function(e){return"Playing"===e.payload})),a=n&&r?r.timestamp-n.timestamp:-1,s=r&&i?i.timestamp-r.timestamp:-1,c=i&&o?o.timestamp-i.timestamp:-1,l=t.filter((function(e){return"Seeked"===e.payload})),u=t.filter((function(e){return"Seeking"===e.payload})),d=t.filter((function(e){return"Paused"===e.payload})),p=t.filter((function(e){return"Resume"===e.payload})),h=t.filter((function(e){return"Buffering"===e.payload})),g=["BitrateChangedDownload","BitrateChangedPlayback","Error","Mute","StateChanged","Volume","StreamOptionsConfigured"],f=e.filter((function(e){return"Error"===e.eventType})),m=e.filter((function(e){return"Volume"===e.eventType||"Mute"===e.eventType})),_=e.filter((function(e){return"StreamOptionsConfigured"===e.eventType})),y=e.filter((function(e){return!g.includes(e.eventType)}));return{playback_timeReadyToPlay:a,playback_timePlayToStart:s,playback_timeStartToPlaying:c,playback_bufferingEvents:this.prepareForTelemetry(h),playback_errorEvents:this.prepareForTelemetry(f),playback_pauseEvents:this.prepareForTelemetry(d),playback_resumeEvents:this.prepareForTelemetry(p),playback_otherEvents:this.prepareForTelemetry(y),playback_seekedEvents:this.prepareForTelemetry(l),playback_seekingEvents:this.prepareForTelemetry(u),playback_stateChangeEvents:this.prepareForTelemetry(t),playback_volumeEvents:this.prepareForTelemetry(m),playback_streamOptionsConfiguredEvents:this.prepareForTelemetry(_)}},e.prototype.generateCleanedStreamOption=function(e){var t,n,i,o,a,s;return r(r({},e),{stream:r(r({},null==e?void 0:e.stream),{decryptionToken:(null===(t=null==e?void 0:e.stream)||void 0===t?void 0:t.decryptionToken)?"valid":"empty",sdnContext:(null===(n=null==e?void 0:e.stream)||void 0===n?void 0:n.sdnContext)?"valid":"empty",keyAuthorizationToken:(null===(i=null==e?void 0:e.stream)||void 0===i?void 0:i.keyAuthorizationToken)?"valid":"empty"}),altStream:(null==e?void 0:e.altStream)?r(r({},null==e?void 0:e.altStream),{decryptionToken:(null===(o=null==e?void 0:e.altStream)||void 0===o?void 0:o.decryptionToken)?"valid":"empty",sdnContext:(null===(a=null==e?void 0:e.altStream)||void 0===a?void 0:a.sdnContext)?"valid":"empty",keyAuthorizationToken:(null===(s=null==e?void 0:e.stream)||void 0===s?void 0:s.keyAuthorizationToken)?"valid":"empty"}):void 0})},e.prototype.getBitrateReport=function(e){var t=e.filter((function(e){return"BitrateChangedDownload"===e.eventType})),n=t.sort((function(e){return Number(e.payload)})),i=t.length?{bitrate_downloadChanges:this.prepareForTelemetry(t),bitrate_downloadChangeCount:t.length||-1,bitrate_downloadMin:n[0].payload||-1,bitrate_downloadMax:n[n.length-1].payload||-1}:{},o=e.filter((function(e){return"BitrateChangedPlayback"===e.eventType})),a=o.sort((function(e){return Number(e.payload)})),s=o.length?{bitrate_playbackChanges:this.prepareForTelemetry(o),bitrate_playbackChangeCount:o.length||-1,bitrate_playbackMin:a[0].payload||-1,bitrate_playbackMax:a[a.length-1].payload||-1}:{};return r(r({},i),s)},e.prototype.addNetworkTypeEventListener=function(){var e,t,n,r,i=this;(null===(t=null===(e=window.navigator)||void 0===e?void 0:e.connection)||void 0===t?void 0:t.type)&&(null===(r=null===(n=window.navigator)||void 0===n?void 0:n.connection)||void 0===r||r.addEventListener("change",(function(){return i.updateClientNetworkType()})))},e.prototype.updateClientNetworkType=function(){this.clientNetworkType=void 0,this.getClientNetworkType()},e.prototype.getClientNetworkType=function(){var e,t,n,r;if(void 0===this.clientNetworkType){var i="Unknown";if(null===(t=null===(e=window.navigator)||void 0===e?void 0:e.connection)||void 0===t?void 0:t.type)switch(null===(r=null===(n=window.navigator)||void 0===n?void 0:n.connection)||void 0===r?void 0:r.type){case"cellular":i="WWAN";break;case"ethernet":i="Wired";break;case"wifi":i="Wireless";break;default:i="Unknown"}this.clientNetworkType=i}return this.clientNetworkType},e.prototype.getSdnReport=function(e){var t=e.filter((function(e){return"SdnPluginLoad"===e.name})),n=t.length?t[t.length-1]:void 0;return{sdn_loaded:!(!n||void 0!==n.failReason),sdn_details:n&&n.details||"",sdn_error:n&&n.failReason||"",sdn_events:this.prepareForTelemetry(t)}},e.prototype.getSetSourceReport=function(e){var t=e.filter((function(e){return"SetSource"===e.name}));return{set_source_events:this.prepareForTelemetry(t)}},e.prototype.registerScenario=function(e,t){var n=this.currentScenarioMap.get(e),r=new s(e,this.stopCrash,t);o.assert(!n,"previous scenario:".concat((0,a.stringifyObject)(n)," is not completed, new scenario:").concat((0,a.stringifyObject)(r)),this.stopCrash),this.currentScenarioMap.set(e,r),this.playerEvents.push(r)},e.prototype.getScenario=function(e){return this.currentScenarioMap.get(e)},e.prototype.completeScenario=function(e,t,n){var r=this.currentScenarioMap.get(e);o.assert(r,"no scenario to complete",this.stopCrash),t?r.fail(t):("StreamConnection"!==e||this.initialStreamConnectionEstablishedTimestamp||(this.initialStreamConnectionEstablishedTimestamp=Date.now()),n&&(r.detail=n),r.complete()),this.currentScenarioMap.delete(e)},e.prototype.logTelemetryEvent=function(e){this.config.debug&&(this.logger.debug("PlayerTelemetryEvent: ".concat(JSON.stringify(e))),this.logger.debug("PlayerDiagnosticData: ".concat(JSON.stringify(this.currentPlayerDiagnosticSnapshot))))},e.prototype.filterAndPrepareTelemetry=function(){var e=this,t=new Set;t.add("serviceLatencyCdg"),t.add("endToEndLatencyCdg"),t.add("videoEdgeLatencyCdg");var n={};return Object.keys(this.currentPlayerDiagnosticSnapshot).forEach((function(r){t.has(r)||(n["player_".concat(r)]=e.prepareForTelemetry(e.currentPlayerDiagnosticSnapshot[r]))})),n},e.prototype.prepareForTelemetry=function(e){return"boolean"==typeof e?e:"string"==typeof e||void 0===e?e||"":"number"==typeof e?null!=e?e:-1:JSON.stringify(e)},e}();t.LiveStreamStatistic=c},2559:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPIISafeCallInitOptions=t.truncate=t.safeJsonStringify=t.getPrintableObject=t.getPIISafeObject=void 0;var r=n(3607),i=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","phrase","subCode","reason","conversationType"];t.getPIISafeObject=function(e){try{return JSON.parse(JSON.stringify(e,i,4))}catch(e){return{error:"failed to parse object"}}};function o(e){return e||!1===e||""===e||0===e}t.getPrintableObject=function(e,t){if(void 0===t&&(t=!1),null==e)return"void";if(e instanceof Error)return e.toString();if(e instanceof String||e instanceof Number||e instanceof Boolean)return e.toString();try{return e.stack&&(e.stack=function(e){try{return e.split("\n")[0]}catch(e){return"invalid stack"}}(e.stack)),(t?JSON.stringify(e):JSON.stringify(e,i,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(t){return"failed to get error information:".concat(e&&"function"==typeof e.toString&&e.toString()," ").concat((null==e?void 0:e.response)&&JSON.stringify(e.response))}},t.safeJsonStringify=function(e){try{return JSON.stringify(e,null,2)}catch(t){return"failed to stringify obj ".concat(e)}},t.truncate=function(e,t){try{return e.substring(0,length)}catch(t){return e}},t.getPIISafeCallInitOptions=function(e){var t={mediaPeerType:e.mediaPeerType,threadId:(0,r.getLoggableThreadId)(e.threadId)};return o(e.messageId)&&(t.messageId=e.messageId),o(e.enableGroupCallMeetupGeneration)&&(t.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration),o(e.endpointMetadata)&&(t.endpointMetadata=e.endpointMetadata),o(e.onBehalfOf)&&(t.onBehalfOf=(0,r.scrubMriOrOmit)(e.onBehalfOf)),o(e.onBehalfOfUserDisplayName)&&(t.onBehalfOfUserDisplayName=e.onBehalfOfUserDisplayName),o(e.emergencyContent)&&(t.emergencyContent=e.emergencyContent),o(e.isEmergency)&&(t.isEmergency=e.isEmergency),o(e.broadcastContext)&&(t.broadcastContext=e.broadcastContext),e.meetingInfo&&(t.meetingInfo={tenantId:e.meetingInfo.tenantId,organizerId:(0,r.scrubMriOrOmit)(e.meetingInfo.organizerId)},o(e.meetingInfo.meetingType)&&(t.meetingInfo.meetingType=e.meetingInfo.meetingType),o(e.meetingInfo.replyChainMessageId)&&(t.meetingInfo.replyChainMessageId=e.meetingInfo.replyChainMessageId)),e.transferContext&&(t.transferContext={transferorMri:(0,r.scrubMriOrOmit)(e.transferContext.transferorMri),targetMri:(0,r.scrubMriOrOmit)(e.transferContext.targetMri),context:e.transferContext.context},o(e.transferContext.transferType)&&(t.transferContext.transferType=e.transferContext.transferType)),t}},1595:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TsCallingLogger=void 0;var r=n(4132),i=n(6773),o=function(){function e(e,t,n){void 0===n&&(n=""),this.ulLogComponent=e,this.ulSafeComponent=t,this._getPrefix=(0,i.isFunction)(n)?n:function(){return n},this.logComponent=r.LogFactory.instance().component(this.ulLogComponent),r.LogFactory.instance().declareComponentSafe(this.ulLogComponent,t)}return e.prototype.createChild=function(t){var n=this,r=(0,i.isFunction)(t)?t:function(){return t};return new e(this.ulLogComponent,this.ulSafeComponent,(function(){return n._getPrefix()?"".concat(n._getPrefix(),"/").concat(r()):r()}))},e.prototype.log=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.debug2(null,t)}),t)},e.prototype.debug=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.debug4(null,t)}),t)},e.prototype.info=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.debug1(null,t)}),t)},e.prototype.warn=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.warn(null,t)}),t)},e.prototype.error=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.error(null,t)}),t)},e.prototype._apply=function(e,t){void 0===t&&(t=[]),this._addPrefix(t),e(t.map((function(e){return e instanceof DOMException?e.toString():e})).map((function(e){return(0,i.isObject)(e)?JSON.stringify(e):e})).join(", "))},e.prototype._addPrefix=function(e){if(e&&e[0]){var t="".concat(this._getPrefix()," ").concat(e[0]);e[0]=t}},e}();t.TsCallingLogger=o},4218:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RedirectingLogAppender=void 0;var o=n(4132),a=function(e){function t(t){var n=e.call(this,new o.StandardLogFormatter(o.SLF_Flags.Component))||this;return n._logger=t,n}return i(t,e),t.prototype.log=function(e,t,n,r){if(this._logger){var i=e.level<=o.LogLevel.Debug4?this._logger.debug:e.level<=o.LogLevel.Debug2?this._logger.log:e.level<=o.LogLevel.Debug1?this._logger.info:e.level<=o.LogLevel.Warning?this._logger.warn:this._logger.error;i&&i.apply(this._logger,[this.formatter().format(e,t,n,r)])}},t}(o.AbstractLogAppender);t.RedirectingLogAppender=a},8201:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapMediaTypeStringToMediaType=t.getMediaType=t.getMediaLabel=void 0,t.getMediaLabel=function(e){switch(e){case 0:return"main-audio";case 1:return"main-video";case 2:return"applicationsharing-video";case 3:return"data"}throw new Error("Invalid media type")},t.getMediaType=function(e){switch(e){case"main-audio":return 0;case"main-video":return 1;case"applicationsharing-video":return 2;case"data":return 3}throw new Error("Invalid media label")},t.mapMediaTypeStringToMediaType=function(e){switch(e){case"audio":return 0;case"video":return 1;case"applicationsharing-video":return 2;case"data":return 3;default:return}}},7277:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compareMeetingData=t.getMeetingCodeFromMeetingUrl=t.sanitizeMeetingCode=t.isMeetingCodeUrl=void 0;var r=n(2559);function i(e,t,n){if(!e)return n.info("sanitizeMeetingCode[".concat(t,"] empty / undefined meeting code parameter")),e;var r=e.replace(/\s/g,"");return r=r.replace(/-/g,""),n.info("sanitizeMeetingCode[".concat(t,"] meetingCode: ").concat(e,", sanitizedMeetingCode: ").concat(r)),r}function o(e,t,n){if(!e)return n.info("getMeetingCodeFromMeetingUrl[".concat(t,"] empty / undefined meeting Url parameter")),e;var i=new URL(e),o="";if(i&&i.pathname&&i.pathname.split("/").length>=2){var a=i.pathname.split("/");"meet"===a[a.length-2]&&(o=a[a.length-1])}return n.info("getMeetingCodeFromMeetingUrl[".concat(t,"] meetingUrl: ").concat(e,", meetingUrlObject: ").concat((0,r.safeJsonStringify)(i),", meetingCode: ").concat(o)),o}t.isMeetingCodeUrl=function(e){var t=new URL(e).pathname.split("/");return t.pop(),"meet"===t.pop()},t.sanitizeMeetingCode=i,t.getMeetingCodeFromMeetingUrl=o,t.compareMeetingData=function(e,t,n,r){var a=i(e&&e.meetingCode||"",n,r),s=i(t&&t.meetingCode||"",n,r),c=function(e,t){return!!e&&!!t&&e===t};if(c(a,s))return!0;var l=o(e&&e.meetingUrl||"",n,r);l=i(l,n,r);var u=o(t&&t.meetingUrl||"",n,r);if(c(l,u=i(u,n,r)))return!0;if(c(l,s)||c(u,a))return!0;if(e&&e.meetingUrl&&t&&t.meetingUrl){var d=new URL(e.meetingUrl),p=new URL(t.meetingUrl);if(d.hostname===p.hostname&&d.pathname===p.pathname)return!0}return!1}},4147:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getMriType=t.generateAliasedMri=t.stripMriAliases=t.MriTypes=t.BOT_MRI_PREFIX=t.PSTN_MRI_PREFIX=t.MRI_SIP_PREFIX=t.MRI_ALIAS_PREFIX=t.MRI_SKYPE_PREFIX=void 0;var r,i=/;aliases=.*$/i;t.MRI_SKYPE_PREFIX="8:",t.MRI_ALIAS_PREFIX=";aliases=",t.MRI_SIP_PREFIX="2:",t.PSTN_MRI_PREFIX="4:",t.BOT_MRI_PREFIX="28:",function(e){e[e.Skype=0]="Skype",e[e.Sip=1]="Sip",e[e.Pstn=2]="Pstn",e[e.Bot=3]="Bot"}(r||(t.MriTypes=r={}));var o=((n={})[t.MRI_SKYPE_PREFIX]=r.Skype,n[t.MRI_SIP_PREFIX]=r.Sip,n[t.PSTN_MRI_PREFIX]=r.Pstn,n[t.BOT_MRI_PREFIX]=r.Bot,n);t.stripMriAliases=function(e){return e?e.replace(i,""):e},t.generateAliasedMri=function(e,n){var r=e;return n&&(r+=t.MRI_ALIAS_PREFIX+t.MRI_SIP_PREFIX+n),r},t.getMriType=function(e){return o[e.substring(0,e.indexOf(":")+1)]}},6144:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.changed=function(e,t){return this.subscribe({changed:{skipEventConfig:t,handler:e},on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,n){var r,i=this;return r=this.on(e,this._fromEventCallback((function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r.dispose(n),i._toEventCallback(t).apply(void 0,e)}))),r},t.prototype.raiseChanged=function(e){var t=this;this.raiseEvents((function(n){if(n.changed){var r=n.changed,i=r.skipEventConfig,o=r.handler;!t.getShouldSkipChangedEvent(e,i)&&o()}}))},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t._raiseEventImpl.apply(t,o([String(e)],n,!1))}))}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents((function(n){var r;return n.on&&n.on.name===e&&(r=n.on).handler.apply(r,t)}))},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t.prototype.getShouldSkipChangedEvent=function(e,t){return(null==e?void 0:e.skipDominantSpeakerUpdatesOnCall)?!!(null==t?void 0:t.skipDominantSpeakerUpdatesOnCall):!!(null==e?void 0:e.skipParticipantsUpdatesOnCall)&&!!(null==t?void 0:t.skipParticipantsUpdatesOnCall)},t}(n(7289).EventSourceImpl);t.default=a},5005:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.reason=t.callStartOptions=t.causeId=t.operationId=t.participantOperation=t.callOperation=t.IDEMPOTENCY_LEVEL=t.OPERATION_TYPE=void 0;var i,o=n(891),a=n(7584),s=n(6136),c=n(6871),l=n(4545);!function(e){e.CHAINED="Chained",e.SYNC="Sync",e.ASYNC="Async"}(i||(t.OPERATION_TYPE=i={}));var u,d,p="_operationIdValue_",h="_causeIdValue_",g="_callStartOptionsValue_",f="_clientReasonValue_";!function(e){e.NO_OP="NoOp",e.ERROR="Error"}(u||(t.IDEMPOTENCY_LEVEL=u={})),function(e){e[e.CALL=0]="CALL",e[e.PARTICIPANT=1]="PARTICIPANT"}(d||(d={})),t.callOperation=function(e,t,n){return void 0===n&&(n=!1),m(d.CALL,e,t,n)},t.participantOperation=function(e,t){return m(d.PARTICIPANT,e,t)};t.operationId=function(e,t,n){if(e[t][p])throw new Error("can not specify more than one operation id");e[t][p]=n};t.causeId=function(e,t,n){if(e[t][h])throw new Error("can not specify more than one cause id");e[t][h]=n};t.callStartOptions=function(e,t,n){if(e[t][g])throw new Error("can not specify options more than once");e[t][g]=n};t.reason=function(e,t,n){if(e[t][f])throw new Error("can not specify reason more than once");e[t][f]=n};var m=function(e,t,n,d){return void 0===d&&(d=!1),function(m,y,v){var S,C,E,T,I=v.value,P=null===(S=m[y])||void 0===S?void 0:S[p],O=null===(C=m[y])||void 0===C?void 0:C[h],b=null===(E=m[y])||void 0===E?void 0:E[g],A=null===(T=m[y])||void 0===T?void 0:T[f],R=(null==n?void 0:n.type)||i.ASYNC;return v.value=function(){for(var p=this,h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];var f=d?(0,l.default)():(0,a.generateCauseId)();void 0!==O&&(h[O]&&((0,a.validateCauseId)(h[O])||(0,l.validateGuid)(h[O]))?f=h[O]:h[O]=f);var m,y=void 0!==P?h[P]:void 0;if(void 0!==y)if(Array.isArray(y))try{var v=y.map((function(e){return e.toString()})).sort().concat().toString();y=function(e){for(var t=0,n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t}(v).toString()}catch(e){var S="[".concat(y,"]").concat(t," failed in array parsing in operationDecorator"),C={terminatedReason:32,terminatedReasonCode:c.CONSTANTS.CODE.UNKNOWN_ERROR,terminatedReasonSubCode:c.CONSTANTS.SUB_CODE.UNKNOWN_FAILURE,errorMessage:S};return Promise.reject(C)}else if(y&&"object"==typeof y)try{var E=JSON.stringify(y);n&&n.operationIdKey&&y.hasOwnProperty(n.operationIdKey)&&(E=y[n.operationIdKey]),y=E}catch(e){S="[".concat(y,"]").concat(t," failed in object parsing in operationDecorator"),C={terminatedReason:32,terminatedReasonCode:c.CONSTANTS.CODE.UNKNOWN_ERROR,terminatedReasonSubCode:c.CONSTANTS.SUB_CODE.UNKNOWN_FAILURE,errorMessage:S};return Promise.reject(C)}void 0!==A&&h[A]&&(m=h[A]);var T=_(this,e);if(T.logOperation(f,t),n&&n.singular&&T.hasPendingOperation(t))return T.logOperation(f,t,"Not allowed, pending operation exists"),Promise.reject(60);if(n&&n.idempotencyLevel&&T.getRecord(t)>0)switch(T.logOperation(f,t,"Called multiple times, handling operation according to specified policy: idempotency=".concat(n.idempotencyLevel)),n.idempotencyLevel){case u.NO_OP:return Promise.resolve();case u.ERROR:return Promise.reject(60)}try{void 0!==b&&h[b]&&this.processCallStartOptions(h[b],f)}catch(e){S="".concat(t," failed in processCallStartOptions"),C={terminatedReason:32,terminatedReasonCode:c.CONSTANTS.CODE.UNKNOWN_ERROR,terminatedReasonSubCode:c.CONSTANTS.SUB_CODE.UNKNOWN_FAILURE,errorMessage:S};return Promise.reject(C)}var w=!(!n||!n.convertError),D=function(){return R===i.CHAINED?T.executeChained(I.bind.apply(I,r([p],h,!1)),t,y,f,w,m,n):R===i.SYNC?T.executeSync(I.bind.apply(I,r([p],h,!1)),t,y,f,w,m):T.execute(I.bind.apply(I,r([p],h,!1)),t,y,f,w,m,n)};if(t!==o.CALL_OPERATIONS.START_CALL&&t!==o.CALL_OPERATIONS.JOIN_CALL||T.hasPendingOperation(o.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED)||T.createPendingOperation(o.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED).catch(s.noop),n&&n.triggerAttach&&(T.hasPendingOperation(o.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY)||T.createPendingOperation(o.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY).catch(s.noop)),n&&n.type!==i.SYNC){var L=n&&n.waitFor;if(Array.isArray(L))return Promise.all(L.map((function(e){return e&&T.hasPendingOperation(e)&&T.waitForOperation(e,void 0,f)}))).then(D,D);if(L&&T.hasPendingOperation(L))return T.waitForOperation(L,void 0,f).then(D,D)}return D()},v}},_=function(e,t){if(t===d.CALL)return e._callOperationHandler;if(t===d.PARTICIPANT)return e._participantOperationHandler;throw new Error("Unsupported operation handler type!")}},8067:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3607),c=n(3077),l=n(7584),u=n(2321),d=n(4487),p=n(2559),h=n(1165),g=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.callTelemetry=n,a._ecsConfig=r,a._publishCallback=i,a._preconditionFunction=o,a._record={},a.logSuccess=function(e,t,n){a._logger.info("".concat(e," execution succeeded, result=").concat(t?a.stringifyForLogging(t):"void",", time=").concat(n.duration()))},a.logFailure=function(e,t,n){a._logger.info("".concat(e," execution failed, reason=").concat(a.stringifyForLogging(t),", time=").concat(n.duration()))},a.logTimeout=function(e,t,n){a._logger.info("".concat(e," execution timed out, reason=").concat(a.stringifyForLogging(t),", time=").concat(n.duration()))},a.stringifyForLogging=function(e){var t;if(e instanceof Error)t=e.toString()||"Unknown Error";else try{t=JSON.stringify(e)}catch(e){t="Unable to stringify data"}return t},a.convertToTransactionEndIfErrorOrString=function(e,t,n){if(a._logger.info("ecsEnableErrorConversion in operationHandler is: ".concat(a._ecsConfig&&a._ecsConfig.enableErrorConversion)),t&&a._ecsConfig&&a._ecsConfig.enableErrorConversion&&("string"==typeof e||e instanceof Error)){var r=(0,d.getRejectTransactionEnd)(e);return a._logger.info("".concat(n," Error converted from ").concat(e," to ").concat((0,p.getPrintableObject)(r))),r}return e},a._logger=t.createChild("[Operation]"),a._chainedPromise=new u.default(a._logger.createChild("[Chained]")),a}return i(t,e),t.prototype.resetOperationChain=function(e){this._chainedPromise.reset(e)},t.prototype.executeSync=function(e,t,n,r,i,o){void 0===r&&(r=(0,l.generateCauseId)());var a=this.getOperationInfoForLogging(r,t,n),s=h.build();this._logger.info("".concat(a,"API calledSync"));var c,u=this.callTelemetry.recordOperation(t,r,n,o);try{this._setRecord(t),c=e(),u.recordSuccess(c,r),this.logSuccess(a,c,s)}catch(e){var d=this.convertToTransactionEndIfErrorOrString(e,i,a);u.recordFailure(d,r),this.logFailure(a,d,s)}return c},t.prototype.executeChained=function(e,t,n,r,i,s,c){return void 0===r&&(r=(0,l.generateCauseId)()),o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,this.checkPendingOperationAndExecute(e,!0,t,n,r,i,s,c)]}))}))},t.prototype.execute=function(e,t,n,r,i,s,c){return void 0===r&&(r=(0,l.generateCauseId)()),o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,this.checkPendingOperationAndExecute(e,!1,t,n,r,i,s,c)]}))}))},t.prototype.logOperation=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=r.length&&r.map((function(e){return n.stringifyForLogging(s.scrubMriOrOmit(e))}));this._logger.info("[".concat(e.substring(0,8),"][").concat(t,"]API called, ").concat(o?"with args=".concat(o):""))},t.prototype.rejectPendingOperations=function(t,n,r){if(void 0===n&&(n=(0,l.generateCauseId)()),r){for(var i=0,o=Object.keys(this._deferredOperations);i<o.length;i++){var a=o[i];this.callTelemetry.maybeRecordOperationFailure(a,r,void 0,n)}for(var s=0,c=Object.keys(this._deferredOperationsWithOperationId);s<c.length;s++){a=c[s];for(var u=0,d=Object.keys(this._deferredOperationsWithOperationId[a]);u<d.length;u++){var p=d[u];this.callTelemetry.maybeRecordOperationFailure(a,r,p,n)}}}e.prototype.rejectPendingOperations.call(this,t,n)},t.prototype.maybeRejectOperations=function(t,n,r,i,o){if(void 0===i&&(i=(0,l.generateCauseId)()),o)for(var a=0,s=t;a<s.length;a++){var c=s[a];this.callTelemetry.maybeRecordOperationFailure(c,o,void 0,i)}e.prototype.maybeRejectOperations.call(this,t,n,r,i)},t.prototype.checkPendingOperationAndExecute=function(e,t,n,r,i,o,a,s){var c=this;void 0===i&&(i=(0,l.generateCauseId)());var u=this.getOperationInfoForLogging(i,n,r),d=null,p=null;return this.hasPendingOperationWithOperationId(n,r)||this.hasPendingOperation(n)?(this._logger.info("".concat(u,"already pending, returning existing operation")),d=this.waitForOperation(n,r,i)):p=this.createPendingOperation(n,r,i,s),t?(this._logger.info("".concat(u,"chained")),this._chainedPromise.chainPromise((function(){return d||c.executeInternal(p,i,e,n,r,o,a,s)}),n,i)):d||this.executeInternal(p,i,e,n,r,o,a,s)},t.prototype._setRecord=function(e){this._record.hasOwnProperty(e)||(this._record[e]=0),this._record[e]+=1},t.prototype.getRecord=function(e){return this._record[e]},t.prototype._recordTelemetryTimeoutAndPublish=function(e,t,n,r,i,o,a){var s=this,c=e||60;return window.setTimeout((function(){if(s._publishCallback){if(s.hasPendingOperationWithOperationId(r,a)||s.hasPendingOperation(r)){var e=new Error("".concat(i," execution did not complete before telemetry timeout of ").concat(c,"s."));s.logTimeout(i,e,o),s.callTelemetry.maybeRecordOperationTimeout(r,e,a,n),s._publishCallback(t),s.callTelemetry.removeRecordedEvent(t)}}else s._logger.warn("".concat(i," is marked to publish telemetry but no publish callback is defined."))}),1e3*c)},t.prototype._instantTelemetryPublish=function(e,t){this._publishCallback?(this._publishCallback(t),this.callTelemetry.removeRecordedEvent(t)):this._logger.warn("".concat(e," is marked to publish telemetry but no publish callback is defined."))},t.prototype.parseInstantTelemetryParameters=function(e){var t,n=!1;return e&&(n=e.enableInstantTelemetry,t=e.telemetryTimeout),[n,t]},t.prototype.executeInternal=function(e,t,n,r,i,s,c,l){var u;return o(this,void 0,void 0,(function(){var o,d,p,g,f,m,_,y,v,S;return a(this,(function(a){switch(a.label){case 0:o=this.getOperationInfoForLogging(t,r,i),this._logger.info("".concat(o," executing operation...")),d=h.build(),p=this.callTelemetry.recordOperation(r,t,i,c),g=this.parseInstantTelemetryParameters(l),f=g[0],m=g[1],a.label=1;case 1:return a.trys.push([1,3,,4]),this._setRecord(r),_=void 0,f&&(_=this._recordTelemetryTimeoutAndPublish(m,p,t,r,o,d,i)),(null===(u=null==l?void 0:l.preconditionTags)||void 0===u?void 0:u.length)&&this._preconditionFunction&&this._preconditionFunction(r,l.preconditionTags),[4,n()];case 2:return y=a.sent(),_&&clearTimeout(_),this.callTelemetry.maybeRecordOperationSuccess(r,y,i),this.logSuccess(o,y,d),this.maybeResolveOperation(r,y,i,t),[3,4];case 3:return v=a.sent(),S=this.convertToTransactionEndIfErrorOrString(v,s,o),this.callTelemetry.maybeRecordOperationFailure(r,S,i),this.logFailure(o,S,d),this.maybeRejectOperation(r,S,i,t),[3,4];case 4:return f&&this._instantTelemetryPublish(o,p),[2,e]}}))}))},t.prototype.getEcsConfig=function(){return this._ecsConfig},t}(c.default);t.default=g},638:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSharingParticipantLeg=t.getParticipantIdForSourceId=t.getSourceId=t.getSourceIdForMediaType=t.hasStagingGroup=t.findParticipantUsingParticipantLegId=t.findSelfEndpointDetailUsingParticipantLegId=void 0;var r=n(6871),i=n(8201);function o(e,t){var n=-1;try{if(e.endpoints)e:for(var o=0,a=e.endpoints.endpointDetails;o<a.length;o++){var s=a[o];if(null!==s&&void 0!==s.mediaStreams)for(var c=0,l=s.mediaStreams;c<l.length;c++){var u=l[c];if(i.mapMediaTypeStringToMediaType(u.type)===t){n=u.sourceId;break e}}else n=r.DATA_SOURCE_ID_ANY}}catch(e){return-1}return n}function a(e){return"sendonly"===e.direction&&"applicationsharing-video"===e.label}t.findSelfEndpointDetailUsingParticipantLegId=function(e,t){var n;return null===(n=e.endpoints)||void 0===n?void 0:n.endpointDetails.find((function(e){return e.participantId===t}))},t.findParticipantUsingParticipantLegId=function(e,t){return e.participants.find((function(e){return function(e,t){var n,r,i;return null!==(i=null===(r=null===(n=e.endpoints)||void 0===n?void 0:n.endpointDetails)||void 0===r?void 0:r.some((function(e){return e.participantId===t})))&&void 0!==i&&i}(e,t)}))},t.hasStagingGroup=function(e){var t;return!!(null===(t=null==e?void 0:e.meetingGroupDetails)||void 0===t?void 0:t.groups)&&Object.keys(e.meetingGroupDetails.groups).some((function(e){return"stagingGroup"===e}))},t.getSourceIdForMediaType=o,t.getSourceId=function(e,t,n){if(!e||!e.endpoints)return-1;var r=e.endpoints.endpointDetails.find((function(e){return(null==e?void 0:e.participantId)===t}));if(!r)return o(e,n);if(!r.mediaStreams)return o(e,n);var a=r.mediaStreams.find((function(e){var t=e.type;return i.mapMediaTypeStringToMediaType(t)===n}));return a?a.sourceId:-1},t.getParticipantIdForSourceId=function(e,t,n){var r;try{if(!e.endpoints)return;for(var o=0,a=e.endpoints.endpointDetails;o<a.length;o++){var s=a[o];if(null==s?void 0:s.mediaStreams)for(var c=0,l=s.mediaStreams;c<l.length;c++){var u=l[c];if(n===u.sourceId&&i.mapMediaTypeStringToMediaType(u.type)===t)return null!==(r=s.participantId)&&void 0!==r?r:null}}return}catch(e){return}},t.getSharingParticipantLeg=function(e){var t,n;if(null===(t=e.endpoints)||void 0===t?void 0:t.endpointDetails)return 1===e.endpoints.endpointDetails.length?e.endpoints.endpointDetails[0].participantId:null===(n=e.endpoints.endpointDetails.find((function(e){var t;return null===(t=null==e?void 0:e.mediaStreams)||void 0===t?void 0:t.some(a)})))||void 0===n?void 0:n.participantId}},3607:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLoggableThreadId=t.mriOrId=t.scrubMriOrOmitList=t.scrubMriOrOmit=void 0;var r=n(4132);function i(e){return"string"==typeof e?r.pii.Mri(e):r.pii.Omit(e)}t.scrubMriOrOmit=i,t.scrubMriOrOmitList=function(e){return e.forEach(i)},t.mriOrId=function(e){return e&&r.pii.Mri(e)},t.getLoggableThreadId=function(e){var t=function(e){var t="99:";if(e&&e.substr(0,3)===t)return r.pii.Omit(e);return e}(e);return t&&t.substr(0,8)}},4600:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ControlBase=void 0;var s,c,l=n(2227),u=n(2177),d=n(6773),p=n(5442),h=n(961),g=n(4545),f=n(3607),m=n(5212),_=n(4132),y=n(7584),v=n(6871),S=n(8201),C=n(6144),E=n(638),T=n(3907),I=1e4,P="";!function(e){e.INITIATED="Initiated",e.CALL_STATE="CallState",e.SHARING_STARTED="SharingStarted",e.DATA_CHANNEL_AVAILABLE="DataChannelAvailable",e.DATA_CHANNEL_UNAVAILABLE="DataChannelUnavailable",e.CONTROL_GIVEN="ControlGiven",e.CONTROL_REQUEST="ControlRequest",e.AVAILABLE_HANDSHAKE="AvailableHandshake",e.SESSION_SHUTDOWN="Shutdown",e.SESSION_SHUTDOWN_BY_ANOTHER_SESSION="ShutdownByOtherSession"}(s||(s={})),function(e){e.INITIATED="Initiated",e.CALL_STATE="CallState",e.DATA_CHANNEL_AVAILABLE="DataChannelAvailable",e.DATA_CHANNEL_UNAVAILABLE="DataChannelUnavailable",e.GIVE_CONTROL="GiveControl",e.CONTROL_REQUEST="ControlRequest",e.SESSION_SHUTDOWN="Shutdown",e.SESSION_SHUTDOWN_BY_ANOTHER_SESSION="ShutdownByOtherSession",e.AVAILABLE_ACK_ENABLED="AvailableAckEnabled",e.AVAILABLE_ACK_DISABLED="AvailableAckDisabled"}(c||(c={}));var O=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,n,(function(){return s.recordedEvents.length>100}))||this;return s.negotiationTag=r,s.callId=i,s.participantId=o,s.endpointId=a,s.messagesFromUnknownSender={},s.tsCallingVersion=(0,m.getTsCallingVersion)(),s}return i(t,e),t.prototype.recordProtocolMessage=function(e,t){e||(t in this.messagesFromUnknownSender||(this.messagesFromUnknownSender[t]=0),this.messagesFromUnknownSender[t]++)},t.prototype.setCallId=function(e){this.callId=e},t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setParticipantId=function(e){this.participantId=e},t.prototype.setTenantId=function(e){this.tenantId=e},t.prototype.setUserHexCID=function(e){this.userHexCID=e},t}(h.TelemetryUtilities),b=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,t,n,r,i,o,a)||this,l=E.getSharingParticipantLeg(s);if(l){c.sharerParticipantId=l;var u=(0,d.find)(s.endpoints.endpointDetails,(function(e){return e.participantId===l}));u&&(c.sharerClientVersion=u.clientVersion)}return c}return i(t,e),t.prototype.getEvent=function(t,n){var r=function(e){return void 0===e?"":e};return{CorrelationId:r(this.callId),ParticipantId:r(this.participantId),EndpointId:r(this.endpointId),NegotiationTag:r(this.negotiationTag),TsCallingVersion:r(this.tsCallingVersion),TenantId:r(this.tenantId),SharerParticipantId:r(this.sharerParticipantId),SharerClientVersion:r(this.sharerClientVersion),EventTimestampBag:e.prototype.getEventTimestampBag.call(this,t,n),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},t}(O),A=function(e){function t(t,n,r,i,o,a){return e.call(this,t,n,r,i,o,a)||this}return i(t,e),t.prototype.getEvent=function(t,n){var r=function(e){return void 0===e?"":e};return{CorrelationId:r(this.callId),ParticipantId:r(this.participantId),EndpointId:r(this.endpointId),NegotiationTag:r(this.negotiationTag),TsCallingVersion:r(this.tsCallingVersion),TenantId:r(this.tenantId),EventTimestampBag:e.prototype.getEventTimestampBag.call(this,t,n),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},t}(O),R=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o._logger=t,o._call=n,o._telemetryLoggers=r,o._config=i,o.controlState=0,o.role=0,o._enabled=!1,o._availableAckEnabled=!0,o._dataChannelAvailable=!1,o._availableHandshakeSent=!1,o._controlRequest=null,o._controlRequestSubscription=null,o._controllerParticipant=null,o._controllerParticipantSubscription=null,o._controllerSourceId=null,o._screenSharingVideoRenderer=null,o._screenSharingVideoRendererSubscriptions=[],o._sharerParticipant=null,o._pendingSharer=null,o._controlCapturer=null,o._captureEventSubscription=null,o._mouseControlEventSubscription=null,o._keyboardControlEventSubscription=null,o._requestControlTimer=null,o._grantControlTimer=null,o._acceptControlTimer=null,o._terminateControlTimer=null,o._delayedSendHandshakeTimer=null,o._availableAckTimer=null,o._retryAttempt=0,o._raiseRenderedAtViewer=null,o._participantSubscriptions={},o._viewerSessionLastTerminatedReason=0,o._completedViewerSessions=[],o.giveControlEnabled=!0,o.isEscalationInProgress=!1,o._logger.info("constructor"),o._callId=o._call.callId,o._call.on("callIdChanged",(function(e){o._callId=e,o._currentViewerSessionTelemetry&&o._currentViewerSessionTelemetry.setCallId(e),o._currentSharerSessionTelemetry&&o._currentSharerSessionTelemetry.setCallId(e)})),o._participantId=o._call.participantId,o._call.on("callLegIdChanged",(function(e){o._participantId=e,o._currentViewerSessionTelemetry&&o._currentViewerSessionTelemetry.setParticipantId(e),o._currentSharerSessionTelemetry&&o._currentSharerSessionTelemetry.setParticipantId(e)})),o._endpointId=o._call.endpointId,o}return i(t,e),t.prototype.setAdapters=function(e,t,n){var r=this;this._controlInjector=e,this._rendererAdapter=t,this._dataChannelAdapter=n,this._dataChannelAdapter.on("stateChange",(function(e){r._onDataChannelStatusChanged(e)})),this._dataChannelAdapter.on("protocolMessage",(function(e,t,n,i){return r.processProtocolMessage(e,t,n,i)})),this._dataChannelAdapter.on("controlMessage",(function(e,t){return r.processControlMessage(e,t)}))},t.prototype.testSetControlInjector=function(e){},t.prototype.enableScreenSharingControl=function(e,t,n,r){if(this._logger.info("enableScreenSharingControl() enabled=".concat(e," disabledReason=").concat(t)),this._availableAckEnabled!==e||this._allowControlForUser!==r){if(this._allowControlForUser=r,e)this._raiseScreenSharingControlCapableEvent(!0,P);else{if(0===t){var i={reason:2,detail:n};this.event("sharingControlError").raise(i)}this._raiseScreenSharingControlCapableEvent(!1,P)}if(this._availableAckEnabled!==e){var o=e?c.AVAILABLE_ACK_ENABLED:c.AVAILABLE_ACK_DISABLED;this._recordSharerSessionTelemetry((function(e){return e.recordEvent(o)}),!1)}this._availableAckEnabled=e}},t.prototype.setGiveControlEnabled=function(e){this.giveControlEnabled=e},t.prototype._canEnableGiveControl=function(){return this._controlInjector.canBeEnabled()&&this.giveControlEnabled},t.prototype.setRaiseRenderedAtViewer=function(e){this._raiseRenderedAtViewer=e},t.prototype.setScreenSharingControlFeatureFlag=function(e){this._logger.info("setScreenSharingControlFeatureFlag() enabled=".concat(e)),this._enabled=e,this._availableAckEnabled=e,this._enabled&&this._handleCallState(this._callState)},t.prototype.isScreenSharingControlEnabled=function(){return this._enabled},t.prototype._disposeRenderer=function(e){this._disposeControlCapturer(e);for(var t=0,n=this._screenSharingVideoRendererSubscriptions;t<n.length;t++){n[t].dispose()}this._screenSharingVideoRendererSubscriptions=[],this._screenSharingVideoRenderer=null},t.prototype.setRenderer=function(e,t){var n=this;this._logger.info("setRenderer");var r=(0,y.generateCauseId)();if(this._disposeRenderer(r),!e)return Promise.resolve();var i=t||this._rendererAdapter.getTarget(e);return(0,p.asap)((function(){n._setViewingRenderer(e,i)}))},t.prototype._isDataChannelActive=function(){return this._dataChannelAdapter.isActive()&&this._dataChannelAvailable},t.prototype._raiseScreenSharingControlCapableEvent=function(e,t,n){if(this._enabled&&this._isDataChannelActive()){this._logger.info("_raiseScreenSharingControlCapableEvent() enabled=true, capable=".concat(e,", role=").concat(this.role));var r={capable:e,id:t,disabledBySharer:n};this.event("sharingControlCapable").raise(r)}else{this._logger.info("_raiseScreenSharingControlCapableEvent() enabled=false, capable=".concat(e,", role=").concat(this.role));r={capable:!1,id:t};this.event("sharingControlCapable").raise(r)}},t.prototype.initControlForSharer=function(e){this._logger.info("initControlForSharer()"),this._isSharing()&&this._logger.warn("initControlForSharer() when already sharing"),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this._logger.info("role is changing from=".concat(this.role," to=").concat(1)),this.role=1,this._availableHandshakeSent=!1,this._raiseScreenSharingControlCapableEvent(this._canEnableGiveControl(),P),this._initiateSharerSessionTelemetry(e)},t.prototype.enableControlInjector=function(e){var t=this;this._logger.info("enableControlInjector() trackId: ".concat(e)),this._canEnableGiveControl()?this._controlInjector.enableInjector(e).catch((function(e){var n={reason:0,detail:JSON.stringify({errorMsg:e})};t.event("sharingControlError").raise(n)})):this._logger.info("enableControlInjector() give control cannot be enabled")},t.prototype.shutdownControlForSharer=function(){var e=this;if(this._logger.info("shutdownControlForSharer()"),this._isSharing()||this._logger.warn("shutdownControlForSharer() when not sharing"),this._controlRequest){this._logger.warn("Rejecting pending control requests");var t=this._getDataSourceIdForParticipantLeg(this._controlRequest),n=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(n),this._sendControlRejectRequest(5,t)}if(this._controllerParticipant){var r={inControl:!1,id:this._controllerParticipant.participant.id,terminatedReason:5};this.event("sharingControlChanged").raise(r)}this._finalizeSharerSessionTelemetry(c.SESSION_SHUTDOWN),this._teardownSharerRemoteControl(),this._controlInjector.disableInjector().catch((function(t){var n={reason:0,detail:JSON.stringify({errorMsg:t})};e.event("sharingControlError").raise(n)})),this._resetControlState(),this._resetParticipantSubscriptions(),this._availableAckEnabled=this._enabled,this._logger.info("role is changing from=".concat(this.role," to=").concat(0)),this.role=0},t.prototype._resetParticipantSubscriptions=function(){this._logger.info("resetParticipantSubscriptions() Stopping tracking all participant state changes"),(0,d.each)(this._participantSubscriptions,(function(e){e.dispose()})),this._participantSubscriptions={}},t.prototype._initiateViewerSessionTelemetry=function(e,t,n){if(!n&&!t)return null;if(!n&&(0,d.find)(this._completedViewerSessions,(function(e){return t===e})))return null;if(this._currentViewerSessionTelemetry){if(this._currentViewerSessionTelemetry.negotiationTag===t)return null;this._finalizeViewerSessionTelemetry(s.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}return this._logger.info("Initiating new viewer session telemetry for ".concat(t)),this._currentViewerSessionTelemetry=new b(this._logger,(new Date).getTime(),t,this._callId,this._participantId,this._endpointId,e),this._currentViewerSessionTelemetry.recordEvent(s.CALL_STATE,{state:this._callState}),this._isDataChannelActive()&&this._currentViewerSessionTelemetry.recordEvent(s.DATA_CHANNEL_AVAILABLE),this._currentViewerSessionTelemetry},t.prototype._recordViewerSessionTelemetry=function(e,t){void 0===t&&(t=!0),this._currentViewerSessionTelemetry?e&&e(this._currentViewerSessionTelemetry):t&&this._logger.error("Cannot record telemetry without current session")},t.prototype._finalizeViewerSessionTelemetry=function(e){if(this._currentViewerSessionTelemetry){this._currentViewerSessionTelemetry.recordEvent(e);var t=this._currentViewerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_viewer_session",t),this._currentViewerSessionTelemetry.negotiationTag&&this._completedViewerSessions.push(this._currentViewerSessionTelemetry.negotiationTag),this._currentViewerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentViewerSessionTelemetry.messagesFromUnknownSender).length&&_.RootToolsManager.logExternalForDDL("ScreenSharingControl_viewer: messages received from unkonwn sender",JSON.stringify(t.ProtocolMessages)),this._currentViewerSessionTelemetry=null}},t.prototype._initiateSharerSessionTelemetry=function(e){if(this._currentSharerSessionTelemetry){if(this._currentSharerSessionTelemetry.negotiationTag===e)return null;this._finalizeSharerSessionTelemetry(c.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}this._logger.info("Initiating new sharer session telemetry for ".concat(e)),this._currentSharerSessionTelemetry=new A(this._logger,(new Date).getTime(),e,this._callId,this._participantId,this._endpointId),this._isDataChannelActive()&&this._currentSharerSessionTelemetry.recordEvent(c.DATA_CHANNEL_AVAILABLE)},t.prototype._recordSharerSessionTelemetry=function(e,t){void 0===t&&(t=!0),this._currentSharerSessionTelemetry?e&&e(this._currentSharerSessionTelemetry):t&&this._logger.error("Cannot record telemetry without current session")},t.prototype._finalizeSharerSessionTelemetry=function(e){if(this._currentSharerSessionTelemetry){this._currentSharerSessionTelemetry.recordEvent(e);var t=this._currentSharerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_sharer_session",t),this._currentSharerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentSharerSessionTelemetry.messagesFromUnknownSender).length&&_.RootToolsManager.logExternalForDDL("ScreenSharingControl_sharer: messages received from unkonwn sender",JSON.stringify(t.ProtocolMessages)),this._currentSharerSessionTelemetry=null}},t.prototype._sendTelemetryEvent=function(e,t){var n,r,i=this;this._logger.info("Sending event ".concat(e,": ")),Object.keys(t).forEach((function(e){i._logger.info("     ".concat(e," => ").concat(t[e]))})),null===(r=null===(n=this._telemetryLoggers)||void 0===n?void 0:n.media)||void 0===r||r.sendEvent({eventName:e,props:t})},t.prototype._recordProtocolMessage=function(e,t){this._currentViewerSessionTelemetry&&this._currentViewerSessionTelemetry.recordProtocolMessage(e,t),this._currentSharerSessionTelemetry&&this._currentSharerSessionTelemetry.recordProtocolMessage(e,t)},t.prototype.reportSharingSessionChangeForViewer=function(e,t){t&&this._initiateViewerSessionTelemetry(e,t,!1)},t.prototype.initControlForViewer=function(e,t){if(this._logger.info("initControlForViewer(".concat(f.scrubMriOrOmit(null==e?void 0:e.id),", ").concat(t,")")),e){if(this._isViewing()&&this._logger.warn("initControlForViewer: called when already viewing"),3!==this._callState)return this._logger.info("initControlForViewer: postponed until call is connected, callState=".concat(this._callState)),this._pendingNegotiationTag=t,void(this._pendingSharer=e);var n=!this._sharerParticipant||this._sharerParticipant&&this._sharerParticipant.id!==e.id||t!==this._currentNegotiationTag;this._currentNegotiationTag=t,this._logger.info("role is changing from=".concat(this.role," to=").concat(2)),this.role=2,this._sharerParticipant?this._sharerParticipant.id!==e.id&&(this._recordViewerSessionTelemetry((function(e){return e.recordEvent(s.SESSION_SHUTDOWN_BY_ANOTHER_SESSION,null,t)})),this._logger.info("initControlForViewer: sharer switched, new sharer id=".concat(f.scrubMriOrOmit(e.id))),this._availableHandshakeSent=!1,4===this.controlState&&this._terminateControl(!1)):(this._logger.info("initControlForViewer: setting sharer to id=".concat(f.scrubMriOrOmit(e.id))),this._sharerParticipant=e,this._availableHandshakeSent=!1),this._initiateViewerSessionTelemetry(e,t,!0),n&&this._recordViewerSessionTelemetry((function(e){return e.recordEvent(s.SHARING_STARTED)})),this._enabled&&this._isDataChannelActive()&&!this._availableHandshakeSent&&(this._resetControlState(),this._sharerParticipant=e,this._logger.info("initControlForViewer: sending Available message to sharer"),this._startAvailableHandshake())}else this._logger.warn("initControlForViewer: Sharer undefined, ignoring")},t.prototype.shutdownControlForViewer=function(e){var t;this._logger.info("shutdownControlForViewer()"),this._pendingSharer=null;var n=!1;if(e&&e.id!==(null===(t=this._sharerParticipant)||void 0===t?void 0:t.id)||(this._logger.info("shutdownControlForViewer: setting shouldShutdownControlForViewer to true, isViewing: ".concat(this._isViewing())),n=!0),n&&this._isViewing()){if(1===this.controlState){if(this._sharerParticipant){var r=this._getSharerDataSourceId();this._sendRequest({action:2,terminatedReason:6},r)}else this._logger.warn("shutdownControlForViewer: sharer participant is null");var i={inControl:!1,id:P,terminatedReason:6};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:i,details:""}))):this._logger.error("shutdownControlForViewer: Unexpected, no promise could be resolved, controlState=RequestSent")}else if(4===this.controlState){i={inControl:!1,id:P,terminatedReason:6};this.event("sharingControlChanged").raise(i)}this._teardownViewerRemoteControl(),this._resetControlState(),this._screenSharingVideoRenderer=null,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._availableHandshakeSent=!1,this._finalizeViewerSessionTelemetry(s.SESSION_SHUTDOWN),2===this.role?(this._logger.info("_raiseScreenSharingControlCapableEvent  with user role=".concat(this.role,", MRI=").concat(P,", isCapable=false")),this._raiseScreenSharingControlCapableEvent(!1,P)):this._logger.warn("can't call _raiseScreenSharingControlCapableEvent, role=".concat(this.role)),this._logger.info("role is changing from=".concat(this.role," to=").concat(0)),this.role=0}},t.prototype._resetControlRequest=function(e){this._clearControlRequest(),this._controlRequest=e,this._registerParticipantListener(e),3===e.participantState&&(this._logger.info("participantState: Connected, raising: sharingIncomingControlRequest for participantId: ".concat(e.participant.id)),this.event("sharingIncomingControlRequest").raise(e.participant.id))},t.prototype._clearControlRequest=function(){this._logger.info("_clearControlRequest()"),this._stopListeningToParticipantChanges(this._controlRequest),this._controlRequest=null},t.prototype._stopListeningToParticipantChanges=function(e){this._controlRequestSubscription&&(this._logger.info("_stopListeningToParticipantChanges: stopping tracking changes for ".concat(e.participant.id)),this._controlRequestSubscription.dispose(),this._controlRequestSubscription=null)},t.prototype._registerParticipantListener=function(e){var t=this;this._logger.info("_registerParticipantListener: tracking changes for ".concat(e.participant.id)),this._logger.info("request.participantState: ".concat(e.participantState," | request.participant.state: ").concat(e.participant.state)),this._controlRequestSubscription=e.participant.changed((function(){if(e.participant.state!==e.participantState)switch(t._logger.info("request.participantState about to changed from: ".concat(e.participantState," to: ").concat(e.participant.state)),e.participantState=e.participant.state,e.participantState){case 3:t.event("sharingIncomingControlRequest").raise(e.participant.id),t._logger.info("participantState: Connected, raising: sharingIncomingControlRequest for participantId: ".concat(e.participant.id));break;case 0:case 5:case 4:t.denyControlRequest().catch((function(e){t._logger.info("It is ok if denyControlRequest rejects here as screensharing may have just been stopped. Err: ".concat(e))})),t._logger.info("_registerParticipantListener: participant ".concat(e.participant.id," is no longer connected. resetting")),t._clearControlRequest(),t._raiseControlRequestCanceled(e);break;case 1:case 2:case 6:case 7:t._logger.info("participantState: ".concat(e.participantState,", participantId: ").concat(e.participant.id));break;default:t._logger.error("_registerParticipantListener: Unexpected participantState ".concat(e.participantState," unhandled"))}}))},t.prototype._resetControllerParticipant=function(e){var t=this;this._controllerParticipantSubscription&&(this._logger.info("_resetControllerParticipant: stopping tracking changes for ".concat(this._controllerParticipant.participant.id)),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),e&&(this._logger.info("_resetControllerParticipant: tracking changes for ".concat(e.participant.id)),this._controllerParticipantSubscription=e.participant.changed((function(){3!==e.participant.state&&t.handleParticipantRemoved(e.participant.id)}))),this._controllerParticipant=e},t.prototype.handleParticipantRemoved=function(e){if(this._participantSubscriptions[e]&&(this._logger.info("handleParticipantRemoved(): Stopping tracking state changes for ".concat(e)),this._participantSubscriptions[e].dispose(),delete this._participantSubscriptions[e]),this._isSharing()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===e){this._logger.info("handleParticipantRemoved: controller left call, tearing down control session"),this._teardownSharerRemoteControl(),this.controlState=0,this._resetControllerParticipant();var t={inControl:!1,id:e,terminatedReason:5};this.event("sharingControlChanged").raise(t)}this._raiseScreenSharingControlCapableEvent(!1,e)}else if(this._sharerParticipant&&this._sharerParticipant.id===e&&4===this.controlState){this._logger.info("handleParticipantRemoved: sharer left call, tearing down control session"),this._teardownViewerRemoteControl(),this.controlState=0;t={inControl:!1,id:P,terminatedReason:6};this.event("sharingControlChanged").raise(t)}},t.prototype.callStateChanged=function(e){this._callState=e,this._recordViewerSessionTelemetry((function(t){return t.recordEvent(s.CALL_STATE,{state:e})}),!1),this._recordSharerSessionTelemetry((function(t){return t.recordEvent(c.CALL_STATE,{state:e})}),!1),this.isScreenSharingControlEnabled()&&this._handleCallState(e)},t.prototype.setIsEscalationInProgress=function(e){this.isEscalationInProgress=e},t.prototype._getHandshakeDelay=function(){var e,t;if(!(null===(e=this._config.handshakeSendDelay)||void 0===e?void 0:e.minParticipantThreshold))return 0;var n=0;if(this._call.participants.length>=this._config.handshakeSendDelay.minParticipantThreshold)for(var r=0,i=this._call.participants;r<i.length;r++){(null===(t=i[r].endpoints)||void 0===t?void 0:t.endpointDetails.some((function(e){return"interactive"===e.appliedInteractivityLevel})))&&n++}if(n<=this._config.handshakeSendDelay.minParticipantThreshold)return 0;var o=Math.ceil((n-this._config.handshakeSendDelay.minParticipantThreshold)/this._config.handshakeSendDelay.increaseEveryN);return Math.min(this._config.handshakeSendDelay.maxDelay,o*this._config.handshakeSendDelay.delayPerN)},t.prototype._handleCallState=function(e){switch(e){case 3:this._handleCallConnected();break;case 7:this._handleCallDisconnected();break;case 4:case 5:this.shutdownControlForViewer()}},t.prototype._handleCallConnected=function(){this._logger.info("_handleCallConnected()"),this._pendingSharer&&(this.initControlForViewer(this._pendingSharer,this._pendingNegotiationTag),this._pendingSharer=null)},t.prototype._handleCallDisconnected=function(){this._logger.info("_handleCallDisconnected()"),this._isSharing()?this.shutdownControlForSharer():this.shutdownControlForViewer()},t.prototype._videoSizeChanged=function(e,t){null!==this._controlCapturer&&this._controlCapturer.updateVideoSize(e,t)},t.prototype._onRenderStarted=function(){if(this._sharerParticipant){var e=this._getSharerDataSourceId();this._sendRequest({action:11,terminatedReason:0},e)}else this._logger.error("Attempted to send sharing rendered message to null sharerParticipant")},t.prototype._setViewingRenderer=function(e,t){var n=this;try{this._screenSharingVideoRenderer=e,this._screenSharingVideoRendererSubscriptions.push(this._rendererAdapter.subscribeVideoSizeChangedEvent(this._screenSharingVideoRenderer,(function(e,t){n._videoSizeChanged(e,t)}))),this._screenSharingVideoRendererSubscriptions.push(this._rendererAdapter.subscribeRenderStartedEvent(this._screenSharingVideoRenderer,(function(){n._onRenderStarted()})));var r=1;e.streamSize&&e.streamSize.width>0&&e.streamSize.height>0&&(r=e.streamSize.width/e.streamSize.height),this._controlCapturer=new l.SlimCoreElectronControlCapturer(this._logger,t,!0,r),4===this.controlState?(this._logger.info("_setViewingRenderer: detected local state is controlling"),this._setupViewerRemoteControl()):this._teardownViewerRemoteControl()}catch(e){this._logger.error("_setViewingRenderer: unable to set _screenSharingVideoRenderer error=".concat(e))}},t.prototype._onDataChannelStatusChanged=function(e){this._logger.info("_onDataChannelStatusChanged(): Data channel status=".concat(e,", isEscalationInProgress=").concat(this.isEscalationInProgress)),e?this._dataChannelAvailable||(this._dataChannelAvailable=!0,this._recordViewerSessionTelemetry((function(e){return e.recordEvent(s.DATA_CHANNEL_AVAILABLE)}),!1),this._recordSharerSessionTelemetry((function(e){return e.recordEvent(c.DATA_CHANNEL_AVAILABLE)}),!1),this._enabled&&(this._isViewing()?this._availableHandshakeSent||(this._sharerParticipant?(this._logger.info("_onDataChannelStatusChanged: sending Available message to sharer"),this._startAvailableHandshake()):this._logger.error("Unexpected null _sharerParticipant trying to send Available to sharer")):this._isSharing()&&(this.isEscalationInProgress||this._raiseScreenSharingControlCapableEvent(!0,P)))):this._dataChannelAvailable&&(this._recordViewerSessionTelemetry((function(e){return e.recordEvent(s.DATA_CHANNEL_UNAVAILABLE)}),!1),this._recordSharerSessionTelemetry((function(e){return e.recordEvent(c.DATA_CHANNEL_UNAVAILABLE)}),!1),this._dataChannelAvailable=!1,this._availableHandshakeSent=!1,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(3),this.isEscalationInProgress||this._raiseScreenSharingControlCapableEvent(!1,P))},t.prototype._isSharing=function(){return 1===this.role},t.prototype._isViewing=function(){return 2===this.role},t.prototype._handleAvailableRequest=function(e,t,n){var r=this,i=!1,o=0;if(this._enabled)if(this._availableAckEnabled)if(this._canEnableGiveControl())if(null==t?void 0:t.id){if(this._allowControlForUser&&typeof this._allowControlForUser==typeof Function)return void this._allowControlForUser(t).then((function(a){a||(i=!0,o=1),r._sendResponseToAvailableRequest(e,t,n,i,o)}))}else i=!0,o=10;else this._logger.info("GiveControl is not enabled. no need to answer the available ack"),i=!0,o=9;else this._logger.info("Available ack is off. no need to answer the available ack"),i=!0,o=9;else this._logger.info("Feature flag is off. no need to answer the available ack"),i=!0,o=9;this._sendResponseToAvailableRequest(e,t,n,i,o)},t.prototype._sendResponseToAvailableRequest=function(e,t,n,r,i){var o=this;r?(this._logger.info("Rejecting Available for handShake:".concat(n,":").concat(e.handshakeId)),this.event("controlAvailableHandshake").raise(e.handshakeId,n,7,this._getAvailableHandshakeTerminatedFromControlTerminated(i)),this._sendRequest({action:10,terminatedReason:i,handshakeId:e.handshakeId},n)):(this._raiseScreenSharingControlCapableEvent(!0,t.id),this._participantSubscriptions[t.id]||(this._logger.info("Tracking participant status for ".concat(t.id)),this._participantSubscriptions[t.id]=t.changed((function(){3!==t.state&&(o._logger.info("Participant ".concat(t.id," is not connected. removing")),o.handleParticipantRemoved(t.id))}))),this._logger.info("Acking Available for handShake:".concat(n,":").concat(e.handshakeId)),this.event("controlAvailableHandshake").raise(e.handshakeId,n,3),this._sendRequest({action:9,terminatedReason:0,handshakeId:e.handshakeId},n))},t.prototype.processProtocolMessage=function(e,t,n,r){var i=this;return(0,p.asap)((function(){i._processProtocolMessage(e,t,n,r)}))},t.prototype._raiseControlRequestCanceled=function(e){this.event("sharingIncomingControlRequestCancelled").raise(e.participant.id)},t.prototype._handleControlRequest=function(e,t,n){this._recordSharerSessionTelemetry((function(e){e.recordOperation(c.CONTROL_REQUEST,null,String(t))})),this._enabled?this._controlRequest?(this._logger.warn("Sharer is already processing a control request...rejecting new requests"),this._sendControlRejectRequest(3,t)):this._controllerParticipant&&this._controllerParticipant.participant===e?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==n?(this._logger.warn("rejecting control request from second endpoint. participantId: ".concat(n)),this._sendControlRejectRequest(3,t)):(this._logger.warn("Got control request for someone already in control"),this._resetControllerParticipant(),this._resetControlRequest({participant:e,participantState:e.state,participantId:n})):e?(this._logger.info("resetControlRequest for participantId: ".concat(n)),this._resetControlRequest({participant:e,participantState:e.state,participantId:n})):this._logger.error("Got ControlRequest message but could not find a sender participant, ignoring"):(this._logger.warn("Sharer control is disabled - rejecting request"),this._sendControlRejectRequest(9,t))},t.prototype._handleAcceptRequest=function(e,t){if(1===this.controlState){var n=this._sendRequest({action:5,terminatedReason:0},t);this._logger.info("_handleAcceptRequest controlMessage.action: ".concat(w(e.action)," _sendRequest isSent: ").concat(n)),n?(this._setupViewerRemoteControl(),this.controlState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error("Unexpected, no promise could be resolved - controlState=RequestSent action=".concat(w(e.action))),this._recordViewerSessionTelemetry((function(e){e.recordOperationSuccess(s.CONTROL_REQUEST,null)}))):this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control is accepted, but failed to send ack"}))):this._logger.error("Unexpected, no promise could be resolved - controlState=".concat(D(this.controlState)," action=").concat(w(e.action))),this._cancelRequestControlTimer()}else this._logger.warn("AcceptRequest message received in controlState=".concat(D(this.controlState)))},t.prototype._handleRejectRequest=function(e){if(1===this.controlState){this._logger.info("_handleRejectRequest: controlState: ".concat(D(this.controlState),", about to be changed to: ").concat(D(0))),this.controlState=0;var t={inControl:!1,id:P,terminatedReason:e.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:""}))):this._logger.error("Unexpected, no promise could be resolved - controlState=RequestSent action=".concat(w(e.action))),this._recordViewerSessionTelemetry((function(t){t.recordOperationFailure(s.CONTROL_REQUEST,{reason:L(e.terminatedReason)})})),this._cancelRequestControlTimer()}else this._logger.warn("RejectRequest message received in controlState=".concat(D(this.controlState)," reason=").concat(e.terminatedReason))},t.prototype._handleCancelControlRequest=function(e,t){if(this._logger.info("_handleCancelControlRequest action=".concat(w(e.action)," sender=").concat(t,", controlRequest participantId: ").concat(this._controlRequest.participantId,", controlRequest participantState: ").concat(this._controlRequest.participantState,":")),this._controlRequest){var n=this._controlRequest;this._logger.info("_handleCancelControlRequest action=".concat(w(e.action)," sender=").concat(t,", about to raise: _raiseControlRequestCanceled state: ").concat(this._controlRequest.participantState," ")),this._recordSharerSessionTelemetry((function(e){e.recordOperationTimeout(c.CONTROL_REQUEST,{participantId:t},String(t))})),this._clearControlRequest(),this._raiseControlRequestCanceled(n)}},t.prototype._handleGiveControl=function(e,t,n){var r=this._sendRequest({action:5,terminatedReason:0},t);if(this._logger.info("_handleGiveControl: controlMessage.action: ".concat(w(e.action)," _sendRequest isSent: ").concat(r)),r){this._setupViewerRemoteControl(),this._logger.info("controlState: ".concat(D(this.controlState),", about to be changed to: ").concat(D(4))),this.controlState=4,this._recordViewerSessionTelemetry((function(e){e.recordEvent(s.CONTROL_GIVEN,{sender:t})}));var i={inControl:!0,id:P,terminatedReason:e.terminatedReason};this.event("sharingControlChanged").raise(i)}},t.prototype._handleAck=function(e,t,n){if(2===this.controlState)if(this._controllerParticipant&&this._controllerParticipant.participant===t){var r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);n!==r&&this._logger.warn("acknowledging source id: ".concat(n," does not match requesting source id: ").concat(r)),this._logger.info("Setting up remote control for controller source id=".concat(r)),this._setupSharerRemoteControl(r),this._logger.info("controlState: ".concat(D(this.controlState),", about to be changed to: ").concat(D(3))),this.controlState=3;var i={inControl:!0,id:this._controllerParticipant.participant.id,terminatedReason:e.terminatedReason};this.event("sharingControlChanged").raise(i),this._grantControlPromise?(this._grantControlPromise.resolve(),this._cancelGrantControlTimer(),this._recordSharerSessionTelemetry((function(e){e.recordOperationSuccess(c.GIVE_CONTROL,{participantId:r})}))):this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer(),this._recordSharerSessionTelemetry((function(e){e.recordOperationSuccess(c.CONTROL_REQUEST,{participantId:r},String(r))}))):this._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForControlAck action=".concat(w(e.action)))}else t?this._logger.warn("Ignoring ack from participant that does not match controller id=".concat(f.scrubMriOrOmit(t.id))):this._logger.warn("Ignoring ack from null participant source id=".concat(n));else 5===this.controlState?(this._logger.info("controlState: ".concat(D(this.controlState),", about to be changed to: ").concat(D(0))),this.controlState=0,this._resetControllerParticipant(),this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._cancelTerminateControlTimer()):this._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForTerminateAck action=".concat(w(e.action)))):this._logger.warn("Unexpected ack in control controlState=".concat(D(this.controlState)))},t.prototype._handleTerminate=function(e,t,n){var r;this._isViewing()?(this._teardownViewerRemoteControl(),r=P):(this._teardownSharerRemoteControl(),t?r=t.id:this._logger.error("Got terminate message but could not find a sender participant!")),this._logger.info("controlMessage action: ".concat(w(e.action),", controllerId: ").concat(r)),this._logger.info("controlState: ".concat(D(this.controlState),", about to be changed to: ").concat(D(0))),this.controlState=0,this._resetControllerParticipant();var i={inControl:!1,id:r,terminatedReason:e.terminatedReason};this.event("sharingControlChanged").raise(i),8===e.action&&this._sendRequest({action:5,terminatedReason:0},n)},t.prototype._handleAvailableAck=function(e){this._terminateAvailableHandshake&&(this._logger.info("_handleAvailableAck: terminate available handshake reason: ".concat(1,",handshakeId: ").concat(e.handshakeId)),this._terminateAvailableHandshake(1,e.handshakeId)),2===this.role?this._raiseScreenSharingControlCapableEvent(!0,P):this._logger.info("Ignoring AvailableAck as viewer session is not initialized, role: ".concat(this.role))},t.prototype._handleAvailableNack=function(e){this._logger.info("_handleAvailableNack: action=".concat(w(e.action)," terminate reason: ").concat(L(e.terminatedReason))),this._viewerSessionLastTerminatedReason=e.terminatedReason,this._recordViewerSessionTelemetry((function(t){t.updateOperationData(s.AVAILABLE_HANDSHAKE,{nackReason:e.terminatedReason},e.handshakeId)})),10!==e.terminatedReason?(this._terminateAvailableHandshake&&(this._terminateAvailableHandshake(this._getAvailableHandshakeTerminatedFromControlTerminated(e.terminatedReason),e.handshakeId),this._logger.info("_handleAvailableNack: terminateAvailableHandshake reason=".concat(L(e.terminatedReason)))),1===e.terminatedReason?(this._logger.warn("_handleAvailableNack: control terminate reason: SharerDenied"),this._raiseScreenSharingControlCapableEvent(!0,P,!0)):this._raiseScreenSharingControlCapableEvent(!1,P)):this._logger.warn("_handleAvailableNack: control terminate reason: UnknownSender")},t.prototype._handleRenderedAtViewer=function(e,t){this._raiseRenderedAtViewer&&(t?(this._logger.info("raiseRenderedAtViewer senderId=".concat(t.id,", action=").concat(w(e.action))),this._raiseRenderedAtViewer(t.id)):this._logger.error("Got RenderedAtViewer message but could not find a sender participant!"))},t.prototype._processProtocolMessage=function(e,t,n,r){var i;this._recordProtocolMessage(t,r);try{i=JSON.parse(e)}catch(e){return void this._logger.error("Error parsing controlMessage")}switch(t||this._logger.warn("protocol message from unknown sender with sourceId=".concat(r)),this._logger.info("_processProtocolMessage action=".concat(w(i.action),", sourceId=").concat(r)),i.action){case 0:this._handleAvailableRequest(i,t,r);break;case 1:this._handleControlRequest(t,r,n);break;case 3:this._handleAcceptRequest(i,r);break;case 4:this._handleRejectRequest(i);break;case 2:this._handleCancelControlRequest(i,r);break;case 6:this._handleGiveControl(i,r,t);break;case 5:this._handleAck(i,t,r);break;case 8:case 7:this._handleTerminate(i,t,r);break;case 9:this._handleAvailableAck(i);break;case 10:this._handleAvailableNack(i);break;case 11:this._handleRenderedAtViewer(i,t);break;default:this._logger.error("Unknown request action received on control protocol data sink, action=".concat(w(i.action)))}},t.prototype._getAvailableHandshakeTerminatedFromControlTerminated=function(e){switch(e){case 10:return 6;case 1:return 7;default:return 0}},t.prototype._sendRequest=function(e,t){if(t<0)return this._logger.warn("Unexpected: invalid sourceID=".concat(t)),!1;this._logger.info("_sendRequest() action=".concat(w(e.action)," recipient sourceid=").concat(t));var n={type:0,message:JSON.stringify(e)},r=[t];return this._dataChannelAdapter.sendProtocolMessage((0,T.stringToBuffer)(JSON.stringify(n)),r),!0},t.prototype.processControlMessage=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return t!==this._controllerSourceId?(this._logger.debug("Ignoring control message, wrong sourceId. Expected: ".concat(t,", got: ").concat(this._controllerSourceId)),[2]):3!==this.controlState?(this._logger.debug("Ignoring control message, wrong controlState. Expected: RemoteControlling, got: ".concat(D(this.controlState))),[2]):[2,this._processControlMessage(e,t)]}))}))},t.prototype._processControlMessage=function(e,t){return this._controlInjector.injectRawInput(e,t)},t.prototype._resetControlState=function(){this._logger.info("_resetControlState()"),this.controlState=0,this._resetControllerParticipant(),this._sharerParticipant=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer()},t.prototype._setupSharerRemoteControl=function(e){var t=this;this._logger.info("_setupSharerRemoteControl() sourceId=".concat(e)),this._controllerSourceId=e,this._controlInjector.showVirtualCursor(e).catch((function(n){var r={reason:3,detail:JSON.stringify({sourceId:e,errorMsg:n})};t.event("sharingControlError").raise(r)}))},t.prototype._teardownSharerRemoteControl=function(){var e=this;this._logger.info("_teardownSharerRemoteControl()"),this._controllerSourceId=null,this._controlInjector.showVirtualCursor(0).catch((function(t){var n={reason:3,detail:JSON.stringify({sourceId:0,errorMsg:t})};e.event("sharingControlError").raise(n)}))},t.prototype._setupViewerRemoteControl=function(){this._logger.info("_setupViewerRemoteControl()"),this._setCapturerMode(3)},t.prototype._teardownViewerRemoteControl=function(){this._logger.info("_teardownViewerRemoteControl()"),this._setCapturerMode(0)},t.prototype._clearCapturerEventSubscriptions=function(){this._logger.info("_clearCapturerEventSubscriptions()"),this._captureEventSubscription&&(this._captureEventSubscription.dispose(),this._captureEventSubscription=null),this._mouseControlEventSubscription&&(this._mouseControlEventSubscription.dispose(),this._mouseControlEventSubscription=null),this._keyboardControlEventSubscription&&(this._keyboardControlEventSubscription.dispose(),this._keyboardControlEventSubscription=null)},t.prototype.sendRemoteControlEvent=function(e,t){if(t)switch(e){case"mouseControlEvent":this._sendControlEvent(u.ScreenSharingControlProtocol.encodeMouseEvent(t));break;case"keyboardControlEvent":this._sendControlEvent(u.ScreenSharingControlProtocol.encodeKeyboardEvent(t));break;default:return void this._logger.error("sendRemoteControlEvent: Invalid type=",e)}else this._logger.error("sendRemoteControlEvent: Invalid argument.")},t.prototype._sendControlEvent=function(e){if(this._isDataChannelActive()&&this._sharerParticipant&&4===this.controlState){var t=[this._getSharerDataSourceId()];this._dataChannelAdapter.sendControlMessage(e,t)}else this._logger.error("_sendControlEvent: Dropping message - No data channel or wrong controlState. dataConnected: ".concat(this._isDataChannelActive()," controlState: ").concat(D(this.controlState),")"))},t.prototype._setCapturerMode=function(e){var t=this;this._logger.info("_setCapturerMode() capturerMode=".concat(e)),this._controlCapturer?(this._controlCapturer.setCaptureMode(e),this._clearCapturerEventSubscriptions(),1===e?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(e){0===e&&t.event("sharingRendererClicked").raise()})):2===e?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(e){1===e?t.event("sharingRendererMouseEntering").raise():2===e&&t.event("sharingRendererMouseLeaving").raise()})):3===e&&(this._mouseControlEventSubscription=this._controlCapturer.on("mouseControlEvent",(function(e){t._sendControlEvent(u.ScreenSharingControlProtocol.encodeMouseEvent(e))})),this._keyboardControlEventSubscription=this._controlCapturer.on("keyboardControlEvent",(function(e){t._sendControlEvent(u.ScreenSharingControlProtocol.encodeKeyboardEvent(e))})),this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(e){1===e?t.event("sharingRendererMouseEntering").raise():2===e&&t.event("sharingRendererMouseLeaving").raise()})))):this._logger.info("_controlCapturer not set, relying on external controlCapturer")},t.prototype.setPointerImage=function(e,t){return this._logger.warn("setPointerImage is deprecated. Use setLocalPointerImage or setRemotePointerImage"),e?this.setRemotePointerImage(e,t):this.setLocalPointerImage(t)},t.prototype.setLocalPointerImage=function(e){return 0===e.length?Promise.reject(new Error("setLocalPointerImage invalid image length")):this._setPointerImage(0,e)},t.prototype.setRemotePointerImage=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(a){switch(a.label){case 0:if(!e)throw new Error("setRemotePointerImage participant is null");if(0===t.length)throw new Error("setRemotePointerImage invalid image length");if(0===(n=this._getParticipantsDataSourceIds(e)).length)throw new Error("setRemotePointerImage unable to map participant to sourceIds");this._logger.info("set pointer image for ".concat(n.length," sources")),r=0,i=n,a.label=1;case 1:return r<i.length?(o=i[r],[4,this._setPointerImage(o,t)]):[3,4];case 2:a.sent(),a.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}))},t.prototype._setPointerImage=function(e,t){return this._isSharing()||this._logger.warn("_setPointerImage called when not sharing"),this._controlInjector.setPointerImage(e,t)},t.prototype.startPointerMode=function(){var e=this;return this._enabled?this._isDataChannelActive()?0!==this.controlState?Promise.reject(new Error("startPointerMode called in bad control controlState=".concat(D(this.controlState)))):this._isViewing()?(0,p.asap)((function(){e._setCapturerMode(2)})):Promise.reject(new Error("startPointerMode when not viewing")):Promise.reject(new Error("startPointerMode when data channel not active")):Promise.reject(new Error("startPointerMode when feature not enabled"))},t.prototype.stopPointerMode=function(){var e=this;return 0!==this.controlState?Promise.reject(new Error("stopPointerMode called in bad control controlState=".concat(D(this.controlState)))):this._isViewing()?(0,p.asap)((function(){e._setCapturerMode(1)})):Promise.reject(new Error("stopPointerMode when not viewing"))},t.prototype._startAvailableHandshake=function(){var e,t=this,n=this._getSharerDataSourceId(),r=(0,g.default)(),i=this._getHandshakeDelay(),o=Math.floor(Math.random()*i);if(this._logger.info("_startAvailableHandshake() - handshakeId: ".concat(n,":").concat(r," ").concat(o>0?"delay: ".concat(o,"ms maxDelay: ").concat(i,"ms"):"","}")),this._terminateAvailableHandshake&&(this._logger.warn("Replacing existing availble handshake"),this._terminateAvailableHandshake(4)),this._recordViewerSessionTelemetry((function(e){return e.recordOperation(s.AVAILABLE_HANDSHAKE,r)})),n<0)this._logger.warn("_startAvailableHandshake() - sharer: ".concat(f.scrubMriOrOmit(null===(e=this._sharerParticipant)||void 0===e?void 0:e.id)," has no data channel, retrying later")),this._waitForAvailableAck(r);else{var a=function(){t.event("controlAvailableHandshake").raise(r,n,1),t._sendRequest({action:0,terminatedReason:0,handshakeId:r},n)||t._logger.error("Failed to send Available message to sharer, will retry after backoff"),t._waitForAvailableAck(r)};o>0?(this._delayedSendHandshakeTimer=window.setTimeout(a,o),this._recordViewerSessionTelemetry((function(e){e.updateOperationData(s.AVAILABLE_HANDSHAKE,{delay:o,maxDelay:i},r)}))):a()}this._availableHandshakeSent=!0,this._terminateAvailableHandshake=function(e,i){void 0===e&&(e=0),t._logger.info("_terminateAvailableHandshake() - handshakeId: ".concat(n,":").concat(r,", status: ").concat(e)),t._recordViewerSessionTelemetry((function(e){e.updateOperationData(s.AVAILABLE_HANDSHAKE,{tries:t._retryAttempt},i)})),1===e?t._recordViewerSessionTelemetry((function(e){e.recordOperationSuccess(s.AVAILABLE_HANDSHAKE,null,"",i)})):(t._logger.error("GTC handshake terminated with code ".concat(e,", last terminated reason: ").concat(L(t._viewerSessionLastTerminatedReason))),_.RootToolsManager.logExternalForDDL("GTC handshake terminated with code ".concat(e,","),t._viewerSessionLastTerminatedReason.toString()),t._recordViewerSessionTelemetry((function(t){t.recordOperationFailure(s.AVAILABLE_HANDSHAKE,{reason:e},"",i)}))),t._terminateAvailableHandshake=null,t.event("controlAvailableHandshake").raise(r,n,1===e?5:6,e),i&&i!==r&&t._logger.warn("AvailableSeries: Got handshake from another series - expected: ".concat(r,", received: ").concat(i)),t._availableAckTimer&&(clearTimeout(t._availableAckTimer),t._availableAckTimer=null),t._delayedSendHandshakeTimer&&(clearTimeout(t._delayedSendHandshakeTimer),t._delayedSendHandshakeTimer=null),t._retryAttempt=0}},t.prototype._waitForAvailableAck=function(e){var t=this;this._logger.info("_waitForAvailableAck()"),this._availableAckTimer=window.setTimeout((function(){var n;t._logger.warn("No Ack received for Available message from attempt=".concat(t._retryAttempt)),t._availableAckTimer=null;var r=t._getSharerDataSourceId();if(t._retryAttempt<=6)r>=0?(t._logger.info("Re-sending Available message handshakeId: ".concat(r,":").concat(e)),t.event("controlAvailableHandshake").raise(e,r,2),t._sendRequest({action:0,terminatedReason:0,handshakeId:e},r)):t._logger.warn("_waitForAvailableAck() - sharer: ".concat(f.scrubMriOrOmit(null===(n=t._sharerParticipant)||void 0===n?void 0:n.id)," has no data channel, retrying later")),t._waitForAvailableAck(e);else if(t._logger.error("Reached Available retry limit! Control capability will be false"),t._terminateAvailableHandshake)t._terminateAvailableHandshake(5);else{var i={reason:4,detail:JSON.stringify({sourceId:r,errorMsg:"Timed out after ".concat(t._retryAttempt," tries")})};t.event("sharingControlError").raise(i)}}),2e3*++this._retryAttempt)},t.prototype.requestControl=function(){return this._enabled?this._isDataChannelActive()?0!==this.controlState?Promise.reject(new Error("requestControl called in bad controlState=".concat(D(this.controlState)))):this._isViewing()?this._sharerParticipant?this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while requesting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while requesting control")):this._requestControl():Promise.reject(new Error("requestControl unexpected null sharer")):Promise.reject(new Error("requestControl when not viewing")):Promise.reject(new Error("requestControl when data channel not active")):Promise.reject(new Error("requestControl when feature not enabled"))},t.prototype._requestControl=function(){var e=this;this._logger.info("_requestControl(), controlState: ".concat(this.controlState)),this._requestControlPromise=new p.Deferred;var t=function(){e._requestControlPromise=null};this._requestControlPromise.promise.then(t,t);var n=this._getSharerDataSourceId();if(!this._sendRequest({action:1,terminatedReason:0},n)){var r={inControl:!1,id:P,terminatedReason:7};return this._requestControlPromise.reject(new Error),this._logger.error("_requestControl(): failed to send the request."),Promise.reject(new Error(JSON.stringify({controlInfo:r,details:""})))}return this._recordViewerSessionTelemetry((function(e){return e.recordOperation(s.CONTROL_REQUEST,"")})),this.controlState=1,this._requestControlTimer=window.setTimeout((function(){if(1===e.controlState){e.controlState=0,e._logger.warn("No response to control request - canceling"),e._sendRequest({action:2,terminatedReason:2},n)||e._logger.error("Failed to send the cancel control request");var t={inControl:!1,id:P,terminatedReason:2};e._recordViewerSessionTelemetry((function(e){e.recordOperationTimeout(s.CONTROL_REQUEST,null)})),e._requestControlPromise?e._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:"we did not get any response to the control - terminating control"}))):e._logger.error("Unexpected, no promise could be resolved - controlState=RequestSent")}else e._requestControlPromise?e._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control - times out in bad state - do nothing"}))):e._logger.error("Unexpected, no promise could be resolved - controlState=".concat(D(e.controlState)));e._requestControlTimer=null}),3e4),this._requestControlPromise.promise},t.prototype._cancelRequestControlTimer=function(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(new Error("cancelled by _cancelRequestControlTimer")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)},t.prototype.cancelControl=function(){return this._enabled?this._isDataChannelActive()?1!==this.controlState?Promise.reject(new Error("cancelControl called in bad state=".concat(D(this.controlState)))):this._isViewing()?this._sharerParticipant?this._requestControlPromise?this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while cancelling control")):this._cancelControl():Promise.reject(new Error("Request control promise has been resolved while cancelling control")):Promise.reject(new Error("cancelControl unexpected null sharer")):Promise.reject(new Error("cancelControl when not viewing")):Promise.reject(new Error("cancelControl when data channel not active")):Promise.reject(new Error("cancelControl when feature not enabled"))},t.prototype._cancelControl=function(){this._logger.info("_cancelControl()");var e=this._getSharerDataSourceId();if(1!==this.controlState)return Promise.reject(new Error("Cancel control - in bad state - do nothing"));if(this._cancelRequestControlTimer(),this.controlState=0,this._logger.info("Viewer cancels the control"),!this._sendRequest({action:2,terminatedReason:8},e))return Promise.reject(new Error("Failed to send cancel control request"));var t={inControl:!1,id:P,terminatedReason:8};return this._recordViewerSessionTelemetry((function(e){e.recordOperationFailure(s.CONTROL_REQUEST,{reason:L(t.terminatedReason)})})),this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:""}))),new Promise((function(e,t){e()}))},t.prototype.acceptControlRequest=function(){return this._enabled?this._isDataChannelActive()?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("Accept control promise has not been resolved yet while accepting control")):this._grantControlPromise?Promise.reject(new Error("Grant control promise has not been resolved yet while accepting control")):this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while accepting control")):this._acceptControlRequest():Promise.reject(new Error("acceptControlRequest when not sharing")):Promise.reject(new Error("acceptControlRequest while no control request pending")):Promise.reject(new Error("acceptControlRequest when data channel not active")):Promise.reject(new Error("acceptControlRequest when feature not enabled"))},t.prototype._acceptControlRequest=function(){var e=this;this._logger.info("_acceptControlRequest()"),this._acceptControlPromise=new p.Deferred;var t=function(){e._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(t,t),this._controllerParticipant){this._logger.warn("_acceptControlRequest called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var n=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},n)||this._logger.error("Failed to send the terminateNoAck request"),this._resetControllerParticipant()}var r=this._getDataSourceIdForParticipantLeg(this._controlRequest),i=this._controlRequest.participant.id;return this._sendControlAcceptRequest(r)?(this._resetControllerParticipant(this._controlRequest),this._clearControlRequest(),this.controlState=2,this._acceptControlTimer=window.setTimeout((function(){if(2===e.controlState){e.controlState=0,e._resetControllerParticipant(),e._recordSharerSessionTelemetry((function(e){e.recordOperationTimeout(c.CONTROL_REQUEST,{participantId:r},String(r))})),e._logger.error("No ack received when accepting control request - terminating control"),e._sendRequest({action:7,terminatedReason:4},r)||e._logger.error("Failed to send the TerminateNoAck request");var t={inControl:!1,id:i,terminatedReason:4};e.event("sharingControlChanged").raise(t),e._acceptControlPromise?e._acceptControlPromise.reject(new Error("No ack received when accept control - terminating control")):e._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForControlAck")}else e._acceptControlPromise?e._acceptControlPromise.reject(new Error("accept control - times out in bad state - do nothing")):e._logger.error("Unexpected, no promise could be resolved - controlState=".concat(D(e.controlState)));e._acceptControlTimer=null}),I),this._acceptControlPromise.promise):(this._logger.error("Failed to send the accept control request"),this._acceptControlPromise.reject(new Error),Promise.reject(new Error("Failed to send the accept control request!")))},t.prototype._sendControlAcceptRequest=function(e){var t=this._sendRequest({action:3,terminatedReason:0},e);return this._recordSharerSessionTelemetry((function(t){t.updateOperationData(c.CONTROL_REQUEST,{status:"accepting",participantId:e},null,String(e))})),t},t.prototype._sendControlRejectRequest=function(e,t){var n=this._sendRequest({action:4,terminatedReason:e},t);return this._recordSharerSessionTelemetry((function(n){n.recordOperationFailure(c.CONTROL_REQUEST,{participantId:t,reason:L(e)},String(t))})),n},t.prototype._cancelAcceptControlTimer=function(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(new Error("cancelled by _cancelAcceptControlTimer")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)},t.prototype.denyControlRequest=function(){return this._enabled?this._isDataChannelActive()?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("Accept control promise has not been resolved yet while denying control")):this._grantControlPromise?Promise.reject(new Error("Grant control promise has not been resolved yet while denying control")):this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while denying control")):this._denyControlRequest():Promise.reject(new Error("denyControlRequest when not sharing")):Promise.reject(new Error("denyControlRequest while no control request pending")):Promise.reject(new Error("denyControlRequest when data channel not active")):Promise.reject(new Error("denyControlRequest when feature not enabled"))},t.prototype._denyControlRequest=function(){this._logger.info("_denyControlRequest()");var e=this._getDataSourceIdForParticipantLeg(this._controlRequest);return this._clearControlRequest(),this._sendControlRejectRequest(1,e)?Promise.resolve():Promise.reject(new Error("Failed to send the deny control requst"))},t.prototype.grantControl=function(e){return this._enabled?this._isDataChannelActive()?this._controlRequest?Promise.reject(new Error("grantControl called while control request pending")):this._isSharing()?e?this._acceptControlPromise?Promise.reject(new Error("Accept control promise has not been resolved yet while granting control")):this._grantControlPromise?Promise.reject(new Error("Grant control promise has not been resolved yet while granting control")):this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while granting control")):this._grantControl(e):Promise.reject(new Error("grantControl null participant")):Promise.reject(new Error("grantControl when not sharing")):Promise.reject(new Error("grantControl when data channel not active")):Promise.reject(new Error("grantControl when feature not enabled"))},t.prototype._grantControl=function(e){var t=this;this._logger.info("_grantControl()"),this._grantControlPromise=new p.Deferred;var n=function(){t._grantControlPromise=null};if(this._grantControlPromise.promise.then(n,n),3===this.controlState){if(this._controllerParticipant.participant===e)return this._logger.warn("_grantControl called for participant who already has control"),this._grantControlPromise.resolve(),new Promise((function(e,t){e()}));this._logger.warn("_grantControl called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},r)||this._logger.error("Failed to send the terminateNoAck request")}var i=this._mapParticipantToSourceId(e),o=this._sendRequest({action:6,terminatedReason:0},i);if(this._recordSharerSessionTelemetry((function(e){e.recordOperation(c.GIVE_CONTROL,null)})),!o)return this._logger.error("Failed to send the grant control request"),this._grantControlPromise.reject(new Error),Promise.reject(new Error("Failed to send the grant control request!"));var a=this._getParticipantIdForDataSourceId(e,i);return this._resetControllerParticipant({participant:e,participantState:e.state,participantId:a}),this.controlState=2,this._grantControlTimer=window.setTimeout((function(){2===t.controlState?(t.controlState=0,t._resetControllerParticipant(),t._logger.error("No ack received when granting control - terminating control"),t._sendRequest({action:7,terminatedReason:4},i)||t._logger.error("Failed to send the terminateNoAck request"),t._recordSharerSessionTelemetry((function(e){e.recordOperationTimeout(c.GIVE_CONTROL,null)})),t._grantControlPromise?t._grantControlPromise.reject(new Error("No ack received when granting control - terminating control")):t._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForControlAck")):t._grantControlPromise?t._grantControlPromise.reject(new Error("Grant control - times out in bad state - do nothing")):t._logger.error("Unexpected, no promise could be resolved - controlState=".concat(D(t.controlState)));t._grantControlTimer=null}),I),this._grantControlPromise.promise},t.prototype._cancelGrantControlTimer=function(){this._grantControlTimer&&(this._grantControlPromise&&this._grantControlPromise.reject(new Error("cancelled by _cancelGrantControlTimer")),clearTimeout(this._grantControlTimer),this._grantControlTimer=null)},t.prototype._mapParticipantToSourceId=function(e){return this._dataChannelAdapter.isActive()?E.getSourceIdForMediaType(e,3):(this._logger.error("Null data channel cannot map participant to source id"),-1)},t.prototype._getParticipantsDataSourceIds=function(e){var t,n=[];try{if(null===(t=null==e?void 0:e.endpoints)||void 0===t?void 0:t.endpointDetails){if(1===e.endpoints.endpointDetails.length)if(!(null==(o=e.endpoints.endpointDetails[0])?void 0:o.mediaStreams))return n.push(v.DATA_SOURCE_ID_ANY),n;for(var r=0,i=e.endpoints.endpointDetails;r<i.length;r++){var o;if(null==(o=i[r])?void 0:o.mediaStreams)for(var a=0,s=o.mediaStreams;a<s.length;a++){var c=s[a];if(3===S.mapMediaTypeStringToMediaType(c.type)){if(n.push(c.sourceId),n.length>=8)return this._logger.error("Excessive amount of data streams"),n;break}}}}}catch(e){this._logger.error("_getParticipantsDataSourceIds caught exception error=".concat(e))}return n},t.prototype._getParticipantIdForDataSourceId=function(e,t){return E.getParticipantIdForSourceId(e,3,t)},t.prototype._getDataSourceIdForParticipantId=function(e,t){return this._dataChannelAdapter.isActive()?E.getSourceId(e,t,3):(this._logger.error("Null data channel cannot map participant to source id"),-1)},t.prototype._getDataSourceIdForParticipantLeg=function(e){return this._getDataSourceIdForParticipantId(e.participant,e.participantId)},t.prototype._getSharerDataSourceId=function(){var e=E.getSharingParticipantLeg(this._sharerParticipant);return e?this._getDataSourceIdForParticipantId(this._sharerParticipant,e):(this._logger.warn("Unable to identify the sharer participantId, falling back to first data channel"),this._mapParticipantToSourceId(this._sharerParticipant))},t.prototype.terminateControl=function(){if(this._isViewing()){if(4!==this.controlState)return Promise.reject(new Error("terminateControl called while not in control"));if(!this._sharerParticipant)return Promise.reject(new Error("terminateControl called but _sharerParticipant is null"))}else{if(!this._isSharing())return Promise.reject(new Error("terminateControl called but not sharing nor viewing"));if(!this._controllerParticipant)return Promise.reject(new Error("terminateControl called but controllerParticipant is null"))}return this._requestControlPromise?Promise.reject(new Error("Request control promise has not been resolved yet while terminating control")):this._acceptControlPromise?Promise.reject(new Error("Accept control promise has not been resolved yet while terminating control")):this._grantControlPromise?Promise.reject(new Error("Grant control promise has not been resolved yet while terminating control")):this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while terminating control")):this._terminateControl()},t.prototype._terminateControl=function(e){var t=this;void 0===e&&(e=!0),this._logger.info("_terminateControl()"),this._terminateControlPromise=new p.Deferred;var n=function(){t._terminateControlPromise=null};this._terminateControlPromise.promise.then(n,n);var r,i,o=0,a=e?8:7;if(this._isViewing()){if(4!==this.controlState)return this._logger.error("Local viewer called terminateControl when not controlling"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local viewer called terminateControl when not controlling"));this._teardownViewerRemoteControl(),o=6,r=this._getSharerDataSourceId(),i=P,this._logger.info("Terminating remote control reason: ".concat(o,",  recipient: ").concat(r,", controllerId: ").concat(i))}else{if(3!==this.controlState||!this._controllerParticipant)return this._logger.error("Local sharer called terminateControl when no one is in control"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local sharer called terminateControl when no one is in control"));this._teardownSharerRemoteControl(),o=5,r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),i=this._controllerParticipant.participant.id,this._logger.info("Terminating control on the sharer side, reason: ".concat(o,", recipient: ").concat(r,", controllerId: ").concat(i))}if(!this._sendRequest({action:a,terminatedReason:o},r)){if(e)return this._logger.error("Failed to send the terminate control request"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Failed to send the grant control request!"));this._logger.error("Failed to send the terminateNoAck request")}this.controlState=e?5:0;var s={inControl:!1,id:i,terminatedReason:o};return this._logger.info("raising event sharingControlChanged reason=".concat(s.terminatedReason," controlState=").concat(this.controlState)),this.event("sharingControlChanged").raise(s),e?(this._terminateControlTimer=window.setTimeout((function(){5===t.controlState?(t.controlState=0,t._resetControllerParticipant(),t._logger.error("No ack received when terminating control - resending terminate request"),t._sendRequest({action:7,terminatedReason:4},r)||t._logger.error("Failed to send the terminateNoAck request"),t._terminateControlPromise?t._terminateControlPromise.reject(new Error("No ack received when terminating control - resending terminate request")):t._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForTerminateAck")):t._terminateControlPromise?t._terminateControlPromise.reject(new Error("terminate control - times out in bad state - do nothing")):t._logger.error("Unexpected, no promise could be resolved - controlState=".concat(D(t.controlState)));t._terminateControlTimer=null}),I),this._terminateControlPromise.promise):(this._terminateControlPromise.resolve(),new Promise((function(e,t){e()})))},t.prototype._cancelTerminateControlTimer=function(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(new Error("cancelled by _cancelTerminateControlTimer")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null,this._logger.info("_cancelTerminateControlTimer()"))},t.prototype._disposeControlCapturer=function(e){void 0===e&&(e=(0,y.generateCauseId)()),this._logger.info("_disposeControlCapturer causeId: ".concat(e)),this._clearCapturerEventSubscriptions(),this._controlCapturer&&(this._controlCapturer.dispose(e),this._controlCapturer=null)},t.prototype.dispose=function(t){this._logger.info("dispose causeId: ".concat(t)),this._dataChannelAdapter.dispose(t),this._resetControlState(),this._disposeRenderer(t),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._call=null,this._resetParticipantSubscriptions(),this._finalizeViewerSessionTelemetry(s.SESSION_SHUTDOWN),this._finalizeSharerSessionTelemetry(c.SESSION_SHUTDOWN),e.prototype.dispose.call(this,t)},t}(C.default);function w(e){switch(e){case 0:return"Available";case 1:return"ControlRequest";case 2:return"CancelControlRequest";case 3:return"AcceptRequest";case 4:return"RejectRequest";case 5:return"Ack";case 6:return"GiveControl";case 7:return"TerminateNoAck";case 8:return"Terminate";case 9:return"AvailableAck";case 10:return"AvailableNack";case 11:return"RenderedAtViewer";default:return"Unknown"}}function D(e){switch(e){case 0:return"None";case 1:return"RequestSent";case 2:return"WaitingForControlAck";case 3:return"RemoteControlling";case 4:return"LocalControlling";case 5:return"WaitingForTerminateAck";default:return"Unknown"}}function L(e){switch(e){case 0:return"None";case 1:return"SharerDenied";case 2:return"SharerNoResponse";case 3:return"SharerBusy";case 4:return"AckTimeout";case 5:return"SharerTerminated";case 6:return"ViewerTerminated";case 7:return"DataChannelError";case 8:return"ViewerCancelled";case 9:return"SharerControlDisabled";case 10:return"UnknownSender";default:return"Unknown"}}t.ControlBase=R},2177:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingControlProtocol=void 0,function(e){e.encodeMouseEvent=function(e){if(!e)return new Uint8Array(0);e.buttonType||(e.buttonType=0),e.xPos||(e.xPos=0),e.yPos||(e.yPos=0),e.wheelRotation||(e.wheelRotation=0);var t=new ArrayBuffer(7),n=new DataView(t),r=3&e.type,i=(7&e.buttonType)<<2,o=(e.buttonDown?1:0)<<5,a=(e.wheelButtonDown?1:0)<<6;return n.setUint8(0,1),n.setUint8(1,r|i|o|a),n.setUint16(2,e.xPos,!0),n.setUint16(4,e.yPos,!0),n.setUint8(6,e.wheelRotation),new Uint8Array(t)},e.encodeKeyboardEvent=function(e){var t=new ArrayBuffer(3),n=new DataView(t),r=3&e.codeType,i=(e.keyUp?1:0)<<4,o=(e.repeat?1:0)<<5;return n.setUint8(0,0),n.setUint8(1,r|i|o),n.setUint8(2,e.code),new Uint8Array(t)},e.decodeEventType=function(e){return e[0]},e.decodeMouseEvent=function(e){if(1!==e[0]||7!==e.length)return null;var t=new DataView(e.buffer),n=t.getUint8(1);return{type:3&n,buttonType:n>>2&7,buttonDown:!!(n>>5&1),wheelButtonDown:!!(n>>6&1),xPos:t.getUint16(2,!0),yPos:t.getUint16(4,!0),wheelRotation:t.getUint8(6)}},e.decodeKeyboardEvent=function(e){if(0!==e[0]||3!==e.length)return null;var t=new DataView(e.buffer),n=t.getUint8(1);return{codeType:3&n,code:t.getUint8(2),repeat:!!(n>>5&1),keyUp:!!(n>>4&1)}}}(n||(t.ScreenSharingControlProtocol=n={}))},3467:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.validStateTransitions=t.callStateIsAnyOf=void 0,t.callStateIsAnyOf=function(e,t){return-1!==t.indexOf(e)},t.validStateTransitions=((n={})[0]=[1,2,8,6,10,11,9],n[1]=[2,6,7,10,13],n[2]=[1,3,6,7,9,10,13,14],n[3]=[6,7,4,5,10,13],n[8]=[1,11,10,2,9,6,7],n[4]=[6,7,3,5,10,13],n[5]=[6,7,3,4,10,13],n[9]=[3,6,7,10,13],n[10]=[3,6,7,9,4,5,13,15],n[13]=[3,6,7,4,5],n[14]=[3,6,7,10,13],n[15]=[3,6,7,4,5,13],n[11]=[12,1,2,6,7],n[12]=[2,6,7],n[6]=[7],n[7]=[],n)},1165:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.build=t.Stopwatch=void 0;var n=function(){function e(){var e=this;this.msElapsed=0,this.isPaused=!1,this._startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e._startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e._startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e._startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}}return Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},enumerable:!1,configurable:!0}),e}();t.Stopwatch=n,t.build=function(){return new n}},5212:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOvb=t.getTsCallingVersion=void 0,t.getTsCallingVersion=function(){return"2024.23.01.5"},t.getOvb=function(){return"9a35b47a347468d9a766e58a99b35ab39118ba32"}},3907:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isObjectEmpty=t.stringToBuffer=t.stringifyObject=t.isPromiseLike=t.isStringBase64=t.getRandomizedTimeout=void 0,t.getRandomizedTimeout=function(e){var t=Math.floor(11*Math.random())+10;return Math.floor(e*(1-t/100))},t.isStringBase64=function(e){if(!e)return!1;try{return atob(e),!0}catch(e){return!1}},t.isPromiseLike=function(e){return!!e&&"function"==typeof e.then},t.stringifyObject=function(e){if(!e)return"".concat(e);if(e instanceof Map)return function(e){var t={};return e.forEach((function(e,n){t[n.toString()]=e})),JSON.stringify(t)}(e);var t=e.toString();return t.endsWith("[object Object]")?JSON.stringify(e):t},t.stringToBuffer=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},t.isObjectEmpty=function(e){return!e||0===Object.keys(e).length}},2727:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){if(this.ecsConfig=t,this.logger=n,this._isECSEnabled=!1,this._isECSEnabled=this.ecsConfig.getBoolean("MediaAgent","enableIpcPerfCollection",!1),this._ipcStatsArraySize=this.ecsConfig.getNumber("MediaAgent","ipcStatsArraySize",4),this._isECSEnabled)try{this._ipcPerfProvider=null==e?void 0:e.getOrCreateIPCStatsProvider()}catch(e){this.logger.info("IpcStats provider is not available or not provided")}else this.logger.info("IpcStats provider disabled by ECS or not available")}return e.prototype._filterStats=function(e){var t,n;(null===(t=null==e?void 0:e.topAsyncMethodsByDuration)||void 0===t?void 0:t.length)>this._ipcStatsArraySize&&(e.topAsyncMethodsByDuration=e.topAsyncMethodsByDuration.slice(0,this._ipcStatsArraySize)),(null===(n=null==e?void 0:e.topSyncMethodsByDuration)||void 0===n?void 0:n.length)>this._ipcStatsArraySize&&(e.topSyncMethodsByDuration=e.topSyncMethodsByDuration.slice(0,this._ipcStatsArraySize))},e.prototype.getIpcStats=function(){var e;if(this._isECSEnabled){var t=null===(e=this._ipcPerfProvider)||void 0===e?void 0:e.getPerformanceMetrics();return this._filterStats(t),t}return null},e}();t.default=n},5773:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.deviceCapabilitiesToString=t.selectMonitorForScreenSharing=t.returnStringifiedVersionOfMediaStateConfiguration=t.returnVideoDirection=t.convertEndpointScope=t.convertImageData=t.createLocalVideo=t.getParticipantsVideos=t.mapToEmptyStrIfFalsy=t.stringToBuffer=t.bufferToString=t.isVideoAvailable=t.isDisposed=t.waitForVideoObjectToBeStopped=t.waitForVideoObjectToBeRunning=t.waitForVideoObjectToBeAvailable=t.videoObjectTimeout=t.isVideoInState=t.waitForVideoObjectState=t.VideoStateCancelEvent=t.hasFeature=t.getProperties=t.getMultipleProperties=t.forgetAndLog=t.PlatformType=t.wrap=void 0;var c=n(6773),l=n(7289);c.defaults(window,{SlimCore:{}}),c.defaults(SlimCore,{Enums:{}}),Proxy&&(SlimCore.Enums=new Proxy(SlimCore.Enums,{get:function(e,t){return t in e?e[t]:{}}}));var u,d=function(){return[SlimCore.Enums.VideoStatus.Available,SlimCore.Enums.VideoStatus.Starting,SlimCore.Enums.VideoStatus.Running]};function p(e,t,n,r,i){t.info("getProperties oid ".concat(n," ").concat(c.size(r)," / ").concat(c.size(i)));var a=c.mapValues(i,(function(e){var t;return o(o({},e),{fallback:null!==(t=e.fallback)&&void 0!==t?t:0})})),s=function(e){return void 0!==e.propKey},l=c.size(r),u=c.size(a),d=c.pickBy(r,s),p=c.size(d),h=c.pickBy(a,s),g=c.size(h),f=p+g>0?e.getProperties(n,d,h):{};if(l!==p){var m=f;c.forEach(c.omitBy(r,s),(function(e,t){m[t]=e.fallback}))}if(u!==g){var _=f;c.forEach(c.omitBy(a,s),(function(e,t){_[t]=e.fallback}))}return f}t.wrap=function(e){return e},function(e){e[e.Electron=1]="Electron"}(u||(t.PlatformType=u={})),t.forgetAndLog=function(e,t,n){return e?(t.info("Promise executing: ".concat(n)),e.catch((function(e){t.logFailure("Promise execution: ".concat(n," failed: ").concat(e))}))):(t.logFailure("Undefined promise @ ".concat((new Error).stack)),Promise.resolve())},t.getMultipleProperties=function(e,t,n,r,i){if(!n.length)return[];for(var a=[],s={},c={},l=0,u=0,d=n;u<d.length;u++){for(var h=d[u],g=0,f=Object.values(r);g<f.length;g++){var m=f[g];s[l++]=o(o({},m),{objectId:h})}for(var _=0,y=Object.values(i);_<y.length;_++){m=y[_];c[l++]=o(o({},m),{objectId:h})}}for(var v=l>0?p(e,t,0,s,c):{},S=0,C=0;C<n.length;C++){for(var E={},T=0,I=Object.keys(r);T<I.length;T++){E[I[T]]=v[S++]}for(var P=0,O=Object.keys(i);P<O.length;P++){E[O[P]]=v[S++]}a.push(E)}return a},t.getProperties=p,t.hasFeature=function(e){return e in SlimCore.Enums.Feature};var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.fire=function(){this.raiseEvents((function(e){e()}))},t}(l.EventSourceImpl);function g(e){return new Promise((function(t,n){var r,i=!1,o=null,a=0,s=e.logger.createFnLogger("waitForVideoObjectState[".concat(e.videoObjectId,"]"),e.causeId),c=function(e){i=!0,o&&(o.dispose(),o=null),a&&(clearTimeout(a),a=0),r&&r.dispose(),e?n(e):t()},l=function(t,n){if(!i){var r=null!=t?t:p(e.slimcoreInstance,s,e.videoObjectId,{},{status:{propKey:SlimCore.Enums.Property.VideoStatus}}).status;n?s.info("timeout. check state ".concat(r," (").concat(SlimCore.Enums.VideoStatus[r],") again")):s.info("state changed -> ".concat(r," (").concat(SlimCore.Enums.VideoStatus[r],")")),f(r,e.resolveStates)?c():e.rejectStates&&f(r,e.rejectStates)?c("rejecting state ".concat(r," (").concat(SlimCore.Enums.VideoStatus[r],")")):n&&c("timeout, state ".concat(r," (").concat(SlimCore.Enums.VideoStatus[r],") expectedStates ").concat(JSON.stringify(e.resolveStates)))}};e.timeout&&(a=window.setTimeout((function(){l(void 0,!0)}),e.timeout)),e.cancelEvent&&(r=e.cancelEvent.subscribe((function(){s.info("canceled, expectedStates ".concat(JSON.stringify(e.resolveStates))),c("canceled")}))),o=e.slimcoreInstance.handle("object-property-changed",{objectId:e.videoObjectId,propKey:SlimCore.Enums.Property.VideoStatus},(function(e){l(e.value)})),l()}))}function f(e,t){return-1!==t.indexOf(e)}function m(e,t){return c.reduce(e,(function(e,n){return t(n)?e+1:e}),0)}t.VideoStateCancelEvent=h,t.waitForVideoObjectState=g,t.isVideoInState=f,t.videoObjectTimeout=function(e){return 5e3},t.waitForVideoObjectToBeAvailable=function(e,t,n,r,i,o){return g({slimcoreInstance:e,videoObjectId:t,logger:n,causeId:r,resolveStates:d(),rejectStates:[],timeout:i,cancelEvent:o})},t.waitForVideoObjectToBeRunning=function(e,t,n,r,i,o){return g({slimcoreInstance:e,videoObjectId:t,logger:n,causeId:r,resolveStates:[SlimCore.Enums.VideoStatus.Running],rejectStates:[SlimCore.Enums.VideoStatus.Stopping],timeout:i,cancelEvent:o})},t.waitForVideoObjectToBeStopped=function(e,t,n,r,i,o){return g({slimcoreInstance:e,videoObjectId:t,logger:n,causeId:r,resolveStates:[SlimCore.Enums.VideoStatus.NotStarted,SlimCore.Enums.VideoStatus.Available,SlimCore.Enums.VideoStatus.NotAvailable],rejectStates:[],timeout:i,cancelEvent:o})},t.isDisposed=function(e){var t;return!!(null===(t=e.isDisposed)||void 0===t?void 0:t.call(e))},t.isVideoAvailable=function(e){return f(e,d())},t.bufferToString=function(e){return String.fromCharCode.apply(null,e)},t.stringToBuffer=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},t.mapToEmptyStrIfFalsy=function(e){return e||""},t.getParticipantsVideos=function(e,t){if(e.getParticipantsVideos)return e.getParticipantsVideos(t);for(var n=[],r=0,i=t;r<i.length;r++)for(var o=i[r],a=0,s=e.callGetParticipantVideos(o);a<s.length;a++){var c=s[a];n.push(c)}return n},t.createLocalVideo=function(e,t,n,r,i,o,c){return a(this,void 0,void 0,(function(){var a;return s(this,(function(s){return e.createSendVideo?[2,e.createSendVideo(n,r,i,o,c)]:(0!==(a=e.createLocalVideo(r,i,o,c))&&t.callAttachSendVideo(n,a),[2,a])}))}))},t.convertImageData=function(e){if(e.isImage)return e;var t=e.data,n=new Uint8ClampedArray(t.buffer,t.byteOffset,t.byteLength);return new ImageData(n,e.width,e.height)},t.convertEndpointScope=function(e){switch(e){case 0:return SlimCore.Enums.RemoveEndpointScope.RemoveEndpointScopeSpecified;case 1:return SlimCore.Enums.RemoveEndpointScope.RemoveEndpointScopeOther;default:return}},t.returnVideoDirection=function(e){var t;if(void 0!==e.videoDirection)return e.videoDirection;if(e.withVideo)return 4;if(null===(t=e.sendMediaModalities)||void 0===t?void 0:t.mediaStates){var n=c.find(e.sendMediaModalities.mediaStates,(function(e){return 1===e.mediaType}));if(n)return n.isDisabled?0:4}return 1},t.returnStringifiedVersionOfMediaStateConfiguration=function(e){return e?JSON.stringify(e,(function(e,t){return t&&t.constructor===RegExp?t.toString():"mediaType"===e?0===t?"Audio":3===t?"Data":2===t?"ScreenShare":1===t?"Video":"Unknown":t})):""},t.selectMonitorForScreenSharing=function(e,t){return e?function(t){return e.isDuplicated&&function(e){var t=m(e,(function(e){return e.isDuplicated})),n=m(e,(function(e){return e.isPrimary}));return 0===t&&1===n&&e.length>1}(t)?c.find(t,(function(e){return!e.isInternal})):null}(t)||function(t){return!e.isDuplicated&&function(e){var t=m(e,(function(e){return e.isDuplicated})),n=m(e,(function(e){return e.isPrimary}));return 1===t&&1===n}(t)?c.find(t,(function(e){return e.isPrimary})):null}(t)||function(t){return c.find(t,(function(t){return t.monitorId===e.monitorId||c.isEqual(t.region,e.region)}))}(t):null},t.deviceCapabilitiesToString=function(e){return e&&e.videoAR?"videoAR = [".concat(e.videoAR.width,":").concat(e.videoAR.height,"]"):"<empty>"}},2356:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._aiCameraManager=e.createAiCameraManager()}return e.prototype.dispose=function(){this._aiCameraManager.dispose()},e.prototype.getAiCameras=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,this._aiCameraManager.getAiCameras()]}))}))},e.prototype.registerAiCamera=function(e,t){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,this._aiCameraManager.registerAiCamera(e,t)]}))}))},e.prototype.unregisterAiCamera=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return[2,this._aiCameraManager.unregisterAiCamera(e)]}))}))},e}();t.default=i},5437:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this._slimcoreInstance=t,this._logger=e.createChild("Electron[AiMdp]")}return e.prototype.startDataCollection=function(e,t){this._logger.info("startDataCollection(callId: ".concat(e,", devMode: ").concat(t,")"));try{return this._slimcoreInstance.startMdpDataCollection?this._slimcoreInstance.startMdpDataCollection(e,t):(this._logger.warn("startMdpDataCollection() not implemented in SkyLib"),!1)}catch(n){throw this._logger.error("Error in startMdpDataCollection(callId: ".concat(e,", devMode: ").concat(t,") error: ").concat(n)),n}},e.prototype.stopDataCollection=function(e){this._logger.info("stopDataCollection(callId: ".concat(e,")"));try{return this._slimcoreInstance.stopMdpDataCollection?this._slimcoreInstance.stopMdpDataCollection(e):(this._logger.warn("stopMdpDataCollection() not implemented in SkyLib"),!1)}catch(t){throw this._logger.error("Error in stopMdpDataCollection(callId: ".concat(e,") error: ").concat(t)),t}},e}();t.default=n},8287:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1775),c=n(7584),l=function(e){function t(t,n,r,i){var o=e.call(this,t.createChild("AudioPlayer"),n,r)||this;return o._deviceManager=i,o._isDisposed=!1,o._logger.info("created"),o._rtcAudioPlayer=o._slimcoreInstance.createAudioPlayer(),o._logger.info("rtc audio player is created"),o._registerDisposable(o._rtcAudioPlayer.handle("audioplayer-error",void 0,(function(e){o._logger.info("on audio player error: ".concat(e.errorCode,", causeId: ").concat(e.causeId)),o.event("onAudioPlayerError").raise(o.convertToAudioPlayerError(e.errorCode),e.causeId)}))),o._registerDisposable(o._rtcAudioPlayer.handle("audioplayer-event",void 0,(function(e){o._logger.info("on audio player event: ".concat(e.event,", causeId: ").concat(e.causeId)),o.event("onAudioPlayerEvent").raise(o.convertToAudioPlayerEvent(e.event),e.causeId)}))),o}return i(t,e),t.prototype.startAudio=function(e,t){return void 0===t&&(t=(0,c.generateCauseId)()),o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:this._logger.info("start playing audio, causeId = ".concat(t)),r.label=1;case 1:if(r.trys.push([1,3,,4]),!e.deviceId){if(e.deviceId=this._deviceManager.getSelectedDevices().speaker,!e.deviceId)throw new Error("start audio issue, no deviceId");this._logger.info("using default device: ".concat(e.deviceId,", causeId: ").concat(t))}return e.playbackOptions=e.playbackOptions||{looping:!1},[4,this._rtcAudioPlayer.startAudio(t,e)];case 2:return r.sent(),[3,4];case 3:throw n=r.sent(),this._logger.error("failed to play audio file, causeId: ".concat(t,", error: ").concat(n)),n;case 4:return[2]}}))}))},t.prototype.stopAudio=function(){this._logger.info("stop playing audio"),this._rtcAudioPlayer.stopAudio()},t.prototype.dispose=function(t){void 0===t&&(t=(0,c.generateCauseId)()),this._isDisposed||(this._isDisposed=!0,this._logger.info("dispose causeId: ".concat(t)),this._rtcAudioPlayer.dispose(),e.prototype.dispose.call(this,t),this._logger.info("dispose causeId: ".concat(t," done")))},t.prototype.convertToAudioPlayerError=function(e){switch(e){case SlimCore.Enums.AudioPlayerError.NoError:return 0;case SlimCore.Enums.AudioPlayerError.NotReady:return 1;case SlimCore.Enums.AudioPlayerError.InvalidAudioFileUrl:return 2;case SlimCore.Enums.AudioPlayerError.OpenFileFailed:return 3;case SlimCore.Enums.AudioPlayerError.UnsupportedWavAudioFormat:return 4;case SlimCore.Enums.AudioPlayerError.ReadFileFailed:return 5;case SlimCore.Enums.AudioPlayerError.StartDeviceFailed:return 6;case SlimCore.Enums.AudioPlayerError.PlayAudioError:return 7;case SlimCore.Enums.AudioPlayerError.StartPlayingInvalidParameters:return 8;case SlimCore.Enums.AudioPlayerError.AlreadyPlaying:return 9;default:return this._logger.warn("Unmapped SlimCore.Enums.AudioPlayerError value: ".concat(e)),-1}},t.prototype.convertToAudioPlayerEvent=function(e){switch(e){case SlimCore.Enums.AudioPlayerEvent.PlayingStarted:return 0;case SlimCore.Enums.AudioPlayerEvent.PlayingStopped:return 1;default:return this._logger.warn("Unmapped SlimCore.Enums.AudioPlayerEvent value: ".concat(e)),-1}},t}(s.default);t.default=l},1775:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6144),s=n(5773),c=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o._logger=t,o._settings=n,o._slimcoreInstance=r,o._eventBus=i,o._disposables=[],o._objectPropertyChangedHandlers=new Map,o._propkeysToLog=[],o}return i(t,e),t.prototype.dispose=function(t){this._logger.info("dispose causeId: ".concat(t)),this._disposables.forEach((function(e){return e.dispose(t)})),this._disposables=[],this._objectPropertyChangedHandlers.clear(),e.prototype.dispose.call(this,t)},t.prototype._registerDisposable=function(e){e?this._disposables.push(e):this._logger.error("Attempt to register null disposable, ignoring")},t.prototype._getMultipleProperties=function(e,t,n){return s.getMultipleProperties(this._slimcoreInstance,this._logger,e,t,n)},t.prototype._getProperties=function(e,t,n){return s.getProperties(this._slimcoreInstance,this._logger,e,t,n)},t.prototype._onObjectPropertyChanged=function(e,t,n){var r=this;this._objectPropertyChangedHandlers.has(e)||(this._objectPropertyChangedHandlers.set(e,new Map),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{objectId:e},(function(e){return r._onObjectPropertyChangedCallback(e)}))),this._eventBus&&this._registerDisposable(this._eventBus.handle("object-property-changed",{objectId:e},(function(e){return r._onObjectPropertyChangedCallback(e)})))),this._objectPropertyChangedHandlers.get(e).set(t,n)},t.prototype.setPropertiesToLog=function(e){this._propkeysToLog=e},t.prototype._logPropertyChange=function(e,t){if(this._settings.enableSlimCoreEventsCounting&&t||this._propkeysToLog.includes(e.propKey)){var n=SlimCore.Enums.ObjectType[e.objectType]||e.objectType,r=SlimCore.Enums.Property[e.propKey]||e.propKey;this._logger.debug("_onObjectPropertyChangedCallback - objectId: ".concat(e.objectId,", objectType: ").concat(n,", propKey: ").concat(r,", value: ").concat(e.value,", handler: ").concat(!!t))}},t.prototype._onObjectPropertyChangedCallback=function(e){var t=this._objectPropertyChangedHandlers.get(e.objectId),n=t&&t.get(e.propKey);this._logPropertyChange(e,n),n&&n.call(this,e)},t.prototype.raiseChanged=function(t){try{e.prototype.raiseChanged.call(this,t)}catch(e){this._logger.error("Change handling error: ".concat(e))}},t.prototype._raiseEventImpl=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];try{e.prototype._raiseEventImpl.apply(this,o([t],n,!1))}catch(e){this._logger.error("Event '".concat(t,"' handling error: ").concat(e))}},t}(a.default);t.default=c},2642:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreElectronBindingManager=void 0;var i=function(){function e(e,t,n){this._create=e,this._release=t,this._logger=n,this._bindingMap={},this._logger.info("created")}return e.prototype.acquire=function(e,t,n){var r=this;if(!this._bindingMap[n]||this._bindingMap[n].releasePromise){var i=!1,o=void 0;this._bindingMap[n]?(o=this._bindingMap[n].releasePromise.catch((function(t){r._logger.info("Release binding error: ".concat(t,". videoObjectId: ").concat(n," causeId: ").concat(e))})),i=!0,this._logger.info("Will wait for the release promise to complete before creating. videoObjectId: ".concat(n," causeId: ").concat(e))):o=Promise.resolve();var a=o.then((function(){return r._create(e,n)})).then((function(t){return r._logger.info("Binding created for videoObjectId: ".concat(n," causeId: ").concat(e)),t})).catch((function(t){throw delete r._bindingMap[n],r._logger.info("Create binding error: ".concat(t," for videoObjectId: ").concat(n," causeId: ").concat(e)),t}));this._bindingMap[n]={createPromise:a,owners:[],chained:i}}return this._bindingMap[n].owners.push(t),this._logger.info("Added owner for ".concat(n," causeId: ").concat(e,". Total now: ").concat(this._bindingMap[n].owners.length)),this._bindingMap[n].createPromise},e.prototype.release=function(e,t,i){return n(this,void 0,void 0,(function(){var n,o,a=this;return r(this,(function(r){switch(r.label){case 0:return this._bindingMap[i]?[4,this._bindingMap[i].createPromise]:[3,2];case 1:return n=r.sent(),(o=this._bindingMap[i].owners.indexOf(t))>-1&&(this._bindingMap[i].owners.splice(o,1),this._logger.info("Removed owner for ".concat(i," causeId: ").concat(e,". Remaining: ").concat(this._bindingMap[i].owners.length))),0===this._bindingMap[i].owners.length?(this._bindingMap[i].releasePromise=this._release(e,i,n).then((function(){a._bindingMap[i].chained||delete a._bindingMap[i]})),[2,this._bindingMap[i].releasePromise]):(this._logger.info("More owners for videoObjectId: ".concat(i," causeId: ").concat(e)),[3,3]);case 2:this._logger.info("BindingManager release() called. _bindingMap empty for videoObjectId: ".concat(i," causeId: ").concat(e)),r.label=3;case 3:return[2]}}))}))},e}();t.SlimCoreElectronBindingManager=i},8994:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}},l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.mapLocalRecordingFailureReasonToLocalRecordingError=void 0;var d=n(6773),p=n(5442),h=n(891),g=n(961),f=n(7584),m=n(6871),_=n(2944),y=n(4487),v=n(6136),S=n(4545),C=n(2559),E=n(4147),T=n(5005),I=n(8067),P=n(638),O=n(3607),b=n(3467),A=n(5773),R=n(1775),w=n(1325),D=n(4385),L=n(7715),N=n(8672),M=n(1011),k=n(8404),F=n(5320),x=n(2832),j=n(3024),H=n(1113),U=n(5851),V=n(1153),B=n(2727),G=n(6894),W=function(e){function t(n,r,i,o,a,s,c,p,g,y,S,E,T,P,O,b,A){var R,w=e.call(this,n.createChild((function(){var e=(w.endpointId||"").substr(0,8),t=(w.participantId||"").substr(0,8);return"Electron/".concat(w.instanceNumber,"[").concat(w.slimcoreCallId,":").concat(w.callId,"][").concat(e,"][").concat(t,"][").concat(w.state,"]")})),r,i,A)||this;w._slimcoreCallHandler=o,w._ecs=a,w._deviceManager=s,w._appHooks=c,w.groupId=p,w.threadId=g,w.callId=y,w.currentUserSkypeIdentity=S,w.participantId=E,w._telemetryLoggers=T,w.accountConfiguration=b,w.participants=[],w.participantMap={},w.isMuted=!1,w.isSpeakerMuted=!1,w.isServerMuted=!1,w.isVideoOn=!1,w.isScreenSharingOn=!1,w.dominantSpeakerInfo={speakerList:[],timestamp:null,noCurrentDominantSpeaker:!1},w.slowedDownActiveTalkerInfo={speakerList:[],timestamp:null},w.callStartedAt=null,w.callHeldAt=null,w.conversationStartTime=null,w.failureType=2,w.slimcoreCallId=0,w.isHostless=!0,w.callType=-1,w.isIncomingOneOnOneVideoCall=!1,w.contentSharingSessions=[],w.screenSharingControl=null,w.dataChannelAdapter=null,w.isPreheatEnabled=!1,w.localMediaStreams=[],w.ptzHandler=null,w.mediaStreams=((R={})[0]=[],R[1]=[],R[2]=[],R),w._streamContextMap={},w._isAudioStreamConnected=!1,w._wasAudioStreamConnected=!1,w._callGotConnected=!1,w._enableGroupCallMeetupGeneration=!1,w._mediaPeerType=0,w._dataChannel=null,w._dataChannelUsers=[],w._isRelayWhiteListingIssue=!1,w._isOptimizedSpeakerEventingEnabled=!1,w._enableCallMemberCountChangedFallback=!1,w._enableContentSharingSessionsProperty=!1,w._callIsSetupComplete=!1,w._transferState=0,w._parkState=0,w._capabilityFlags=SlimCore.Enums.SelfCapability.None,w._capabilities={canMuteOthers:!1,canUnmuteSelf:!1},w._removeCallChangeOnParticipantChanges=!1,w.inCallTelemetryReported=!1,w.setupTelemetryReported=!1,w.connectCallPromise=Promise.resolve(),w._spamRiskLevel=null,w._spamStirAttestation=null,w._deferRaisingChangesInElectronCall=!1,w._enableVirtualParticipantMsiMappingForSelf=!1,w._disableActiveSpeakerLogging=!1,w.raiseChangedDeferredIfEnabled=function(){return w._deferRaisingChangesInElectronCall?w.raiseChangedDeferred():w.raiseChanged()},w._videoRequestedOnWhileConnecting=!1,w._videoRequestedOffWhileConnecting=!1,w._callStartTime=(new Date).getTime(),w._state=0,w._mode=0,w._isCallConnectedToMixer=!1,w._isE2EE=!1,w._mergeParticipantMriToParticipantIdMap={},w._mergeReplacementParticipantIdToNewParticipantIdMap={},w._isLocallyHeld=!1,w._isSharedLineAppearanceV2Activated=!1,w._isLocalRecordingAllowedByEcs=!0,w._isUpdatePropertiesSpecifiedAllowedByEcs=!1,w._isLocalRecordingRunning=!1,w._resumeLocalRecordingAfterCallResumesFromHold=!1,w._localRecordingPromiseOnHold=null,w._mergeParticipantLegIdsEnabled=!1,w._participantJoinedDeferRunner=_.GlobalDeferHandler.instance.createDeferRunner("Call.participantJoined"),w._participantJoinedOrRemovedDeferRunner=_.GlobalDeferHandler.instance.createDeferRunner("Call.participantJoinedOrRemoved"),w._updateDominantSpeakerListDeferRunner=_.GlobalDeferHandler.instance.createDeferRunner("Call.updateDominantSpeakerList"),w._tryResolveMsisDeferRunner=_.GlobalDeferHandler.instance.createDeferRunner("Call.tryResolveMsis"),w.mapOfUnresolvedVirtualParticipantMSIs=new Map,w._enableVirtualParticipantMsiMapping=!1,w._disableAddParticipantCheck=!1,w._suppressParticipantDiagnosticsCodeChanged=!0,w._participantChangedEventSkipConfig={skipParticipantsUpdatesOnCall:!0},w._dominantSpeakerChangedEventSkipConfig={skipDominantSpeakerUpdatesOnCall:!0},w.instanceNumber=t.instanceCount++%1e3,w.maxVbssChannels=0,w.isServerMuteUnmuteEnabled=function(){return!!w.endpoints&&d.some(w.endpoints.endpointDetails,(function(e){return w.endpointId===e.endpointId&&(e.capabilities&&"enabled"===e.capabilities.serverMuteUnmute)}))},w.isMuteDisabled=function(){return w.isMuted},w.isUnMuteDisabled=function(){return 1===w.callType?!w.isMuted:2===w.callType&&(w.isServerMuteUnmuteEnabled()?!w.isServerMuted&&!w.isMuted:!w.isMuted)},w.cleanUp=function(e){return l(w,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return this._logger.info("[".concat(e,"][cleanup]start")),this._callTelemetry.recordOperation(h.CALL_OPERATIONS_INTERNAL.MEDIA_CLEAN_UP,e),[4,Promise.all([this._getCallEndOperation(),this._cleanCallResources(e)])];case 1:return n.sent(),t={code:m.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:m.CONSTANTS.SUB_CODE.ABANDONED},this._callOperationHandler.rejectPendingOperations(61,e,t),this._participantOperationHandler.rejectPendingOperations(47,e,t),this._callTelemetry.recordOperationSuccess(h.CALL_OPERATIONS_INTERNAL.MEDIA_CLEAN_UP),this._callTelemetry.setTerminationState(this.state),this._callTelemetry.setTerminationReason(this.terminatedReason),this._reportTsCallingTelemetry(!this._callIsSetupComplete),[2]}}))}))},w._getCallEndOperation=function(){return w._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.STOP_CALL)?w._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.STOP_CALL):w._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.REJECT)?w._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.REJECT):Promise.resolve()},w._getFirstParticipantFailureReason=function(e){try{return w._getProperties(w.slimcoreCallId,{},{callFailureReason:{propKey:SlimCore.Enums.Property.CallFailureReason}}).callFailureReason}catch(e){return void w._logger.logFailure("participantFailureReason=".concat((0,C.getPrintableObject)(e)))}},w.createVirtualParticipantMSIToParticipantIdMapper=function(e){var t=!1,n=function(t){e(t)},r={update:function(e){if(w._enableVirtualParticipantMsiMapping){if(t)return;if(e===j.SOURCE_NONE)w._logger.info("notify: msi is SOURCE_NONE. Clearing name lable"),i.mri="",n();else{var r=w.mapVirtualParticipantMsisToParticipantId([e])[0];r?i.mri!==r&&(w._logger.info("notify: msi[".concat(e,"] -> mri[").concat(i.mri,"] -> ").concat(r)),i.mri=r,n(r)):(w._logger.info("notify: cant find msi[".concat(e,"] mapping, clearing previous name lable")),i.mri="",n())}i.msi=e}},dispose:function(){t||(w._logger.info("createVirtualParticipantMSIToParticipantIdMapper: dispose"),w.mapOfUnresolvedVirtualParticipantMSIs.delete(e),t=!0)}},i={msi:j.SOURCE_NONE,mri:"",notify:n};return w.mapOfUnresolvedVirtualParticipantMSIs.set(e,i),r},w._setTransferState=function(e,t){w.transferState!==e&&(w._logger.info("Transfer: state set: ".concat(e)),w._transferState=e,w._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_TRANSFER_STATE,{state:e},t),w.raiseChanged())},w._setParkState=function(e,t){w.parkState!==e&&(w._logger.info("Park: state set: ".concat(e)),w._parkState=e,w._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_PARK_STATE,{state:e},t),w.raiseChangedDeferredIfEnabled())},w._logger.info("constructor"),w.terminatedReason=0,w.meetingData=O,w._ipcStats=new B.default(w._appHooks,w._ecs,w._logger.createChild("IpcStatsModule")),w._setupCallTelemetry(),w._setParticipantId(w.participantId),w._setGroupId(w.groupId),w._setThreadId(w.threadId),w._setCallId(w.callId),w._setCallOrigin(0),w._setMessageId(P),w._setIsEmergency(!1),w.accountConfiguration&&w._setApplicationType(b.applicationType);try{w._setEndpointId(w._slimcoreInstance.getRegistrationId(w.currentUserSkypeIdentity.id))}catch(e){w._logger.warn("getRegistrationId is missing!")}w.screenSharingControl=new U.SlimCoreElectronScreenSharingControl(w._logger,w._slimcoreInstance,w,w._appHooks.getControlInjector(),w._telemetryLoggers,w._ecs),w.raiseRenderedAtViewer=w.raiseRenderedAtViewer.bind(w),w.screenSharingControl.setRaiseRenderedAtViewer(w.raiseRenderedAtViewer),w.dataChannelAdapter=new N.default(w._logger,w._slimcoreInstance),w.ptzHandler=new x.default(w._logger,w._settings,w._slimcoreInstance,w,w._deviceManager),w._dataChannelUsers=[w.screenSharingControl,w.dataChannelAdapter,w.ptzHandler];var D=w._ecs.getBoolean("SkypeCalling","enableErrorConversion",!1);w._removeCallChangeOnParticipantChanges=w._ecs.getBoolean("SkypeCalling","removeCallChangeOnParticipantChanges",!1),w._enableVirtualParticipantMsiMapping=w._ecs.getBoolean("SkypeCalling","enableVirtualParticipantMsiMapping",!1),w._disableAddParticipantCheck=w._ecs.getBoolean("SkypeCalling","disableAddParticipantCheck",!1);var L=w._ecs.getBoolean("SkypeCalling","deferUsingMicrotask",!1);w._enableContentSharingSessionsProperty=w._ecs.getBoolean("SkypeCalling","enableContentSharingSessionsProperty",!1),L&&(w._deferRaisingChangesInElectronCall=w._ecs.getBoolean("SkypeCalling","deferRaisingChangesInElectronCall",!1)),_.GlobalDeferHandler.instance.setDeferToQueueMicrotask(L),_.GlobalDeferHandler.instance.setLogger(n),w._isLocalRecordingAllowedByEcs=w._ecs.getBoolean("SkypeVideoLibrary","enableLocalRecording",!0),w._suppressParticipantDiagnosticsCodeChanged=w._ecs.getBoolean("SkypeCalling","suppressParticipantDiagnosticsCodeChanged",!0),w._isUpdatePropertiesSpecifiedAllowedByEcs=w._ecs.getBoolean("SkypeCalling","enableUpdateParticipantsSpecified",!0),w._enableVirtualParticipantMsiMappingForSelf=w._ecs.getBoolean("SkypeCalling","enableVirtualParticipantMsiMappingForSelf",!1),w._disableActiveSpeakerLogging=w._ecs.getBoolean("SkypeCalling","disableActiveSpeakerLogging",!1);var M={enableErrorConversion:D};return w._callOperationHandler=new I.default(w._logger,w._callTelemetry,M,void 0,(function(e,t){w.preconditions(e,t)})),w._participantOperationHandler=new I.default(w._logger,w._callTelemetry,M),w._dataChannelCreatedPromise=w._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED,void 0,(0,f.generateCauseId)(),{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE,h.OPERATION_TAGS.NOT_SUPPORTED_IN_E2EE]}),w._dataChannelCreatedPromise.catch(v.noop),w._localRecordingCreatedPromise=w._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_LOCAL_RECORDING_CREATED,void 0,(0,f.generateCauseId)(),{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),w._localRecordingCreatedPromise.catch(v.noop),w._streamContextMap[0]=new j.SlimCoreElectronRemoteStreamContext,w._streamContextMap[1]=new j.SlimCoreElectronRemoteStreamContext,w._streamContextMap[2]=new j.SlimCoreElectronRemoteStreamContext,w.setPropertiesToLog([SlimCore.Enums.Property.CallStatus]),w}return i(t,e),Object.defineProperty(t.prototype,"callMode",{get:function(){return this._mode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transferState",{get:function(){return this._transferState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parkState",{get:function(){return this._parkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRecordingLocally",{get:function(){return this._isLocalRecordingRunning},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"publishedStates",{get:function(){return this._publishedStates},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"participantCounts",{get:function(){return this._participantCounts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spamRiskLevel",{get:function(){return this._spamRiskLevel},set:function(e){e&&(this._spamRiskLevel=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spamStirAttestation",{get:function(){return this._spamStirAttestation},set:function(e){e&&(this._spamStirAttestation=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"meetingData",{get:function(){return this._meetingData},set:function(e){this._logger&&this._logger.info("Set meetingData: _meetingData=".concat(this._meetingData,", value:").concat(e)),this._meetingData=e},enumerable:!1,configurable:!0}),t.prototype.updateMeetingStates=function(e,t){for(var n,r,i=this,o={},a=0,s=Object.keys(e.meetingStates);a<s.length;a++){var c=s[a],d=e.operationId+"_"+c,p=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.UPDATE_MEETING_STATES,d,t);null!==(n=o[r=e.operationId])&&void 0!==n||(o[r]={}),o[e.operationId][c]=p,this._callTelemetry.recordOperation(h.CALL_OPERATIONS.UPDATE_MEETING_STATES,t,d)}return Promise.resolve().then((function(){return l(i,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:return[4,this._slimcoreCallHandler.updateMeetingStates(this.slimcoreCallId,t,e.operationId,JSON.stringify(e.meetingStates))];case 1:return[2,n.sent()]}}))}))})).catch((function(e){throw i._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_STATES,{error:(0,C.getPIISafeObject)(e)},t),i._logger.logFailure(e),(0,y.getRejectTransactionEnd)(e)})).then((function(){return o}))},t.prototype.init=function(e){this._logger.info("init callInitOptions:".concat((0,C.safeJsonStringify)((0,C.getPIISafeCallInitOptions)(e)))),this._setMessageId(e.messageId),e.threadId&&this._setThreadId(e.threadId),this.meetingInfo=e.meetingInfo,this._enableGroupCallMeetupGeneration=!!e.enableGroupCallMeetupGeneration,e.transferContext&&(this._transferContext=e.transferContext,1===e.transferContext.transferType?this._setCallOrigin(2):0===e.transferContext.transferType?this._setCallOrigin(1):2===e.transferContext.transferType&&this._setCallOrigin(3),e.transferContext.transferorMri&&this._updateTransferorMri(e.transferContext.transferorMri)),this._endpointMetadata=e.endpointMetadata,this.onBehalfOfMri=e.onBehalfOf,this.onBehalfOfUserDisplayName=e.onBehalfOfUserDisplayName,this._emergencyContent=e.emergencyContent,this._mediaPeerType=e.mediaPeerType,this.broadcastMeeting&&(this.broadcastMeeting.context=e.broadcastContext),this._setIsEmergency(!!e.isEmergency),this.raiseChangedDeferredIfEnabled()},t.prototype.setDeviceManager=function(e){},t.prototype.setCallConstraints=function(e){throw new Error("Unsupported")},t.prototype.switchInterpreterGroup=function(e){return l(this,void 0,void 0,(function(){return u(this,(function(t){return this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.SWITCH_INTERPRETER_GROUP)&&this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.SWITCH_INTERPRETER_GROUP,(0,y.getRejectTransactionEnd)("Reject Pending Switch Interpreter Group Operation")),[2,this._switchInterpreterGroup(e.targetGroupId,e.causeId)]}))}))},t.prototype._switchInterpreterGroup=function(e,t){return l(this,void 0,void 0,(function(){var n;return u(this,(function(r){return this._logger.createFnLogger(h.CALL_OPERATIONS.SWITCH_INTERPRETER_GROUP,t).info("targetGroupId: ".concat(e)),n=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.SWITCH_INTERPRETER_GROUP,"",t),this._slimcoreCallHandler.switchInterpreterGroup(this.slimcoreCallId,e,t),[2,n]}))}))},t.prototype.processCallStartOptions=function(e,t){var n=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.PROCESS_CALL_START_OPTIONS,t);try{1&e.preheatFlags&&(this.isPreheatEnabled=!0)}catch(e){n.logFailure(e)}},t.prototype.setMuteAndTriggerEvent=function(e,t){var n=this.isMuted!==e;this.isMuted=e,n&&this.event("muteStateChanged").raise(this.isMuted,t)},t.prototype.containsMultipleVideos=function(e){return e&&e.sendMediaModalities&&e.sendMediaModalities.mediaStates&&d.filter(e.sendMediaModalities.mediaStates,(function(e){return 1===e.mediaType&&!e.isDisabled})).length>1},t.prototype.join=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r,i;return u(this,(function(a){return r=this._logger.createFnLogger(h.CALL_OPERATIONS.JOIN_CALL,n),i={shouldResurrect:this._getResurrectPreferrence()},r.info("Starting join call with context : ".concat(e)),[2,this._join(h.CALL_OPERATIONS.JOIN_CALL,e,o(o({},t),i),n)]}))}))},t.prototype._join=function(e,t,n,r){return l(this,void 0,void 0,(function(){var i;return u(this,(function(a){return this._setCallerMri((0,E.stripMriAliases)(t.groupCallInitiator),r),this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.JOIN),this.containsMultipleVideos(n)&&this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),1&n.preheatFlags&&this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.PREHEAT),n.muteFlags&&(i={muteMicrophone:!!(1&n.muteFlags),muteSpeaker:!!(2&n.muteFlags)},this._callTelemetry.updateOperationData(e,i,r)),this._callTelemetry.setPreheatFlags(n.preheatFlags),this.connectCallPromise=this._callOperationHandler.waitForOperation(e),[2,this._joinOrStartCall(e,o(o(o({},t),n),{videoDirection:A.returnVideoDirection(n),scenario:A.mapToEmptyStrIfFalsy(n.scenario),sendMediaModalities:A.returnStringifiedVersionOfMediaStateConfiguration(n.sendMediaModalities)}),r)]}))}))},t.prototype._getResurrectPreferrence=function(){return this.meetingInfo?"resurrect":"doNotResurrect"},t.prototype.start=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n;return u(this,(function(r){return n={shouldResurrect:this._getResurrectPreferrence()},[2,this._start(h.CALL_OPERATIONS.START_CALL,o(o({},e),n),t)]}))}))},t.prototype._start=function(e,t,n){return l(this,void 0,void 0,(function(){var r,i,a,s,c=this;return u(this,(function(l){return r=this._logger.createFnLogger(e,n),this._setCallerMri(E.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,n),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this.containsMultipleVideos(t)&&this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),1&t.preheatFlags?this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.PREHEAT):t.encryptedKey&&this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.ENCRYPTED),this.connectCallPromise=this._callOperationHandler.waitForOperation(e),t.muteFlags&&(i={muteMicrophone:!!(1&t.muteFlags),muteSpeaker:!!(2&t.muteFlags)},this._callTelemetry.updateOperationData(e,i,n)),this._callTelemetry.setPreheatFlags(t.preheatFlags),this._transferContext?(r.info("Transfer: Starting transfered call."),(a=this._transferContext.context).newCallObjectId?(this._setCallType(1),s=4===A.returnVideoDirection(t),2===this._transferContext.transferType&&(s=!1),[2,this._callOperationHandler.execute((function(){return c._startTransferTargetCall(a.newCallObjectId,s,n,c._mediaPeerType)}),h.CALL_OPERATIONS.START_TRANSFER_TARGET_CALL)]):[2,Promise.reject(new Error("Transfer: Transfered context is invalid. Missing callObjectId or newCallObjectId"))]):[2,this._joinOrStartCall(e,o(o({},t),{videoDirection:A.returnVideoDirection(t),conversationType:this.isEmergency?"emergencyGroupCall":t.isCast?"cast":"",scenario:A.mapToEmptyStrIfFalsy(t.scenario),sendMediaModalities:A.returnStringifiedVersionOfMediaStateConfiguration(t.sendMediaModalities)}),n)]}))}))},t.prototype.startCallToVoicemail=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return this._setCallerMri(E.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,t),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL),[2,this._joinOrStartCall(h.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{callToVoicemail:!0,voicemailResourcePath:e.voicemailResourcePath,voicemailItemId:e.voicemailItemId},t)]}))}))},t.prototype.startWithMeetingData=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(n){return[2,this._start(h.CALL_OPERATIONS.START_WITH_MEETING_DATA,t,e)]}))}))},t.prototype.joinWithMeetingData=function(e,t,n){return l(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this._join(h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,t,n,e)]}))}))},t.prototype.subscribeWithMeetingData=function(e,t,n){return l(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this._subscribe(h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,t,n,e)]}))}))},t.prototype.startCallWithNudge=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r,i;return u(this,(function(a){return this._setCallerMri(E.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,n),r=this._logger.createFnLogger(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,n),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this.containsMultipleVideos(t)&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),t.encryptedKey&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h.OPERATION_VARIANTS.ENCRYPTED),d.isEmpty(e)?(r.logFailure("No participants provided to nudge"),[2,Promise.reject(new Error("No participants provided to nudge"))]):t.isCast&&t.isHuddleGroupCall?(r.logFailure("Cast ".concat(t.isCast," huddleGroupCall ").concat(t.isHuddleGroupCall)),[2,Promise.reject(new Error("isCast or huddleGroupCall can only be set exclusively."))]):(this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE),i=t.isCast?"cast":t.isHuddleGroupCall?"huddleGroupCall":"",[2,this._joinOrStartCall(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,o(o({},t),{videoDirection:A.returnVideoDirection(t),ringOthers:!1,conversationType:i,participantsToNudge:e,invitationType:SlimCore.Enums.InvitationType.Nudge,scenario:A.mapToEmptyStrIfFalsy(t.scenario),sendMediaModalities:A.returnStringifiedVersionOfMediaStateConfiguration(t.sendMediaModalities)}),n)])}))}))},t.prototype.startAndUnpark=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var i,a;return u(this,(function(s){switch(this._setCallerMri(E.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,r),i=this._logger.createFnLogger(h.CALL_OPERATIONS.START_CALL_AND_UNPARK,r),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this.containsMultipleVideos(n)&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),n.encryptedKey&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.START_CALL_AND_UNPARK,h.OPERATION_VARIANTS.ENCRYPTED),this._setCallType(1),this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.START_CALL_AND_UNPARK),a=h.UNPARK_CODE.SERVER_HOLD,e){case 0:a=h.UNPARK_CODE.PARK;break;case 1:a=h.UNPARK_CODE.SHARED_LINE;break;case 5:a=h.UNPARK_CODE.CALL_PARK;break;case 2:a=h.UNPARK_CODE.SERVER_HOLD;break;default:throw new Error("[startAndUnpark] unsupported ParkContext name: ".concat(e))}return this.addParticipant("4:".concat(a),void 0,r).catch((function(e){i.logFailure("Failed to add participant to unparked call=".concat(e))})),[2,this._joinOrStartCall(h.CALL_OPERATIONS.START_CALL_AND_UNPARK,o(o({},n),{videoDirection:A.returnVideoDirection(n),conversationType:n.isCast?"cast":"",parkContext:e,pickupCode:t,scenario:A.mapToEmptyStrIfFalsy(n.scenario),sendMediaModalities:A.returnStringifiedVersionOfMediaStateConfiguration(n.sendMediaModalities)}),r)]}))}))},t.prototype.joinCallWithoutCallModality=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r;return u(this,(function(i){return r={shouldResurrect:this._getResurrectPreferrence()},[2,this._subscribe(h.CALL_OPERATIONS.SUBSCRIBE,e,o(o({},t),r),n)]}))}))},t.prototype._subscribe=function(e,n,r,i){return l(this,void 0,void 0,(function(){var o,a,s,c,l;return u(this,(function(u){switch(u.label){case 0:if(this._setCallerMri((0,E.stripMriAliases)(n.groupCallInitiator),i),(o=this._logger.createFnLogger(e,i)).info("".concat(e,": ").concat(n.conversationUrl)),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.SUBSCRIBE),n.conversationUrl||this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.CCWM),0!==this.state)return o.logFailure("Trying to start a call that has already been acted on"),[2,Promise.reject(new Error("Trying to start a call that has already been acted on"))];a={audioDirection:SlimCore.Enums.MediaDirection.Disabled,videoDirection:SlimCore.Enums.MediaDirection.Disabled,screenshareDirection:SlimCore.Enums.MediaDirection.Disabled,datachannelDirection:SlimCore.Enums.MediaDirection.Disabled,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:!1,isGoLive:!r.ringOthers,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,groupId:A.mapToEmptyStrIfFalsy(this.groupId),threadId:A.mapToEmptyStrIfFalsy(this.threadId),messageId:A.mapToEmptyStrIfFalsy(this.messageId),subject:A.mapToEmptyStrIfFalsy(r.label),conversationType:A.mapToEmptyStrIfFalsy(n.conversationType),meetingInfo:A.mapToEmptyStrIfFalsy(JSON.stringify(this.meetingInfo)),endpointMetadata:A.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:A.mapToEmptyStrIfFalsy(this.onBehalfOfMri),onBehalfOfUserDisplayName:A.mapToEmptyStrIfFalsy(this.onBehalfOfUserDisplayName),emergencyContent:A.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:"",encryptedKey:"",invitationType:SlimCore.Enums.InvitationType.None,connectionType:SlimCore.Enums.ConnectionType.AllSupported,maxVideoChannels:r.maxVideoChannels||0,maxVbssChannels:r.maxVbssChannels||0,publishedStatesJson:A.mapToEmptyStrIfFalsy(JSON.stringify(r.publishedStates)),muteFlags:r.muteFlags,negotiationTag:A.mapToEmptyStrIfFalsy(r.negotiationTag),routingFlags:r.routingFlags,scenario:A.mapToEmptyStrIfFalsy(r.scenario),mediaConfigurationJson:A.mapToEmptyStrIfFalsy(JSON.stringify(r.mediaConfiguration)),mediaStateConfigurationJson:A.returnStringifiedVersionOfMediaStateConfiguration(r.sendMediaModalities),clientEndpointCapabilities:r.clientEndpointCapabilities,clientEndpointDebugContent:A.mapToEmptyStrIfFalsy(r.clientEndpointDebugContent),additionalEndpointProperties:A.mapToEmptyStrIfFalsy(JSON.stringify(null==r?void 0:r.additionalEndpointProperties)),invitationDataJson:A.mapToEmptyStrIfFalsy(r.invitationDataJson),meetingRegistrationId:A.mapToEmptyStrIfFalsy(r.meetingRegistrationId),participantPin:A.mapToEmptyStrIfFalsy(r.participantPin)},u.label=1;case 1:switch(u.trys.push([1,9,,10]),s=void 0,c=JSON.stringify({conversationUrl:n.conversationUrl,conversationId:this.callId,conversationType:n.conversationType}),e){case h.CALL_OPERATIONS.SUBSCRIBE:return[3,2];case h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA:return[3,4]}return[3,6];case 2:return[4,this._slimcoreCallHandler.subscribe(c,a)];case 3:return s=u.sent(),[3,7];case 4:return[4,this._slimcoreCallHandler.subscribeToSignalingSessionWithMeetingData(JSON.stringify(this.meetingData),r.shouldResurrect,c,a)];case 5:return s=u.sent(),[3,7];case 6:throw new Error("[_subscribe] unsupported operation name: ".concat(e));case 7:return this._setCallState(8,i),[4,this.attachSlimCoreCallObject(s,i,e)];case 8:return u.sent(),A.hasFeature(SlimCore.Enums.Feature.ObservingStateSupported)?[2,this._callOperationHandler.waitForOperation(e,void 0,i)]:[2,Promise.resolve()];case 9:throw l=u.sent(),o.logFailure("sync failure, cleaning up slimcore ready operation: error=".concat((0,C.getPrintableObject)(l))),this._callTelemetry.updateOperationData(e,{error:(0,C.getPIISafeObject)(l)},i),this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),l;case 10:return[2]}}))}))},t.prototype._assertSlimcoreObjectId=function(e,t){if(0===e)throw new Error("".concat(t," Failed. Slimcore returned objectId of 0"))},t.prototype.joinPreheatedCall=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:if(n=this._logger.createFnLogger(h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,t),11!==this.state&&12!==this.state)return n.logFailure("Trying to join a call that is not in preheating state"),[2,Promise.reject(new Error("Trying to join a call that is not in preheating state"))];1&~e.muteFlags||(n.info("isMuted set to true in joinPreheatedCall, causeId=".concat(t)),this.setMuteAndTriggerEvent(!0,t)),2&~e.muteFlags||(n.info("isSpeakerMuted set to true in joinPreheatedCall"),this.isSpeakerMuted=!0),this._setCallState(2,t),this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.JOIN_PREHEATED_CALL),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._slimcoreCallHandler.joinPreheatedCall(this.slimcoreCallId,t,e.muteFlags,A.mapToEmptyStrIfFalsy(JSON.stringify(e.publishedStates)))];case 2:return i.sent(),[3,4];case 3:throw r=i.sent(),this.stopInternal({causeId:t,terminatedReason:7}),n.logFailure(r),r;case 4:return[2,this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,void 0,t)]}}))}))},t.prototype.toggleVideoFlagsWhileConnecting=function(e){e?(this._videoRequestedOnWhileConnecting=!0,this._videoRequestedOffWhileConnecting=!1):(this._videoRequestedOnWhileConnecting=!1,this._videoRequestedOffWhileConnecting=!0)},t.prototype.startVideoSafe=function(e){var t=this;return this.startVideo(e).catch((function(n){t._logger.createFnLogger(h.CALL_OPERATIONS.START_VIDEO,e).logFailure(n)}))},t.prototype.startVideo=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r,i=this;return u(this,(function(o){return n=this._logger.createFnLogger(h.CALL_OPERATIONS.START_VIDEO,t),this.callStateCanToggleVideo()?(r=Promise.resolve().then((function(){return i._startLocalVideo(e,t)})).then((function(){i._setVideoOn(!0,t)})),[2,this._callOperationHandler.registerPromise(h.CALL_OPERATIONS.START_VIDEO,r).catch((function(n){throw i._callTelemetry.updateOperationData(h.CALL_OPERATIONS.START_VIDEO,{error:(0,C.getPIISafeObject)(n)},t),i._logger.logFailure(n),i.stopVideo(e,t).catch(v.noop),n}))]):(n.info("startVideo called but call is not in togglable state - starting preview only, video will start once available"),this.toggleVideoFlagsWhileConnecting(!0),this._setVideoOn(!0,t),[2])}))}))},t.prototype.cleanupLocalVideo=function(e){var t=this._getLocalVideo();t&&(this._removeMediaStream(t),t.dispose(e)),this._setVideoOn(!1,e)},t.prototype.stopVideo=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r,i=this;return u(this,(function(o){return n=this._logger.createFnLogger(h.CALL_OPERATIONS.STOP_VIDEO,t),this.callStateCanToggleVideo()?(r=Promise.resolve().then((function(){return l(i,void 0,void 0,(function(){var r;return u(this,(function(i){switch(i.label){case 0:return(r=this._getLocalVideo())?[4,A.forgetAndLog(r.stop(t,e),n,"stopVideo: stopping localVideo")]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))})),[2,this._callOperationHandler.registerPromise(h.CALL_OPERATIONS.STOP_VIDEO,r).then((function(){i.cleanupLocalVideo(t)}),(function(e){i._callTelemetry.updateOperationData(h.CALL_OPERATIONS.STOP_VIDEO,{error:(0,C.getPIISafeObject)(e)},t),n.logFailure(e),i.cleanupLocalVideo(t)}))]):(this._videoRequestedOnWhileConnecting?(n.info("stopVideo called but call is not in togglable state - video will stop once available"),this.toggleVideoFlagsWhileConnecting(!1),this._setVideoOn(!1,t)):n.info("stopVideo called but call is not in togglable state - enabling video was not requested anyway, so ignoring"),[2,Promise.resolve()])}))}))},Object.defineProperty(t.prototype,"endpointId",{get:function(){return this._endpointId},enumerable:!1,configurable:!0}),t.prototype._setEndpointId=function(e){this._endpointId=e,this._callTelemetry.setEndpointId(e)},t.prototype._setFailureType=function(e){this._callTelemetry.setFailureType(e),this.failureType=e},t.prototype._setGroupId=function(e){this._logger.info("Set groupId:".concat(O.scrubMriOrOmit(e))),this.groupId=e,this._callTelemetry.setGroupId(e)},t.prototype._setThreadId=function(e){this._logger.info("Set threadId:".concat(O.getLoggableThreadId(e))),this.threadId=e,this._callTelemetry.setThreadId(e)},t.prototype._setMessageId=function(e){this._logger.info("Set messageId:".concat(e)),this.messageId=e,this._callTelemetry.setMessageId(e)},t.prototype._setCallType=function(e){this._logger.info("Set callType:".concat(e)),this.callType=e,this._callTelemetry.setCallType(e)},t.prototype._setCallerMri=function(e,t){this._logger.info("[".concat(t,"]Set callerMri:").concat(O.scrubMriOrOmit(e))),this.callerMri=e},t.prototype._setCallOrigin=function(e){this._logger.info("Set origin:".concat(e)),this._origin=e,this._callTelemetry.setCallOrigin(e)},t.prototype._setIsCast=function(e){this._logger.info("Set isCast:".concat(e)),this.isCast=e,this._callTelemetry.setIsCast(e)},t.prototype._setIsHuddleGroupCall=function(e){this._logger.info("Set isHuddleGroupCall:".concat(e)),this.isHuddleGroupCall=e,this._callTelemetry.setIsHuddleGroupCall(e)},t.prototype._setIsEmergency=function(e){this._logger.info("Set isEmergency:".concat(e)),this.isEmergency=e,this._callTelemetry.setIsEmergency(e)},t.prototype._setApplicationType=function(e){this._logger.info("Set applicationType:".concat(e)),this.applicationType=e,this._callTelemetry.setApplicationType(e)},t.prototype._addToMediaStreams=function(e){this.localMediaStreams.push(e),this.raiseChangedDeferredIfEnabled()},t.prototype._removeMediaStream=function(e){d.remove(this.localMediaStreams,e),this.raiseChangedDeferredIfEnabled()},t.prototype._getLocalVideo=function(){return d.find(this.localMediaStreams,(function(e){return 1===e.mediaType}))},t.prototype._getlocalScreenShareStream=function(){return d.find(this.localMediaStreams,(function(e){return 2===e.mediaType}))},t.prototype._startLocalVideo=function(e,t){var n=this._getLocalVideo();return n||(n=new F.default(t,this._logger,this._settings,this._slimcoreInstance,this._ecs,this.slimcoreCallId,this._slimcoreCallHandler,this._deviceManager,{enableMultiVideo:2===this.callType}),this._addToMediaStreams(n)),n.start(t,e)},t.prototype.dumpVideoSourceImages=function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){return[2,0]}))}))},t.prototype.startScreenSharing=function(e,t,n,r){var i;return void 0===r&&(r=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var o=this;return u(this,(function(a){return(null===(i=this.screenSharingControl)||void 0===i?void 0:i.isScreenSharingControlEnabled())&&this.screenSharingControl.shutdownControlForViewer(),[2,Promise.resolve().then((function(){var e=o._getlocalScreenShareStream();return e||(e=new k.default(r,o._logger,o._settings,o._slimcoreInstance,o.slimcoreCallId,o._slimcoreCallHandler,o._deviceManager,o._appHooks,o._callTelemetry),o._addToMediaStreams(e),e.changed((function(){o._onLocalScreenShareStreamChanged(r)})),e.on("sharingSourceLost",(function(){o._onLocalScreenShareSourceLost()})),e.on("windowClosed",(function(){return o.stopScreenSharing(!1,n,r)})),e.on("scraperEvent",(function(e){o._onScraperEvent(e)})),e.on("shellSharingStopped",(function(){return o.stopScreenSharing(!1,n,r)})),e.on("setInjectorRectFailed",(function(e){o.screenSharingControl.enableScreenSharingControl(!1,0,e)})),e.on("captureRegionAndWindow",(function(e,t){o._onScreenShareCaptureRegionAndWindowSet(e,t)}))),e})).then((function(i){return o._isLocalRecordingRunning&&o._appHooks.hideSharingIndicator(),i.start(r,e,t,n)}))]}))}))},t.prototype.changeCropRegion=function(e){return l(this,void 0,void 0,(function(){var t;return u(this,(function(n){return(t=this._getlocalScreenShareStream())?[2,t.changeCropRegion(e)]:[2]}))}))},t.prototype._onLocalScreenShareSourceLost=function(){var e;(null===(e=this.screenSharingControl)||void 0===e?void 0:e.isScreenSharingControlEnabled())&&this.screenSharingControl.shutdownControlForSharer();var t=this._getlocalScreenShareStream();t&&t.isStreaming&&this.event("sharingDropped").raise()},t.prototype._onScraperEvent=function(e){var t={event:e.event,data:e.data};this.event("scraperEvent").raise(t)},t.prototype.raiseRenderedAtViewer=function(e){this.event("sharingRenderedAtViewer").raise(e)},t.prototype._onLocalScreenShareStreamChanged=function(e){var t,n,r=this._getlocalScreenShareStream();r&&r.isStreaming?(!this.isScreenSharingOn&&this._dataChannel&&(null===(t=this.screenSharingControl)||void 0===t?void 0:t.isScreenSharingControlEnabled())&&(this.screenSharingControl.initControlForSharer(r.negotiationTag),this.screenSharingControl.enableControlInjector(""),this._dataChannel.start()),this._setScreenSharingOn(!0,e)):r&&!r.isAvailable&&(this.isScreenSharingOn&&(null===(n=this.screenSharingControl)||void 0===n?void 0:n.isScreenSharingControlEnabled())&&this.screenSharingControl.shutdownControlForSharer(),this._setScreenSharingOn(!1,e))},t.prototype.startLocalRecording=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:if(this._logger.info("startLocalRecording with causeId ".concat(t)),!this._isLocalRecordingAllowedByEcs)throw(0,y.getRejectTransactionEnd)("LocalRecording feature is turned off",h.TRANSACTION_END_SUBCODE.NOT_IMPLEMENTED);return this._localRecordingPromiseOnHold?[4,this._localRecordingPromiseOnHold]:[3,2];case 1:n.sent(),this._localRecordingPromiseOnHold=null,n.label=2;case 2:if(0===this.slimcoreCallId||!this._localRecordingInstance)throw(0,y.getRejectTransactionEnd)("Local Recording cannot be started if the call has not been started",h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED);return[4,this._localRecordingCreatedPromise];case 3:if(n.sent(),this._isLocalRecordingRunning)throw this._logger.warn("LocalRecording::IS_RUNNING"),(0,y.getRejectTransactionEnd)("Should not start LocalRecording when it has already been started",h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED);if(void 0!==e.callWindow){if(void 0===e.location)throw(0,y.getRejectTransactionEnd)("StartLocalRecordingOptions requires location when callWindow is set.",h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED);this._localRecordingCallWindowId=e.callWindow.getNativeWindowId(),this._localRecordingStartParameters={storageLocation:e.location}}else{if(void 0===e.callWindowId)throw(0,y.getRejectTransactionEnd)("StartLocalRecordingOptions requires callWindowId",h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED);if(void 0===e.recordingTitle)throw(0,y.getRejectTransactionEnd)("StartLocalRecordingOptions requires recordingTitle",h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED);if(void 0===e.meetingTime)throw(0,y.getRejectTransactionEnd)("StartLocalRecordingOptions requires meetingTime",h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED);this._localRecordingCallWindowId=e.callWindowId,this._localRecordingStartParameters={recordingTitle:e.recordingTitle,meetingTime:e.meetingTime,recordingTitleSuffix:e.recordingTitleSuffix,additionalData:e.additionalData}}return[4,this._startLocalRecording(t)];case 4:return[2,n.sent()]}}))}))},t.prototype._startLocalRecording=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,a=this;return u(this,(function(s){switch(s.label){case 0:return this._logger.info("_startLocalRecording with causeId ".concat(e)),this._localRecordingPromiseOnHold?[4,this._localRecordingPromiseOnHold]:[3,2];case 1:s.sent(),this._localRecordingPromiseOnHold=null,s.label=2;case 2:return 4!==this._state&&5!==this._state?[3,4]:(this._resumeLocalRecordingAfterCallResumesFromHold=!0,void 0!==this._localRecordingStartParameters.storageLocation?[2,o(o({},(0,y.getSuccessTransactionEnd)()),{sessionId:"",accountIdentity:""})]:[4,this._slimcoreInstance.getOrCreateLocalRecordingSessionInfo({accountIdentity:this.currentUserSkypeIdentity.id,causeId:e,recordingTitle:this._localRecordingStartParameters.recordingTitle,meetingTime:this._localRecordingStartParameters.meetingTime,recordingTitleSuffix:this._localRecordingStartParameters.recordingTitleSuffix,additionalData:this._localRecordingStartParameters.additionalData})]);case 3:return t=s.sent(),[2,o(o({},(0,y.getSuccessTransactionEnd)()),{sessionId:t.id,accountIdentity:this.currentUserSkypeIdentity.id})];case 4:return n=this._getlocalScreenShareStream(),(null==n?void 0:n.isActive())?[4,this._setLocalRecordingCaptureToPresenter(e)]:[3,6];case 5:return s.sent(),[3,8];case 6:return[4,this._localRecordingInstance.setCaptureRegionAndWindow(e,0,0,0,0,this._localRecordingCallWindowId).catch((function(t){throw a._logger.error("setCaptureRegionAndWindow ".concat(a._localRecordingCallWindowId," with causeId ").concat(e," failed with reason ").concat(t.message)),{code:2147500037,subCode:0,phrase:"LocalRecording setCaptureRegionAndWindow ".concat(a._localRecordingCallWindowId," with reason ").concat(t.message)}}))];case 7:s.sent(),s.label=8;case 8:return r=null,i=new Promise((function(t,n){r=a._localRecordingInstance.handle("local-recording-start-result",{causeId:e},(function(r){if(a._logger.info("LocalRecording::START_LOCAL_RECORDING returned from slimcore with ".concat(JSON.stringify(r))),r.failureReason===SlimCore.Enums.LocalRecordingFailureReason.NoFailure){a._isLocalRecordingRunning=!0;var i=a._getlocalScreenShareStream();((null==i?void 0:i.isActive())?a._setLocalRecordingCaptureToPresenter(e):a._localRecordingInstance.setCaptureRegionAndWindow(e,0,0,0,0,a._localRecordingCallWindowId).then((function(){a._logger.info("LocalRecording::Start local Screen Sharing of the call window via LocalRecording"),a._appHooks.showSharingIndicator(a._localRecordingCallWindowId,"local-recording")}),(function(t){throw a._logger.error("setCaptureRegionAndWindow ".concat(a._localRecordingCallWindowId," with causeId ").concat(e," failed with reason ").concat(t.message)),{code:2147500037,subCode:0,phrase:"LocalRecording setCaptureRegionAndWindow ".concat(a._localRecordingCallWindowId," with reason ").concat(t.message)}}))).then((function(){a.event("localRecordingEvent").raise({event:0}),t(o(o({},(0,y.getSuccessTransactionEnd)()),{sessionId:r.sessionId,accountIdentity:a.currentUserSkypeIdentity.id}))}),n)}else{a.event("localRecordingEvent").raise({event:2,data:q(r.failureReason)}),a._logger.error("Local recording start with causeId ".concat(e," failed with reason ").concat(r.failureReason));var s={code:r.code,subCode:r.subCode,phrase:"LocalRecording failed to start with reason ".concat(q(r.failureReason))};n(s)}}))})).finally((function(){r.dispose(e)})),[4,this._localRecordingInstance.start(this._localRecordingStartParameters,e).catch((function(e){throw a.event("localRecordingEvent").raise({event:2,data:8}),{code:2147500037,subCode:0,phrase:"LocalRecording failed to start with reason ".concat(e.message)}}))];case 9:return s.sent(),this._logger.info("LocalRecording::START_LOCAL_RECORDING"),this._resumeLocalRecordingAfterCallResumesFromHold=!1,[4,i];case 10:return[2,s.sent()]}}))}))},t.prototype._onLocalRecordingError=function(e){this.event("localRecordingEvent").raise({event:2,data:q(e.failureReason)})},t.prototype._onScreenShareCaptureRegionAndWindowSet=function(e,t){this._presenterRegion=e,this._presenterWindowId=t,this._setLocalRecordingCaptureToPresenter("screenshare")},t.prototype._setLocalRecordingCaptureToPresenter=function(e){var t,n,r,i,o,a,s,c,d,p;return l(this,void 0,void 0,(function(){var l=this;return u(this,(function(u){switch(u.label){case 0:return this._logger.info("_setLocalRecordingCaptureToPresenter"),(null===(t=this._localRecordingInstance)||void 0===t?void 0:t.setCaptureRegionAndWindow)&&(this._presenterRegion||this._presenterWindowId)?(this._logger.info("causeId: ".concat(e," region: ").concat(JSON.stringify(this._presenterRegion)," windowId: ").concat(JSON.stringify(this._presenterWindowId))),[4,this._localRecordingInstance.setCaptureRegionAndWindow(e,null!==(r=null===(n=this._presenterRegion)||void 0===n?void 0:n.x)&&void 0!==r?r:0,null!==(o=null===(i=this._presenterRegion)||void 0===i?void 0:i.y)&&void 0!==o?o:0,null!==(s=null===(a=this._presenterRegion)||void 0===a?void 0:a.width)&&void 0!==s?s:0,null!==(d=null===(c=this._presenterRegion)||void 0===c?void 0:c.height)&&void 0!==d?d:0,null!==(p=this._presenterWindowId)&&void 0!==p?p:0).catch((function(e){throw l.event("localRecordingEvent").raise({event:2,data:8}),{code:2147500037,subCode:0,phrase:"LocalRecording failed to start with reason ".concat(e.message)}}))]):[3,2];case 1:u.sent(),u.label=2;case 2:return[2]}}))}))},t.prototype.setMeetingLayout=function(e,t){throw new Error("Method not implemented.")},t.prototype.stopLocalRecording=function(e){return void 0===e&&(e=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:if(this._logger.info("stopLocalRecording with causeId ".concat(e)),!this._isLocalRecordingAllowedByEcs)throw(0,y.getRejectTransactionEnd)("LocalRecording feature is turned off",h.TRANSACTION_END_SUBCODE.NOT_IMPLEMENTED);return this._localRecordingPromiseOnHold?[4,this._localRecordingPromiseOnHold]:[3,2];case 1:t.sent(),this._localRecordingPromiseOnHold=null,t.label=2;case 2:if(this._resumeLocalRecordingAfterCallResumesFromHold)return this._resumeLocalRecordingAfterCallResumesFromHold=!1,[2,(0,y.getSuccessTransactionEnd)()];if(!this._isLocalRecordingRunning)throw this._logger.info("Trying to stop LocalRecording when already stopped"),(0,y.getRejectTransactionEnd)("LocalRecording can only be stopped after it has started",h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED);return[4,this._stopLocalRecording(e)];case 3:return[2,t.sent()]}}))}))},t.prototype._stopLocalRecording=function(e){return l(this,void 0,void 0,(function(){var t,n,r=this;return u(this,(function(i){switch(i.label){case 0:return this._logger.info("_stopLocalRecording with causeId ".concat(e)),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.STOP_LOCAL_RECORDING_START,null,e),this._localRecordingPromiseOnHold?[4,this._localRecordingPromiseOnHold]:[3,2];case 1:i.sent(),this._localRecordingPromiseOnHold=null,i.label=2;case 2:return t=null,n=new Promise((function(n,i){t=r._localRecordingInstance.handle("local-recording-stop-result",{causeId:e},(function(e){if(r._logger.info("LocalRecording::STOP_LOCAL_RECORDING returned from slimcore with ".concat(JSON.stringify(e))),e.failureReason===SlimCore.Enums.LocalRecordingFailureReason.NoFailure){var t=r._getlocalScreenShareStream();(null==t?void 0:t.isActive())||r._appHooks.hideSharingIndicator(),r._isLocalRecordingRunning=!1,r.event("localRecordingEvent").raise({event:1}),n((0,y.getSuccessTransactionEnd)())}else{r.event("localRecordingEvent").raise({event:2,data:q(e.failureReason)});var o={code:e.code,subCode:e.subCode,phrase:"LocalRecording failed to stop with reason ".concat(e.failureReason)};i(o)}}))})).finally((function(){t.dispose(e)})),[4,this._localRecordingInstance.stop(e).catch((function(t){throw r._logger.error("stop local recording with causeId ".concat(e," failed with reason ").concat(t.message)),{code:2147500037,subCode:0,phrase:"LocalRecording failed to start with reason ".concat(t.message)}}))];case 3:return i.sent(),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.STOP_LOCAL_RECORDING_END,{},e),this._logger.info("LocalRecording::STOP_LOCAL_RECORDING"),this._resumeLocalRecordingAfterCallResumesFromHold=!1,this._localRecordingPromiseOnHold=null,[4,n];case 4:return[2,i.sent()]}}))}))},t.prototype.includeSystemAudioInLocalRecording=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r,i=this;return u(this,(function(o){switch(o.label){case 0:if(!this._isLocalRecordingAllowedByEcs)throw(0,y.getRejectTransactionEnd)("LocalRecording feature is turned off",h.TRANSACTION_END_SUBCODE.NOT_IMPLEMENTED);return this._logger.info("LocalRecording::INCLUDE_SYSTEM_AUDIO"),n=null,r=new Promise((function(e,r){n=i._localRecordingInstance.handle("local-recording-include-system-audio-result",{causeId:t},(function(t){if(i._logger.info("LocalRecording::INCLUDE_SYSTEM_AUDIO returned from slimcore with ".concat(JSON.stringify(t))),t.failureReason===SlimCore.Enums.LocalRecordingFailureReason.NoFailure)e((0,y.getSuccessTransactionEnd)());else{i.event("localRecordingEvent").raise({event:2,data:q(t.failureReason)});var n={code:t.code,subCode:t.subCode,phrase:"LocalRecording failed to include system audio with reason ".concat(t.failureReason)};r(n)}}))})).finally((function(){n.dispose(t)})),[4,this._localRecordingInstance.includeSystemAudio({value:e.shouldSystemAudioBeIncluded},t).catch((function(n){throw i._logger.error("include system audio ".concat(e.shouldSystemAudioBeIncluded," with causeId ").concat(t," failed with reason ").concat(n.message)),{code:2147500037,subCode:0,phrase:"LocalRecording include system audio ".concat(e.shouldSystemAudioBeIncluded," with reason ").concat(n.message)}}))];case 1:return o.sent(),[4,r];case 2:return[2,o.sent()]}}))}))},t.prototype.overlayWindowInLocalRecording=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n=this;return u(this,(function(r){switch(r.label){case 0:if(!this._isLocalRecordingAllowedByEcs)throw(0,y.getRejectTransactionEnd)("LocalRecording feature is turned off",h.TRANSACTION_END_SUBCODE.NOT_IMPLEMENTED);return this._logger.info("LocalRecording::OVERLAY_WINDOW"),[4,this._localRecordingInstance.setOverlayWindow(t,e.overlayWindowId).catch((function(r){throw n._logger.error("setOverlayWindow ".concat(e.overlayWindowId," with causeId ").concat(t," failed with reason ").concat(r.message)),{code:2147500037,subCode:0,phrase:"LocalRecording setOverlayWindow ".concat(e.overlayWindowId," with reason ").concat(r.message)}}))];case 1:return r.sent(),[2,(0,y.getSuccessTransactionEnd)()]}}))}))},t.prototype.stopScreenSharing=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var e,r,i,o=this;return u(this,(function(a){return e=this._logger.createFnLogger(h.CALL_OPERATIONS.STOP_SCREEN_SHARING,n),r=function(){var e,t=o._getlocalScreenShareStream();t&&(o._removeMediaStream(t),t.dispose(n)),o._setScreenSharingOn(!1,n),(null===(e=o.screenSharingControl)||void 0===e?void 0:e.isScreenSharingControlEnabled())&&o.screenSharingControl.shutdownControlForSharer()},i=Promise.resolve().then((function(){return l(o,void 0,void 0,(function(){var r;return u(this,(function(i){switch(i.label){case 0:return(r=this._getlocalScreenShareStream())?[4,A.forgetAndLog(this.shareSystemSound(!1),e,"stopScreenSharing: set shareSystemSound to false.")]:[3,4];case 1:return i.sent(),[4,A.forgetAndLog(r.stop(n,t),e,"stopScreenSharing: stopping screen sharing")];case 2:return i.sent(),this._isLocalRecordingRunning?[4,this._localRecordingInstance.setCaptureRegionAndWindow(n,0,0,0,0,this._localRecordingCallWindowId)]:[3,4];case 3:i.sent(),this._appHooks.showSharingIndicator(this._localRecordingCallWindowId,"local-recording"),i.label=4;case 4:return[2]}}))}))})),[2,this._callOperationHandler.registerPromise(h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,i).then(r,(function(t){throw e.logFailure(t),r(),t}))]}))}))},t.prototype.startDataChannel=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return t.sent(),[2,this._dataChannel.start(e)]}}))}))},t.prototype.stopDataChannel=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return t.sent(),[2,this._dataChannel.stop(e)]}}))}))},t.prototype.sendUserEvents=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return n.sent(),[2,this._dataChannel.sendUserEvents(e,t)]}}))}))},t.prototype.shareSystemSound=function(e){return l(this,void 0,void 0,(function(){var t=this;return u(this,(function(n){return this._logger.info("shareSystemSound: ".concat(e)),[2,Promise.resolve().then((function(){t._slimcoreCallHandler.callShareSystemSound(t.slimcoreCallId,e)}))]}))}))},t.prototype.startFaceStream=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(n){return this._logger.info("startFaceStream: deviceid = ".concat(e,", recipientId = ").concat(t)),this._slimcoreCallHandler.startFaceStream(this.slimcoreCallId,e,t),[2]}))}))},t.prototype.stopFaceStream=function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){return this._logger.info("stopFaceStream"),this._slimcoreCallHandler.stopFaceStream(this.slimcoreCallId),[2]}))}))},t.prototype.startInRoomFaceAtrribution=function(e,t,n){return l(this,void 0,void 0,(function(){return u(this,(function(r){return this._logger.info("startInRoomFaceAtrribution : deviceid = ".concat(e,", recipientId = ").concat(t,", enableFaceStream = ").concat(n)),this._slimcoreCallHandler.startInRoomFaceAtrribution(this.slimcoreCallId,e,t,n),[2]}))}))},t.prototype.stopInRoomFaceAtrribution=function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){return this._logger.info("stopInRoomFaceAtrribution"),this._slimcoreCallHandler.stopInRoomFaceAtrribution(this.slimcoreCallId),[2]}))}))},t.prototype.startMultichannelAudioDevice=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(n){return this._logger.info("startMultichannelAudioDevice: ".concat(e)),[2,this._slimcoreCallHandler.startMultichannelAudioDevice(this.slimcoreCallId,e,t)]}))}))},t.prototype.stopMultichannelAudioDevice=function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){return this._logger.info("stopMultichannelAudioDevice"),[2,this._slimcoreCallHandler.stopMultichannelAudioDevice(this.slimcoreCallId)]}))}))},t.prototype.transferCall=function(e){return this._logger.warn("transferCall is deprecated, please use callBlindTransfer instead"),this.callBlindTransfer(e)},t.prototype.callBlindTransfer=function(e,t,n){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r;return u(this,(function(i){return r={transferTarget:e,transferType:0,transferStatusSuccessList:[SlimCore.Enums.CallStatus.Transferring,SlimCore.Enums.CallStatus.Transferred]},[2,this._transferCall(r,n,t)]}))}))},t.prototype.callSafeTransfer=function(e,t,n){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r;return u(this,(function(i){return r={transferTarget:e,transferType:0,transferStatusSuccessList:[SlimCore.Enums.CallStatus.Transferred]},[2,this._transferCall(r,n,t)]}))}))},t.prototype.transferCallToVoicemail=function(e,t){void 0===t&&(t=(0,f.generateCauseId)());var n={transferTarget:e.transferTargetMri,transferType:2,transferStatusSuccessList:[SlimCore.Enums.CallStatus.Transferred]};return this._transferCall(n,null,t)},t.prototype.callConsultativeTransfer=function(e,t,n,r){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var i,o=this;return u(this,(function(a){return i={targetCallId:e.slimcoreCallId,transferType:0,transferStatusSuccessList:[SlimCore.Enums.CallStatus.Transferred]},[2,this._transferCall(i,r,t,n).then((function(r){return o._callTelemetry.updateOperationData(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{participantLegId:n,targetCallId:e.callId},t),o._logger.logSuccess("[".concat(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,"][").concat(t,"] target call id: ").concat(e.callId," Transfer target participant_leg_id: ").concat(n)),Promise.resolve(r)})).catch((function(r){return o._callTelemetry.updateOperationData(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{error:(0,C.getPIISafeObject)(r),participantLegId:n,targetCallId:e.callId},t),o._logger.logFailure("[".concat(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,"][").concat(t,"] target call id: ").concat(e.callId," Transfer target participant_leg_id: ").concat(n," error: ").concat(r)),Promise.reject((0,y.getRejectTransactionEnd)(r))}))]}))}))},t.prototype.consultativeTransferWithPickupCode=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r,i=this;return u(this,(function(o){return(n=this._logger.createFnLogger(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,t)).info("pickup code: ".concat(e)),e?(r=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,"",t),[2,Promise.resolve().then((function(){i._slimcoreCallHandler.consultativeTransferWithOptions(i.slimcoreCallId,e,0,t)})).catch((function(e){return i._callTelemetry.updateOperationData(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,{error:(0,C.getPIISafeObject)(e)},t),n.logFailure(e),Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return r}))]):(n.info("pickup code cannot be empty"),[2,Promise.reject((0,y.getRejectTransactionEnd)("pickup code cannot be empty"))])}))}))},t.prototype._transferCall=function(e,t,n,r){return l(this,void 0,void 0,(function(){var i,o;return u(this,(function(a){if(this._logger.createFnLogger("Transfer",n).info("start"),this._setTransferState(1,n),i=this._waitForTransferSuccessOrFailure(e.transferStatusSuccessList,0,n),o=(null==t?void 0:t.clientTransferContext)?JSON.stringify(t.clientTransferContext):void 0,e.transferTarget&&2===e.transferType)this._slimcoreCallHandler.startCallTransfer(this.slimcoreCallId,e.transferTarget,SlimCore.Enums.TransferType.TransferToVoicemail,!1);else if(e.transferTarget)this._slimcoreCallHandler.startCallTransfer(this.slimcoreCallId,e.transferTarget,SlimCore.Enums.TransferType.TransferStandard,!(!t||!t.disableForwardingAndUnanswered),o);else{if(!e.targetCallId)return[2,Promise.reject(new Error("Either transferTarget/transfereeCallId should be present"))];this._slimcoreCallHandler.startConsultativeCallTransfer(e.targetCallId,this.slimcoreCallId,r,n,!(!t||!t.disableForwardingAndUnanswered),o)}return[2,i]}))}))},t.prototype.callRedirect=function(e,t){var n=this;void 0===t&&(t=(0,f.generateCauseId)());var r=this._logger.createFnLogger("CallRedirect",t),i={id:e.id,redirectionTargetIdType:SlimCore.Enums.RedirectionTargetIdType.Mri,redirectionEndpointType:"default"===e.endpointType?SlimCore.Enums.RedirectionEndpointType.RedirectionDefault:SlimCore.Enums.RedirectionEndpointType.RedirectionVoicemail};return r.info("Start Redirecting call with endpoint type as ".concat(i.redirectionEndpointType)),Promise.resolve().then((function(){n._slimcoreCallHandler.startCallRedirect(n.slimcoreCallId,t,i)})).catch((function(e){return r.info("Redirecting call failed with error: ".concat(JSON.stringify(e))),Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.CALL_REDIRECT,t)})).catch((function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.CALL_REDIRECT,{error:(0,C.getPIISafeObject)(e)},t),r.logFailure(e),e}))},t.prototype.park=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r,i,o,a,s=this;return u(this,(function(c){return n={context:e,parkStatusSuccessList:[SlimCore.Enums.CallStatus.Parked]},(r=this.mapParkContext(n.context))===SlimCore.Enums.ParkContext.Invalid?[2,Promise.reject("invalid park context ".concat(r))]:3===e||4===e?(i=this._logger.createFnLogger("Park",t),o=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.PARK_CALL,"",t),[2,Promise.resolve().then((function(){s._slimcoreCallHandler.startCallPark(s.slimcoreCallId,r,t)})).then((function(){return o})).then((function(e){return i.info("operation succeeded: result: ".concat(JSON.stringify(e))),""}))]):5===e?(a=this._logger.createFnLogger("Park",t),this._parkCompletePromise=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_PARK_V2,void 0,t),this._slimcoreCallHandler.startCallPark(this.slimcoreCallId,r,t),[2,this._parkCompletePromise.then((function(){try{var e=s._getProperties(s.slimcoreCallId,{pickupCode:{propKey:SlimCore.Enums.Property.CallParkPickupCode},serverHoldLocation:{propKey:SlimCore.Enums.Property.CallServerHoldLocation},parkAdditionalContextJson:{propKey:SlimCore.Enums.Property.CallParkAdditionalContextJson}},{}),t=e.pickupCode,n=e.serverHoldLocation,r=e.parkAdditionalContextJson;return s._serverHoldLocation=n,s._parkAdditionalContextJson=r,a.info("pickupCode: ".concat(t,", serverHoldLocation: ").concat(s._serverHoldLocation,",\n                        parkAdditionalContextJson: ").concat(s._parkAdditionalContextJson)),Promise.resolve(t)}catch(e){a.logFailure(e);var i="Park operaton succeeded but failed to fetch properties with error: ".concat(e),o={terminatedReason:32,terminatedReasonCode:m.CONSTANTS.CODE.UNKNOWN_ERROR,terminatedReasonSubCode:m.CONSTANTS.SUB_CODE.UNKNOWN_FAILURE,errorMessage:i};return Promise.reject(o)}}))]):(this._setParkState(1,t),this._parkCompletePromise=this._waitForTransferSuccessOrFailure(n.parkStatusSuccessList,1,t),this._slimcoreCallHandler.startCallPark(this.slimcoreCallId,r,t),[2,this._parkCompletePromise.then((function(){try{var e=s._getProperties(s.slimcoreCallId,{pickupCode:{propKey:SlimCore.Enums.Property.CallParkPickupCode},serverHoldLocation:{propKey:SlimCore.Enums.Property.CallServerHoldLocation}},{}),t=e.pickupCode,n=e.serverHoldLocation;return s._serverHoldLocation=n,Promise.resolve(t)}catch(e){var r="Park operaton succeeded but failed to fetch properties with error: ".concat(e),i={terminatedReason:32,terminatedReasonCode:m.CONSTANTS.CODE.UNKNOWN_ERROR,terminatedReasonSubCode:m.CONSTANTS.SUB_CODE.UNKNOWN_FAILURE,errorMessage:r};return Promise.reject(i)}}))])}))}))},t.prototype.unpark=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i=this;return u(this,(function(o){return(n=this.mapParkContext(e))===SlimCore.Enums.ParkContext.Invalid?[2,Promise.reject("invalid park context ".concat(e))]:(r=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UNPARK_CALL,"",t),[2,Promise.resolve().then((function(){i._slimcoreCallHandler.unpark(i.slimcoreCallId,n,t)})).then((function(){return r}))])}))}))},t.prototype.getServerHoldLocation=function(){return l(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return[2,this._parkCompletePromise.then((function(){return e._logger.info("getServerHoldLocation=".concat(e._serverHoldLocation)),Promise.resolve(e._serverHoldLocation)}))]}))}))},t.prototype.getParkAdditionalContextJson=function(){return l(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return[2,this._parkCompletePromise.then((function(){return e._logger.info("getParkAdditionalContextJson=".concat(e._parkAdditionalContextJson)),Promise.resolve(e._parkAdditionalContextJson)}))]}))}))},t.prototype.getJoinBlob=function(){return l(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){return[2,Promise.resolve().then((function(){var t=e._slimcoreCallHandler.getJoinBlob(e.slimcoreCallId);return e._logger.info("getJoinBlob=".concat(t)),t}))]}))}))},t.prototype.mapParkContext=function(e){switch(e){case 0:return SlimCore.Enums.ParkContext.Team;case 1:return SlimCore.Enums.ParkContext.Sharedline;case 4:return SlimCore.Enums.ParkContext.Sharedlinev2;case 2:return SlimCore.Enums.ParkContext.Serverhold;case 3:return SlimCore.Enums.ParkContext.Serverholdv2;case 5:return SlimCore.Enums.ParkContext.Callpark;default:return SlimCore.Enums.ParkContext.Invalid}},t.prototype.mapClientScenario=function(e){switch(e){case 0:return SlimCore.Enums.ClientScenario.BreakoutRoom;case 1:return SlimCore.Enums.ClientScenario.MusicOnHoldV2;case 2:return SlimCore.Enums.ClientScenario.SharedLineAppearanceV2;case 3:return SlimCore.Enums.ClientScenario.CallParkV2;default:return SlimCore.Enums.ClientScenario.ClientScenarioNone}},t.prototype.mapMonitorActionType=function(e){switch(e){case 0:return SlimCore.Enums.MonitorActionType.Monitor;case 1:return SlimCore.Enums.MonitorActionType.Whisper;case 2:return SlimCore.Enums.MonitorActionType.Barge;case 3:return SlimCore.Enums.MonitorActionType.Takeover;default:return}},t.prototype._waitForTransferSuccessOrFailure=function(e,n,r){var i=this,o=this._logger.createFnLogger("WaitForTransfer",r);o.info("successStatusList=".concat(e,", type=").concat(n));var a=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,r),s=0===n?SlimCore.Enums.Property.CallTransferStatus:SlimCore.Enums.Property.CallParkStatus,c=0===n?SlimCore.Enums.Property.CallTransferFailureReason:SlimCore.Enums.Property.CallParkFailureReason,l=this._slimcoreInstance.handle("object-property-changed",{objectId:this.slimcoreCallId,propKey:s},(function(n){!function(n){if(o.info("status changed: ".concat(n," (").concat(SlimCore.Enums.CallStatus[n],")")),-1!==e.indexOf(n)||n===SlimCore.Enums.CallStatus.Failed)if(l&&(l.dispose(),l=null),-1!==e.indexOf(n))i._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,1);else{var a=i._getProperties(i.slimcoreCallId,{},{failureReason:{propKey:c}}).failureReason,s=t.convertParticipantReasonToTerminatedReason(M.convertFailureReasonToParticipantReason(a)),u={reason:a,code:i.transferDiagnosticsInfo&&i.transferDiagnosticsInfo.callControllerCode,subcode:i.transferDiagnosticsInfo&&i.transferDiagnosticsInfo.callControllerSubCode};i._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,u,r),o.logFailure("failureReason=".concat(a," => terminatedReason=").concat(s,", diagnostic info: ").concat((0,C.getPrintableObject)(i.transferDiagnosticsInfo))),i._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,s)}}(n.value)}));return a},t.prototype.mute=function(e){return void 0===e&&(e=(0,S.default)()),l(this,void 0,void 0,(function(){return u(this,(function(t){return this.isMuteDisabled()?[2,Promise.reject((0,y.getRejectTransactionEnd)(h.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]:[2,this._muteUnmute(!0,e)]}))}))},t.prototype.unmute=function(e){return void 0===e&&(e=(0,S.default)()),l(this,void 0,void 0,(function(){return u(this,(function(t){return this.isUnMuteDisabled()&&2!==this.callMode?[2,Promise.reject(new Error("Cannot unmute when already locally and server unmuted, and call is not streaming"))]:[2,this._muteUnmute(!1,e)]}))}))},t.prototype.muteSpeaker=function(e){return void 0===e&&(e=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(t){return this.isSpeakerMuted?[2,Promise.reject(new Error("Cannot mute speaker when already muted"))]:[2,this._muteUnmuteSpeaker(!0,e)]}))}))},t.prototype.unmuteSpeaker=function(e){return void 0===e&&(e=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(t){return this.isSpeakerMuted?[2,this._muteUnmuteSpeaker(!1,e)]:[2,Promise.reject(new Error("Cannot unmute speaker when already unmuted"))]}))}))},t.prototype.muteParticipants=function(e,t,n){return void 0===n&&(n=(0,S.default)()),l(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this._muteParticipants(e,t,n)]}))}))},t.prototype.hold=function(e,t,n,r){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(i){return[2,n&&n.isLocal?this._localHold(e,t,n,r):this._hold(e,t,n)]}))}))},t.prototype._localHold=function(e,t,n,r){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(i){return[2,this._holdUnhold(!0,t,e,n,r)]}))}))},t.prototype._hold=function(e,t,n){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this._holdUnhold(!0,t,e,n)]}))}))},t.prototype.unhold=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return[2,this._isLocallyHeld?this._localUnhold(e,t):this._unhold(e,t)]}))}))},t.prototype._localUnhold=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(n){return[2,this._holdUnhold(!1,t,e)]}))}))},t.prototype._unhold=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(n){return[2,this._holdUnhold(!1,t,e)]}))}))},t.prototype.updateEndpointMetadata=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return 3!==this.state?(this._logger.warn("Trying to updateEndpointMetadata in a call which is not connected, callId = ".concat(this.callId)),[2,Promise.reject(new Error("cannot updateEndpointMetadata in a call which is not connected"))]):(this._endpointMetadata=e,[2,this._updateEndpointMetadata(this._endpointMetadata,t)])}))}))},t.prototype.preconditions=function(e,t){this._logger.info("check call mode currentMode is ".concat(this.callMode," operationName is ").concat(e)),d.some(t,(function(e){return e===h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE}))&&this.checkCallMode(),d.some(t,(function(e){return e===h.OPERATION_TAGS.NOT_SUPPORTED_IN_E2EE}))&&this.checkE2EE()},t.prototype.checkCallMode=function(){if(2===this.callMode)throw this._logger.info("reject check callmode"),{code:h.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE,phrase:h.TRANSACTION_END_PHRASE.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE}},t.prototype.checkE2EE=function(){if(this._isE2EE)throw this._logger.info("reject check isE2EE"),{code:h.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED_FOR_E2EE,phrase:h.TRANSACTION_END_PHRASE.TRANSACTION_NOT_ALLOWED_FOR_E2EE}},t.prototype.sendDtmfTone=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return this._logger.info("DTMF tone <omitted>"),[2,this._sendDtmfTone(e,t)]}))}))},t.prototype.setAudioUsageMode=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return[2,this._setAudioUsageMode(e,t)]}))}))},t.prototype.setAudioMidcallConfig=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(r){return[2,this._setAudioMidcallConfig(e,t,n)]}))}))},t.prototype.setAudioMidcallConfigJson=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return[2,this._setAudioMidcallConfigJson(e,t)]}))}))},t.prototype.setParticipantSpatialAudioPositions=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return[2,this._setParticipantSpatialAudioPositions(e,t)]}))}))},t.prototype.getTechnicalInformationJson=function(){return l(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._slimcoreCallHandler.callGetTechnicalInformationJson(this.slimcoreCallId)];case 1:return[2,t.sent()];case 2:throw e=t.sent(),this._logger.error("Error in callGetTechnicalInformationJson callId: ".concat(this.callId,", error: ").concat(e)),e;case 3:return[2]}}))}))},t.prototype.startAudio=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:if(n=this._logger.createFnLogger(h.CALL_OPERATIONS.START_AUDIO,t),3!==this.state)throw n.logFailure("cannot startAudio when call is not connected"),60;return r=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.START_AUDIO,void 0,t),[4,this._slimcoreCallHandler.callStartAudio(this.slimcoreCallId,e)];case 1:return i.sent(),[2,r]}}))}))},t.prototype.stopAudio=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:if(n=this._logger.createFnLogger(h.CALL_OPERATIONS.STOP_AUDIO,t),3!==this.state)throw n.logFailure("cannot stopAudio when call is not connected"),60;return r=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.STOP_AUDIO,void 0,t),[4,this._slimcoreCallHandler.callStopAudio(this.slimcoreCallId,e)];case 1:return i.sent(),[2,r]}}))}))},t.prototype.assimilate=function(e,t,n,r){return void 0===r&&(r=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(i){return this._logger.createFnLogger(h.CALL_OPERATIONS.ASSIMILATE,r).info("assimilate: ".concat(e.callId," threadId: ").concat(O.getLoggableThreadId(t),", messageId: ").concat(n,", causeId: ").concat(r)),this._slimcoreCallHandler.callAssimilate(this.slimcoreCallId,e.slimcoreCallId,t,n),[2,Promise.resolve({code:0})]}))}))},t.prototype._onMediaNegotiationStatusChanged=function(e){var t,n=this._logger.createFnLogger("onMediaNegotiationStatusChanged",e.causeId);switch(n.info("_onMediaNegotiationStatusChanged modalityType: ".concat(e.modalityType,"\n            mediaNegotiationStatusCode: ").concat(e.mediaNegotiationStatusCode," response: ").concat(e.transactionEnd)),e.modalityType){case SlimCore.Enums.ModalityType.Audio:t=this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.START_AUDIO)?h.CALL_OPERATIONS.START_AUDIO:h.CALL_OPERATIONS.STOP_AUDIO;break;case SlimCore.Enums.ModalityType.Video:t=h.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS;break;case SlimCore.Enums.ModalityType.Screenshare:t=h.CALL_OPERATIONS.SET_MAX_VBSS_CHANNELS;break;default:return}if(this._callOperationHandler.hasPendingOperation(t)||this._callOperationHandler.hasPendingOperationWithOperationId(t,e.causeId)){var r=void 0;e.transactionEnd&&(r=JSON.parse(e.transactionEnd)),n.info("Transaction end: ".concat(JSON.stringify(r))),e.mediaNegotiationStatusCode===SlimCore.Enums.MediaNegotiationStatusCode.Succeeded?(r||(r=(0,y.getSuccessTransactionEnd)()),this._callOperationHandler.maybeResolveOperation(t,r,e.causeId,e.causeId)):(r||(r=(0,y.getRejectTransactionEnd)("Media negotiation failed",h.TRANSACTION_END_SUBCODE.GENERIC_MEDIA_NEGOTIATION_FAILURE)),this._callOperationHandler.maybeRejectOperation(t,r,e.causeId,e.causeId))}},t.prototype.publishState=function(e,t){var n=this,r=e.level,i=this._logger.createFnLogger(h.CALL_OPERATIONS.PUBLISH_STATE,t),o=e.type;return this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.PUBLISH_STATE,e.participantIds&&e.participantIds.length>0?"".concat(o).concat(h.OPERATION_VARIANTS.SPECIFIED):"".concat(o).concat(h.OPERATION_VARIANTS.NONE)),Promise.resolve().then((function(){return l(n,void 0,void 0,(function(){var n;return u(this,(function(i){switch(i.label){case 0:return n=this.getSlimcoreEnumLevel(r),[4,this._slimcoreCallHandler.publishState(this.slimcoreCallId,o,n,e.content,t,e.participantIds)];case 1:return i.sent(),[2]}}))}))})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.PUBLISH_STATE,t,t)})).catch((function(e){return n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.PUBLISH_STATE,{type:o,error:(0,C.getPIISafeObject)(e)},t),i.logFailure(e),Promise.reject(e)}))},t.prototype.publishStatesForEveryone=function(e,t){var n=this,r=e.level,i=this._logger.createFnLogger(h.CALL_OPERATIONS.PUBLISH_STATE,t),o=e.type;return this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.PUBLISH_STATE,"".concat(e.type).concat(h.OPERATION_VARIANTS.ALL)),Promise.resolve().then((function(){return l(n,void 0,void 0,(function(){var n;return u(this,(function(i){switch(i.label){case 0:return n=this.getSlimcoreEnumLevel(r),[4,this._slimcoreCallHandler.publishStatesForEveryone(this.slimcoreCallId,o,n,e.content,t)];case 1:return i.sent(),[2]}}))}))})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.PUBLISH_STATE,t,t)})).catch((function(e){return n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.PUBLISH_STATE,{type:o,error:(0,C.getPIISafeObject)(e)},t),i.logFailure(e),Promise.reject(e)}))},t.prototype.removeState=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.REMOVE_STATE,t);return Promise.resolve().then((function(){n._slimcoreCallHandler.removeState(n.slimcoreCallId,e.stateIds,t)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.REMOVE_STATE,t)})).catch((function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.REMOVE_STATE,{error:(0,C.getPIISafeObject)(e)},t),r.logFailure(e),e}))},t.prototype.removeStatesForEveryone=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.REMOVE_STATE,t);return Promise.resolve().then((function(){n._slimcoreCallHandler.removeStatesForEveryone(n.slimcoreCallId,e.type,t)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.REMOVE_STATE,t)})).catch((function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.REMOVE_STATE,{error:(0,C.getPIISafeObject)(e)},t),r.logFailure(e),e}))},t.prototype.updateMeetingSettings=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,t);return Promise.resolve().then((function(){n._slimcoreCallHandler.updateMeetingSettingsJson?n._slimcoreCallHandler.updateMeetingSettingsJson(n.slimcoreCallId,JSON.stringify(e),t):n._slimcoreCallHandler.updateMeetingSettings(n.slimcoreCallId,!!e.allowRaiseHands,t)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,t)})).catch((function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,{error:(0,C.getPIISafeObject)(e)},t),r.logFailure(e),e}))},t.prototype.mapParticipantScope=function(e){switch(e){case 0:return SlimCore.Enums.ParticipantScope.ParticipantScopeAll;case 3:return SlimCore.Enums.ParticipantScope.ParticipantScopeAttendees;case 2:return SlimCore.Enums.ParticipantScope.ParticipantScopePresenters;case 1:return SlimCore.Enums.ParticipantScope.ParticipantScopeSpecified;case 4:return SlimCore.Enums.ParticipantScope.ParticipantScopeSelf;default:return SlimCore.Enums.ParticipantScope.ParticipantScopeNone}},t.prototype.updateMeetingGroups=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,e),i={participantScope:this.mapParticipantScope(t.scope),participantsJson:JSON.stringify(t.participants),fromGroup:t.fromGroup,toGroup:t.toGroup};return Promise.resolve().then((function(){n._slimcoreCallHandler.updateMeetingGroups(n.slimcoreCallId,e,i)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,e)})).catch((function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,{error:(0,C.getPIISafeObject)(t)},e),r.logFailure(t),t}))},t.prototype.updateMeetingLiveState=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,e),i=o({},t);return Promise.resolve().then((function(){n._slimcoreCallHandler.updateMeetingLiveState(n.slimcoreCallId,e,i)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,e)})).catch((function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,{error:(0,C.getPIISafeObject)(t)},e),r.logFailure(t),t}))},t.prototype.updateParticipantInterpretationState=function(e,t){var n=this,r=[];if(0===t.length)return Promise.reject((0,y.getRejectTransactionEnd)("Invalid UpdateParticipantInterpretationStateOptions participantIds"));for(var i=0,o=t;i<o.length;i++){var a=o[i],s=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,a.id,e);r.push(s),this._callTelemetry.recordOperation(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,e,a.id)}return Promise.resolve().then((function(){if(!n.slimcoreCallId)throw(0,y.getRejectTransactionEnd)("Invalid self slimcore call id ".concat(n.slimcoreCallId));n._slimcoreCallHandler.updateParticipantInterpretationState(n.slimcoreCallId,e,{interpretationStateJsons:t.map((function(e){return JSON.stringify(e)}))})})).catch((function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,{error:(0,C.getPIISafeObject)(t)},e),n._logger.logFailure(t),(0,y.getRejectTransactionEnd)(t)})).then((function(){return r}))},t.prototype.joinMeetingGroup=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,e),i=o(o(o({},"meetingGroupId"in t&&{meetingGroupId:t.meetingGroupId}),"meetingGroupLabel"in t&&{meetingGroupLabel:t.meetingGroupLabel}),t.groupPreferences&&{groupPreferences:JSON.stringify(t.groupPreferences)});return Promise.resolve().then((function(){n._slimcoreCallHandler.joinMeetingGroup(n.slimcoreCallId,e,i)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,e)})).catch((function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,{error:(0,C.getPIISafeObject)(t)},e),r.logFailure(t),t}))},t.prototype.leaveMeetingGroup=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,e),i={meetingGroupId:t.meetingGroupId};return Promise.resolve().then((function(){n._slimcoreCallHandler.leaveMeetingGroup(n.slimcoreCallId,e,i)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,e)})).catch((function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,{error:(0,C.getPIISafeObject)(t)},e),r.logFailure(t),t}))},t.prototype.sendMessages=function(e,t){var n,r,i,o,a=this;void 0===e&&(e=(0,f.generateCauseId)());for(var s={},c=0,l=t;c<l.length;c++){var u=l[c];if(0===u.scope){var d=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.SEND_MESSAGES,u.operationId,e);s[u.operationId]={all:d},this._callTelemetry.recordOperation(h.CALL_OPERATIONS.SEND_MESSAGES,e,u.operationId)}else if(1===u.scope)for(var p in u.to)if("participant"===u.to[p].level){var g=p+"-"+u.operationId;d=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.SEND_MESSAGES,g,e);null!==(n=s[i=u.operationId])&&void 0!==n||(s[i]={}),s[u.operationId][p]=d,this._callTelemetry.recordOperation(h.CALL_OPERATIONS.SEND_MESSAGES,e,g)}else if("endpoint"===u.to[p].level)for(var m in u.to[p].participantLegIdMap){g=m+"-"+u.operationId,d=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.SEND_MESSAGES,g,e);null!==(r=s[o=u.operationId])&&void 0!==r||(s[o]={}),s[u.operationId][m]=d,this._callTelemetry.recordOperation(h.CALL_OPERATIONS.SEND_MESSAGES,e,g)}}return Promise.resolve().then((function(){return a._slimcoreCallHandler.sendMessages(a.slimcoreCallId,e,{sendMessagesJsons:t.map((function(e){return e.hasOwnProperty("scope")&&(e.scope=a.mapParticipantScope(e.scope)),e})).map((function(e){return JSON.stringify(e)}))})})).catch((function(t){throw a._callTelemetry.updateOperationData(h.CALL_OPERATIONS.SEND_MESSAGES,{error:(0,C.getPIISafeObject)(t)},e),a._logger.logFailure(t),(0,y.getRejectTransactionEnd)(t)})).then((function(){return s}))},t.prototype.updateMonitorSession=function(e,t){var n=this;void 0===t&&(t=(0,f.generateCauseId)());var r=this.mapMonitorActionType(e.monitorActionType),i=A.mapToEmptyStrIfFalsy((0,C.safeJsonStringify)(e.monitorData));if(this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MONITOR_SESSION,t).info("updateMonitorSession: monitorActionType: ".concat(r,", monitorData: ").concat(i)),void 0===r)return Promise.reject("Invalid monitor action type ".concat(e.monitorActionType));var o=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MONITOR_SESSION,"",t);return Promise.resolve().then((function(){n._slimcoreCallHandler.updateMonitorSession(n.slimcoreCallId,r,i,t)})).then((function(){return o}))},t.prototype.stop=function(e,t,n,r){void 0===e&&(e=!1),void 0===t&&(t=(0,f.generateCauseId)());var i=this._logger.createFnLogger(h.CALL_OPERATIONS.STOP_CALL,t);if(6===this.state)return i.logFailure("Trying to stop a call which is already Disconnecting, callId = ".concat(this.callId)),Promise.reject(new Error("cannot stop call in Disconnecting state"));if(7===this.state)return i.logFailure("Trying to stop a call which is already Disconnected, callId = ".concat(this.callId)),Promise.reject(new Error("cannot stop call in Disconnected state"));var a=o(o({},n),{causeId:t,forEveryone:e,reason:r||{}});return this.stopInternal(a)},t.prototype.testHook=function(e,t){void 0===t&&(t=(0,f.generateCauseId)());var n=this._logger.createFnLogger("testHook","causeId");if(n.info("test hook ".concat(e)),0===this.slimcoreCallId){var r="Slimcore call object not found";n.logFailure(r);var i={terminatedReason:32,terminatedReasonCode:m.CONSTANTS.CODE.UNKNOWN_ERROR,terminatedReasonSubCode:m.CONSTANTS.SUB_CODE.UNKNOWN_FAILURE,errorMessage:r};return Promise.reject(i)}return this._slimcoreCallHandler.testHook(this.slimcoreCallId,e),Promise.resolve()},t.prototype.reject=function(e,t){return void 0===e&&(e=(0,f.generateCauseId)()),1!==this.state?Promise.reject(60):this.stopInternal({causeId:e,reason:t||{}})},t.prototype.stopInternal=function(e){var t=this,n=e.causeId,r=e.terminatedReason||0,i=this._logger.createFnLogger("stopInternal",n);return i.info("reason from client: ".concat((0,C.getPrintableObject)(e.reason))),6===this.state?(i.info("Trying to stop a call which is already Disconnecting"),this.disconnectingPromise):7===this.state?(i.info("Trying to stop a call which is already Disconnected"),this.disconnectingPromise):(this._setCallState(6,n,r),this.disconnectingPromise=Promise.resolve().then((function(){return l(t,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return this._isLocalRecordingRunning?[4,this._stopLocalRecording(n).then((function(){}),(function(){}))]:[3,2];case 1:t.sent(),t.label=2;case 2:return i.info("Leaving from call"),[4,this._leaveSlimCoreCall(e)];case 3:return t.sent(),[2]}}))}))})).catch((function(e){throw t._callTelemetry.updateOperationData(h.CALL_OPERATIONS.STOP_CALL,{error:(0,C.getPIISafeObject)(e)},n),i.logFailure(e),t._setCallState(7,n,e),e})),this.disconnectingPromise)},t.prototype.mapEndpointScope=function(e){return 1===e?SlimCore.Enums.EndpointScope.EndpointScopeAll:SlimCore.Enums.EndpointScope.EndpointScopeNone},t.prototype._leaveSlimCoreCall=function(e){var t,n,r,i,o=this,a=e.causeId,s=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.ELECTRON_LEAVE_CALL,a);if(s.info("forEveryone: ".concat(e&&e.forEveryone)),0===this.slimcoreCallId){var c=null!==(t=e.errorMessage)&&void 0!==t?t:"Slimcore call object not found";s.logFailure(c);var d={terminatedReason:null!==(n=e.terminatedReason)&&void 0!==n?n:32,terminatedReasonCode:null!==(r=e.terminatedReasonCode)&&void 0!==r?r:m.CONSTANTS.CODE.UNKNOWN_ERROR,terminatedReasonSubCode:null!==(i=e.terminatedReasonSubCode)&&void 0!==i?i:m.CONSTANTS.SUB_CODE.UNKNOWN_FAILURE,errorMessage:c};return Promise.reject(d)}var p=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_ENDED);return Promise.resolve().then((function(){return l(o,void 0,void 0,(function(){var t,n,r,i;return u(this,(function(o){switch(o.label){case 0:return e&&e.forEveryone?(this._slimcoreCallHandler.endCallForAll(this.slimcoreCallId,void 0,void 0,null===(t=e.reason)||void 0===t?void 0:t.clientSubCode,null===(n=e.reason)||void 0===n?void 0:n.clientPhrase),[3,3]):[3,1];case 1:return[4,this._slimcoreCallHandler.leaveCall(this.slimcoreCallId,this.mapEndpointScope(e.scope),a,null===(r=e.reason)||void 0===r?void 0:r.clientSubCode,null===(i=e.reason)||void 0===i?void 0:i.clientPhrase)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))})).then((function(){s.info("Waiting for SlimCore to end call")})).then((function(){return p})).then((function(){s.info("SlimCore ended the call")}),(function(e){return s.logFailure("Error in leaveSlimCoreCall().. ignoring, error = ".concat((0,C.getPrintableObject)(e),", reason = ").concat(25)),Promise.reject(25)}))},t.prototype.incomingCallInit=function(e,t){void 0===t&&(t=(0,f.generateCauseId)());var n=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,t);try{var r=this._getProperties(e,{callerMriIdentity:{propKey:SlimCore.Enums.Property.CallerMriIdentity}},{}).callerMriIdentity;if(this.callerMri=(0,E.stripMriAliases)(r),!this.callerMri)return void n.logFailure("Unable to get callerMRI from call object. Ignoring incoming call");var i=this._getProperties(e,{conversationType:{propKey:SlimCore.Enums.Property.CallConversationType},callQueueInfo:{propKey:SlimCore.Enums.Property.CallQueueInfo},transferorMri:{propKey:SlimCore.Enums.Property.CallTransferorMri},transferorDisplayName:{propKey:SlimCore.Enums.Property.CallTransferorDisplayName},transferorType:{propKey:SlimCore.Enums.Property.CallTransferorType},onBehalfOfMri:{propKey:SlimCore.Enums.Property.CallOnBehalfOfMri},onBehalfOfUserDisplayName:{propKey:SlimCore.Enums.Property.CallOnBehalfOfUserDisplayName},callPhoneLineType:{propKey:SlimCore.Enums.Property.CallPhoneLineType},incomingCallType:{propKey:SlimCore.Enums.Property.CallIncomingType},consultativeCallId:{propKey:SlimCore.Enums.Property.CallConsultativeTransferCallId},messageId:{propKey:SlimCore.Enums.Property.CallMessageId},spamRiskLevel:{propKey:SlimCore.Enums.Property.CallSpamRiskLevel},spamStirAttestation:{propKey:SlimCore.Enums.Property.CallSpamStirAttestation},redirectionProperties:{propKey:SlimCore.Enums.Property.CallRedirectionProperties},fromApplicationType:{propKey:SlimCore.Enums.Property.CallFromApplicationType},bannerContent:{propKey:SlimCore.Enums.Property.CallBannerContent},callQueueSupervisorContent:{propKey:SlimCore.Enums.Property.CallCallQueueSupervisorContent},groupKeyManagerMri:{propKey:SlimCore.Enums.Property.CallGroupKeyManagerMri}},{status:{propKey:SlimCore.Enums.Property.CallStatus},isIncomingOneOnOneVideoCall:{propKey:SlimCore.Enums.Property.CallIsIncomingOneOnOneVideoCall}});this.transferorMri=(0,E.stripMriAliases)(i.transferorMri),this.transferorDisplayName=i.transferorDisplayName,this.transferorType=i.transferorType,this.onBehalfOfMri=(0,E.stripMriAliases)(i.onBehalfOfMri),this.onBehalfOfUserDisplayName=i.onBehalfOfUserDisplayName,this.callPhoneLineType=i.callPhoneLineType,this.callQueueInfo=i.callQueueInfo&&JSON.parse(i.callQueueInfo).callQueueInfo,this.incomingCallType=i.incomingCallType,this.consultativeCallId=i.consultativeCallId,this.isIncomingOneOnOneVideoCall=!!i.isIncomingOneOnOneVideoCall,this.messageId=i.messageId,this.spamRiskLevel=i.spamRiskLevel,this.spamStirAttestation=i.spamStirAttestation,this.redirectionProperties=i.redirectionProperties,this.bannerContent=i.bannerContent&&JSON.parse(i.bannerContent),this.callQueueSupervisorContent=i.callQueueSupervisorContent&&JSON.parse(i.callQueueSupervisorContent),this._setFromApplicationType(i.fromApplicationType,t),this._updateConversationType(i.conversationType,t),this._updateGroupKeyManagerMri(i.groupKeyManagerMri),this.attachSlimCoreCallObject(e,t),i.status===SlimCore.Enums.CallStatus.RingingIn&&(this._setCallState(1,t),this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLEE))}catch(e){throw n.logFailure("sync failure, cleaning up slimcore ready operation: error=".concat((0,C.getPrintableObject)(e))),this._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:(0,C.getPIISafeObject)(e)},t),this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),e}},t.prototype.acknowledge=function(e,n,r){var i=this;void 0===r&&(r=(0,f.generateCauseId)());var o=this._logger.createFnLogger(h.CALL_OPERATIONS.ACKNOWLEDGE,r);if(0!==this.state&&8!==this.state)return this._callTelemetry.maybeRecordOperationSuccess(h.CALL_OPERATIONS.ACKNOWLEDGE,{code:4}),Promise.reject(new Error("Trying to acknowledge a call that has already been acted on"));this._setCallerMri((0,E.stripMriAliases)(e.callerId),r),this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLEE);var a={callId:e.convoCallId,callerId:e.callerId,launchTime:e.launchTime.toString(),pushReceivedTime:e.pushReceivedTime.toString(),registrationId:e.registrationId,participantId:e.participantId},s=this._slimcoreInstance.handlePushNotification({eventType:e.body.evt,servicePayload:e.body.gp,correlationIdsJson:JSON.stringify(a),callKey:e.callKey,connectionType:t.convertConnectionType(e.connectionType),accountIdentity:this.currentUserSkypeIdentity.id,mediaConfigurationJson:A.mapToEmptyStrIfFalsy(JSON.stringify(e.mediaConfiguration))}),c=[],l=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,void 0,r);c.push(this._slimcoreInstance.handle("push-handling-complete",{token:s},(function(e){if(e.token===s)if(o.info("HandlePushNotification: Received event for token: ".concat(e.token," result: ").concat(e.result)),e.result===SlimCore.Enums.PushHandlingResult.CallSetupSucceeded)o.logSuccess("HandlePushNotification: Succeeded"),i._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,{code:1,success:!0},void 0,r).catch((function(e){o.logFailure("HandlePushNotification: Failed ".concat(e))}));else if(e.result===SlimCore.Enums.PushHandlingResult.CallSetupProgress)o.info("HandlePushNotification: In progress, keep waiting...");else{var n="HandlePushNotification: Failed ".concat(e.result);o.logFailure(n),i._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,t.convertPushHandlingResult(e.result),void 0,r).catch((function(e){o.logFailure("HandlePushNotification: Failed ".concat(e))}))}else o.logFailure("HandlePushNotification: Received unexpected token ".concat(e.token," (expected ").concat(s,")"))})));var u=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING);u.catch(v.noop),c.push(this._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.Call},(function(e){var t=i._getProperties(e.objectId,{callId:{propKey:SlimCore.Enums.Property.CallName}},{status:{propKey:SlimCore.Enums.Property.CallStatus}}),n=t.callId,a=t.status;n===i.callId?a===SlimCore.Enums.CallStatus.RingingIn&&(i.attachSlimCoreCallObject(e.objectId,r,"acknowledge"),i._fillIncomingCallProperties(r),i._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING)&&i._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING,void 0,void 0,r).then((function(){o.logSuccess("Reached ringing/active state for call pending acknowledgement")}),(function(e){o.logFailure("Reached ringing/active state for call pending acknowledgement ".concat(e))})),i.raiseChangedDeferredIfEnabled()):o.info("Ignoring SlimCore event for incorrect call ".concat(e.objectId,"/").concat(n))})));var p=function(){return d.each(c,(function(e){e.dispose()}))},m=function(e){i._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING,e,void 0,r),i._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,e,void 0,r)};return l.then((function(e){return e.success?u.then((function(){return i._setCallState(1,r),e})):(m(e),e)})).then((function(e){return o.logSuccess("Acknowledge done"),p(),e})).catch((function(e){throw o.logFailure("sync failure, cleaning up slimcore ready operation: error=".concat((0,C.getPrintableObject)(e))),i._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:(0,C.getPIISafeObject)(e)},r),i._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),p(),m(e),e}))},t.prototype.accept=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r,i,o,a,s,c;return u(this,(function(l){switch(l.label){case 0:(n=this._logger.createFnLogger(h.CALL_OPERATIONS.ACCEPT,t)).info("accept, answerMediaType: ".concat(e.answerMediaType,",\n                            withVideo: ").concat(e.withVideo,",\n                            muted: ").concat(e.muted,",\n                            clientEndpointCapabilities: ").concat(e.clientEndpointCapabilities,",\n                            additionalEndpointProperties: ").concat(e.additionalEndpointProperties,",\n                            muteFlags: ").concat(e.muteFlags)),this.containsMultipleVideos(e)&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.ACCEPT,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),this._setCallState(2,t),this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.ACCEPT),r=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,t),l.label=1;case 1:if(l.trys.push([1,5,,6]),e.sendMediaModalities&&this._slimcoreCallHandler.answer){if(i=A.returnStringifiedVersionOfMediaStateConfiguration(e.sendMediaModalities),this._logger.info("sendMediaModalitiesJson: ".concat(i)),""===i)throw new Error("Passed invalid JSON");o=e.endpointBehaviors?JSON.stringify(e.endpointBehaviors):"",a=e.additionalEndpointProperties?JSON.stringify(e.additionalEndpointProperties):"",this._slimcoreCallHandler.answer(this.slimcoreCallId,i,o,e.clientEndpointCapabilities||0,e.muteFlags||0,a,e.maxVbssChannels||0,t)}else this._acceptCall(e,t);return 1&e.muteFlags&&this.setMuteAndTriggerEvent(!0,t),2&e.muteFlags&&(this.isSpeakerMuted=!0),s=this._getProperties(this.slimcoreCallId,{},{isConference:{propKey:SlimCore.Enums.Property.CallIsConference}}).isConference,this._updateCallType(s,t),1===e.answerMediaType||e.sendMediaModalities&&e.sendMediaModalities.mediaStates&&d.find(e.sendMediaModalities.mediaStates,(function(e){return 1===e.mediaType&&!e.isDisabled}))?(n.info("Call has been answered - turning on video"),[4,this.startVideoSafe(t)]):[3,3];case 2:l.sent(),l.label=3;case 3:return this._logger.info("The Speaker and Microphone mute state after accepting call is ".concat(this.isSpeakerMuted," and ").concat(this.isMuted)),[4,r];case 4:return l.sent(),this._logger.info("acceptCallPromise resolved"),[3,6];case 5:throw c=l.sent(),this._callTelemetry.updateOperationData(h.CALL_OPERATIONS.ACCEPT,{error:(0,C.getPIISafeObject)(c)},t),this.stopInternal({causeId:t,terminatedReason:7}),this._logger.error("Error in accept(), callId = ".concat(this.callId,", error = ").concat(c)),c;case 6:return[2]}}))}))},t.prototype.mergeParticipants=function(e,t,n,r,i){return l(this,void 0,void 0,(function(){var o,a,s,c,l,d,p,g=this;return u(this,(function(u){if(o=[],0===t.length)return[2,Promise.reject((0,y.getRejectTransactionEnd)("Invalid participantIds"))];for(a=0,s=t;a<s.length;a++)if(c=s[a],A.hasFeature(SlimCore.Enums.Feature.MergeWithEndpoints))p=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANT,c,r),o.push(p),this._callTelemetry.recordOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANT,r,c);else{if(!(l=(0,P.findParticipantUsingParticipantLegId)(e,c)))return[2,Promise.reject((0,y.getRejectTransactionEnd)("ParticipantLegId ".concat(c," is invalid!")))];d=l.isIdentityMasked?l.nonMaskedId:l.id,p=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANT,d,r),o.push(p),this._mergeParticipantMriToParticipantIdMap.hasOwnProperty(d)?this._mergeParticipantMriToParticipantIdMap[d].push(c):this._mergeParticipantMriToParticipantIdMap[d]=[c],this._callTelemetry.recordOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANT,r,d)}return[2,Promise.resolve().then((function(){if(!g.slimcoreCallId)throw(0,y.getRejectTransactionEnd)("Invalid self slimcore call id ".concat(g.slimcoreCallId));if(!e)throw(0,y.getRejectTransactionEnd)("Invalid callToMerge slimcore call id ".concat(g.slimcoreCallId));var o=n.additionalData?JSON.stringify(n.additionalData):"";if(!g._slimcoreCallHandler.mergeCallParticipantLegs)return g._logger.info("[MergeParticipants] old method"),void g._slimcoreCallHandler.mergeCallParticipants(g.slimcoreCallId,e.slimcoreCallId,t,n.threadId,n.messageId,r,o,n.groupId,g.mapClientScenario(i));g._logger.info("[MergeParticipants] mergeCallParticipantLegs");for(var a={mergeParticipantIdInfo:[]},s=0,c=t;s<c.length;s++){var l=c[s],u=g._mergeParticipantLegIdsEnabled?(0,S.default)():l,d={participantLegId:u,replacementParticipantId:l};a.mergeParticipantIdInfo.push(d),g._mergeReplacementParticipantIdToNewParticipantIdMap[l]=u}g._slimcoreCallHandler.mergeCallParticipantLegs(g.slimcoreCallId,e.slimcoreCallId,JSON.stringify(a),n.threadId,n.messageId,r,o,n.groupId,g.mapClientScenario(i))})).catch((function(e){throw g._callTelemetry.updateOperationData(h.CALL_OPERATIONS.MERGE_PARTICIPANT,{error:(0,C.getPIISafeObject)(e)},r),g._logger.logFailure(e),(0,y.getRejectTransactionEnd)(e)})).then((function(){return o}))]}))}))},t.prototype.mergeWithPickupCode=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r,i,o,a=this;return u(this,(function(s){return(r=this._logger.createFnLogger(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,n)).info("mergeWithPickupCode: pickup code: ".concat(e,", groupId: ").concat(O.scrubMriOrOmit(t.groupId)," threadId: ").concat(O.getLoggableThreadId(t.threadId)," messageId: ").concat(t.messageId)),e?(i=t.additionalData?JSON.stringify(t.additionalData):"",o=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,e,n),[2,Promise.resolve().then((function(){a._mergeWithPickupCode(e,t.threadId,t.messageId,n,i,t.groupId)})).catch((function(e){return a._callTelemetry.updateOperationData(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,{error:(0,C.getPIISafeObject)(e)},n),r.logFailure(e),Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return o}))]):(r.info("mergeWithPickupCode: pickup code cannot be empty"),[2,Promise.reject((0,y.getRejectTransactionEnd)("pickup code cannot be empty"))])}))}))},t.prototype.merge=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r,i,o,a,s,c=this;return u(this,(function(l){return(r=this._logger.createFnLogger(h.CALL_OPERATIONS.MERGE_CALL,n)).info("merge: ".concat(e.callId," threadId: ").concat(O.getLoggableThreadId(t.threadId),", messageId: ").concat(t.messageId)),e.participants&&1===e.participants.length?(i=e.participants[0].id,o=t.additionalData?JSON.stringify(t.additionalData):"",a=this._getOrCreateParticipant(i,n),this._addParticipantToCall(a,n),s=this._participantOperationHandler.createPendingOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,a.id,n),[2,Promise.resolve().then((function(){c._slimcoreCallHandler.callMerge(c.slimcoreCallId,e.slimcoreCallId,t.threadId,t.messageId,n,o)})).catch((function(e){return c._callTelemetry.updateOperationData(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{error:(0,C.getPIISafeObject)(e)},n,i),r.logFailure(e),c._handleParticipantRemoved(i,n,e),Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return s})).then((function(){return Promise.resolve({code:h.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:h.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE})})).catch((function(e){r.logFailure(e),c._handleParticipantRemoved(i,n,e);var t=e;return(0,y.isTransactionEnd)(e)&&(t=e),Promise.reject(t)}))]):(r.error("error invalid number of participants on call to be merged ".concat(e.participants.length)),[2,Promise.reject((0,y.getRejectTransactionEnd)(h.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))])}))}))},t.prototype._acceptCall=function(e,n){var r=e.endpointBehaviors?JSON.stringify(e.endpointBehaviors):"";try{e.withVideo&&(e.answerMediaType=1),this._slimcoreCallHandler.acceptCall(this.slimcoreCallId,t.toAnswerMediaType(e.answerMediaType),r,e.clientEndpointCapabilities||0,e.muteFlags||0)}catch(t){this._logger.info("acceptCall is missing from the slimcore electron module: ".concat(t)),1===e.answerMediaType&&(e.withVideo=!0),this._slimcoreCallHandler.answerCall(this.slimcoreCallId,e.withVideo,r)}},t.prototype.reconnect=function(){return Promise.reject(new Error("Retargeting is not supported"))},t.prototype.provideCallQualityFeedback=function(e,t,n,r){return l(this,void 0,void 0,(function(){return u(this,(function(i){this._logger.info("provideCallQualityFeedback");try{this._slimcoreInstance.provideCallQualityFeedbackEx(this.callId,this.participantId,e,t,n,r,"","")}catch(e){throw this._logger.error("Error in provideCallQualityFeedback callId: ".concat(this.callId,", error: ").concat(e)),e}return[2]}))}))},t.prototype.showCQFInfo=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(n){this._logger.info("showCQFInfo");try{return this._slimcoreCallHandler.showCQFInfo?[2,this._slimcoreCallHandler.showCQFInfo(e,this.callId,t)]:(this._logger.warn("showCQFInfo not on SkyLib::CallHandler"),[2,null])}catch(e){throw this._logger.error("Error in showCQFInfo callId: ".concat(this.callId,", error: ").concat(e)),e}return[2]}))}))},t.prototype.isCqfRendered=function(e){return l(this,void 0,void 0,(function(){return u(this,(function(t){this._logger.info("isCqfRendered");try{this._slimcoreCallHandler.isCqfRendered?this._slimcoreCallHandler.isCqfRendered(this.callId,this.participantId,e):this._logger.warn("isCqfRendered not on SkyLib::CallHandler")}catch(e){throw this._logger.error("Error in isCqfRendered callId: ".concat(this.callId,", error: ").concat(e)),e}return[2]}))}))},t.prototype.provideCallQualityFeedbackEx=function(e,t,n,r,i,o){return l(this,void 0,void 0,(function(){return u(this,(function(a){this._logger.info("provideCallQualityFeedback");try{this._slimcoreCallHandler.provideCallQualityFeedbackEx?this._slimcoreCallHandler.provideCallQualityFeedbackEx(this.callId,this.participantId,e,t,n,r,i,o):this._logger.warn("provideCallQualityFeedbackEx not on SkyLib::CallHandler")}catch(e){throw this._logger.error("Error in provideCallQualityFeedbackEx callId: ".concat(this.callId,", error: ").concat(e)),e}return[2]}))}))},t.prototype._mergeWithPickupCode=function(e,t,n,r,i,o){this._logger.info("_mergeWithPickupCode: pickupCode = ".concat(e," groupId = ").concat(O.scrubMriOrOmit(o)," threadId = ").concat(O.getLoggableThreadId(t)," messageId = ").concat(n," causeId = ").concat(r)),this._slimcoreCallHandler.mergeCallWithPickupCode(this.slimcoreCallId,e,A.mapToEmptyStrIfFalsy(t),A.mapToEmptyStrIfFalsy(n),A.mapToEmptyStrIfFalsy(r),A.mapToEmptyStrIfFalsy(i),A.mapToEmptyStrIfFalsy(o))},t.prototype._onCallOriginChanged=function(e){e===SlimCore.Enums.OriginType.Transfer?this._setCallOrigin(1):e===SlimCore.Enums.OriginType.Park?this._setCallOrigin(2):e===SlimCore.Enums.OriginType.Unspecified?this._setCallOrigin(0):e===SlimCore.Enums.OriginType.TransferToVoicemail?this._setCallOrigin(3):this._logger.info("Unknown origin")},t.prototype._onCallMutedUnmuted=function(e,t){var n=10===this.state;this._logger.info("onCallMutedUnmuted current: ".concat(this.isMuted," new: ").concat(e)),this._logger.info("onCallMutedUnmuted isServerMuted: ".concat(this.isServerMuted," inLobby: ").concat(n)),this.isMuted!==e&&(this.isServerMuted&&!n||e||(this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.MUTE),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.UNMUTE)),e&&(this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.MUTE),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.UNMUTE)),this._logger.info("isMuted set to ".concat(e," in _onCallMutedUnmuted, causeId=").concat(t)),this.setMuteAndTriggerEvent(e,t),this._logger.info("onCallMutedUnmuted isMuted: ".concat(this.isMuted)),this._updateCapabilities((0,f.generateCauseId)()),this.raiseChangedDeferredIfEnabled())},t.prototype._onCallMutedUnmutedSpeaker=function(e,t){void 0===t&&(t=(0,f.generateCauseId)()),this._logger.createFnLogger("onCallMutedUnmutedSpeaker",t).info("current: ".concat(this.isSpeakerMuted," new: ").concat(e)),e?this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.MUTE_SPEAKER,void 0,void 0,t):this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.UNMUTE_SPEAKER,void 0,void 0,t),this._setMutedSpeaker(e,t)},t.prototype._onCallIsServerMuted=function(e,t){void 0===t&&(t=(0,f.generateCauseId)()),this._logger.info("_onCallIsServerMuted ".concat(e)),e!==this.isServerMuted&&(this.isServerMuted=e,this._callTelemetry.recordEvent(h.PARTICIPANT_OPERATIONS_INTERNAL.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted},t),this.event("serverMutedChanged").raise(e,t),this._updateCapabilities(t),this.raiseChangedDeferredIfEnabled())},t.prototype._onCallCapabilitiesChanged=function(e){e!==this._capabilityFlags&&(this._logger.info("_onCallCapabilitiesChanged: new value is ".concat(e)),this._capabilityFlags=e,this._updateCapabilities((0,f.generateCauseId)(),!0))},t.prototype._onCallJoinAsStreamingUser=function(e){e&&e!==this.joinAsStreamingUser&&(this.joinAsStreamingUser=e,this._logger.info("_onCallJoinAsStreamingUser: ".concat(e)),this.raiseChangedDeferredIfEnabled())},t.prototype._onCallEnableCaptcha=function(e){e&&e!==this.enableCaptcha&&(this.enableCaptcha=e,this._logger.info("_onCallEnableCaptcha: ".concat(e)),this.raiseChangedDeferredIfEnabled())},t.prototype._updateCapabilities=function(e,t){void 0===t&&(t=!1);var n=!1,r=!1;b.callStateIsAnyOf(this.state,[11,12])||(n=!(this.isUnMuteDisabled()||this.isServerMuted&&!(this._capabilityFlags&SlimCore.Enums.SelfCapability.UnmuteSelf)),r=!!(this._capabilityFlags&SlimCore.Enums.SelfCapability.MuteOthers)),this._capabilities.canUnmuteSelf===n&&this._capabilities.canMuteOthers===r||(this._capabilities.canUnmuteSelf=n,this._capabilities.canMuteOthers=r,this._logger.info("[".concat(e,"]_updateCapabilities Computed capabilities: ").concat(JSON.stringify(this._capabilities))),t&&this.raiseChangedDeferredIfEnabled())},t.prototype._getCallParticipantMriMap=function(e){if(this._logger.info("[".concat(e,"] _getCallParticipantMriMap")),this._participantMriMap){var t=o({},this._participantMriMap);return delete this._participantMriMap,t}var n={};this._logger.info("[".concat(e,"] callGetParticipants"));var r=this._slimcoreCallHandler.callGetParticipants(this.slimcoreCallId),i={mri:{propKey:SlimCore.Enums.Property.ParticipantMriIdentity}};return this._getMultipleProperties(r,i,{}).forEach((function(e,t){t<r.length&&e.mri&&(n[e.mri]=r[t])})),n},t.prototype._getParticipantsData=function(e){var t=[],n=e.map((function(e){return e.objectId})),r=(0,H.getParticipantsVideoProperties)(n,this._logger,this._slimcoreInstance,this._slimcoreCallHandler),i=(0,w.getParticipantProps)();return this._getMultipleProperties(n,i.strProps,i.intProps).forEach((function(n,i){if(i<e.length){var o=e[i],a=o.objectId,s=o.mri,c=r.get(a);t.push({objectId:a,mri:s,props:n,videoProps:c})}})),t},t.prototype._callGetParticipantsData=function(e,t){var n=this;this._logger.info("[".concat(t,"] _callGetParticipantsData"));var r=this._getCallParticipantMriMap(t),i=[],o=[],a=Object.keys(r).length,s=Object.keys(e).length;e.forEach((function(e){var t;t=e,r.hasOwnProperty(t.mri)?function(e){return e.objectId}(e)&&(!function(e){return e.objectId===r[e.mri]}(e)?o.push(e):n._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e.mri)||delete r[e.mri]):n._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e.mri)||o.push(e)}));var c=Object.keys(r).length;return this._logger.info("[".concat(t,"]onParticipantJoinedOrRemoved # of participants in roster=").concat(a,"[").concat(s,"][").concat(i.length,"][").concat(o.length,"][").concat(c,"]")),Object.keys(r).forEach((function(e){i.push({mri:e,objectId:r[e]}),n._getOrCreateParticipant(e,t,r[e],!1)})),{newParticipantsData:this._getParticipantsData(i),participantsToRemove:o}},t.prototype._onParticipantJoinedOrRemoved=function(e){var t=this;this._logger.info("[".concat(e,"] _onParticipantJoinedOrRemoved"));var n=this._callGetParticipantsData(this.participants.map((function(e){return{objectId:e.slimcoreObjectId,mri:e.id}})),e),r=n.newParticipantsData;n.participantsToRemove.forEach((function(n){t._handleParticipantRemoved(n.mri,e,t.participantMap[n.mri].stateReason)})),Object.keys(r).forEach((function(n){t._handleParticipantJoined(r[n],e)})),this._enableVirtualParticipantMsiMapping&&this.tryResolveMsis()},t.prototype._updateDominantSpeakerList=function(){var e=this;if(this._isOptimizedSpeakerEventingEnabled)return{fullOrderMatches:!0,topSpeakerMatches:!1};var t=[],n=!1,r=!1;return 7!==this.state&&(t=d.map(d.sortBy(d.map(d.filter(this.participants,(function(e){return 3===e.state})),(function(t){return{mri:t.id,rank:t.dominantSpeakerRank?t.dominantSpeakerRank:e.participants.length+1}})),"rank"),(function(e){return e.mri})),(r=n=d.isEqual(this.dominantSpeakerInfo.speakerList,t))||(r=!d.isEmpty(this.dominantSpeakerInfo.speakerList)&&!d.isEmpty(t)&&d.head(this.dominantSpeakerInfo.speakerList)===d.head(t))),this.dominantSpeakerInfo={speakerList:t,timestamp:new Date,noCurrentDominantSpeaker:!1},n||this._logger.info("_updateDominantSpeakerList: ".concat(this.dominantSpeakerInfo.speakerList.length," noCurrentDominantSpeaker ").concat(this.dominantSpeakerInfo.noCurrentDominantSpeaker)),{fullOrderMatches:n,topSpeakerMatches:r}},t.prototype._handleParticipantRemoved=function(e,t,n){var r;void 0===n&&(n=0);var i=this._logger.createFnLogger("handleParticipantRemoved",t);i.info("reason=".concat(n)),(null===(r=this.screenSharingControl)||void 0===r?void 0:r.isScreenSharingControlEnabled())&&this.screenSharingControl.handleParticipantRemoved(e),this.ptzHandler&&this.ptzHandler.isPTZFeatureEnabled()&&this.ptzHandler.handleParticipantRemoved(e);var o=this._removeParticipantEntry(e);if(o){if(o.setState(4,t,n),this._participantOperationHandler.maybeRejectOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n,e),this._participantOperationHandler.maybeResolveOperation(h.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,n,e),!A.hasFeature(SlimCore.Enums.Feature.AsyncAdmitResponse)){var a=this._getParticipantLegId(o),s=a?{participantLegId:a}:{},c=void 0;switch(n){case 45:c=h.TRANSACTION_END_SUBCODE.TIMED_OUT_IN_LOBBY;break;case 44:c=h.TRANSACTION_END_SUBCODE.DENIED_IN_LOBBY;break;default:c=h.TRANSACTION_END_SUBCODE.LEFT_LOBBY}var l={code:h.TRANSACTION_END_CODE.SUCCESS,subCode:c,phrase:""};this._callTelemetry.maybeRecordOperationSuccess(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,l,e,t,s),o.rejectAdmitParticipantDeferred(l)}o.dispose(t),this._updateDominantSpeakerList(),this.event("participantRemoved").raise(o),this._removeCallChangeOnParticipantChanges||this.raiseChangedDeferred(this._participantChangedEventSkipConfig)}else i.logFailure("unable to remove participant")},t.prototype._handleParticipantJoined=function(e,t){var n=this;this._logger.debug("[".concat(t,"]handleParticipantJoined: ").concat(O.scrubMriOrOmit(e.mri)));var r=this._getOrCreateParticipant(e.mri,t,e.objectId);if(this._logger.debug("Updating data from handleParticipantJoined method"),r.updateParticipantData(t,e),r.enableRaisingChange(),this.event("participantAdded").raise(r),this._removeCallChangeOnParticipantChanges||this.raiseChangedDeferred(this._participantChangedEventSkipConfig),w.default.isParticipantActive(r.state)&&this._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e.mri)){this._callTelemetry.recordOperationSuccess(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{code:h.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:""},e.mri),this._participantOperationHandler.resolveOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,r,e.mri);this._callTelemetry.recordOperationSuccess(h.PARTICIPANT_OPERATIONS_INTERNAL.PARTICIPANT_JOINED,(0,g.getEndpointInformationForTelemetry)(function(e){var t,n;return null!==(n=null===(t=null==e?void 0:e.endpoints)||void 0===t?void 0:t.endpointDetails)&&void 0!==n?n:[]}(r)),e.mri,t)}this._participantJoinedDeferRunner((function(){n._updateDominantSpeakerList().fullOrderMatches||n.raiseChangedDeferred(n._participantChangedEventSkipConfig)}))},t.prototype._admitParticipantToSlimCoreElectronCall=function(e,t){var n=[e];return this._slimcoreCallHandler.admitParticipants(this.slimcoreCallId,n,t),Promise.resolve()},t.prototype.admitParticipant=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r,i,o,a,s,c,l=this;return u(this,(function(u){return(n=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,t)).info("participantId = ".concat(O.scrubMriOrOmit(e))),0===this.slimcoreCallId?[2,Promise.reject("call not started")]:(r=this._getParticipant(e),i=this._getParticipantLegId(r),o=i?{participantLegId:i}:{},r&&7!==r.state?(a={code:h.TRANSACTION_END_CODE.SUCCESS,subCode:h.TRANSACTION_END_SUBCODE.NOT_IN_LOBBY,phrase:h.TRANSACTION_END_PHRASE.NOT_IN_LOBBY},this._callTelemetry.maybeRecordOperationSuccess(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,a,e,t,o),[2,Promise.reject(a)]):(s=new p.Deferred,c=this._admitParticipantToSlimCoreElectronCall(e,t).then((function(){r&&r.addAdmitParticipantDeferred(s)})).then((function(){return r?s.promise:l._participantOperationHandler.waitForOperation(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,e,t)})).then((function(){n.logSuccess("admitted"),l._callTelemetry.maybeRecordOperationSuccess(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,{code:h.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:""},e,t,o)})).catch((function(i){n.logFailure(i);var o=l._handleParticipantOperationFailure(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,i,t,e,r);return Promise.reject(o)})),[2,c]))}))}))},t.prototype.admit=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.ADMIT,t);return e.scope&&"none"===e.scope?(r.logFailure("Can not admit if scope is None"),Promise.reject((0,y.getRejectTransactionEnd)(h.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))):Promise.resolve().then((function(){n._slimcoreCallHandler.admit(n.slimcoreCallId,t,"none"===e.scope?SlimCore.Enums.AdmitScope.AdmitScopeNone:SlimCore.Enums.AdmitScope.AdmitScopeAll)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.ADMIT,t,t)})).catch((function(e){return n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.ADMIT,{error:(0,C.getPIISafeObject)(e)},t),r.logFailure(e),Promise.reject(e)}))},t.prototype._addParticipantToSlimCoreElectronCall=function(e,t,n,r,i){this._logger.info("addParticipantToSlimCoreElectronCall: participantId = ".concat(O.scrubMriOrOmit(e)," groupId = ").concat(O.scrubMriOrOmit(t)," threadId = ").concat(O.getLoggableThreadId(n)," messageId = ").concat(r," participantInvitationData = ").concat(O.scrubMriOrOmit(i)));var o=this._slimcoreCallHandler.addParticipant(this.slimcoreCallId,e,A.mapToEmptyStrIfFalsy(n),A.mapToEmptyStrIfFalsy(r),A.mapToEmptyStrIfFalsy(i),A.mapToEmptyStrIfFalsy(t));return 0===o?Promise.reject(new Error("AddParticipant call to slimcore failed")):Promise.resolve(o)},t.prototype.callMeBack=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r,i,o,a=this;return u(this,(function(s){return(r=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,n)).info("callMeBack: participantMri = ".concat(O.scrubMriOrOmit(e)," assertedMri = ").concat(O.scrubMriOrOmit(t))),0===this.slimcoreCallId?(r.logFailure("call is not initialized yet"),[2,Promise.reject(new Error("call is not initialized yet"))]):(i=this._participantOperationHandler.waitForOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e),o=(0,E.generateAliasedMri)("".concat(E.MRI_SKYPE_PREFIX).concat(this.currentUserSkypeIdentity.id),this.currentUserSkypeIdentity.sipUri),[2,Promise.resolve().then((function(){return a._slimcoreCallHandler.callMeBack(a.slimcoreCallId,e,t||o,n),i})).catch((function(t){throw a._callTelemetry.updateOperationData(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,{error:(0,C.getPIISafeObject)(t)},n,e),a._participantOperationHandler.maybeRejectOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,1,e,n),r.logFailure("Error in callMeBack(), callId = ".concat(a.callId,", error = ").concat(t)),t}))])}))}))},t.prototype.nudgeParticipants=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var i,o,a,s=this;return u(this,(function(c){return(i=this._logger.createFnLogger(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,r)).info("nudgeParticipants: context = ".concat(e)),2!==this.state&&3!==this.state?[2,Promise.reject(48)]:0===this.slimcoreCallId?[2,Promise.reject(new Error("call is not initialized yet"))]:n.sipUri?[2,Promise.reject(new Error("sipUri not supported yet"))]:(o=n.participantInvitationData?JSON.stringify(n.participantInvitationData):"",i.info("nudgeParticipants: context = ".concat(e," groupId = ").concat(O.scrubMriOrOmit(n.groupId)," threadId = ").concat(O.getLoggableThreadId(n.threadId)," messageId = ").concat(n.messageId," participantInvitationData = ").concat(O.scrubMriOrOmit(o))),a=this._participantOperationHandler.waitForOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,e),[2,Promise.resolve().then((function(){return s._slimcoreCallHandler.nudgeParticipants(s.slimcoreCallId,t,A.mapToEmptyStrIfFalsy(e),A.mapToEmptyStrIfFalsy(n.threadId),A.mapToEmptyStrIfFalsy(n.messageId),A.mapToEmptyStrIfFalsy(o),A.mapToEmptyStrIfFalsy(n.groupId)),a})).catch((function(t){throw s._callTelemetry.updateOperationData(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,{error:(0,C.getPIISafeObject)(t)},r,e),s._participantOperationHandler.rejectOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,38,e,r),i.logFailure("Error in NudgeParticipants(), callId = ".concat(s.callId,", context = ").concat(e,", error = ").concat(t)),t}))])}))}))},t.prototype.updateParticipantsProperties=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,a,s,c,l,d,p,g,f,m,_,v,S,T=this;return u(this,(function(u){if(n={},r=e.scope,i=(0,E.generateAliasedMri)("".concat(E.MRI_SKYPE_PREFIX).concat(this.currentUserSkypeIdentity.id),this.currentUserSkypeIdentity.sipUri),o=JSON.stringify(e),(a=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES,t)).info("updateParticipantsProperties: context = ".concat(O.scrubMriOrOmit(o)," self=").concat(i," id=").concat(this.participantId)),"self"===r)for(f in e.propertyBag)m=i+"_"+e.operationId+"_"+f,_=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES,m,t),n[m]=((v={})[i]=_,v),a.info("updateParticipantsProperties promises: ".concat(JSON.stringify(n))),this._callTelemetry.recordOperation(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES,t,m);else{if("specified"!==r||!this._isUpdatePropertiesSpecifiedAllowedByEcs)throw new Error("This scope is not supported.");for(s=e.operationId,c=e.participants,l=0,d=c;l<d.length;l++)for(f in p=d[l],g=p.id,p.propertyBag)m=g+"_"+s+"_"+f,_=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES,m,t),n[m]=((S={})[g]=_,S),a.info("updateParticipantsProperties promises: ".concat(JSON.stringify(n))),this._callTelemetry.recordOperation(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES,t,m)}return[2,Promise.resolve().then((function(){return T._slimcoreCallHandler.updateParticipantsProperties(T.slimcoreCallId,t,o)})).catch((function(e){throw T._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES,{error:(0,C.getPIISafeObject)(e)},t),T._logger.logFailure(e),(0,y.getRejectTransactionEnd)(e)})).then((function(){return n}))]}))}))},t.prototype._handleParticipantOperationFailure=function(e,t,n,r,i){this._callTelemetry.updateOperationData(e,{error:(0,C.getPIISafeObject)(t)},n,r);var o={callId:this.callId,reason:t},a=i||this._getParticipant(r);a&&a.callEndDiagnosticsInfo&&(o.code=a.callEndDiagnosticsInfo.callControllerCode,o.subCode=a.callEndDiagnosticsInfo.callControllerSubCode,o.phrase=a.callEndDiagnosticsInfo.phrase);var s=this._getParticipantLegId(a),c=s?{participantLegId:s}:{};return this._callTelemetry.maybeRecordOperationFailure(e,o,r,n,c),o},t.prototype._getParticipantLegId=function(e){return d.has(e,"endpoints.endpointDetails")&&e.endpoints.endpointDetails.length&&e.endpoints.endpointDetails[0].participantId?e.endpoints.endpointDetails[0].participantId:null},t.prototype.updateMeetingRoles=function(e,t,n){return void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r,i,o=this;return u(this,(function(a){return(r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,n)).info("updateMeetingRole: participants = ".concat(O.scrubMriOrOmitList(e),", role = ").concat(t)),i=this._participantOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,n),[2,Promise.resolve().then((function(){return o._slimcoreCallHandler.updateMeetingRoles(o.slimcoreCallId,e,t,n),i})).catch((function(e){throw r.logFailure("Error in UpdateMeetingRoles(), callId = ".concat(o.callId,", error = ").concat(e)),o._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,{error:(0,C.getPIISafeObject)(e)},n),o._participantOperationHandler.rejectOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,38,n,n),e}))]}))}))},t.prototype.addParticipant=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r,i,o,a,s,c=this;return u(this,(function(l){return r=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n),this.isEmergency&&0===this.slimcoreCallId&&0!==this.participants.length?[2,Promise.reject(new Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"))]:(t.sipUri&&r.logFailure("sipUri not supported yet"),i=t.participantInvitationData?JSON.stringify(t.participantInvitationData):"",r.info("participantId = ".concat(O.scrubMriOrOmit(e)," groupId = ").concat(O.scrubMriOrOmit(t.groupId)," threadId = ").concat(O.getLoggableThreadId(t.threadId)," messageId = ").concat(t.messageId," participantInvitationData = ").concat(O.scrubMriOrOmit(i))),o=this._getOrCreateParticipant(e,n),0===this.slimcoreCallId?[2,Promise.resolve(o)]:this._disableAddParticipantCheck||-1!==[0,4].indexOf(o.state)?(a=this._participantOperationHandler.waitForOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,o.id),s=Promise.resolve().then((function(){c._addParticipantToCall(o,n)})).then((function(){return c._addParticipantToSlimCoreElectronCall(o.id,t.groupId,t.threadId,t.messageId,i)})).then((function(e){o.attachSlimcoreObjectId(e,n)})).catch((function(t){return c._callTelemetry.updateOperationData(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{error:(0,C.getPIISafeObject)(t)},n,e),r.logFailure(t),Promise.reject(1)})).then((function(){return a})).then((function(){return o})).catch((function(t){return r.logFailure(t),c._handleParticipantOperationFailure(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t,n,e,o),c._handleParticipantRemoved(e,n,t),Promise.reject(t)})),this.raiseChanged(this._participantChangedEventSkipConfig),[2,s]):[2,Promise.resolve(o)])}))}))},t.prototype.addParticipants=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var r,i,o,a,s,c,l=this;return u(this,(function(u){return r=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS,n),!this.isEmergency||0!==this.slimcoreCallId||0===this.participants.length&&1===e.length?(i=t.participantInvitationData?JSON.stringify(t.participantInvitationData):"",r.info("groupId = ".concat(O.scrubMriOrOmit(t.groupId)," threadId = ").concat(O.getLoggableThreadId(t.threadId)," messageId = ").concat(t.messageId," participantInvitationData = ").concat(O.scrubMriOrOmit(i))),o=[],a=[],s=[],c=[0,4],e.forEach((function(e){var t=l._getOrCreateParticipant(e,n);if(0===l.slimcoreCallId)s.push(Promise.resolve(t));else if(-1!==c.indexOf(t.state)){o.push(t),a.push(e),l._addParticipantToCall(t,n);var r=l._participantOperationHandler.createPendingOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id,n);r=r.catch((function(e){return l._handleParticipantOperationFailure(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e,n,t.id,t),l._handleParticipantRemoved(t.id,n,e),Promise.reject(e)})),s.push(r)}else l._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id)?s.push(l._participantOperationHandler.waitForOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id)):s.push(Promise.resolve(t))})),0===o.length?[2,Promise.resolve(s)]:[2,Promise.resolve().then((function(){return l._slimcoreCallHandler.addParticipantsToCall(l.slimcoreCallId,a,A.mapToEmptyStrIfFalsy(t.threadId),A.mapToEmptyStrIfFalsy(t.messageId),A.mapToEmptyStrIfFalsy(i),void 0!==t.disableUnmute&&t.disableUnmute,n,A.mapToEmptyStrIfFalsy(t.groupId),t.callingLineIdentity)})).then((function(e){if(!e||0===e.length)throw new Error("addParticipants: participantObjectIds null or empty");for(var t=0;t<e.length;t++)o[t].attachSlimcoreObjectId(e[t],n);return s})).catch((function(e){return r.logFailure(e),a.forEach((function(t){l._handleParticipantRemoved(t,n,e)})),Promise.reject(1)}))]):[2,Promise.reject(new Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"))]}))}))},t.prototype.removeParticipant=function(e,t,n,r){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var i,o,a,s,c,l=this;return u(this,(function(u){return(i=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,t)).info("removeParticipant: participantId = ".concat(O.scrubMriOrOmit(e),", endpointScope =").concat(r)),(o=this._getParticipant(e))&&(i.info("removeParticipant: current participant state: ".concat(o.state)),0===o.state||4===o.state)?(i.logFailure("Participant in invalid state, None or Disconnected"),[2,Promise.reject(new Error("Participant already in disconnected state"))]):(a=A.convertEndpointScope(r),r&&!a?(this._logger.error("Slimcore mapping for endpointScope failed: ".concat(r," => ").concat(a)),[2,Promise.reject(60)]):(s=new p.Deferred,c=Promise.resolve().then((function(){o?(l._assertSlimcoreObjectId(o.slimcoreObjectId,"removeParticipant"),l._slimcoreCallHandler.removeParticipant(o.slimcoreObjectId,a),o.addRemoveParticipantDeferred(s)):(l._assertSlimcoreObjectId(l.slimcoreCallId,"removeParticipantByMri"),l._slimcoreCallHandler.removeParticipantByMri(l.slimcoreCallId,e,n,a),s.resolve())})).then((function(){return A.hasFeature(SlimCore.Enums.Feature.AttendeeBlackList)||s.resolve(),s.promise})).then((function(){i.logSuccess("removed")})).catch((function(n){return i.logFailure(n),l._handleParticipantOperationFailure(h.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,n,t,e,o),Promise.reject(n)})),this.raiseChanged(this._participantChangedEventSkipConfig),[2,c]))}))}))},t.prototype.cancelNudge=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(e){throw new Error("Method not implemented.")}))}))},t.prototype.searchParticipants=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,t);return Promise.resolve().then((function(){n._slimcoreCallHandler.searchParticipants(n.slimcoreCallId,JSON.stringify(e),t)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,t)})).catch((function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,{error:(0,C.getPIISafeObject)(e)},t),r.logFailure(e),e}))},t.prototype.getAllParticipants=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,t);return"lobby"!==e.scope?(this._logger.error("Expected scope: lobby. Received scope: ".concat(e.scope)),Promise.reject(60)):Promise.resolve().then((function(){n._slimcoreCallHandler.getAllParticipants(n.slimcoreCallId,e.scope,t)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,t)})).catch((function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,{error:(0,C.getPIISafeObject)(e)},t),r.logFailure(e),e}))},t.prototype._startTransferTargetCall=function(e,n,r,i){var o=this;this._logger.info("Transfer: _startTransferTargetCall",e);var a=t.convertToSlimCoreMediaPeerType(i);return this.attachSlimCoreCallObject(e,r,"_startTransferTargetCall").then((function(){o._slimcoreCallHandler.startTransferTargetCall(e,n,o.threadId,o.messageId,a)}))},t.prototype._isEnterpriseMultiParty=function(e){return 5===e||10===e},t.prototype._joinOrStartSlimCoreCall=function(e,n,r){return l(this,void 0,void 0,(function(){var i,a,s,c,l,d,p,f,m,_,y,v,S=this;return u(this,(function(u){switch(u.label){case 0:if(i=this._logger.createFnLogger("[joinOrStartSlimCoreCall][".concat(e,"]"),r),a=0,s=!n.ringOthers,!0,c=JSON.stringify(n.endpointBehaviors),l=o(o({},n),{audioDirection:void 0!==n.audioDirection?t.toMediaDirection(n.audioDirection):SlimCore.Enums.MediaDirection.Bidirectional,videoDirection:void 0!==n.videoDirection?t.toMediaDirection(n.videoDirection):SlimCore.Enums.MediaDirection.ReceiveFromPeer,screenshareDirection:void 0!==n.screenshareDirection?t.toMediaDirection(n.screenshareDirection):this._isEnterpriseMultiParty(this._mediaPeerType)?SlimCore.Enums.MediaDirection.ReceiveFromPeer:SlimCore.Enums.MediaDirection.Disabled,datachannelDirection:void 0!==n.datachannelDirection?t.toMediaDirection(n.datachannelDirection):SlimCore.Enums.MediaDirection.Disabled,muteFlags:n.muteFlags,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:4===n.videoDirection,isGoLive:s,isHostless:true,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,groupId:A.mapToEmptyStrIfFalsy(this.groupId),threadId:A.mapToEmptyStrIfFalsy(this.threadId),messageId:A.mapToEmptyStrIfFalsy(this.messageId),subject:A.mapToEmptyStrIfFalsy(n.label),conversationType:A.mapToEmptyStrIfFalsy(n.conversationType),meetingInfo:A.mapToEmptyStrIfFalsy(JSON.stringify(this.meetingInfo)),endpointMetadata:A.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:A.mapToEmptyStrIfFalsy(this.onBehalfOfMri),onBehalfOfUserDisplayName:A.mapToEmptyStrIfFalsy(this.onBehalfOfUserDisplayName),callQueueContext:A.mapToEmptyStrIfFalsy(JSON.stringify(n.callQueueContext)),emergencyContent:A.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,connectionType:t.convertConnectionType(n.connectionType),maxVideoChannels:n.maxVideoChannels||0,maxVbssChannels:n.maxVbssChannels||0,publishedStatesJson:A.mapToEmptyStrIfFalsy(JSON.stringify(n.publishedStates)),negotiationTag:A.mapToEmptyStrIfFalsy(n.negotiationTag),scenario:A.mapToEmptyStrIfFalsy(n.scenario),mediaConfigurationJson:A.mapToEmptyStrIfFalsy(JSON.stringify(n.mediaConfiguration)),mediaStateConfigurationJson:A.mapToEmptyStrIfFalsy(n.sendMediaModalities),endpointBehaviors:c,additionalEndpointProperties:A.mapToEmptyStrIfFalsy(JSON.stringify(null==n?void 0:n.additionalEndpointProperties)),clientEndpointCapabilities:n.clientEndpointCapabilities||0,clientEndpointDebugContent:A.mapToEmptyStrIfFalsy(n.clientEndpointDebugContent),invitationDataJson:A.mapToEmptyStrIfFalsy(n.invitationDataJson),sharedLineCallInvitationContentJson:A.mapToEmptyStrIfFalsy(n.sharedLineCallInvitationContentJson),targetApplicationType:t.convertTargetApplicationType(n.targetApplicationType),participationPreferencesJson:A.mapToEmptyStrIfFalsy(JSON.stringify(n.participationPreferences)),captchaContentJson:A.mapToEmptyStrIfFalsy(n.captchaContentJson)}),d=!!n.conversationUrl||n.isExistingCallInObservingState,p=(0,g.calculateJoinedFromForTelemetry)(this.meetingData,this.threadId,this.messageId,this.groupId,d),this._callTelemetry.setJoinedFrom(p),n.meetingRegistrationId&&this._callTelemetry.setHasMeetingRegistrationId(!0),n.participantPin&&this._callTelemetry.setHasParticipantPin(!0),this._callTelemetry.recordOperation(h.CALL_OPERATIONS_INTERNAL.JOIN_OR_START_SLIMCORE_CALL,r),!d)return[3,6];switch(i.info("options: ".concat((0,C.getPrintableObject)(n))),this._setCallType(2),v=o(o({},l),{invitationType:SlimCore.Enums.InvitationType.None,preheatFlags:n.preheatFlags,meetingRegistrationId:A.mapToEmptyStrIfFalsy(n.meetingRegistrationId),participantPin:A.mapToEmptyStrIfFalsy(n.participantPin),causeId:r}),f=JSON.stringify({conversationUrl:n.conversationUrl,conversationId:this.callId,conversationType:n.conversationType}),i.info("jsonContext: ".concat(f)),e){case h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA:case h.CALL_OPERATIONS.START_WITH_MEETING_DATA:return[3,1]}return[3,3];case 1:return[4,this._slimcoreCallHandler.joinSignalingSessionWithMeetingData(JSON.stringify(this.meetingData),n.shouldResurrect,f,v.mediaPeerType,v)];case 2:return a=u.sent(),[3,5];case 3:return[4,this._slimcoreCallHandler.joinCall(f,v)];case 4:a=u.sent(),u.label=5;case 5:return this._callTelemetry.recordOperationSuccess(h.CALL_OPERATIONS_INTERNAL.JOIN_OR_START_SLIMCORE_CALL,{name:"JoinCall"}),this._assertSlimcoreObjectId(a,"JoinCall"),i.logSuccess("slimcoreCallHandler.JoinCall()"),[3,14];case 6:if(!n.callToVoicemail)return[3,7];if(i.info("Calling slimcoreCallHandler.PlaceCallToVoicemail"),1!==this.participants.length)throw new Error("PlaceCallToVoicemail Failed. Participant size should be one");return this._addParticipantToCall(this.participants[0],r),a=this._slimcoreCallHandler.placeCallToVoicemail(this.callId,t.convertToSlimCoreMediaPeerType(this._mediaPeerType),this.participants[0].id,{threadId:this.threadId,voicemailResourcePath:n.voicemailResourcePath,voicemailItemId:n.voicemailItemId}),this._callTelemetry.recordOperationSuccess(h.CALL_OPERATIONS_INTERNAL.JOIN_OR_START_SLIMCORE_CALL,{name:"PlaceCallToVoicemail"}),this._assertSlimcoreObjectId(a,"PlaceCallToVoicemail"),i.logSuccess("slimcoreCallHandler.PlaceCallToVoicemail()"),[3,14];case 7:return void 0===n.parkContext||void 0===n.pickupCode?[3,8]:(m=this.mapParkContext(n.parkContext),this._setCallType(1),v=o(o({},l),{screenshareDirection:SlimCore.Enums.MediaDirection.Disabled}),a=this._slimcoreCallHandler.startCallUnpark(this.callId,v,m,n.pickupCode),this._callTelemetry.recordOperationSuccess(h.CALL_OPERATIONS_INTERNAL.JOIN_OR_START_SLIMCORE_CALL,{name:"StartCallUnpark"}),this._assertSlimcoreObjectId(a,"StartCallUnpark"),i.logSuccess("slimcoreCallHandler.StartCallUnpark()"),[3,14]);case 8:switch(i.info("Calling slimcoreCallHandler.PlaceCall"),_=[],n.invitationType===SlimCore.Enums.InvitationType.Nudge&&n.participantsToNudge?_=n.participantsToNudge:this.participants.forEach((function(e){S._addParticipantToCall(e,r),_.push(e.id)})),y=1!==_.length,this._setCallType(y?2:1),v=o(o({},l),{preheatFlags:n.preheatFlags,screenshareDirection:void 0!==n.screenshareDirection?t.toMediaDirection(n.screenshareDirection):2===this.callType&&this._isEnterpriseMultiParty(this._mediaPeerType)?SlimCore.Enums.MediaDirection.ReceiveFromPeer:SlimCore.Enums.MediaDirection.Disabled,meetingRegistrationId:A.mapToEmptyStrIfFalsy(n.meetingRegistrationId),participantPin:A.mapToEmptyStrIfFalsy(n.participantPin)}),e){case h.CALL_OPERATIONS.START_WITH_MEETING_DATA:case h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA:return[3,9]}return[3,11];case 9:return[4,this._slimcoreCallHandler.startSignalingSessionWithMeetingData(this.callId,JSON.stringify(this.meetingData),v.shouldResurrect,v.mediaPeerType,v,_)];case 10:return a=u.sent(),[3,13];case 11:return[4,this._slimcoreCallHandler.placeCall(this.callId,_,v)];case 12:a=u.sent(),u.label=13;case 13:void 0!==n.maxVbssChannels&&n.maxVbssChannels>=0&&(this.maxVbssChannels=n.maxVbssChannels),this._callTelemetry.recordOperationSuccess(h.CALL_OPERATIONS_INTERNAL.JOIN_OR_START_SLIMCORE_CALL,{name:"PlaceCall"}),this._assertSlimcoreObjectId(a,"PlaceCall"),i.logSuccess("slimcoreCallHandler.PlaceCall()"),u.label=14;case 14:return this.attachSlimCoreCallObject(a,r,"_joinOrStartSlimCoreCall"),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,r),[2]}}))}))},t.prototype._fillIncomingCallProperties=function(e){var t=this._getProperties(this.slimcoreCallId,{conversationType:{propKey:SlimCore.Enums.Property.CallConversationType},callQueueInfo:{propKey:SlimCore.Enums.Property.CallQueueInfo},callerMri:{propKey:SlimCore.Enums.Property.CallerMriIdentity},transferorMri:{propKey:SlimCore.Enums.Property.CallTransferorMri},transferorDisplayName:{propKey:SlimCore.Enums.Property.CallTransferorDisplayName},transferorType:{propKey:SlimCore.Enums.Property.CallTransferorType},onBehalfOfMri:{propKey:SlimCore.Enums.Property.CallOnBehalfOfMri},onBehalfOfUserDisplayName:{propKey:SlimCore.Enums.Property.CallOnBehalfOfUserDisplayName},incomingCallType:{propKey:SlimCore.Enums.Property.CallIncomingType},consultativeTransferCallId:{propKey:SlimCore.Enums.Property.CallConsultativeTransferCallId},spamRiskLevel:{propKey:SlimCore.Enums.Property.CallSpamRiskLevel},spamStirAttestation:{propKey:SlimCore.Enums.Property.CallSpamStirAttestation},redirectionProperties:{propKey:SlimCore.Enums.Property.CallRedirectionProperties},fromApplicationType:{propKey:SlimCore.Enums.Property.CallFromApplicationType}},{isIncomingOneOnOneVideoCall:{propKey:SlimCore.Enums.Property.CallIsIncomingOneOnOneVideoCall}});this._setCallerMri((0,E.stripMriAliases)(t.callerMri),e),this._updateConversationType(t.conversationType,e),this.transferorMri=(0,E.stripMriAliases)(t.transferorMri),this.transferorDisplayName=t.transferorDisplayName,this.transferorType=t.transferorType,this.onBehalfOfMri=(0,E.stripMriAliases)(t.onBehalfOfMri),this.onBehalfOfUserDisplayName=t.onBehalfOfUserDisplayName,this.callQueueInfo=t.callQueueInfo&&JSON.parse(t.callQueueInfo),this.incomingCallType=t.incomingCallType,this._setConsultativeCallId(this.consultativeCallId),this.isIncomingOneOnOneVideoCall=!!t.isIncomingOneOnOneVideoCall,this.spamRiskLevel=t.spamRiskLevel,this.spamStirAttestation=t.spamStirAttestation,this.redirectionProperties=t.redirectionProperties,this.fromApplicationType=t.fromApplicationType},t.prototype._onCallPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimcoreCallId,e,t)},t.prototype._onPropertyChanged=function(e,t){this[e]!==t&&(this._logger.info("_onPropertyChanged: key=".concat(e," value=").concat(t)),this[e]=t,this.raiseChangedDeferredIfEnabled())},t.prototype.attachSlimCoreCallObject=function(e,t,n){var r=this;void 0===n&&(n="attachSlimCoreCallObject");var i=this._logger.createFnLogger("attachSlimCoreCallObject",t),o=this._callOperationHandler.getPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),a=this.slimcoreCallId;if(this.slimcoreCallId===e)return o;0!==this.slimcoreCallId&&i.info("Call already attached to a different SlimCore object, attaching to new object"),i.info("new slimCoreCallObjectId=".concat(e)),this.slimcoreCallId=e,this._isOptimizedSpeakerEventingEnabled=this._ecs.getBoolean("SkypeCalling","enableOptimizedSpeakerChangeEvents",!1),this._enableCallMemberCountChangedFallback=this._ecs.getBoolean("SkypeCalling","enableCallMemberCountChangedFallback",!1),this._slimCoreElectronRemoteManager=new H.default(t,this._logger,this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this.slimcoreCallId,this.mediaStreams,this._streamContextMap,this.createVirtualParticipantMSIToParticipantIdMapper),this._slimCoreElectronRemoteManager.changed((function(){r.raiseChanged()})),this.createVideoLayout(),this._onCallPropertyChanged(SlimCore.Enums.Property.CallOrigin,(function(e){r._onCallOriginChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallStatus,(function(e){r._onCallStatusChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallConnectedToMixer,(function(e){return r._updateCallConnectedToMixer(!!e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMode,(function(e){return r._onCallModeChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallTransferStatus,(function(e){r._onCallTransferStatusChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallParkStatus,(function(e){r._onCallParkStatusChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallIsMuted,(function(e){r._onCallMutedUnmuted(!!e.value,t)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallIsMutedSpeaker,(function(e){r._onCallMutedUnmutedSpeaker(!!e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallIsServerMuted,(function(e){r._onCallIsServerMuted(!!e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallActiveMembers,(function(e){r._onParticipantJoinedOrRemovedDeferred(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallGroupId,(function(e){r._onGroupIdChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallThreadId,(function(e){r._onThreadIdChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMessageId,(function(e){r._onMessageIdChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallBackroomThreadId,(function(e){r._onBackroomThreadIdChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallEndpointDetails,(function(e){r._updateEndpointDetails(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.SelfParticipantRole,(function(e){r._onSelfParticipantRoleChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.SelfParticipantTenantId,(function(e){r._onSelfParticipantTenantIdChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMeetingDetails,(function(e){r._updateMeetingDetails(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMeetingStates,(function(e){r._onMeetingStatesChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallComplianceRecordingContent,(function(e){r._updateComplianceRecordingContent(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMemberCountChanged,(function(e){r._onParticipantJoinedOrRemovedDeferred(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallIsConference,(function(e){r._updateCallType(e.value,t)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallIsHostless,(function(e){r._updateIsHostless(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallForwardingDestinationType,(function(e){r._updateForwardingDestinationType(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallOptimalRemoteVideoCount,(function(e){r._onCallOptimalVideoCountChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMaxIncomingVideoCount,(function(e){r._onCallMaxIncomingVideoCountChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMaxIncomingVbssCount,(function(e){r._onCallMaxIncomingVbssCountChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallName,(function(e){r._onCallIdChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallDataChannelObjectId,(function(e){r._updateDataChannel(t,e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallLocalRecordingObjectId,(function(e){r._updateLocalRecording(t,e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallBroadcastMetadata,(function(e){r._onBroadcastMetadataChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallProgressStatus,(function(e){r._onCallProgressStatusChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallEndDiagnosticsCode,(function(e){r._onDiagnosticsCodeChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.TransferDiagnosticsCode,(function(e){r._onTransferDiagnosticsCodeChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallInvitationData,(function(e){r._updateCallInvitationData(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.SelfMeetingRole,(function(e){r._updateMeetingRole(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.SelfAdvancedMeetingRole,(function(e){r._updateAdvancedMeetingRole(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.SelfParticipantType,(function(e){r._updateParticipantType(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.SelfPropertyBag,(function(e){r._updatePropertyBag(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.SelfRosterVersion,(function(e){r._updateRosterVersion(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallTransferorMri,(function(e){r._updateTransferorMri(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallClientTransferContext,(function(e){r._updateClientTransferContext(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallCapabilities,(function(e){r._onCallCapabilitiesChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallActiveVideoChannelCount,(function(e){r._updateActiveVideoChannelCount(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallPublishedStates,(function(e){r._onPublishedStatesChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallConversationType,(function(e){r._updateConversationType(e.value,t)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallParticipantCounts,(function(e){r._onParticipantCountsUpdated(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallIsLocallyHeld,(function(e){r._updateIsLocallyHeld(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMeetingData,(function(e){r._onMeetingDataChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMeetingInfo,(function(e){r._onMeetingInfoChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallRegion,(function(e){r._onPropertyChanged("region",e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallBreakoutDetails,(function(e){r._onBreakoutDetailsUpdated(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMeetingGroupDetails,(function(e){r._onMeetingGroupDetailsChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallLimits,(function(e){r._onCallLimitsUpdated(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallIsSharedLineAppearanceV2Activated,(function(e){r._updateIsSharedLineAppearanceV2Activated(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.ParticipantVideoCountChanged,(function(){return r._slimCoreElectronRemoteManager.onVideoCountChanged()})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallContentSharingSessionCountChanged,(function(){return r._onContentSharingChanged()})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallMaskedIdentityDetailsJson,(function(e){r._updateMaskedIdentityDetails(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallConversationStartTime,(function(e){r._onConversationStartTimeChanged(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallGroupKeyManagerMri,(function(e){r._updateGroupKeyManagerMri(e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallJoinAsStreamingUser,(function(e){r._onCallJoinAsStreamingUser(!!e.value)})),this._onCallPropertyChanged(SlimCore.Enums.Property.CallEnableCaptcha,(function(e){r._onCallEnableCaptcha(!!e.value)})),this._registerDisposable(this._slimcoreCallHandler.handle("audio-stream-state-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onAudioStreamStateChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("e-2-e-encryption-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onE2EEncryptionStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("transfer-requested",{callObjectId:this.slimcoreCallId},(function(e){r._onTransferRequested(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("callmeback-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onCallMeBackOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("unmuteself-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onUnmuteOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("muteself-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onMuteOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("media-negotiation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onMediaNegotiationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("nudge-participants-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onNudgeParticipantOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("update-meeting-roles-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onUpdateMeetingRoleOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("mute-participants-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onMuteParticipantOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("incoming-proxied-messages",{callObjectId:this.slimcoreCallId},(function(e){r._onIncomingProxiedMessages(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("active-speaker-list-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onActiveSpeakerListChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("dominant-speaker-list-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onDominantSpeakerListChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("slowed-down-active-talker-list-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onSlowedDownActiveTalkerListChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("remote-user-events-received",{callObjectId:this.slimcoreCallId},(function(e){r._onRemoteUserEventsReceived(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("batch-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onBatchOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("publish-state-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onPublishStateOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("remove-state-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){r._onRemoveStateOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreInstance.handle("quality-changed",void 0,(function(e){r._onQualityChanged(e)})));var s=this._getProperties(this.slimcoreCallId,{callId:{propKey:SlimCore.Enums.Property.CallName},groupId:{propKey:SlimCore.Enums.Property.CallGroupId},threadId:{propKey:SlimCore.Enums.Property.CallThreadId},messageId:{propKey:SlimCore.Enums.Property.CallMessageId},backroomThreadId:{propKey:SlimCore.Enums.Property.CallBackroomThreadId},meetingDetails:{propKey:SlimCore.Enums.Property.CallMeetingDetails},meetingStates:{propKey:SlimCore.Enums.Property.CallMeetingStates},meetingLayout:{propKey:SlimCore.Enums.Property.CallMeetingLayout},tenantId:{propKey:SlimCore.Enums.Property.SelfParticipantTenantId},role:{propKey:SlimCore.Enums.Property.SelfParticipantRole},broadcastMetadata:{propKey:SlimCore.Enums.Property.CallBroadcastMetadata},invitationData:{propKey:SlimCore.Enums.Property.CallInvitationData},clientTransferContext:{propKey:SlimCore.Enums.Property.CallClientTransferContext},meetingRole:{propKey:SlimCore.Enums.Property.SelfMeetingRole},advancedMeetingRole:{propKey:SlimCore.Enums.Property.SelfAdvancedMeetingRole},participantType:{propKey:SlimCore.Enums.Property.SelfParticipantType},propertyBag:{propKey:SlimCore.Enums.Property.SelfPropertyBag},publishedStates:{propKey:SlimCore.Enums.Property.CallPublishedStates},participantCounts:{propKey:SlimCore.Enums.Property.CallParticipantCounts},meetingData:{propKey:SlimCore.Enums.Property.CallMeetingData},meetingInfo:{propKey:SlimCore.Enums.Property.CallMeetingInfo},region:{propKey:SlimCore.Enums.Property.CallRegion},breakoutDetails:{propKey:SlimCore.Enums.Property.CallBreakoutDetails},meetingGroupDetails:{propKey:SlimCore.Enums.Property.CallMeetingGroupDetails},callLimits:{propKey:SlimCore.Enums.Property.CallLimits},maskedIdentityDetailsJson:{propKey:SlimCore.Enums.Property.CallMaskedIdentityDetailsJson},complianceRecordingContent:{propKey:SlimCore.Enums.Property.CallComplianceRecordingContent},callMemberCountChanged:{propKey:SlimCore.Enums.Property.CallMemberCountChanged},conversationStartTime:{propKey:SlimCore.Enums.Property.CallConversationStartTime},groupKeyManagerMri:{propKey:SlimCore.Enums.Property.CallGroupKeyManagerMri},joinAsStreamingUser:{propKey:SlimCore.Enums.Property.CallJoinAsStreamingUser},enableCaptcha:{propKey:SlimCore.Enums.Property.CallEnableCaptcha}},{status:{propKey:SlimCore.Enums.Property.CallStatus},mode:{propKey:SlimCore.Enums.Property.CallMode},isCallConnectedToMixer:{propKey:SlimCore.Enums.Property.CallConnectedToMixer},isConference:{propKey:SlimCore.Enums.Property.CallIsConference},isServerMuted:{propKey:SlimCore.Enums.Property.CallIsServerMuted},capabilityFlags:{propKey:SlimCore.Enums.Property.CallCapabilities},activeVideoChannelCount:{propKey:SlimCore.Enums.Property.CallActiveVideoChannelCount},version:{propKey:SlimCore.Enums.Property.SelfRosterVersion}});return 8!==this.state&&this._slimCoreElectronRemoteManager.onVideoCountChanged(),this._updateCallType(s.isConference,t),this._onCallIdChanged(s.callId),this._onGroupIdChanged(s.groupId),this._onThreadIdChanged(s.threadId),this._onMessageIdChanged(s.messageId),this._onBackroomThreadIdChanged(s.backroomThreadId),this._onCallStatusChanged(s.status,t),this._onCallModeChanged(s.mode,t),this._updateCallConnectedToMixer(!!s.isCallConnectedToMixer,t),this._updateMeetingDetails(s.meetingDetails),this._onMeetingStatesChanged(s.meetingStates),this._updateComplianceRecordingContent(s.complianceRecordingContent),this._onSelfParticipantTenantIdChanged(s.tenantId),this._onSelfParticipantRoleChanged(s.role),this._onCallIsServerMuted(!!s.isServerMuted),this._onBroadcastMetadataChanged(s.broadcastMetadata),this._updateCallInvitationData(s.invitationData),this._updateClientTransferContext(s.clientTransferContext),this._updateMeetingRole(s.meetingRole),this._updateAdvancedMeetingRole(s.advancedMeetingRole),this._updateParticipantType(s.participantType),this._updatePropertyBag(s.propertyBag),this._updateRosterVersion(s.version),this._onPublishedStatesChanged(s.publishedStates),this._onCallCapabilitiesChanged(s.capabilityFlags),this._updateActiveVideoChannelCount(s.activeVideoChannelCount),this._onParticipantCountsUpdated(s.participantCounts),this._onMeetingDataChanged(s.meetingData),this._onMeetingInfoChanged(s.meetingInfo),this._onPropertyChanged("region",s.region),this._onBreakoutDetailsUpdated(s.breakoutDetails),this._onMeetingGroupDetailsChanged(s.meetingGroupDetails),this._onCallLimitsUpdated(s.callLimits),this._updateMaskedIdentityDetails(s.maskedIdentityDetailsJson),this._onConversationStartTimeChanged(s.conversationStartTime),this._updateGroupKeyManagerMri(s.groupKeyManagerMri),this._onCallJoinAsStreamingUser(!!s.joinAsStreamingUser),this._onCallEnableCaptcha(!!s.enableCaptcha),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.ELECTRON_ATTACH_SLIMCORE_CALL,{slimCoreCallObjectId:e,oldSlimcoreCallId:a,callId:s.callId,groupId:s.groupId,threadId:s.threadId,messageId:s.messageId,role:s.role},t),this._enableCallMemberCountChangedFallback&&(this._logger.info("enableCallMemberCountChangedFallback set to true"),s.callMemberCountChanged=s.callMemberCountChanged||'{"sequenceNumber":-1, "participants":{}}'),this._lastSequenceNumberProcessed=void 0,this._handleMemberCountChangedPayload(s.callMemberCountChanged)&&this._onParticipantJoinedOrRemoved(t),this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,void 0,void 0,void 0,!0),this._assertSlimcoreObjectId(this.slimcoreCallId,n),o},t.prototype.createVideoLayout=function(){var e=this,t=V.default.isVideoLayoutSupported(this._slimcoreInstance);this.videoLayout=t?new V.default(this._logger,this._settings,this._slimcoreInstance,this.slimcoreCallId,this.createVirtualParticipantMSIToParticipantIdMapper,(function(t,n){return l(e,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.setMaxVideoChannels(t,"keep_tag",n)];case 1:return e.sent(),[2,t]}}))}))})):void 0},t.prototype._updateCallInvitationData=function(e){try{e&&(this.invitationData=JSON.parse(e),this._logger.info("_updateCallInvitationData updated: invitationData.legnth = ".concat(e.length)),this.raiseChangedDeferredIfEnabled())}catch(t){this._logger.info("Failed to parse invitation data. Error: ".concat(t,", diagnosticsCode: ").concat(e))}},t.prototype._updateCallType=function(e,t){var n=this._logger.createFnLogger("updateCallType",t,"current=".concat(this.callType)),r=0===e?1:1===e?2:-1;2!==this.callType||1!==r?(n.info("newValue: ".concat(r)),r!==this.callType&&(2===r&&this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.CALL_ESCALATED_TO_CONFERENCE,void 0,t),this._setCallType(r),this._updateCapabilities(t),this.raiseChangedDeferredIfEnabled())):n.logFailure("De-escalating to P2P not allowed!")},t.prototype._updateConversationType=function(e,t){this._logger.createFnLogger("updateConversationType",t,"current=".concat(this.conversationType)).info("newValue: ".concat(e)),e!==this.conversationType&&(this.conversationType=e,this._updateCallPropertyBasedOnConversationType(this.conversationType),this._callTelemetry.setConversationType(this.conversationType),this.raiseChangedDeferredIfEnabled())},t.prototype._updateCallPropertyBasedOnConversationType=function(e){this._setIsHuddleGroupCall("huddleGroupCall"===e),this._setIsCast("cast"===e)},t.prototype._setFromApplicationType=function(e,t){e&&(this.fromApplicationType=e,this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_FROM_APPLICATION_TYPE,{fromApplicationType:e},t))},t.prototype._updateForwardingDestinationType=function(e){e!==this.forwardingDestinationType&&(this.forwardingDestinationType=e,this.raiseChangedDeferredIfEnabled())},t.prototype._setupCallTelemetry=function(){this._callTelemetry=new g.CallTelemetry(this._logger,this._callStartTime,this._ipcStats);try{this._callTelemetry.setStackConfig({SlimCoreVersion:SlimCore.getVersion()})}catch(e){this._logger.info("Failed to log stack config")}},t.prototype._updateDataChannel=function(e,t){if(this._logger.info("_updateDataChannel()"),t){this._dataChannel&&this._dataChannel.dispose(e);var n=void 0;try{n=this._slimcoreInstance.getDataChannel(t)}catch(e){return this._logger.error("failed to get data channel: ".concat(e)),void this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED)}this._dataChannel=new L.default(this._logger,this._settings,this._slimcoreInstance,this,n,this._dataChannelUsers,t),this._dataChannel.setAdapterSourceSinkCallback(this.dataChannelAdapter.setInternalSourceSink),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED),this._logger.info("Data channel set")}},t.prototype._updateLocalRecording=function(e,t){var n=this;if(this._logger.info("_updateLocalRecording()"),this._isLocalRecordingAllowedByEcs){this._localRecordingInstance&&this._localRecordingInstance.dispose();try{this._localRecordingInstance=this._slimcoreInstance.getLocalRecording(t,this.currentUserSkypeIdentity.id)}catch(e){return this._logger.error("failed to get local recording: ".concat(e)),void this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_LOCAL_RECORDING_CREATED)}this._setLocalRecordingCaptureToPresenter(e),this._registerDisposable(this._localRecordingInstance.handle("local-recording-error",{},(function(e){n._onLocalRecordingError(e)}))),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_LOCAL_RECORDING_CREATED),this._logger.info("LocalRecording set")}else this._logger.info("LocalRecording feature is turned off")},t.prototype.mapDataChannelSourceIdToParticipant=function(e){var t=null;return(null==(t=1===this.callType?this.participants[0]:d.find(this.participants,(function(t){return t.hasSourceId(3,e)})))?void 0:t.id)?this._logger.info("ParticipantId: ".concat(O.scrubMriOrOmit(t.id)," to SourceId: ").concat(e)):this._logger.warn("No Participant found for SourceId: ".concat(e)),t},t.prototype._onAudioStreamStateChanged=function(e){this.event("mediaStreamStateChanged").raise(),e.direction===SlimCore.Enums.MediaDirection.ReceiveFromPeer&&(this.isAudioStreamConnected=e.streamState===SlimCore.Enums.MediaStreamState.StreamInactive||e.streamState===SlimCore.Enums.MediaStreamState.StreamActive),e.streamState===SlimCore.Enums.MediaStreamState.StreamFail&&this.event("mediaConnectionFailed").raise()},t.prototype._onE2EEncryptionStatusChanged=function(e){var t=o({},e);this._onCallEncryptionChanged(t.enabled),this.event("e2eEncryptionStatusChanged").raise(t)},t.prototype._onTransferRequested=function(e){var t=this;this._logger.info("Transfer: _onTransferRequested",e);var n,r=this._getProperties(e.targetCallObjectId,{},{newCallOrigin:{propKey:SlimCore.Enums.Property.CallOrigin,fallback:SlimCore.Enums.OriginType.Unspecified}}).newCallOrigin;r===SlimCore.Enums.OriginType.Park?n=1:r===SlimCore.Enums.OriginType.Transfer?n=0:r===SlimCore.Enums.OriginType.TransferToVoicemail?n=2:this._logger.info("Unkown transfer type based on new call origin"),this._logger.info("onTransferRequested newCallOrigin=".concat(r," transferType=").concat(n));var i={transferorMri:e.transferorMri,targetMri:e.transferTargetMri,transferType:n,context:{newCallObjectId:e.targetCallObjectId}};this.event("transferRequested").raise({transferContext:i,onCompleted:function(e){t._logger.debug("Transfer: transferCompleted called: ".concat(e)),1!==e&&t._slimcoreCallHandler.leaveCall(i.context.newCallObjectId)}})},t.prototype._operationStatusChanged=function(e,t,n){this._logger.info("[".concat(e,"][OperationStatusChanged]: ").concat(n));var r=n.causeId||(0,f.generateCauseId)();if(e.hasPendingOperation(t)){var i={reason:M.convertFailureReasonToParticipantReason(n.failureReason)};i.code=n.code,i.subCode=n.subCode,i.phrase=n.phrase,this._callTelemetry.updateOperationData(t,i,r)}},t.prototype._onCallMeBackOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e),this._logger.info("[onCallMeBackOperationStatusChanged]: code: ".concat(e.code," subCode: ").concat(e.subCode));var t=M.convertFailureReasonToParticipantReason(e.failureReason),n={code:e.code,subCode:e.subCode,phrase:e.phrase};n.failureReason=t,e.failureReason===SlimCore.Enums.ParticipantFailureReason.NoFailure?this._participantOperationHandler.maybeResolveOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,null,e.participantMri,e.causeId):this._participantOperationHandler.rejectOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,n,e.participantMri,e.causeId)},t.prototype._onUnmuteOperationStatusChanged=function(e){this._operationStatusChanged(this._callOperationHandler,h.CALL_OPERATIONS.UNMUTE,e);var n,r=(0,f.generateCauseId)();try{n=JSON.parse(e.transactionEnd)}catch(e){this._logger.info("_onUnmuteOperationStatusChanged: exception when parsing transactionEnd ".concat(e,", assuming terminated reasion"))}if(n&&n.code)0===n.code&&0===n.subCode?this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.UNMUTE,n,r,r):this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.UNMUTE,n,r,r);else{var i=t.convertParticipantReasonToTerminatedReason(M.convertFailureReasonToParticipantReason(e.failureReason));e.operationResult===SlimCore.Enums.OperationResultCode.Success?this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.UNMUTE,i,void 0,r):this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.UNMUTE,i,void 0,r)}},t.prototype._onMuteOperationStatusChanged=function(e){var t;this._logger.info("_onMuteOperationStatusChanged: eventData ".concat(JSON.stringify(e,null,4)));try{t=JSON.parse(e.transactionEnd)}catch(e){return void this._logger.info("_onMuteOperationStatusChanged: exception when parsing transactionEnd ".concat(e))}if(this._logger.info("_onMuteOperationStatusChanged: parsed transactionEnd ".concat(JSON.stringify(t,null,4))),t){this._operationStatusChanged(this._callOperationHandler,h.CALL_OPERATIONS.MUTE,e);var n=(0,f.generateCauseId)();0===t.code&&0===t.subCode?this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.MUTE,t,n,n):this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.MUTE,t,n,n)}},t.prototype._onNudgeParticipantOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,e);var t=(0,f.generateCauseId)(),n=M.convertFailureReasonToParticipantReason(e.failureReason);e.failureReason===SlimCore.Enums.ParticipantFailureReason.NoFailure?this._participantOperationHandler.resolveOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,n,e.context,t):this._participantOperationHandler.rejectOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,n,e.context,t)},t.prototype._onUpdateMeetingRoleOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,e);var t={code:e.code,subCode:e.subCode,phrase:e.phrase};0===t.code&&0===t.subCode?this._participantOperationHandler.resolveOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,t,e.causeId,e.causeId):this._participantOperationHandler.rejectOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,t,e.causeId,e.causeId)},t.prototype._onMuteParticipantOperationStatusChanged=function(e){this._operationStatusChanged(this._callOperationHandler,h.CALL_OPERATIONS.MUTE_PARTICIPANTS,e);var t={code:e.code,subCode:e.subCode,phrase:e.phrase};0===t.code&&0===t.subCode?this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,t,e.causeId,e.causeId):this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,t,e.causeId,e.causeId)},t.prototype._onIncomingProxiedMessages=function(e){var t;this._logger.info("_onIncomingProxiedMessages: eventData ".concat(JSON.stringify(e,null,4)));try{t=e.messagesJsons.map((function(e){return JSON.parse(e)}))}catch(e){return void this._logger.error("_onIncomingProxiedMessages: exception when parsing incoming proxied messages ".concat(e))}t&&this.event("incomingProxiedMessages").raise(t)},t.prototype._onActiveSpeakerListChanged=function(e){for(var t,n={},r=0,i=null!==(t=e.activeSpeakers)&&void 0!==t?t:[];r<i.length;r++){n[i[r]]=1}for(var o=0,a=this.participants;o<a.length;o++){var s=a[o];s.setVoiceLevel(n[s.id]||0)}this._disableActiveSpeakerLogging||this._logger.info("_onActiveSpeakerListChanged: number of active speakers ".concat(Object.keys(n).length))},t.prototype._onDiagnosticsCodeChanged=function(e){var t=this;if(this._rawCallEndDiagnosticsInfo!==e&&e&&!d.isEmpty(e)){this._logger.info("_onDiagnosticsCodeChanged diagnosticsCode: ".concat(e));try{this._rawCallEndDiagnosticsInfo=e,this.callEndDiagnosticsInfo=JSON.parse(e),this._suppressParticipantDiagnosticsCodeChanged&&this.participants.forEach((function(n){return l(t,void 0,void 0,(function(){return u(this,(function(t){return n.onParticipantDiagnosticsCodeChanged(e),[2]}))}))}));try{this.callEndDiagnosticsInfo.additionalDiagnostics&&(this.callEndDiagnosticsInfo.additionalDiagnostics=JSON.parse(this.callEndDiagnosticsInfo.additionalDiagnostics))}catch(e){this._logger.warn("_onDiagnosticsCodeChanged failed to parse, may be OK. Error: ".concat(e,", additionalDiagnostics: ").concat(this.callEndDiagnosticsInfo.additionalDiagnostics,"."))}this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: ".concat(t,", diagnosticsCode: ").concat(e))}}},t.prototype._onTransferDiagnosticsCodeChanged=function(e){if(this._rawTransferDiagnosticsInfo!==e&&e&&!d.isEmpty(e)){this._logger.info("_onTransferDiagnosticsCodeChanged: ".concat(e));try{this._rawTransferDiagnosticsInfo=e,this.transferDiagnosticsInfo=JSON.parse(e),this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: ".concat(t,", diagnosticsCode: ").concat(e))}}},t.prototype._onDominantSpeakerListChanged=function(e){var t;this.dominantSpeakerInfo.speakerList=null!==(t=e.dominantSpeakers)&&void 0!==t?t:[],this.dominantSpeakerInfo.noCurrentDominantSpeaker=!!e.noCurrentDominantSpeaker,this._logger.info("_onDominantSpeakerListChanged: number of dominant speakers ".concat(this.dominantSpeakerInfo.speakerList.length,", there is no current dominant speaker ").concat(this.dominantSpeakerInfo.noCurrentDominantSpeaker)),this.event("dominantSpeakerChanged").raise(),this._isOptimizedSpeakerEventingEnabled||(this._isOptimizedSpeakerEventingEnabled=!0,this._logger.info("_onDominantSpeakerListChanged: enableOptimizedSpeakerChangeEvents is true from SlimCore. Override _isOptimizedSpeakerEventingEnabled to be ".concat(this._isOptimizedSpeakerEventingEnabled))),this.raiseChanged(this._dominantSpeakerChangedEventSkipConfig)},t.prototype._onSlowedDownActiveTalkerListChanged=function(e){var t;this.slowedDownActiveTalkerInfo.speakerList=null!==(t=e.slowedDownActiveSpeakers)&&void 0!==t?t:[],this._logger.info("_onSlowedDownActiveTalkerListChanged: number of slowed down speakers ".concat(this.slowedDownActiveTalkerInfo.speakerList.length)),this.raiseChangedDeferredIfEnabled()},t.prototype._onRemoteUserEventsReceived=function(e){this.event("remoteUserEventsReceived").raise(e.participantId,e.events)},t.prototype._updateCallLegIdChanged=function(e){this.participantId!==e&&(this._logger.info("updateCallLegIdChanged: new value is ".concat(e)),this._setParticipantId(e),this.event("callLegIdChanged").raise(e),this.raiseChangedDeferredIfEnabled())},t.prototype._completeAdmitParticipantTransaction=function(e,t,n,r,i){void 0===i&&(i=!1),this._logger.info("_completeAdmitParticipantTransaction[".concat(n,"][").concat(O.scrubMriOrOmit(r),"]: operationName ").concat(e," transactionEnd ").concat(JSON.stringify(t,null,4)));var o=this._getParticipantLegId(this._getParticipant(r)),a=o?{participantLegId:o}:{};0===t.code?(this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n,a),this._participantOperationHandler.maybeResolveOperation(e,t,r,n)):(this._callTelemetry.maybeRecordOperationFailure(e,t,r,n,a),this._participantOperationHandler.maybeRejectOperation(e,t,r,n))},t.prototype._completeAddParticipantTransaction=function(e,t,n,r){this._logger.info("_completeAddParticipantTransaction[".concat(n,"][").concat(O.scrubMriOrOmit(r),"]: operationName ").concat(e," transactionEnd ").concat(JSON.stringify(t,null,4)));var i=this._getParticipant(r),o={participantLegId:this._getParticipantLegId(i)};0===t.code&&(this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n,o),this._participantOperationHandler.maybeResolveOperation(e,i,r,n))},t.prototype._completeMergeParticipantTransaction=function(e,t,n,r){this._logger.info("_completeMergeParticipantTransaction[".concat(n,"][").concat(O.scrubMriOrOmit(r),"]: operationName ").concat(e," transactionEnd ").concat(JSON.stringify(t,null,4)));var i={debugContent:{replacementParticipantLegId:r},participantLegId:this._mergeReplacementParticipantIdToNewParticipantIdMap[r]};0===t.code||t.code>=200&&t.code<300?(this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n,i),this._callOperationHandler.maybeResolveOperation(e,t,r,n)):(this._callTelemetry.maybeRecordOperationFailure(e,t,r,n,i),this._callOperationHandler.maybeRejectOperation(e,t,r,n))},t.prototype._completeTransaction=function(e,t,n,r){this._logger.info("_completeTransaction[".concat(n,"][").concat(r,"]: operationName ").concat(e," transactionEnd ").concat(JSON.stringify(t,null,4))),this._callTelemetry.updateOperationData(e,t,n,r),0===t.code||t.code>=200&&t.code<300?(this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n),this._callOperationHandler.maybeResolveOperation(e,t,r,n)):(this._callTelemetry.maybeRecordOperationFailure(e,t,r,n),this._callOperationHandler.maybeRejectOperation(e,t,r,n))},t.prototype._completeWithTransactionResult=function(e,t,n,r,i){if(void 0===i&&(i=!1),this._logger.info("_completeWithTransactionResult[".concat(n,"][").concat(r,"]: operationName ").concat(e," code: ").concat(JSON.stringify(t.code)," subcode: ").concat(JSON.stringify(t.subCode))),this._callTelemetry.updateOperationData(e,(0,C.getPIISafeObject)(t),n,r),0===t.code&&0===t.subCode||i&&t.code>=200&&t.code<300)try{this._callOperationHandler.maybeResolveOperation(e,t.result?JSON.parse(t.result):JSON.parse("{}"),r,n),this._callTelemetry.maybeRecordOperationSuccess(e,t.result||t,r,n)}catch(t){this._logger.error("[".concat(n,"]Failed to parse transaction results. Error: ").concat(t)),this._callTelemetry.maybeRecordOperationSuccess(e,(0,y.getRejectTransactionEnd)(t,h.TRANSACTION_END_SUBCODE.CANNOT_PARSE_RESULT),r,n),this._callOperationHandler.maybeRejectOperation(e,(0,y.getRejectTransactionEnd)(t,h.TRANSACTION_END_SUBCODE.CANNOT_PARSE_RESULT),r,n)}else this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n),this._callOperationHandler.maybeRejectOperation(e,t,r,n)},t.prototype._onOperationStatusChanged=function(e){var t,n=this;this._logger.info("_onOperationStatusChanged: eventData ".concat(JSON.stringify(e,null,4)));try{t=JSON.parse(e.result)}catch(e){return void this._logger.info("_onOperationStatusChanged: exception when parsing result ".concat(e))}if(this._logger.info("_onOperationStatusChanged: parsed response ".concat(JSON.stringify(t,null,4))),t){var r=function(e){e&&t.hasOwnProperty(e)||i._logger.info("_onOperationStatusChanged: causeId empty or invalid ".concat(t));var r=function(r){t[e].hasOwnProperty(r)||i._logger.info("_onOperationStatusChanged: not a valid object ".concat(t));var o=t[e][r];i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,r)?i._completeTransaction(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,o,e,r):i._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE)?i._completeTransaction(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,o,e,r):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,e)?i._completeTransaction(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,o,e,e):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.ADMIT,e)?i._completeTransaction(h.CALL_OPERATIONS.ADMIT,o,e,e):i._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,r)?i._completeAdmitParticipantTransaction(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,o,e,r):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.MERGE_PARTICIPANT,r)?i._completeMergeParticipantTransaction(h.CALL_OPERATIONS.MERGE_PARTICIPANT,o,e,r):i._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_PARK_V2)?i._completeTransaction(h.CALL_OPERATIONS_INTERNAL.CALL_PARK_V2,o,e,r):i._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.PARK_CALL)?i._completeTransaction(h.CALL_OPERATIONS.PARK_CALL,o,e,r):i._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.UNPARK_CALL)?i._completeTransaction(h.CALL_OPERATIONS.UNPARK_CALL,o,e,r):i._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.UPDATE_MONITOR_SESSION)?i._completeTransaction(h.CALL_OPERATIONS.UPDATE_MONITOR_SESSION,o,e,r):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,e)?i._completeWithTransactionResult(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,o,e,e,!0):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,e)?i._completeWithTransactionResult(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,o,e,e,!0):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,e)?i._completeTransaction(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,o,e,e):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,e)?i._completeWithTransactionResult(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,o,e,e):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,e)?i._completeTransaction(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,o,e,e):i._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,r)?i._completeAddParticipantTransaction(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,o,e,r):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.SET_MEETING_LAYOUT,r)?i._completeWithTransactionResult(h.CALL_OPERATIONS.SET_MEETING_LAYOUT,o,e,r):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,r)?i._completeTransaction(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,o,e,r):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,e)?i._completeTransaction(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,o,e,e):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,e)?i._completeTransaction(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,o,e,e):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.SEND_MESSAGES,r)?i._completeTransaction(h.CALL_OPERATIONS.SEND_MESSAGES,o,e,r):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES,r)?i._completeTransaction(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES,o,e,r):i._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_MEETING_STATES,r)?i._completeTransaction(h.CALL_OPERATIONS.UPDATE_MEETING_STATES,o,e,r):i._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.SWITCH_INTERPRETER_GROUP)?i._completeTransaction(h.CALL_OPERATIONS.SWITCH_INTERPRETER_GROUP,o,e,r):i._mergeParticipantMriToParticipantIdMap&&Object.keys(i._mergeParticipantMriToParticipantIdMap).forEach((function(t){var i=n._mergeParticipantMriToParticipantIdMap[t].indexOf(r);i>=0&&n._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.MERGE_PARTICIPANT,t)&&(n._mergeParticipantMriToParticipantIdMap[t].splice(i,1),delete n._mergeParticipantMriToParticipantIdMap[t],n._completeMergeParticipantTransaction(h.CALL_OPERATIONS.MERGE_PARTICIPANT,o,e,t))}))};for(var o in t[e])r(o)},i=this;for(var o in t)r(o)}},t.prototype._onBatchOperationStatusChanged=function(e){this._logger.info("_onBatchOperationStatusChanged: eventData ".concat(JSON.stringify(e,null,4)));for(var t=0,n=e.results;t<n.length;t++){var r=n[t];this._onOperationStatusChanged({callObjectId:e.callObjectId,result:r})}},t.prototype._onPublishStateOperationStatusChanged=function(e){this._logger.info("_onPublishStateOperationStatusChanged: eventData ".concat(JSON.stringify(e,null,4)));var t={};t.code=e.code,t.subCode=e.subCode,t.phrase=e.phrase,t.result=e.result,t.code>=200&&t.code<300&&0===t.subCode?this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.PUBLISH_STATE,e.stateId?e.stateId:e.result,e.causeId,e.causeId):this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS.PUBLISH_STATE,t,e.causeId,e.causeId)},t.prototype._onRemoveStateOperationStatusChanged=function(e){this._logger.info("_onRemoveStateOperationStatusChanged: eventData ".concat(JSON.stringify(e,null,4)));var t={};t.code=e.code,t.subCode=e.subCode,t.phrase=e.phrase,t.result=e.result,e.operationSuccess?this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.REMOVE_STATE,e.result,e.causeId,e.causeId):this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS.REMOVE_STATE,t,e.causeId,e.causeId)},t.prototype._updateIsHostless=function(e){var t=1===e;this.isHostless!==t&&(this._logger.info("_updateIsHostless: new value is ".concat(t)),this.isHostless=t,this.raiseChangedDeferredIfEnabled())},t.prototype._updateIsLocallyHeld=function(e){var t=1===e;this._isLocallyHeld!==t&&(this._logger.info("_updateIsLocallyHeld: new value is ".concat(t)),this._isLocallyHeld=t)},t.prototype._updateIsSharedLineAppearanceV2Activated=function(e){var t=1===e;this._isSharedLineAppearanceV2Activated!==t&&(this._logger.info("_updateIsSharedLineAppearanceV2Activated: new value is ".concat(t)),this._isSharedLineAppearanceV2Activated=t,this.event("sharedLineAppearanceV2ActivatedChanged").raise(this._isSharedLineAppearanceV2Activated))},t.prototype._onCallOptimalVideoCountChanged=function(e){this._logger.info("_onCallOptimalVideoCountChanged ".concat(e)),e!==this.optimalVideoCount&&(this.optimalVideoCount=e,this.raiseChangedDeferredIfEnabled())},t.prototype._onCallMaxIncomingVideoCountChanged=function(e){this._logger.info("_onCallMaxIncomingVideoCountChanged ".concat(e)),e!==this.maxIncomingVideoCount&&(this.maxIncomingVideoCount=e,this.raiseChangedDeferredIfEnabled())},t.prototype._onCallMaxIncomingVbssCountChanged=function(e){this._logger.info("_onCallMaxIncomingVbssCountChanged ".concat(e)),e!==this.maxIncomingVbssCount&&(this.maxIncomingVbssCount=e,this.raiseChangedDeferredIfEnabled())},t.prototype._onCallIdChanged=function(e){this._logger.info("_onCallIdChanged ".concat(e)),e!==this.callId&&(this._setCallId(e),this.event("callIdChanged").raise(this.callId),this.raiseChangedDeferredIfEnabled())},t.prototype._onMeetingDataChanged=function(e){if(this._logger.info("_onMeetingDataChanged ".concat(e)),e&&this._rawMeetingData!==e)try{this.meetingData=JSON.parse(e),this._rawMeetingData=e,this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse the raw meeting data. Error: ".concat(t,", MeetingData: ").concat(e))}},t.prototype._onMeetingInfoChanged=function(e){if(this._logger.info("_onMeetingInfoChanged ".concat(e)),e&&this._rawMeetingInfo!==e)try{this.meetingInfo=JSON.parse(e),this._rawMeetingInfo=e,this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse the raw meeting info. Error: ".concat(t,", MeetingInfo: ").concat(e))}},t.prototype._onMeetingGroupDetailsChanged=function(e){if(this._logger.info("_onMeetingGroupDetailsChanged current=".concat(this.meetingGroupDetails," new=").concat(e)),this._rawMeetingGroupDetails!==e)try{this.meetingGroupDetails=e?JSON.parse(e):void 0,this._rawMeetingGroupDetails=e,this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse the raw meeting group details. Error: ".concat(t,", MeetingGroupDetails: ").concat(e))}},t.prototype._onPublishedStatesChanged=function(e){if(this._logger.info("_onPublishedStatesChanged ".concat(e)),e&&this._rawPublishedStatesJsonString!==e)try{this._publishedStates=JSON.parse(e),this._rawPublishedStatesJsonString=e,this.event("publishedStatesChanged").raise(this._publishedStates),this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.info("[".concat(T.causeId,"]Failed to parse published states. Error: ").concat(t,", PublishedStates: ").concat(e))}},t.prototype._onParticipantCountsUpdated=function(e){if(this._logger.info("_onParticipantCountsUpdated ".concat(e?e.length:"undefined")),this._rawParticipantCountsJsonString!==e)try{d.isEmpty(e)?this._participantCounts=h.EMPTY_COUNTS:this._participantCounts=o(o({},h.EMPTY_COUNTS),JSON.parse(e)),this._rawParticipantCountsJsonString=e,this.event("participantCountsUpdated").raise(this._participantCounts)}catch(t){this._logger.info("[".concat(T.causeId,"]Failed to parse participant counts. Error: ").concat(t,", ParticipantCounts: ").concat(e))}},t.prototype._setCallId=function(e){this.callId=e,this._callTelemetry.setCallId(this.callId)},t.prototype._setParticipantId=function(e){this.participantId=e,this._callTelemetry.setParticipantId(this.participantId)},t.prototype._setConsultativeCallId=function(e){this.consultativeCallId=e,this._callTelemetry.setConsultativeCallId(this.consultativeCallId)},t.prototype._onCallTransferStatusChanged=function(e){var t=(0,f.generateCauseId)();this._logger.info("[".concat(t,"]onCallTransferStatusChanged status: ").concat(e," (").concat(SlimCore.Enums.CallStatus[e],")")),this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(e===SlimCore.Enums.CallStatus.Transferring?this._setTransferState(2,t):e===SlimCore.Enums.CallStatus.Transferred?this._setTransferState(3,t):e===SlimCore.Enums.CallStatus.Failed&&this._setTransferState(4,t))},t.prototype._onCallParkStatusChanged=function(e){var t=(0,f.generateCauseId)();this._logger.info("[".concat(t,"]_onCallParkStatusChanged status: ").concat(e," (").concat(SlimCore.Enums.CallStatus[e],")")),this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(e===SlimCore.Enums.CallStatus.Parking?this._setParkState(2,t):e===SlimCore.Enums.CallStatus.Parked?this._setParkState(3,t):e===SlimCore.Enums.CallStatus.Failed&&this._setParkState(4,t))},t.prototype.cancelOperationsWithPredicate=function(e,t,n){this._callOperationHandler.maybeRejectPendingOperationsWithPredicate(n,e,(function(e,n){return d.some(null==n?void 0:n.preconditionTags,(function(e){return e===t}))})),this._participantOperationHandler.maybeRejectPendingOperationsWithPredicate(n,e,(function(e,n){return d.some(null==n?void 0:n.preconditionTags,(function(e){return e===t}))}))},t.prototype._updateCallConnectedToMixer=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return this._isCallConnectedToMixer===e||(this._logger.createFnLogger("_updateCallConnectedToMixer",t).info("current _isCallConnectedToMixer=".concat(this._isCallConnectedToMixer,", new isCallConnectedToMixer=").concat(e,"}")),this._isCallConnectedToMixer=e),[2]}))}))},t.prototype._onCallEncryptionChanged=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:return this._isE2EE===e?[2]:(this._logger.createFnLogger("_onCallEncryptionChanged",t).info("current _isE2EE=".concat(this._isE2EE,", new isE2EE=").concat(e,"}")),this._isE2EE=e,this._isCallConnectedToMixer?(this.cancelOperationsWithPredicate(t,h.OPERATION_TAGS.NOT_SUPPORTED_IN_E2EE,76),[4,this._cleanDataChannelResources(t)]):[3,2]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.isSubscribedPendingStart=function(){return 8===this.state&&this._callOperationHandler.hasAtleastOneOfPendingOperation([h.CALL_OPERATIONS.START_CALL,h.CALL_OPERATIONS.JOIN_CALL,h.CALL_OPERATIONS.START_WITH_MEETING_DATA,h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA])},t.prototype._onCallModeChanged=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:if(!e)return[2];switch(n=this._logger.createFnLogger("onCallModeChanged",t),r=0,e){case SlimCore.Enums.CallMode.Initial:r=0;break;case SlimCore.Enums.CallMode.RealTime:r=1;break;case SlimCore.Enums.CallMode.Stream:r=2;break;default:return n.info("unexpected mode found"),[2]}return n.info("slimcore new call mode=".concat(e,", mapped slimcore mode to=(").concat(SlimCore.Enums.CallMode[e],")")),n.info("old call mode=".concat(this._mode,", new call mode =").concat(r)),this._mode===r?[3,3]:(this._mode=r,this._monitorCallStart(),2!==this._mode?[3,2]:(this.cancelOperationsWithPredicate(t,h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE,74),this._dataChannelCreatedPromise=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED,void 0,(0,f.generateCauseId)(),{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE,h.OPERATION_TAGS.NOT_SUPPORTED_IN_E2EE]}),this._dataChannelCreatedPromise.catch(v.noop),[4,this._cleanRealTimeCallResources(t)]));case 1:i.sent(),i.label=2;case 2:this.raiseChangedDeferredIfEnabled(),i.label=3;case 3:return[2]}}))}))},t.prototype._onCallStatusChanged=function(e,n){var r=this;void 0===n&&(n=(0,f.generateCauseId)());var i=this._logger.createFnLogger("onCallStatusChanged",n);i.info("new status=".concat(e,", mapped to=(").concat(SlimCore.Enums.CallStatus[e],")"));var o=this._getProperties(this.slimcoreCallId,{updateCallLegIdChanged:{propKey:SlimCore.Enums.Property.CallLegId}},{}).updateCallLegIdChanged;if(this._updateCallLegIdChanged(o),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SIGNALING_STATE_CHANGED,{status:e,statusToEnum:SlimCore.Enums.CallStatus[e]},n),t.isCallConnecting(e))this._setCallState(2,n);else if(t.isCallPreheating(e))i.info("status=Preheating"),this._setCallState(11,n);else if(t.isCallEarlyMedia(e))i.info("status=EarlyMedia"),this._setCallState(9,n);else if(t.isCallRinging(e)){i.info("status=Ringing"),this.participants.forEach((function(e){e.setState(2,n)}));var a=this._getProperties(this.slimcoreCallId,{},{callType:{propKey:SlimCore.Enums.Property.CallIsConference}}).callType;this._updateCallType(a,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],void 0,void 0,n)}else if(t.isCallInLobby(e)){this._callIsSetupComplete=!0,i.info("status=InLobby"),this._setCallState(10,n);var s=this._getProperties(this.slimcoreCallId,{},{isConference:{propKey:SlimCore.Enums.Property.CallIsConference}}).isConference;this._updateCallType(s,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD,h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL],void 0,void 0,n),this._reportTsCallingTelemetry(!0)}else if(t.isCallPreheated(e)){i.info("status=Preheated"),this._setCallState(12,n);var c=this._getProperties(this.slimcoreCallId,{endpointDetails:{propKey:SlimCore.Enums.Property.CallEndpointDetails}},{isHostless:{propKey:SlimCore.Enums.Property.CallIsHostless},isConference:{propKey:SlimCore.Enums.Property.CallIsConference}});this._updateIsHostless(c.isHostless),this._updateCallType(c.isConference,n),this._updateEndpointDetails(c.endpointDetails),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,n)}else if(t.isCallStaging(e)){this._callIsSetupComplete=!0,i.info("status=Staging"),this._setCallState(13,n);c=this._getProperties(this.slimcoreCallId,{endpointDetails:{propKey:SlimCore.Enums.Property.CallEndpointDetails}},{isHostless:{propKey:SlimCore.Enums.Property.CallIsHostless},isConference:{propKey:SlimCore.Enums.Property.CallIsConference},isMuted:{propKey:SlimCore.Enums.Property.CallIsMuted}});this._updateIsHostless(c.isHostless),this._updateCallType(c.isConference,n),this._updateEndpointDetails(c.endpointDetails),this._onCallMutedUnmuted(!!c.isMuted,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD,h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL],void 0,void 0,n),this._reportTsCallingTelemetry(!0)}else if(t.isCallNegotiatingEncryption(e))i.info("status=NegotiatingEncryption"),this._setCallState(14,n);else if(t.isCallNegotiatingEncryptionLobby(e)){this._callIsSetupComplete=!0,i.info("status=NegotiatingEncryptionLobby"),this._setCallState(15,n);s=this._getProperties(this.slimcoreCallId,{},{isConference:{propKey:SlimCore.Enums.Property.CallIsConference}}).isConference;this._updateCallType(s,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD,h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL],void 0,void 0,n),this._reportTsCallingTelemetry(!0)}else if(t.isCallConnected(e)){this._callIsSetupComplete=!0,i.info("status=Connected"),this._setCallState(3,n);c=this._getProperties(this.slimcoreCallId,{endpointDetails:{propKey:SlimCore.Enums.Property.CallEndpointDetails}},{isHostless:{propKey:SlimCore.Enums.Property.CallIsHostless},isConference:{propKey:SlimCore.Enums.Property.CallIsConference},isMuted:{propKey:SlimCore.Enums.Property.CallIsMuted}});this._updateIsHostless(c.isHostless),this._updateCallType(c.isConference,n),this._updateEndpointDetails(c.endpointDetails),this._onCallMutedUnmuted(!!c.isMuted,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD,h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL],void 0,void 0,n),this._reportTsCallingTelemetry(!0)}else if(t.isObserving(e)){var l=this._getProperties(this.slimcoreCallId,{endpointDetails:{propKey:SlimCore.Enums.Property.CallEndpointDetails}},{}).endpointDetails;this._updateEndpointDetails(l),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],void 0,void 0,n)}else if(e===SlimCore.Enums.CallStatus.LocalHold)i.info("status=LocalHold"),this._setCallState(4,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD],void 0,void 0,n);else if(e===SlimCore.Enums.CallStatus.RemoteHold)i.info("status=RemoteHold"),this._setCallState(5,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD],void 0,void 0,n);else if(t.isCallTerminated(e)){var u=t.convertStatusToTerminatedReason(e),d=u;i.info("status=Terminated, reason=".concat(u));var p=this._getProperties(this.slimcoreCallId,{diagnosticsCode:{propKey:SlimCore.Enums.Property.CallEndDiagnosticsCode}},{slimcoreCallFailureReason:{propKey:SlimCore.Enums.Property.CallFailureReason},slimcoreCallType:{propKey:SlimCore.Enums.Property.CallIsConference}}),g=p.slimcoreCallFailureReason,m=p.diagnosticsCode,_=p.slimcoreCallType,y=this._getFirstParticipantFailureReason(i);if(e!==SlimCore.Enums.CallStatus.Failed&&e!==SlimCore.Enums.CallStatus.Dropped&&g!==SlimCore.Enums.ParticipantFailureReason.CallNotFound||(d=this._getTerminatedReason(g,u)),this.isSubscribedPendingStart())return this.slimcoreCallId=0,this._callOperationHandler.maybeRejectOperations([h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],d,void 0,n),void i.info("Subscribe failed, there is pending start/join operation, ignore call end message");if((2===this.state||6===this.state||8===this.state)&&this._callOperationHandler.hasAtleastOneOfPendingOperation([h.CALL_OPERATIONS.START_CALL,h.CALL_OPERATIONS.JOIN_CALL,h.CALL_OPERATIONS.START_WITH_MEETING_DATA,h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA])){var v=JSON.parse(m),S={code:v.callControllerCode,subCode:v.callControllerSubCode,phrase:v.phrase,reason:d};this._callOperationHandler.maybeRejectOperations([h.CALL_OPERATIONS.ACCEPT,h.CALL_OPERATIONS.JOIN_CALL,h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,h.CALL_OPERATIONS.START_CALL,h.CALL_OPERATIONS.START_CALL_AND_UNPARK,h.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h.CALL_OPERATIONS.START_WITH_MEETING_DATA,h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],d,void 0,n,S)}this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.CALL_TERMINATION_INFO,{terminatedReasonFromStatus:u,slimcoreCallFailureReason:g,firstParticipantFailureReason:y,finalReason:d,slimcoreCallType:_},n),i.info("status=Terminated, statusToReason=".concat(u,", slimcoreCallFailureReason=").concat(g,", finalReason=").concat(d));c=this._getProperties(this.slimcoreCallId,{acceptedElsewherebyId:{propKey:SlimCore.Enums.Property.CallAcceptedElsewhereByMriIdentity},acceptedElsewherebyDisplayName:{propKey:SlimCore.Enums.Property.CallAcceptedElsewhereByDisplayName}},{});this.acceptedElsewhereBy={id:c.acceptedElsewherebyId,displayName:c.acceptedElsewherebyDisplayName},this._setCallState(7,n,d,m),this.participants.forEach((function(e){e.setState(4,n,M.convertFailureReasonToParticipantReason(g))})),this._updateDominantSpeakerList(),this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,d,void 0,n),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.CALL_ENDED,d,void 0,n),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.CALL_REDIRECT,d,n,n),this.disconnectingPromise=this.cleanUp(n).catch((function(e){i.logFailure("Error when cleaning up the call, callId = ".concat(r.callId,", error = ").concat(e))}))}this.raiseChangedDeferredIfEnabled()},t.prototype._reportTsCallingTelemetry=function(e){var t;return l(this,void 0,void 0,(function(){var n,r=this;return u(this,(function(i){switch(i.label){case 0:return e&&this.setupTelemetryReported||!e&&this.inCallTelemetryReported?[2]:(this._logger.info("[_reportTsCallingTelemetry] connectCallPromise await started"),[4,this.connectCallPromise.catch((function(e){r._logger.info("[_reportTsCallingTelemetry] connectCallPromise error: ".concat(e))}))]);case 1:return i.sent(),this._logger.info("[_reportTsCallingTelemetry] connectCallPromise await ended"),n=e?h.TELEMETRY_EVENT_NAMES.CALL_SETUP_NATIVE:h.TELEMETRY_EVENT_NAMES.CALL_IN_CALL_NATIVE,this._callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),(null===(t=this._telemetryLoggers)||void 0===t?void 0:t.signaling)&&this._telemetryLoggers.signaling.sendEvent({eventName:n,props:this._callTelemetry.getEvent(e)}),e?(this.setupTelemetryReported=!0,this._callTelemetry.switchToInCallTelemetry()):this.inCallTelemetryReported=!0,[2]}}))}))},t.prototype._getTerminatedReason=function(e,n){if(this._isRelayWhiteListingIssue)return 53;if(!d.isUndefined(e)&&e!==SlimCore.Enums.ParticipantFailureReason.NoFailure)return t.convertParticipantReasonToTerminatedReason(M.convertFailureReasonToParticipantReason(e));if(this.participants.length){var r=this._getProperties(d.head(this.participants).slimcoreObjectId,{},{firstParticipantFailureReason:{propKey:SlimCore.Enums.Property.ParticipantFailureReason}}).firstParticipantFailureReason;return t.convertParticipantReasonToTerminatedReason(M.convertFailureReasonToParticipantReason(r))}return n||0},t.prototype._addParticipantToCall=function(e,t){e.setState(1,t),this._logger.info("[".concat(t,"]starting adding participant to call, participantId = ").concat(O.scrubMriOrOmit(e.id)))},t.prototype._joinOrStartCall=function(e,t,n){return l(this,void 0,void 0,(function(){var r,i,a,s,c;return u(this,(function(l){switch(l.label){case 0:if(r=this._logger.createFnLogger("joinOrStartCall",n),0!==this.state&&8!==this.state)throw new Error("Trying to start a call that has already been acted on");this._updateCallPropertyBasedOnConversationType(t.conversationType),this.label=t.label,this.raiseChangedDeferredIfEnabled(),1&~t.muteFlags||(r.info("isMuted set to true in _joinOrStartCall, causeId=".concat(n)),this.setMuteAndTriggerEvent(!0,n)),2&~t.muteFlags||(r.info("isSpeakerMuted set to true in _joinOrStartCall"),this.isSpeakerMuted=!0),t.isExistingCallInObservingState=8===this.state,1&~t.preheatFlags?(r.info("Call set to connecting in _joinOrStartCall"),this._setCallState(2,n)):(r.info("Call set to preheating in _joinOrStartCall"),this._setCallState(11,n)),i=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,n),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this._joinOrStartSlimCoreCall(e,t,n)];case 2:return l.sent(),[3,4];case 3:throw a=l.sent(),r.logFailure("sync failure, cleaning up slimcore ready operation: error=".concat((0,C.getPrintableObject)(a))),this._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:(0,C.getPIISafeObject)(a)},n),this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),s=(0,C.getPrintableObject)(a),c={terminatedReason:7,terminatedReasonCode:m.CONSTANTS.CODE.CLIENT_ERROR_CODE,terminatedReasonSubCode:m.CONSTANTS.SUB_CODE.SLIMCORE_CALL_SETUP_FAILURE,errorMessage:s},this.stopInternal(o(o({},c),{causeId:n})).catch((function(){})),a;case 4:return 4!==t.videoDirection?[3,6]:(r.info("Call has been started; turning on video"),[4,this.startVideoSafe(n)]);case 5:l.sent(),l.label=6;case 6:return[2,i]}}))}))},t.prototype._muteUnmute=function(e,t){var n,r=this,i=this._logger.createFnLogger("muteUnmute",t);return i.info("muteUnmute, value = ".concat(e," isMuted = ").concat(this.isMuted," isServerMuted = ").concat(this.isServerMuted)),b.callStateIsAnyOf(this.state,[11,12])?(i.logFailure("Can not mute/unmute during preheat call"),Promise.reject((0,y.getRejectTransactionEnd)(h.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))):(n=e?this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.MUTE):this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UNMUTE),Promise.resolve().then((function(){r._slimcoreCallHandler.callMute(r.slimcoreCallId,e,t)})).then((function(){return n})).catch((function(e){throw i.logFailure(e),(0,y.getRejectTransactionEnd)(e)})))},t.prototype._muteUnmuteSpeaker=function(e,t){var n,r=this,i=this._logger.createFnLogger("muteUnmuteSpeaker",t);return i.info("muteUnmuteSpeaker, value = ".concat(e," isSpeakerMuted = ").concat(this.isSpeakerMuted)),n=e?this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.MUTE_SPEAKER):this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UNMUTE_SPEAKER),Promise.resolve().then((function(){r._slimcoreCallHandler.callMuteSpeaker(r.slimcoreCallId,e)})).then((function(){return n})).then((function(){r._setMutedSpeaker(e,t)})).catch((function(e){throw i.logFailure(e),e}))},t.prototype._muteParticipants=function(e,n,r){var i=this,o=t.convertMuteScope(e),a=this._logger.createFnLogger("muteParticipants",r);if(void 0===o)return a.logFailure("Unrecognized ".concat(e)),Promise.reject(new Error("Unrecognized muteScope"));if(b.callStateIsAnyOf(this.state,[11,12]))return a.logFailure("Can not mute/unmute during preheat call"),Promise.reject(60);var s=[];n.forEach((function(e){s.push(e.id)}));var c=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,"",r);return Promise.resolve().then((function(){return i._slimcoreCallHandler.callMuteParticipants(i.slimcoreCallId,o,s,r),A.hasFeature(SlimCore.Enums.Feature.AttendeeBlackList)?c:i._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,null,r,r).then()})).catch((function(e){throw a.logFailure("mute participants failed with ".concat(e)),e}))},t.prototype._holdUnhold=function(e,t,n,r,i){return l(this,void 0,void 0,(function(){var o,a,s,c;return u(this,(function(l){switch(l.label){case 0:if(o=4===this.state,(a=this._logger.createFnLogger("holdUnhold",t)).info("_holdUnhold, value: ".concat(e," currentState: ").concat(o)),o===e)return[2,Promise.resolve()];s=!(!r||!r.isLocal),l.label=1;case 1:return l.trys.push([1,6,,7]),this._slimcoreCallHandler.callHold(this.slimcoreCallId,e,n,t,s,this.mapClientScenario(i)),e?[4,this._callOperationHandler.waitForOperation(s?h.CALL_OPERATIONS.LOCAL_HOLD:h.CALL_OPERATIONS.HOLD)]:[3,3];case 2:return l.sent(),[3,5];case 3:return[4,this._callOperationHandler.waitForOperation(this._isLocallyHeld?h.CALL_OPERATIONS.LOCAL_UNHOLD:h.CALL_OPERATIONS.UNHOLD)];case 4:l.sent(),l.label=5;case 5:return[3,7];case 6:throw c=l.sent(),a.logFailure(c),c;case 7:return[2]}}))}))},t.prototype._updateEndpointMetadata=function(e,t){return l(this,void 0,void 0,(function(){var e,n;return u(this,(function(r){switch(r.label){case 0:e=this._logger.createFnLogger("updateEndpointMetadata",t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._slimcoreCallHandler.callUpdateEndpointMetadata(this.slimcoreCallId,this._endpointMetadata)];case 2:return[2,r.sent()];case 3:throw n=r.sent(),e.logFailure(n),n;case 4:return[2]}}))}))},t.prototype._sendDtmfTone=function(e,n){var r=this,i=this._logger.createFnLogger("sendDtmfTone",n);return Promise.resolve().then((function(){var n=t.convertToSlimCoreDtmfTone(e);if(void 0===n)throw i.logFailure("Unrecognized dtmfTone"),new Error("Unrecognized dtmfTone");try{r._slimcoreCallHandler.callSendDtmf(r.slimcoreCallId,n)}catch(e){throw i.logFailure(e),e}}))},t.prototype.setMaxVideoChannels=function(e,t,n){return l(this,void 0,void 0,(function(){var r,i,o;return u(this,(function(a){switch(a.label){case 0:(r=this._logger.createFnLogger("setMaxVideoChannels",n)).info("setMaxVideoChannels: ".concat(e," operationId: ").concat(n)),a.label=1;case 1:return a.trys.push([1,3,,4]),i=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS,n,n),[4,this._slimcoreCallHandler.callSetMaxVideoChannels(this.slimcoreCallId,e,t,n)];case 2:return a.sent(),[2,i];case 3:throw o=a.sent(),r.logFailure(o),o;case 4:return[2]}}))}))},t.prototype.setMaxVbssChannels=function(e,t,n){return l(this,void 0,void 0,(function(){var r,i,o;return u(this,(function(a){switch(a.label){case 0:(r=this._logger.createFnLogger("setMaxVbssChannels",n)).info("setMaxVbssChannels: ".concat(e," operationId: ").concat(n)),a.label=1;case 1:return a.trys.push([1,3,,4]),i=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.SET_MAX_VBSS_CHANNELS,n,n),[4,this._slimcoreCallHandler.callSetMaxVbssChannels(this.slimcoreCallId,e,t,n)];case 2:return a.sent(),this.maxVbssChannels=e,[2,i];case 3:throw o=a.sent(),r.logFailure(o),o;case 4:return[2]}}))}))},t.prototype.pushParticipantIdIfMsiMatched=function(e,t,n,r,i){var o=!1;if(e.mappedTo)for(var a=0,s=e.mediaStreams;a<s.length;a++){s[a].sourceId===t&&(this._logger.info("mapVirtualParticipantMsisToParticipantId: msi=".concat(t," -> participantId=").concat(n," (endpoint ref: ").concat(e.participantId,", isSelfParticipant: ").concat(r,")")),i.push(n),o=!0)}return o},t.prototype.mapVirtualParticipantMsisToParticipantId=function(e){for(var t=[],n=0,r=e;n<r.length;n++){for(var i=r[n],o=!1,a=0,s=this.participants;a<s.length;a++){var c=s[a];if(c.endpoints)for(var l=0,u=c.endpoints.endpointDetails;l<u.length;l++){var d=u[l];o=this.pushParticipantIdIfMsiMatched(d,i,c.id,!1,t)||o}}if(!o&&this.endpoints&&this._enableVirtualParticipantMsiMappingForSelf)for(var p=(0,E.generateAliasedMri)("".concat(E.MRI_SKYPE_PREFIX).concat(this.currentUserSkypeIdentity.id),""),h=0,g=this.endpoints.endpointDetails;h<g.length;h++){d=g[h];o=this.pushParticipantIdIfMsiMatched(d,i,p,!0,t)||o}o||(this._logger.info("mapVirtualParticipantMsisToParticipantId: could not find virtual participant for msi=".concat(i)),t.push(void 0))}return t},t.prototype.tryResolveMsisDeferred=function(){var e=this;this._tryResolveMsisDeferRunner((function(){return e.tryResolveMsis()}))},t.prototype.tryResolveMsis=function(){this._logger.info("tryResolveMsis()");var e=d.filter(Array.from(this.mapOfUnresolvedVirtualParticipantMSIs.values()),(function(e){return e.msi!==j.SOURCE_NONE})),t=e.map((function(e){return e.msi}));this.mapVirtualParticipantMsisToParticipantId(t).forEach((function(t,n){t&&e[n].notify(t)}))},t.prototype._setAudioUsageMode=function(e,n){return l(this,void 0,void 0,(function(){var r,i,o;return u(this,(function(a){switch(a.label){case 0:r=this._logger.createFnLogger("setAudioUsageMode",n),a.label=1;case 1:if(a.trys.push([1,3,,4]),void 0===(i=t.convertToSlimCoreAudioUsageMode(e)))throw new Error("Unrecognized audioUsageMode");return[4,this._slimcoreCallHandler.callSetAudioUsageMode(this.slimcoreCallId,i)];case 2:return[2,a.sent()];case 3:throw o=a.sent(),r.logFailure(o),o;case 4:return[2]}}))}))},t.prototype._setAudioMidcallConfig=function(e,n,r){return l(this,void 0,void 0,(function(){var i,o,a;return u(this,(function(s){switch(s.label){case 0:(i=this._logger.createFnLogger("setAudioMidcallConfig",r)).info("audioConfig: ".concat(e," mode: ").concat(n)),s.label=1;case 1:if(s.trys.push([1,3,,4]),void 0===(o=t.convertToSlimCoreAudioMidcallConfig(e)))throw new Error("Unrecognized audioConfig");return[4,this._slimcoreCallHandler.callSetAudioMidcallConfig(this.slimcoreCallId,o,n)];case 2:return[2,s.sent()];case 3:throw a=s.sent(),i.logFailure(a),a;case 4:return[2]}}))}))},t.prototype._setAudioMidcallConfigJson=function(e,t){return l(this,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:(n=this._logger.createFnLogger("setAudioMidcallConfigJson",t)).info("audioConfigJson: ".concat(e," ").concat(JSON.stringify(e))),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._slimcoreCallHandler.callSetAudioMidcallConfigJson(this.slimcoreCallId,JSON.stringify(e))];case 2:return[2,i.sent()];case 3:throw r=i.sent(),n.logFailure(r),r;case 4:return[2]}}))}))},t.prototype._setParticipantSpatialAudioPositions=function(e,t){return l(this,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:(n=this._logger.createFnLogger("setParticipantSpatialAudioPositions",t)).info("callId: ".concat(this.callId," audioConfigJson: ").concat(e," ").concat(JSON.stringify(e))),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._slimcoreCallHandler.setParticipantSpatialAudioPositions(this.slimcoreCallId,JSON.stringify(e))];case 2:return[2,i.sent()];case 3:throw r=i.sent(),n.logFailure(r),r;case 4:return[2]}}))}))},t.prototype._getParticipant=function(e){return this.participantMap.hasOwnProperty(e)?this.participantMap[e]:void 0},t.prototype._getOrCreateParticipant=function(e,t,n,r){var i=this;if(void 0===r&&(r=!0),this.participantMap.hasOwnProperty(e)){var o=this.participantMap[e];return n&&o.attachSlimcoreObjectId(n,t,!1),o}var a=new w.default(t,this._logger,this._settings,this._slimcoreInstance,e,this._slimcoreCallHandler,this._streamContextMap,n,this._callTelemetry,this.createVirtualParticipantMSIToParticipantIdMapper,this._eventBus);return a.disableActiveSpeakerLogging=this._disableActiveSpeakerLogging,a.changed((function(){i._participantChangedCallback(a)})),this._addParticipantEntry(a),this._monitorCallStart(),r&&(this.event("participantAdded").raise(a),this._removeCallChangeOnParticipantChanges||this.raiseChangedDeferred(this._participantChangedEventSkipConfig)),a},t.prototype._participantChangedCallback=function(e){var t;e.previousId&&(this._callOperationHandler.updateOperationId(e.previousId,e.id),this._participantOperationHandler.updateOperationId(e.previousId,e.id),e.previousId=null);var n=this._getlocalScreenShareStream(),r=e.streams[1].slice(-1)[0];r&&(0===this.maxVbssChannels&&n&&!this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.START_SCREEN_SHARING)&&r.isAvailable&&(A.forgetAndLog(this.stopScreenSharing(!0),this._logger,"ParticipantChanged: Cleaning up local screenshare because remote screenshare is running"),this.event("sharingStolen").raise()),(null===(t=this.screenSharingControl)||void 0===t?void 0:t.isScreenSharingControlEnabled())&&(this.screenSharingControl.reportSharingSessionChangeForViewer(e,r.negotiationTag),r.isActive()&&this.localEndpointDetails&&"nonInteractive"!==this.localEndpointDetails.appliedInteractivityLevel?this.screenSharingControl.initControlForViewer(e,r.negotiationTag):this.screenSharingControl.shutdownControlForViewer(e))),this._enableVirtualParticipantMsiMapping&&e.endpoints&&e.endpoints.endpointDetails&&e.endpoints.endpointDetails.some((function(e){return!!e.mappedTo}))&&this.tryResolveMsisDeferred(),4===e.state&&this._participantOperationHandler.maybeRejectOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e.stateReason||0,e.id),this._updateDominantSpeakerListDeferred(),this.event("participantUpdated").raise(e),this._removeCallChangeOnParticipantChanges||this.raiseChangedDeferred(this._participantChangedEventSkipConfig)},t.prototype._setCallState=function(e,n,r,i){var o,a=this;if(this.state!==e){var s=this._logger.createFnLogger("setCallState",n);if(b.validStateTransitions[this.state].indexOf(e)>=0){if(s.info("currentState=".concat(this.state,", newState=").concat(e,", terminatedReason=").concat(this.terminatedReason)),this.state=e,this._onDiagnosticsCodeChanged(i),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,{state:e,reason:r},n),3===e)this._callGotConnected=!0,this.callHeldAt=null,this._resumeLocalRecordingAfterCallResumesFromHold&&(this._localRecordingPromiseOnHold=this._startLocalRecording(n).then((function(){}),(function(){})));else if(5===e||4===e)this.callHeldAt||(this.callHeldAt=new Date),this._isLocalRecordingRunning&&(this._localRecordingPromiseOnHold=this._stopLocalRecording(n).then((function(){a._resumeLocalRecordingAfterCallResumesFromHold=!0}),(function(){})));else if(7===e){this.terminatedReason=r,this._setFailureType(t.convertTerminatedReasonToFailureType(r,this._callGotConnected,this._wasAudioStreamConnected));var c={};this.callEndDiagnosticsInfo&&(c.code=this.callEndDiagnosticsInfo.callControllerCode,c.subCode=this.callEndDiagnosticsInfo.callControllerSubCode,c.phrase=this.callEndDiagnosticsInfo.phrase,c.resultCategories=this.callEndDiagnosticsInfo.resultCategories),this._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,{transactionEnd:c},n)}(null===(o=this.screenSharingControl)||void 0===o?void 0:o.isScreenSharingControlEnabled())&&this.screenSharingControl.callStateChanged(this.state),this.ptzHandler&&this.ptzHandler.callStateChanged(this.state),s.logSuccess("changed to ".concat(e,", terminatedReason: ").concat(this.terminatedReason,", failureType=").concat(this.failureType)),this._startInitialVideoIfReady(n),this._monitorCallStart(),this.event("callStateChanged").raise(),this._updateCapabilities(n),this.raiseChanged(),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.RAISE_CALL_STATE_CHANGE_EVENT,{state:e,reason:r},n)}else this._logger.warn("invalid state transition currentState=".concat(this.state,", newState=").concat(e,", terminatedReason=").concat(this.terminatedReason))}},t.prototype._setVideoOn=function(e,t){this.isVideoOn!==e&&(this.isVideoOn=e,this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_LOCAL_VIDEO,{value:e},t),this.raiseChangedDeferredIfEnabled())},t.prototype._setScreenSharingOn=function(e,t){this.isScreenSharingOn!==e&&(this.isScreenSharingOn=e,this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_SCREEN_SHARING,{value:e},t),this.raiseChangedDeferredIfEnabled()),this.event("userActivityChanged").raise()},t.prototype._setMutedSpeaker=function(e,t){this.isSpeakerMuted!==e&&(this.isSpeakerMuted=e,this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_MUTED_SPEAKER,{value:e},t),this.raiseChangedDeferredIfEnabled())},t.prototype._monitorCallStart=function(){this.callStartedAt||3!==this.state||!this.participants.length&&2!==this.callMode||(this.callStartedAt=new Date)},t.prototype._addParticipantEntry=function(e){this.participantMap[e.id]=e,this.participants.push(e)},t.prototype._removeParticipantEntry=function(e){if(!this.participantMap.hasOwnProperty(e))return null;var t=this.participantMap[e];return delete this.participantMap[e],d.pull(this.participants,t),t&&this.raiseChanged(this._participantChangedEventSkipConfig),t},t.prototype._onGroupIdChanged=function(e){e&&this.groupId!==e&&(this._logger.info("_onGroupIdChanged groupId: ".concat(O.scrubMriOrOmit(e)," this.groupId: ").concat(O.scrubMriOrOmit(this.groupId))),this.groupId=e,this.event("groupIdChanged").raise(e))},t.prototype._onThreadIdChanged=function(e){e&&this.threadId!==e&&(this._logger.info("_onThreadIdChanged threadId: ".concat(O.getLoggableThreadId(e)," this.threadId: ").concat(O.getLoggableThreadId(this.threadId))),this.threadId=e,this.raiseChangedDeferredIfEnabled())},t.prototype._onMessageIdChanged=function(e){e&&this.messageId!==e&&(this._logger.info("_onMessageIdChanged messageId: ".concat(e," this.messageId: ").concat(this.messageId)),this.messageId=e,this.raiseChangedDeferredIfEnabled())},t.prototype._onBackroomThreadIdChanged=function(e){this.backroomThreadId!==e&&(this._logger.info("_onBackroomThreadIdChanged backroomThreadId: ".concat(O.getLoggableThreadId(e)," this.backroomThreadId: ").concat(O.getLoggableThreadId(this.backroomThreadId))),this.backroomThreadId=e,this.raiseChangedDeferredIfEnabled())},t.prototype._onSelfParticipantRoleChanged=function(e){e!==this.role&&(this._logger.info("Role for self is set to ".concat(e)),this.role=e,this.raiseChangedDeferredIfEnabled())},t.prototype._updateMeetingRole=function(e){e!==this.meetingRole&&(this.meetingRole=e,this._logger.info("_updateMeetingRole: ".concat(this.meetingRole)),this.event("meetingRoleUpdated").raise(this.meetingRole),this.raiseChangedDeferredIfEnabled())},t.prototype._updateAdvancedMeetingRole=function(e){e!==this.advancedMeetingRole&&(this.advancedMeetingRole=e,this._logger.info("_updateAdvancedMeetingRole: ".concat(this.advancedMeetingRole)),this.event("advancedMeetingRoleUpdated").raise(this.advancedMeetingRole),this.raiseChangedDeferredIfEnabled())},t.prototype._updateParticipantType=function(e){e!==this.participantType&&(this.participantType=e,this._logger.info("_updateParticipantType: ".concat(this.participantType)),this.event("participantTypeUpdated").raise(this.participantType),this.raiseChangedDeferredIfEnabled())},t.prototype._updatePropertyBag=function(e){try{if(e){var t=JSON.parse(e);d.isEqual(t,this.propertyBag)||(this.propertyBag=t,this._logger.info("_updatePropertyBag: ".concat(e.length)),this.event("propertyBagUpdated").raise(this.propertyBag),this.raiseChangedDeferredIfEnabled())}}catch(e){this._logger.info("Failed to parse propertyBagJson. Error: ".concat(e))}},t.prototype._updateMaskedIdentityDetails=function(e){try{if(e){var t=JSON.parse(e);d.isEqual(this.maskedIdentityDetails,t)||(this.maskedIdentityDetails=t,this._logger.info("_updateMaskedIdentityDetails: ".concat(e)),this.event("maskedIdentityDetailsUpdated").raise(this.maskedIdentityDetails),this.raiseChangedDeferredIfEnabled())}}catch(e){this._logger.info("Failed to parse maskedIdentityDetailsJson. Error: ".concat(e))}},t.prototype._updateRosterVersion=function(e){e!==this.version&&(this.version=e,this._logger.info("_updateRosterVersion: ".concat(e)),this.event("propertyRosterVersionUpdated").raise(this.version),this.raiseChangedDeferredIfEnabled())},t.prototype._updateTransferorMri=function(e){var t=(0,E.stripMriAliases)(e);t!==this.transferorMri&&(this.transferorMri=t,this._logger.info("_transferorMri: ".concat(O.scrubMriOrOmit(this.transferorMri))),this.raiseChangedDeferredIfEnabled())},t.prototype._updateGroupKeyManagerMri=function(e){var t=(0,E.stripMriAliases)(e);t!==this.groupKeyManagerMri&&(this.groupKeyManagerMri=t,this._logger.info("_groupKeyManagerMri: ".concat(O.scrubMriOrOmit(this.groupKeyManagerMri))),this.raiseChangedDeferredIfEnabled())},t.prototype._updateClientTransferContext=function(e){try{e&&(this.clientTransferContext=JSON.parse(e),this._logger.info("_updateClientTransferContext updated:\n                    clientTransferContext = ".concat(e)),this.raiseChangedDeferredIfEnabled())}catch(t){this._logger.info("Failed to parse clientTransferContext. Error: ".concat(t,",\n                clientTransferContext json string = ").concat(e))}},t.prototype._updateActiveVideoChannelCount=function(e){e!==this.activeVideoChannelCount&&(this._logger.info("_updateActiveVideoChannelCount to ".concat(e)),this.activeVideoChannelCount=e,this.raiseChangedDeferredIfEnabled())},t.prototype._onSelfParticipantTenantIdChanged=function(e){e!==this.tenantId&&(this._logger.info("TenantId for self is set to ".concat(e)),this.tenantId=e,this.raiseChangedDeferredIfEnabled())},t.prototype._updateEndpointDetails=function(e){var t=this,n=(0,f.generateCauseId)();if(this._logger.info("[".concat(n,"] [_updateEndpointDetails] rawEndpointDetails ").concat(e)),this._rawEndpoints!==e&&e){try{this.endpoints=JSON.parse(e),this._rawEndpoints=e,this.endpoints.endpointDetails.forEach((function(e){e.endpointId===t._endpointId&&t._updateLocalEndpointDetails(e),e.originalId&&t._participantOperationHandler.maybeResolveOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,null,e.originalId,n)}))}catch(t){this._logger.info("[".concat(n,"]Failed to parse raw endpoint details. Error: ").concat(t,", EndpointDetails: ").concat(e))}this._updateCapabilities(n),this.raiseChangedDeferredIfEnabled()}},t.prototype._updateLocalEndpointDetails=function(e){var t=this.localEndpointDetails;if(this.localEndpointDetails=e,e&&(!t||t.appliedInteractivityLevel!==e.appliedInteractivityLevel))for(var n=0,r=this.participants;n<r.length;n++){var i=r[n],o=i.streams[1];o&&o.length&&this._participantChangedCallback(i)}},t.prototype._updateComplianceRecordingContent=function(e){if(this._rawComplianceRecordingContent!==e)try{!e||d.isEmpty(e)?this.complianceRecordingContent=void 0===e?void 0:null:this.complianceRecordingContent=JSON.parse(e),this._rawComplianceRecordingContent=e,this._logger.info("_updateComplianceRecordingContent length: ".concat(e?e.length:"undefined")),this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse the compliance recording content. Error: ".concat(t,", \n            ComplianceRecordingContent length: ").concat(e?e.length:"undefined"))}},t.prototype._updateMeetingDetails=function(e){if(this._rawMeetingDetails!==e)try{!e||d.isEmpty(e)?this.meetingDetails=null:this.meetingDetails=JSON.parse(e),this._rawMeetingDetails=e,this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse the raw meeting details. Error: ".concat(t,", MeetingDetails: ").concat(e))}},t.prototype._onMeetingStatesChanged=function(e){if(this._logger.info("[_onMeetingStatesChanged] current rawMeetingStates: ".concat(this._rawMeetingStates,", new rawEndpointDetails: ").concat(e)),this._rawMeetingStates!==e)try{!e||d.isEmpty(e)?this.meetingStates=null:this.meetingStates=JSON.parse(e),this._rawMeetingStates=e,this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse the raw meeting states. Error: ".concat(t,", MeetingStates: ").concat(e))}},t.prototype._onBreakoutDetailsUpdated=function(e){this._logger.info("_onBreakoutDetailsUpdated: breakoutDetailsJsonString=".concat(e));try{!e||d.isEmpty(e)?this.breakoutDetails=null:this.breakoutDetails=JSON.parse(e),this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse breakoutDetailsJsonString=".concat(e))}},t.prototype._onBroadcastMetadataChanged=function(e){if(e)try{this.broadcastMetadata=JSON.parse(e),this._logger.info("broadcast metadata updated"),this.broadcastMeeting&&this.broadcastMeeting.metadataChanged(e),this.raiseChangedDeferredIfEnabled()}catch(e){this._logger.info("broadcast metadata invalid, failed to parse")}},t.prototype._onCallProgressStatusChanged=function(e){e!==this._callProgressStatus&&(this._callProgressStatus=e,this.callProgressStatus=e,this.event("callProgressStatusChanged").raise(e))},t.prototype._getParticipantByObjectId=function(e){return d.find(this.participants,(function(t){return t.slimcoreObjectId===e}))},t.prototype._onQualityChanged=function(e){if(this._logger.info("onQualityChanged: oid=".concat(e.objectId,", mtype=").concat(e.mediaType,", otype=").concat(e.objectType,", type=").concat(e.type,", value=").concat(e.value)),!(e.mediaType!==SlimCore.Enums.MediaType.Audio&&e.mediaType!==SlimCore.Enums.MediaType.Video&&e.mediaType!==SlimCore.Enums.MediaType.Data||e.objectType===SlimCore.Enums.ObjectType.Call&&e.objectId!==this.slimcoreCallId)){var n={type:t.convertQualityEventType(e.type),value:t.convertQualityLevel(e.value),mediaType:t.convertMediaType(e.mediaType),isLocalSource:e.objectType===SlimCore.Enums.ObjectType.Call};if(e.objectType===SlimCore.Enums.ObjectType.Participant){var r=this._getParticipantByObjectId(e.objectId);if(!r)return;n.id=r.id}n.type&&n.value&&(e.mediaType===SlimCore.Enums.MediaType.Audio&&e.type===SlimCore.Enums.QualityEventType.RelayWhiteListing?(this._isRelayWhiteListingIssue=!0,this.event("mediaConnectionWhitelistingWarning").raise(),this.event("mediaConnectionFailed").raise()):this.event("callQualityChanged").raise(n))}},t.prototype.getContentSharing=function(e){return this._slimcoreInstance.getContentSharing(e)},t.prototype.createContentSharingSession=function(e,t,n,r){var i=this;return Promise.resolve().then((function(){var o=i._slimcoreCallHandler.createContentSharing(i.slimcoreCallId,e,t,n,r);if(!o)throw new Error("Failed to create ContentSharing SlimCore object");var a=i.getContentSharing(o);if(!a)throw new Error("Failed to create ContentSharing SlimCore native object");var s=new D.default(i._logger,i._settings,i._slimcoreInstance,o,a,i._callTelemetry);return i.contentSharingSessions.push(s),i.event("contentSharingChanged").raise(),s}))},t.prototype._onContentSharingChanged=function(e){var t=this;void 0===e&&(e=(0,f.generateCauseId)());var n=[],r=new Map;if(this._logger.info("enableContentSharingSessionsProperty is ${this._enableContentSharingSessionsProperty}"),this._enableContentSharingSessionsProperty){var i=this._getProperties(this.slimcoreCallId,{contentSharingSessions:{propKey:SlimCore.Enums.Property.CallContentSharingSessions}},{}).contentSharingSessions;try{var a=JSON.parse(i);(null==a?void 0:a.sessions)?n=a.sessions.map((function(e){return Number(e.objectId)})):this._logger.error("unable to retrieve contentSharingSessions property")}catch(e){this._logger.error("Error parsing contentSharingSessions:",e)}}else n=this._slimcoreCallHandler.getContentSharingSessions(this.slimcoreCallId);var s=(0,D.getContentSharingProps)(),c=s.strProps,l=s.intProps,u=o(o({},l),{callObjectId:{propKey:SlimCore.Enums.Property.ContentSharingCallId}});this._getMultipleProperties(n,c,u).forEach((function(e,i){i<n.length&&e.callObjectId===t.slimcoreCallId&&r.set(n[i],e)}));var p=d.remove(this.contentSharingSessions,(function(e){return!r.has(e.slimCoreContentSharingObjectId)})),h=!1;r.forEach((function(e,n){var r=d.find(t.contentSharingSessions,(function(e){return e.slimCoreContentSharingObjectId===n}));if(!r){var i=t.getContentSharing(n);if(i){var o=new D.default(t._logger,t._settings,t._slimcoreInstance,n,i,t._callTelemetry,e);t.contentSharingSessions.push(o),t._logger.info("Added new content sharing session with guid ".concat(o.contentSharingGuid)),h=!0}}})),p.forEach((function(n){t._logger.info("Removed content sharing session with guid ".concat(n.contentSharingGuid)),n.setContentSharingStatus(7),n.dispose(e)})),(h||p.length)&&this.event("contentSharingChanged").raise()},t.prototype.raiseChangedDeferred=function(e){var t=this;(!this._raiseChangedDefer||this._raiseChangedDefer.isSkippable&&!e)&&(_.GlobalDeferHandler.instance.runDeferredWithoutDedup((function(){delete t._raiseChangedDefer,t.raiseChanged(e)}),"Call.raiseChanged"),this._raiseChangedDefer={isSkippable:!!e})},t.prototype._onParticipantJoinedOrRemovedDeferred=function(e,t){var n=this;void 0===t&&(t=(0,f.generateCauseId)()),this._logger.info("_onParticipantJoinedOrRemovedDeferred: ".concat(t)),this._handleMemberCountChangedPayload(e)&&this._participantJoinedOrRemovedDeferRunner((function(){n._onParticipantJoinedOrRemoved(t)}))},t.prototype._handleMemberCountChangedPayload=function(e){if(!e)return delete this._participantMriMap,!0;var t;try{if(!(t=JSON.parse(e))||!("sequenceNumber"in t)||!("participants"in t))return delete this._participantMriMap,!0}catch(e){return this._logger.info("Error parsing payload from call member count changed event"),delete this._participantMriMap,!0}return this._lastSequenceNumberProcessed&&this._lastSequenceNumberProcessed>=t.sequenceNumber?(this._logger.info("Ignoring event ".concat(t.sequenceNumber,", last processed event ").concat(this._lastSequenceNumberProcessed)),!1):(this._lastSequenceNumberProcessed=t.sequenceNumber,this._participantMriMap=t.participants,this._logger.info("Parsed payload of ".concat(Object.keys(this._participantMriMap).length," participants with sequence number ").concat(this._lastSequenceNumberProcessed)),!0)},t.prototype._updateDominantSpeakerListDeferred=function(){var e=this;this._updateDominantSpeakerListDeferRunner((function(){return e._updateDominantSpeakerList()}))},t.prototype.callStateCanToggleVideo=function(){return 2!==this._mode&&(3===this.state||4===this.state||5===this.state||13===this.state||10===this.state||15===this.state)},t.prototype._startInitialVideoIfReady=function(e){return l(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return this.callStateCanToggleVideo()&&this._videoRequestedOnWhileConnecting?(this._logger.info("[".concat(e,"]Call has been started; turning on video")),this._videoRequestedOnWhileConnecting=!1,[4,this.startVideoSafe(e)]):[3,2];case 1:return t.sent(),[3,4];case 2:return this.callStateCanToggleVideo()&&this._videoRequestedOffWhileConnecting?(this._logger.info("[".concat(e,"]Call has been started and video turned on; turning off video")),this._videoRequestedOffWhileConnecting=!1,[4,this.stopVideo(e)]):[3,4];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},t.convertConnectionType=function(e){switch(e){case 0:default:return SlimCore.Enums.ConnectionType.AllSupported;case 1:return SlimCore.Enums.ConnectionType.NoDirectConnection}},t.convertTargetApplicationType=function(e){switch(e){case"SFC":return SlimCore.Enums.TargetApplicationType.Sfc;case"TFL":return SlimCore.Enums.TargetApplicationType.Tfl;default:return SlimCore.Enums.TargetApplicationType.None}},t.convertStatusToTerminatedReason=function(e){switch(e){case SlimCore.Enums.CallStatus.Failed:return 7;case SlimCore.Enums.CallStatus.Finished:return 1;case SlimCore.Enums.CallStatus.Missed:return 9;case SlimCore.Enums.CallStatus.Refused:return 10;case SlimCore.Enums.CallStatus.Busy:return 11;case SlimCore.Enums.CallStatus.Cancelled:case SlimCore.Enums.CallStatus.Unplaced:return 12;case SlimCore.Enums.CallStatus.Dropped:return 4;case SlimCore.Enums.CallStatus.DeniedInLobby:return 55;case SlimCore.Enums.CallStatus.TimedOutInLobby:return 56;default:return 0}},t.convertParticipantReasonToTerminatedReason=function(e){switch(e){case 0:return 1;case 1:case 5:case 6:case 7:case 43:return 5;case 23:return 12;case 46:return 59;case 59:return 73;case 2:return 9;case 3:return 10;case 4:return 2;case 8:return 24;case 9:return 3;case 10:return 4;case 12:return 14;case 11:default:return 0;case 13:return 15;case 14:return 16;case 15:return 17;case 16:return 18;case 17:return 19;case 18:return 20;case 19:return 11;case 20:return 21;case 21:return 22;case 22:return 23;case 25:return 33;case 26:return 36;case 27:return 37;case 30:return 41;case 28:return 39;case 31:return 42;case 29:return 40;case 32:return 43;case 33:return 44;case 34:return 45;case 35:return 46;case 36:return 47;case 37:return 48;case 38:return 49;case 39:return 50;case 40:return 51;case 41:return 52;case 42:return 54;case 47:return 61;case 53:return 66;case 54:return 67;case 55:return 68;case 56:return 69;case 57:return 71;case 58:return 72}},t.convertTerminatedReasonToFailureType=function(e,t,n){switch(e){case 0:case 1:case 9:case 10:case 11:case 12:case 2:case 60:default:return 2;case 3:case 5:case 6:case 7:case 8:case 14:case 36:case 37:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 44:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 59:case 73:case 66:case 67:case 68:case 69:case 71:case 72:return 0;case 4:return t&&n?1:0}},t.convertToSlimCoreDtmfTone=function(e){switch(e){case 0:return SlimCore.Enums.DtmfTone.Num0;case 1:return SlimCore.Enums.DtmfTone.Num1;case 2:return SlimCore.Enums.DtmfTone.Num2;case 3:return SlimCore.Enums.DtmfTone.Num3;case 4:return SlimCore.Enums.DtmfTone.Num4;case 5:return SlimCore.Enums.DtmfTone.Num5;case 6:return SlimCore.Enums.DtmfTone.Num6;case 7:return SlimCore.Enums.DtmfTone.Num7;case 8:return SlimCore.Enums.DtmfTone.Num8;case 9:return SlimCore.Enums.DtmfTone.Num9;case 10:return SlimCore.Enums.DtmfTone.Star;case 11:return SlimCore.Enums.DtmfTone.Pound;case 12:return SlimCore.Enums.DtmfTone.A;case 13:return SlimCore.Enums.DtmfTone.B;case 14:return SlimCore.Enums.DtmfTone.C;case 15:return SlimCore.Enums.DtmfTone.D;case 16:return SlimCore.Enums.DtmfTone.Flash;default:return}},t.convertToSlimCoreAudioUsageMode=function(e){switch(e){case"Default":return SlimCore.Enums.AudioUsageMode.Default;case"LongrangeSpeaker":return SlimCore.Enums.AudioUsageMode.LongrangeSpeaker;case"Auditorium":return SlimCore.Enums.AudioUsageMode.Auditorium;default:return}},t.convertToSlimCoreAudioMidcallConfig=function(e){switch(e){case"Default":return SlimCore.Enums.AudioConfig.Default;case"NoiseSuppression":return SlimCore.Enums.AudioConfig.NoiseSuppression;case"SpeechRecognition":return SlimCore.Enums.AudioConfig.SpeechRecognition;case"Recording":return SlimCore.Enums.AudioConfig.Recording;default:return}},t.convertQualityEventType=function(e){switch(e){case SlimCore.Enums.QualityEventType.NetworkSendQuality:return 1;case SlimCore.Enums.QualityEventType.NetworkRecvQuality:return 2;case SlimCore.Enums.QualityEventType.NetworkDelay:return 3;case SlimCore.Enums.QualityEventType.NetworkBandwidthLow:return 4;case SlimCore.Enums.QualityEventType.NetworkReconnect:return 5;case SlimCore.Enums.QualityEventType.NetworkPacketLoss:return 6;case SlimCore.Enums.QualityEventType.NetworkJitter:return 7;case SlimCore.Enums.QualityEventType.NetworkRateMatching:return 8;case SlimCore.Enums.QualityEventType.DeviceCaptureNotFunctioning:return 9;case SlimCore.Enums.QualityEventType.DeviceRenderNotFunctioning:return 10;case SlimCore.Enums.QualityEventType.DeviceRenderGlitches:return 11;case SlimCore.Enums.QualityEventType.DeviceLowSNR:return 12;case SlimCore.Enums.QualityEventType.DeviceLowSpeechLevel:return 13;case SlimCore.Enums.QualityEventType.DeviceClipping:return 14;case SlimCore.Enums.QualityEventType.DeviceEcho:return 15;case SlimCore.Enums.QualityEventType.PresentationAudioQuality:return 16;case SlimCore.Enums.QualityEventType.DeviceHalfDuplexAec:return 17;case SlimCore.Enums.QualityEventType.DeviceMultipleEndpoints:return 18;case SlimCore.Enums.QualityEventType.DeviceHowling:return 19;case SlimCore.Enums.QualityEventType.DeviceRenderZeroVolume:return 20;case SlimCore.Enums.QualityEventType.DeviceRenderMute:return 21;case SlimCore.Enums.QualityEventType.NetworkSendCatastrophic:return 22;case SlimCore.Enums.QualityEventType.NetworkRecvCatastrophic:return 23;case SlimCore.Enums.QualityEventType.CpuInsufficient:return 24;case SlimCore.Enums.QualityEventType.DeviceCaptureMute:return 25;case SlimCore.Enums.QualityEventType.DeviceCaptureNotMuteButSilent:return 26;case SlimCore.Enums.QualityEventType.DeviceSpeakWhileMuted:return 27;case SlimCore.Enums.QualityEventType.VideoVbssRendered:return 28;case SlimCore.Enums.QualityEventType.NetworkEthernetInterfaceUsed:return 29;case SlimCore.Enums.QualityEventType.NetworkWlanInterfaceUsed:return 30;case SlimCore.Enums.QualityEventType.NetworkWwanInterfaceUsed:return 31;case SlimCore.Enums.QualityEventType.RelayWhiteListing:return 32;case SlimCore.Enums.QualityEventType.VideoCapturerDeviceStartFailed:return 33;case SlimCore.Enums.QualityEventType.VideoCapturerDeviceStartTimedOut:return 34;case SlimCore.Enums.QualityEventType.VideoCapturerDeviceStartFailureLackSystemRes:return 35;case SlimCore.Enums.QualityEventType.VideoCapturerDeviceStartFailureMFResConflict:return 36;case SlimCore.Enums.QualityEventType.ZeroCaptureDevicesEnumerated:return 43;case SlimCore.Enums.QualityEventType.ZeroRenderDevicesEnumerated:return 44;case SlimCore.Enums.QualityEventType.NoNetwork:return 37;case SlimCore.Enums.QualityEventType.NetworkNotWorking:return 38;case SlimCore.Enums.QualityEventType.DeviceCaptureNotFunctioningAudioSrvNotRunning:return 41;case SlimCore.Enums.QualityEventType.DeviceRenderNotFunctioningAudioSrvNotRunning:return 42;case SlimCore.Enums.QualityEventType.DeviceCaptureNotFunctioningDeviceInUse:return 39;case SlimCore.Enums.QualityEventType.DeviceRenderNotFunctioningDeviceInUse:return 40;case SlimCore.Enums.QualityEventType.VideoCaptureDeviceFreeze:return 45;case SlimCore.Enums.QualityEventType.AudioCapturePermissionDenied:return 46;case SlimCore.Enums.QualityEventType.VideoCapturePermissionDenied:return 47;case SlimCore.Enums.QualityEventType.VideoCaptureFreezeRecovered:return 48;case SlimCore.Enums.QualityEventType.DeviceRenderHowling:return 49;case SlimCore.Enums.QualityEventType.LowFarEndInput:return 50;case SlimCore.Enums.QualityEventType.RemoteNetworkConnectivityIssue:return 52;case SlimCore.Enums.QualityEventType.PresentationAudioLoopbackDeviceState:return 53;case SlimCore.Enums.QualityEventType.AudioCaptureUltrasoundDetected:return 54;case SlimCore.Enums.QualityEventType.MultichannelAudioBandwidth:return 56;case SlimCore.Enums.QualityEventType.MusicModeNotAvailable:return 57;case SlimCore.Enums.QualityEventType.MusicModeSupported:return 58;case SlimCore.Enums.QualityEventType.AudioCaptureMusicDetectedWithHighNS:return 59;case SlimCore.Enums.QualityEventType.AudioCaptureMusicDetectedWithLowNS:return 60;case SlimCore.Enums.QualityEventType.CameraLighting:return 61;case SlimCore.Enums.QualityEventType.DeviceCaptureVoiceActive:return 62;case SlimCore.Enums.QualityEventType.AudioLoopbackDeviceReady:return 63;case SlimCore.Enums.QualityEventType.SpatialAudioMUCHUnavailable:return 65;case SlimCore.Enums.QualityEventType.SpeechOverlapFailedInterruptionDetected:return 66;case SlimCore.Enums.QualityEventType.BackgroundSpeechSuppressed:return 67;case SlimCore.Enums.QualityEventType.BackgroundLoudSpeechSuppressed:return 68;case SlimCore.Enums.QualityEventType.ActiveSpeechDetected:return 69;case SlimCore.Enums.QualityEventType.DeviceCaptureNotFunctioningBluetoothMidCallFail:return 70;case SlimCore.Enums.QualityEventType.DeviceCaptureNotFunctioningWebcamMicMidCallFail:return 71;case SlimCore.Enums.QualityEventType.DeviceCaptureNotMuteButSilentDongle:return 72;case SlimCore.Enums.QualityEventType.DeviceRenderNotFunctioningBluetoothMidCallFail:return 73;case SlimCore.Enums.QualityEventType.ZeroCaptureDevicesEnumeratedRDP:return 74;case SlimCore.Enums.QualityEventType.ZeroRenderDevicesEnumeratedRDP:return 75;case SlimCore.Enums.QualityEventType.WrongCaptureDevicesUsedRDP:return 76;case SlimCore.Enums.QualityEventType.WrongRenderDevicesUsedRDP:return 77;case SlimCore.Enums.QualityEventType.NetworkStatusIndicator:return 78;case SlimCore.Enums.QualityEventType.LoopbackDeviceRenderNotFunctioning:return 79;default:return}},t.convertQualityLevel=function(e){switch(e){case SlimCore.Enums.QualityLevel.Unknown:return 0;case SlimCore.Enums.QualityLevel.Good:return 1;case SlimCore.Enums.QualityLevel.Poor:return 2;case SlimCore.Enums.QualityLevel.Bad:return 3;default:return}},t.convertMediaType=function(e){switch(e){case SlimCore.Enums.MediaType.Audio:return 0;case SlimCore.Enums.MediaType.Video:return 1;case SlimCore.Enums.MediaType.AppSharing:return 2;case SlimCore.Enums.MediaType.Data:return 3;default:return}},t.toMediaDirection=function(e){switch(e){case 0:default:return SlimCore.Enums.MediaDirection.Disabled;case 3:return SlimCore.Enums.MediaDirection.Inactive;case 2:return SlimCore.Enums.MediaDirection.SendToPeer;case 1:return SlimCore.Enums.MediaDirection.ReceiveFromPeer;case 4:return SlimCore.Enums.MediaDirection.Bidirectional}},t.toAnswerMediaType=function(e){switch(e){case 0:default:return SlimCore.Enums.AnswerMediaType.AnswerWithAudioOnly;case 1:return SlimCore.Enums.AnswerMediaType.AnswerWithAudioVideo;case 2:return SlimCore.Enums.AnswerMediaType.AnswerWithScreenshareOnly}},t.convertMuteScope=function(e){switch(e){case 0:return SlimCore.Enums.MuteScope.All;case 1:return SlimCore.Enums.MuteScope.Specified;default:return}},t.convertToSlimCoreMediaPeerType=function(e){switch(e){case 0:return SlimCore.Enums.MediaPeerType.ConsumerTwoParty;case 1:return SlimCore.Enums.MediaPeerType.ConsumerPstn;case 2:return SlimCore.Enums.MediaPeerType.ConsumerMultiParty;case 3:return SlimCore.Enums.MediaPeerType.EnterpriseTwoPartyOnlineOnly;case 4:return SlimCore.Enums.MediaPeerType.EnterpriseTwoPartyHybrid;case 6:return SlimCore.Enums.MediaPeerType.EnterprisePstnOnlineOnly;case 7:return SlimCore.Enums.MediaPeerType.EnterprisePstnHybrid;case 5:return SlimCore.Enums.MediaPeerType.EnterpriseMultiParty;case 8:return SlimCore.Enums.MediaPeerType.EnterpriseFederated;case 9:return SlimCore.Enums.MediaPeerType.EnterpriseUnknown;case 10:return SlimCore.Enums.MediaPeerType.EnterpriseMultiPartyBroadcasting;default:return}},t.convertPushHandlingResult=function(e){switch(e){case SlimCore.Enums.PushHandlingResult.BadNotificationPayload:return{code:0,fatal:!0};case SlimCore.Enums.PushHandlingResult.CallSetupSucceeded:return{code:1,success:!0};case SlimCore.Enums.PushHandlingResult.BadNotificationEventType:return{code:3,fatal:!0};case SlimCore.Enums.PushHandlingResult.CallSetupSucceededCallAlreadyExists:return{code:4};case SlimCore.Enums.PushHandlingResult.CallSetupFailedCannotConnect:return{code:5,fatal:!0};case SlimCore.Enums.PushHandlingResult.CallSetupFailedNoSignaling:return{code:6,fatal:!0};case SlimCore.Enums.PushHandlingResult.CallSetupFailedConflict:return{code:7};case SlimCore.Enums.PushHandlingResult.CallSetupFailedPushIgnored:return{code:8};case SlimCore.Enums.PushHandlingResult.CallSetupFailedAnsweredElsewhere:return{code:9};case SlimCore.Enums.PushHandlingResult.CallSetupFailedAlreadyEnded:return{code:10};case SlimCore.Enums.PushHandlingResult.CallSetupProgress:return{code:11,success:!0};case SlimCore.Enums.PushHandlingResult.CallSetupFailed:case SlimCore.Enums.PushHandlingResult.CallSetupFailedNoPermission:case SlimCore.Enums.PushHandlingResult.CallSetupFailedNoCommonCodec:default:return{code:2,fatal:!0}}},Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAudioStreamConnected",{get:function(){return this._isAudioStreamConnected},set:function(e){this._isAudioStreamConnected!==e&&(this._isAudioStreamConnected=e,this._wasAudioStreamConnected=this._wasAudioStreamConnected||e,this.raiseChangedDeferredIfEnabled())},enumerable:!1,configurable:!0}),t.isCallConnected=function(e){return e===SlimCore.Enums.CallStatus.InProgress},t.isObserving=function(e){return e===SlimCore.Enums.CallStatus.Observing},t.isCallRinging=function(e){switch(e){case SlimCore.Enums.CallStatus.RingingOut:case SlimCore.Enums.CallStatus.RingingIn:return!0;default:return!1}},t.isCallConnecting=function(e){return e===SlimCore.Enums.CallStatus.Routing},t.isCallEarlyMedia=function(e){return e===SlimCore.Enums.CallStatus.EarlyMedia},t.isCallInLobby=function(e){return e===SlimCore.Enums.CallStatus.InLobby},t.isCallPreheating=function(e){return e===SlimCore.Enums.CallStatus.Preheating},t.isCallPreheated=function(e){return e===SlimCore.Enums.CallStatus.Preheated},t.isCallStaging=function(e){return e===SlimCore.Enums.CallStatus.Staging},t.isCallNegotiatingEncryption=function(e){return e===SlimCore.Enums.CallStatus.NegotiatingEncryption},t.isCallNegotiatingEncryptionLobby=function(e){return e===SlimCore.Enums.CallStatus.NegotiatingEncryptionLobby},t.isCallTerminated=function(e){switch(e){case SlimCore.Enums.CallStatus.Missed:case SlimCore.Enums.CallStatus.Refused:case SlimCore.Enums.CallStatus.Busy:case SlimCore.Enums.CallStatus.Cancelled:case SlimCore.Enums.CallStatus.Finished:case SlimCore.Enums.CallStatus.Failed:case SlimCore.Enums.CallStatus.Dropped:case SlimCore.Enums.CallStatus.DeniedInLobby:case SlimCore.Enums.CallStatus.TimedOutInLobby:case SlimCore.Enums.CallStatus.CallTimedOut:return!0;default:return!1}},t.prototype._cleanRealTimeCallResources=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i;return u(this,(function(o){switch(o.label){case 0:t=this._logger.createFnLogger("cleanRealTimeCallResources",e),o.label=1;case 1:return o.trys.push([1,8,,9]),n=d.map(this.participants,(function(n){return A.forgetAndLog(n.stopVideos(e),t,"cleanRealTimeCallResources: stopping participant videos")})),[4,Promise.all(n)];case 2:return o.sent(),this._getlocalScreenShareStream()?[4,A.forgetAndLog(this.stopScreenSharing(!1,e),t,"cleanRealTimeCallResources: LocalScreenShare stop")]:[3,4];case 3:o.sent(),o.label=4;case 4:return(r=this._getLocalVideo())?[4,A.forgetAndLog(r.stop(e),t,"cleanRealTimeCallResources: LocalVideo stop")]:[3,7];case 5:return o.sent(),[4,this.cleanupLocalVideo(e)];case 6:o.sent(),o.label=7;case 7:return this._cleanDataChannelResources(e),[3,9];case 8:throw i=o.sent(),t.error(i),i;case 9:return[2]}}))}))},t.prototype._cleanDataChannelResources=function(e){var t,n;return l(this,void 0,void 0,(function(){return u(this,(function(r){return null===(t=this._dataChannel)||void 0===t||t.dispose(e),this._dataChannel=null,null===(n=this._dataChannelUsers)||void 0===n||n.forEach((function(e){e.setDataChannel(null)})),[2]}))}))},t.prototype._cleanCallResources=function(e){return l(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:t=this._logger.createFnLogger("cleanCallResources",e),r.label=1;case 1:return r.trys.push([1,5,6,7]),[4,this._cleanRealTimeCallResources(e)];case 2:return r.sent(),this.videoLayout?[4,this.videoLayout.dispose(e)]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.contentSharingSessions.forEach((function(t){t.setContentSharingStatus(7),t.dispose(e)})),this.contentSharingSessions=[],[3,7];case 5:return n=r.sent(),t.error(n),[3,7];case 6:return this.dispose(e),[7];case 7:return[2]}}))}))},t.prototype.dispose=function(t){var n=this._logger.createFnLogger("dispose",t);n.info("start"),this.subscriptions.length&&n.info("".concat(this.subscriptions.length," subscriptions will be lost")),this.videoLayout&&this.videoLayout.dispose(t),this._slimCoreElectronRemoteManager&&this._slimCoreElectronRemoteManager.dispose(t),this.mediaStreams[0]=[],this.mediaStreams[1]=[],this.mediaStreams[2]=[];var r=this._getlocalScreenShareStream();r&&r.dispose(t);var i=this._getLocalVideo();i&&i.dispose(t),this.localMediaStreams=[],this.screenSharingControl&&(this.screenSharingControl.dispose(t),this.screenSharingControl=null),this.ptzHandler&&(this.ptzHandler.dispose(t),this.ptzHandler=null),this.dataChannelAdapter&&(this.dataChannelAdapter.dispose(),this.dataChannelAdapter=null),this._dataChannel&&(this._dataChannel.dispose(t),this._dataChannel=null),this._dataChannelUsers&&(this._dataChannelUsers=null),this._localRecordingPromiseOnHold&&(this._localRecordingPromiseOnHold=null),this.participants.forEach((function(e){e.dispose(t)})),e.prototype.dispose.call(this,t)},t.prototype.testTriggerMediaRelayWhiteListingIssue=function(){throw new Error("testTriggerMediaRelayWhiteListingIssue not implemented in electron call")},t.prototype.testSetCallState=function(e){this._logger.info("Overwriting call state for test purposes: ".concat(this.state," -> ").concat(e)),this.state=e},t.prototype.addGroupModality=function(e,t){var n=this;void 0===t&&(t=(0,f.generateCauseId)());var r=this._logger.createFnLogger(h.CALL_OPERATIONS.ADD_GROUP_MODALITY,t);if(0===this.slimcoreCallId)return Promise.reject(new Error("call is not initialized yet"));var i=e.additionalData?JSON.stringify(e.additionalData):"";return r.info("groupId = ".concat(O.scrubMriOrOmit(e.groupId)," threadId = ").concat(O.getLoggableThreadId(e.threadId)," messageId = ").concat(e.messageId," additionalData = ").concat(O.scrubMriOrOmit(i))),Promise.resolve().then((function(){n._slimcoreCallHandler.addGroupModality(n.slimcoreCallId,e.threadId,e.messageId,i,t,e.groupId)})).catch((function(e){throw r.logFailure(e),e}))},t.prototype.addBroadcastModality=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,t);return this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY)?this._callOperationHandler.getPendingOperation(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY):Promise.resolve().then((function(){n._slimcoreCallHandler.addBroadcastModality(n.slimcoreCallId,JSON.stringify(e),t)})).catch((function(e){return Promise.reject((0,y.getRejectTransactionEnd)(e))})).then((function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,t)})).catch((function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,{error:(0,C.getPIISafeObject)(e)},t),r.logFailure(e),e}))},t.prototype.getMediaTelemetry=function(){return Promise.reject("Not supported")},t.prototype.getMediaSessionStats=function(){throw new Error("Not supported")},t.prototype.getMediaLogs=function(){return Promise.reject("Not supported")},t.prototype.getSlimcoreEnumLevel=function(e){switch(e){case"user":return SlimCore.Enums.PublishStateLevel.PublishStateUser;case"endpoint":return SlimCore.Enums.PublishStateLevel.PublishStateEndpoint;default:throw"Invalid level type."}},t.prototype._onCallLimitsUpdated=function(e){if(this._logger.info("_onCallLimitsUpdated: CallLimits=".concat(e)),e&&this._rawCallLimits!==e)try{this.callLimits=JSON.parse(e),this._rawCallLimits=e,this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse the raw call limits data. Error: ".concat(t,", CallLimits: ").concat(e))}},t.prototype._onConversationStartTimeChanged=function(e){if(this._logger.info("_onConversationStartTimeChanged: Conv start time=".concat(e)),e&&this._rawConversationStartTime!==e)try{this.conversationStartTime=new Date(e),this._rawConversationStartTime=e,this.raiseChangedDeferredIfEnabled()}catch(t){this._logger.warn("Failed to parse the raw conv start timestamp. Error: ".concat(t,", rawConvStartTime: ").concat(e))}},t.prototype.setVideoMidcallConfigJson=function(e,t){return void 0===t&&(t=(0,f.generateCauseId)()),l(this,void 0,void 0,(function(){return u(this,(function(n){return[2,this._setVideoMidcallConfigJson(e,t)]}))}))},t.prototype._setVideoMidcallConfigJson=function(e,t){return l(this,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:(n=this._logger.createFnLogger("setVideoMidcallConfigJson",t)).info("videoConfigJson: ".concat(e," ").concat(JSON.stringify(e))),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._slimcoreCallHandler.callSetVideoMidcallConfigJson(this.slimcoreCallId,JSON.stringify(e))];case 2:return[2,i.sent()];case 3:throw r=i.sent(),n.logFailure(r),r;case 4:return[2]}}))}))},t.prototype.createStage=function(e){return new G.default(this,this._logger,this._slimcoreInstance,this.slimcoreCallId,this.currentUserSkypeIdentity.id,e)},t.instanceCount=0,a([(0,T.callOperation)(h.CALL_OPERATIONS.UPDATE_MEETING_STATES,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"updateMeetingStates",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.INITIALIZE,{type:T.OPERATION_TYPE.SYNC,convertError:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.NO_OP}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],t.prototype,"init",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SWITCH_INTERPRETER_GROUP,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],t.prototype,"_switchInterpreterGroup",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.JOIN_CALL,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),c(1,T.callStartOptions),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],t.prototype,"join",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_CALL,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),c(0,T.callStartOptions),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"start",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"startCallToVoicemail",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_WITH_MEETING_DATA,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"startWithMeetingData",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],t.prototype,"joinWithMeetingData",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],t.prototype,"subscribeWithMeetingData",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),c(1,T.callStartOptions),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Array,Object,Object]),s("design:returntype",Promise)],t.prototype,"startCallWithNudge",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_CALL_AND_UNPARK,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(2,T.callStartOptions),c(3,T.causeId),s("design:type",Function),s("design:paramtypes",[Number,String,Object,Object]),s("design:returntype",Promise)],t.prototype,"startAndUnpark",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SUBSCRIBE,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],t.prototype,"joinCallWithoutCallModality",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{waitFor:h.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"joinPreheatedCall",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_VIDEO,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"startVideo",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_VIDEO,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"stopVideo",null),a([(0,T.callOperation)(h.CALL_OPERATIONS_INTERNAL.START_LOCAL_VIDEO,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],t.prototype,"_startLocalVideo",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.DUMP_VIDEO_SOURCE_IMAGES,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"dumpVideoSourceImages",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_SCREEN_SHARING,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(3,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,String,Object]),s("design:returntype",Promise)],t.prototype,"startScreenSharing",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_LOCAL_RECORDING,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"startLocalRecording",null),a([c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],t.prototype,"_startLocalRecording",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SET_MEETING_LAYOUT,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"setMeetingLayout",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_LOCAL_RECORDING,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"stopLocalRecording",null),a([c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],t.prototype,"_stopLocalRecording",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.INCLUDE_SYSTEM_AUDIO,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"includeSystemAudioInLocalRecording",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.OVERLAY_WINDOW_IN_LOCAL_RECORDING,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"overlayWindowInLocalRecording",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_SCREEN_SHARING,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Boolean,String,Object]),s("design:returntype",Promise)],t.prototype,"stopScreenSharing",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_DATA_CHANNEL,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE,h.OPERATION_TAGS.NOT_SUPPORTED_IN_E2EE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"startDataChannel",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_DATA_CHANNEL,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE,h.OPERATION_TAGS.NOT_SUPPORTED_IN_E2EE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"stopDataChannel",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SHARE_SYSTEM_SOUNDS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[Boolean]),s("design:returntype",Promise)],t.prototype,"shareSystemSound",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_FACESTREAM,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[String,Number]),s("design:returntype",Promise)],t.prototype,"startFaceStream",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_FACESTREAM,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"stopFaceStream",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_INROOM_FACE_ATRRIBUTION,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[String,Number,Boolean]),s("design:returntype",Promise)],t.prototype,"startInRoomFaceAtrribution",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_INROOM_FACE_ATRRIBUTION,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"stopInRoomFaceAtrribution",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_MULTICHANNEL_AUDIO_DEVICE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[String,Number]),s("design:returntype",Promise)],t.prototype,"startMultichannelAudioDevice",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_MULTICHANNEL_AUDIO_DEVICE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"stopMultichannelAudioDevice",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.BLIND_TRANSFER,{singular:!0,type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],t.prototype,"callBlindTransfer",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SAFE_TRANSFER,{singular:!0,type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],t.prototype,"callSafeTransfer",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.TRANSFER_TO_VOICEMAIL,{singular:!0,type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"transferCallToVoicemail",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{singular:!0,type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,String,Object]),s("design:returntype",Promise)],t.prototype,"callConsultativeTransfer",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,{singular:!0,type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"consultativeTransferWithPickupCode",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.CALL_REDIRECT,{singular:!0,type:T.OPERATION_TYPE.CHAINED}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"callRedirect",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.PARK_CALL,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Number,Object]),s("design:returntype",Promise)],t.prototype,"park",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UNPARK_CALL,{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Number,String]),s("design:returntype",Promise)],t.prototype,"unpark",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.MUTE,{waitFor:h.CALL_OPERATIONS.UNMUTE,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]},!0),c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"mute",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UNMUTE,{waitFor:[h.CALL_OPERATIONS.MUTE,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,h.CALL_OPERATIONS_INTERNAL.PROMOTION_TO_REALTIME]},!0),c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"unmute",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.MUTE_SPEAKER,{waitFor:h.CALL_OPERATIONS.UNMUTE_SPEAKER,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"muteSpeaker",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UNMUTE_SPEAKER,{waitFor:h.CALL_OPERATIONS.MUTE_SPEAKER,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"unmuteSpeaker",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY},!0),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Number,Array,Object]),s("design:returntype",Promise)],t.prototype,"muteParticipants",null),a([c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object,Number]),s("design:returntype",Promise)],t.prototype,"hold",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.LOCAL_HOLD,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object,Number]),s("design:returntype",Promise)],t.prototype,"_localHold",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.HOLD,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],t.prototype,"_hold",null),a([c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"unhold",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.LOCAL_UNHOLD,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],t.prototype,"_localUnhold",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UNHOLD,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],t.prototype,"_unhold",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UPDATE_ENDPOINT_METADATA,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"updateEndpointMetadata",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SEND_DTMF_TONE,{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Number,Object]),s("design:returntype",Promise)],t.prototype,"sendDtmfTone",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SET_AUDIO_USAGE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"setAudioUsageMode",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Number,Object]),s("design:returntype",Promise)],t.prototype,"setAudioMidcallConfig",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG_JSON,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"setAudioMidcallConfigJson",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SET_PARTICIPANT_SPATIAL_POSITIONS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Array,Object]),s("design:returntype",Promise)],t.prototype,"setParticipantSpatialAudioPositions",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.GET_TECHNICAL_INFORMATION_JSON,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"getTechnicalInformationJson",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.START_AUDIO,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"startAudio",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_AUDIO,{type:T.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"stopAudio",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ASSIMILATE,{waitFor:h.CALL_OPERATIONS.ASSIMILATE}),c(3,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],t.prototype,"assimilate",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.PUBLISH_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"publishState",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.PUBLISH_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"publishStatesForEveryone",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.REMOVE_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"removeState",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.REMOVE_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"removeStatesForEveryone",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"updateMeetingSettings",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(0,T.operationId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"updateMeetingGroups",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(0,T.operationId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"updateMeetingLiveState",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(0,T.operationId),s("design:type",Function),s("design:paramtypes",[String,Array]),s("design:returntype",Promise)],t.prototype,"updateParticipantInterpretationState",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(0,T.operationId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"joinMeetingGroup",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(0,T.operationId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"leaveMeetingGroup",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SEND_MESSAGES,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Array]),s("design:returntype",Promise)],t.prototype,"sendMessages",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.UPDATE_MONITOR_SESSION,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"updateMonitorSession",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.STOP_CALL,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.causeId),c(3,T.reason),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object]),s("design:returntype",Promise)],t.prototype,"stop",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.REJECT,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(0,T.causeId),c(1,T.reason),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"reject",null),a([(0,T.callOperation)(h.CALL_OPERATIONS_INTERNAL.ELECTRON_LEAVE_CALL,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"_leaveSlimCoreCall",null),a([(0,T.callOperation)(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{triggerAttach:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Number,Object]),s("design:returntype",void 0)],t.prototype,"incomingCallInit",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ACKNOWLEDGE,{type:T.OPERATION_TYPE.CHAINED,triggerAttach:!0,convertError:!0,idempotencyLevel:T.IDEMPOTENCY_LEVEL.ERROR}),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,String,Object]),s("design:returntype",Promise)],t.prototype,"acknowledge",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ACCEPT,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"accept",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.MERGE_PARTICIPANTS),c(1,T.operationId),c(3,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Array,Object,String,Number]),s("design:returntype",Promise)],t.prototype,"mergeParticipants",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE),c(0,T.operationId),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],t.prototype,"mergeWithPickupCode",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.MERGE_CALL,{singular:!0,waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],t.prototype,"merge",null),a([(0,T.callOperation)(h.CALL_OPERATIONS_INTERNAL.RECONNECT),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"reconnect",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ELECTRON_PROVIDE_CQF,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s("design:type",Function),s("design:paramtypes",[String,String,Number,String]),s("design:returntype",Promise)],t.prototype,"provideCallQualityFeedback",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ELECTRON_SHOW_CQF_INFO,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s("design:type",Function),s("design:paramtypes",[String,Number]),s("design:returntype",Promise)],t.prototype,"showCQFInfo",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ELECTRON_IS_CQF_RENDERED,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],t.prototype,"isCqfRendered",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ELECTRON_PROVIDE_CQF,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s("design:type",Function),s("design:paramtypes",[String,String,Number,String,String,String]),s("design:returntype",Promise)],t.prototype,"provideCallQualityFeedbackEx",null),a([(0,T.participantOperation)(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT),c(0,T.operationId),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"admitParticipant",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ADMIT,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"admit",null),a([(0,T.participantOperation)(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK),c(0,T.operationId),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[String,String,Object]),s("design:returntype",Promise)],t.prototype,"callMeBack",null),a([(0,T.participantOperation)(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS),c(0,T.operationId),c(3,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Array,Object,Object]),s("design:returntype",Promise)],t.prototype,"nudgeParticipants",null),a([(0,T.participantOperation)(h.CALL_OPERATIONS.UPDATE_PARTICIPANTS_PROPERTIES),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"updateParticipantsProperties",null),a([(0,T.participantOperation)(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Array,String,Object]),s("design:returntype",Promise)],t.prototype,"updateMeetingRoles",null),a([(0,T.participantOperation)(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT),c(0,T.operationId),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],t.prototype,"addParticipant",null),a([(0,T.participantOperation)(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS),c(0,T.operationId),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Array,Object,Object]),s("design:returntype",Promise)],t.prototype,"addParticipants",null),a([(0,T.participantOperation)(h.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT),c(0,T.operationId),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,String,Number]),s("design:returntype",Promise)],t.prototype,"removeParticipant",null),a([(0,T.participantOperation)(h.PARTICIPANT_OPERATIONS.CANCEL_NUDGE),c(0,T.operationId),c(0,T.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"cancelNudge",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"searchParticipants",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"getAllParticipants",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS,{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(2,T.operationId),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Number,String,String]),s("design:returntype",Promise)],t.prototype,"setMaxVideoChannels",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SET_MAX_VBSS_CHANNELS,{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(2,T.operationId),c(2,T.causeId),s("design:type",Function),s("design:paramtypes",[Number,String,String]),s("design:returntype",Promise)],t.prototype,"setMaxVbssChannels",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.CREATE_CONTENT_SHARING_SESSION,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s("design:type",Function),s("design:paramtypes",[String,String,String,String]),s("design:returntype",Promise)],t.prototype,"createContentSharingSession",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ADD_GROUP_MODALITY,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"addGroupModality",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),c(1,T.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],t.prototype,"addBroadcastModality",null),a([(0,T.callOperation)(h.CALL_OPERATIONS.SET_VIDEO_MIDCALL_CONFIG_JSON,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),c(1,T.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"setVideoMidcallConfigJson",null),t}(R.default);function q(e){switch(e){case SlimCore.Enums.LocalRecordingFailureReason.CallingWindowDoesNotExist:return 1;case SlimCore.Enums.LocalRecordingFailureReason.DirectoryNotFound:return 2;case SlimCore.Enums.LocalRecordingFailureReason.DiskFull:return 5;case SlimCore.Enums.LocalRecordingFailureReason.InsufficientPermissionToCreateDirectory:return 3;case SlimCore.Enums.LocalRecordingFailureReason.InsufficientPermissionToCreateFile:return 4;case SlimCore.Enums.LocalRecordingFailureReason.NotSupported:return 7;case SlimCore.Enums.LocalRecordingFailureReason.UnexpectedFailure:return 8;case SlimCore.Enums.LocalRecordingFailureReason.WriteError:return 6;case SlimCore.Enums.LocalRecordingFailureReason.FailedToNotifyOtherParticipants:return 9;case SlimCore.Enums.LocalRecordingFailureReason.NoFailure:default:var t=Object.keys(SlimCore.Enums.LocalRecordingFailureReason).find((function(t){return SlimCore.Enums.LocalRecordingFailureReason[t]===e}));throw new Error("unknown mapping for SlimCore.Enums.LocalRecordingFailureReason.".concat(t," to LocalRecordingError"))}}t.default=W,t.mapLocalRecordingFailureReasonToLocalRecordingError=q},6753:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._slimcoreInstance=t,this._logger=e.createChild("CallFeedback")}return e.prototype.getCallFeedbackInfo=function(e,t,i,o){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:this._logger.info("getCallFeedbackInfo callId: ".concat(i)),r.label=1;case 1:return r.trys.push([1,5,,6]),this._slimcoreInstance.getCallFeedbackInfo?[4,this._slimcoreInstance.getCallFeedbackInfo(t,i,this.toCallType(o,this.getSlimCoreBuildVersion()))]:[3,3];case 2:return[2,r.sent()];case 3:return this._logger.warn("getCallFeedbackInfo not on SkyLib"),e?[2,e.showCQFInfo(t,o)]:[2,null];case 4:return[3,6];case 5:throw n=r.sent(),this._logger.error("Error in getCallFeedbackInfo callId: ".concat(i,", error: ").concat(n)),n;case 6:return[2]}}))}))},e.prototype.isQuestionaryRendered=function(e,t,i,o){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:this._logger.info("isQuestionaryRendered callId: ".concat(t)),r.label=1;case 1:return r.trys.push([1,5,,6]),this._slimcoreInstance.isQuestionaryRendered?[4,this._slimcoreInstance.isQuestionaryRendered(t,i,o)]:[3,3];case 2:return[2,r.sent()];case 3:this._logger.warn("isQuestionaryRendered not on SkyLib"),e&&e.isCqfRendered(o),r.label=4;case 4:return[3,6];case 5:throw n=r.sent(),this._logger.error("Error in isQuestionaryRendered callId: ".concat(t,", error: ").concat(n)),n;case 6:return[2]}}))}))},e.prototype.provideCallQualityFeedbackEx=function(e,t,i,o,a,s,c,l,u){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:this._logger.info("provideCallQualityFeedback callId: ".concat(t)),r.label=1;case 1:return r.trys.push([1,5,,6]),this._slimcoreInstance.provideCallQualityFeedbackEx?[4,this._slimcoreInstance.provideCallQualityFeedbackEx(t,i,o,a,this.toQualityRating(s),c,l,u)]:[3,3];case 2:return[2,r.sent()];case 3:this._logger.warn("provideCallQualityFeedbackEx not on SkyLib"),e&&e.provideCallQualityFeedbackEx(o,a,s,c,l,u),r.label=4;case 4:return[3,6];case 5:throw n=r.sent(),this._logger.error("Error in provideCallQualityFeedback callId: ".concat(t,", error: ").concat(n)),n;case 6:return[2]}}))}))},e.prototype.toCallType=function(e,t){return 0===e?SlimCore.Enums.EcsCallType.EcsCallTypeGroup:2===e?SlimCore.Enums.EcsCallType.EcsCallTypePstn:1===e?SlimCore.Enums.EcsCallType.EcsCallTypeS2s:3===e&&(t.length>1&&t[0]>2021||t[0]>=2021&&t[1]>=3)?SlimCore.Enums.EcsCallType.EcsCallTypeMeeting:SlimCore.Enums.EcsCallType.EcsCallTypeS2s},e.prototype.toQualityRating=function(e){return 0===e?SlimCore.Enums.CallQualityRating2.VeryBad:1===e?SlimCore.Enums.CallQualityRating2.Bad:2===e?SlimCore.Enums.CallQualityRating2.Average:3===e?SlimCore.Enums.CallQualityRating2.Good:4===e?SlimCore.Enums.CallQualityRating2.VeryGood:SlimCore.Enums.CallQualityRating2.NotApplicable},e.prototype.getSlimCoreBuildVersion=function(){for(var e=[],t=0,n=SlimCore.getVersion().split(".");t<n.length;t++){var r=n[t];e.push(+r)}return e},e}();t.default=i},1325:function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.getParticipantProps=void 0;var a=n(6773),s=n(891),c=n(961),l=n(7584),u=n(2944),d=n(8201),p=n(4147),h=n(638),g=n(3607),f=n(5773),m=n(1775),_=n(8994),y=n(1011),v=n(1113),S=((i={})[0]=[1,2,3,4,6,7,5,8],i[1]=[2,3,4,6,7,0,8,9],i[2]=[0,1,3,4,6,7,8],i[3]=[2,1,4,5,0,7,8],i[4]=[0],i[5]=[3,7,4,0,8],i[6]=[3,8,4,0],i[7]=[3,8,4,0,10],i[8]=[3,5,4],i[9]=[3,4,8],i[10]=[3,8,4],i);t.getParticipantProps=function(){return{strProps:{displayName:{propKey:SlimCore.Enums.Property.ParticipantDisplayName},role:{propKey:SlimCore.Enums.Property.ParticipantRole},tenantId:{propKey:SlimCore.Enums.Property.ParticipantTenantId},acceptedBy:{propKey:SlimCore.Enums.Property.ParticipantAcceptedBy},endpointDetails:{propKey:SlimCore.Enums.Property.ParticipantEndpointDetails},meetingRole:{propKey:SlimCore.Enums.Property.ParticipantMeetingRole},advancedMeetingRole:{propKey:SlimCore.Enums.Property.ParticipantAdvancedMeetingRole},participantType:{propKey:SlimCore.Enums.Property.ParticipantParticipantType},nonMaskedId:{propKey:SlimCore.Enums.Property.ParticipantNonMaskedIdentity},nonMaskedDisplayName:{propKey:SlimCore.Enums.Property.ParticipantNonMaskedDisplayName},nonMaskedObjectId:{propKey:SlimCore.Enums.Property.ParticipantNonMaskedObjectIdentity},participantPropertyBag:{propKey:SlimCore.Enums.Property.ParticipantPropertyBag}},intProps:{isServerMuted:{propKey:SlimCore.Enums.Property.ParticipantIsServerMuted},capabilities:{propKey:SlimCore.Enums.Property.ParticipantCapabilities,fallback:SlimCore.Enums.Capability.All},contentRole:{propKey:SlimCore.Enums.Property.ParticipantContentRole,fallback:SlimCore.Enums.ContentSharingRole.None},status:{propKey:SlimCore.Enums.Property.ParticipantStatus},failure:{propKey:SlimCore.Enums.Property.ParticipantFailureReason},maskedIdSeqNumber:{propKey:SlimCore.Enums.Property.ParticipantMaskedIdentitySequenceNumber},isIdentityMasked:{propKey:SlimCore.Enums.Property.ParticipantIsIdentityMasked},participantVersion:{propKey:SlimCore.Enums.Property.ParticipantRosterVersion}}}};var C=function(e){function n(t,r,i,o,a,s,c,l,d,h,f){var m;void 0===l&&(l=0);var _=e.call(this,r.createChild((function(){return"ICallParticipant[".concat(g.scrubMriOrOmit(_.id),"][").concat(_.state,"][").concat(_.slimcoreObjectId,"]")})),i,o,f)||this;return _._parentLogger=r,_._callHandler=s,_._streamContextMap=c,_._callTelemetry=d,_._participantIdMapperFactory=h,_.streams=((m={})[0]=[],m[1]=[],m[2]=[],m),_.voiceLevel=0,_.isServerMuted=!1,_.dominantSpeakerRank=0,_.state=0,_.id=null,_.role=null,_.tenantId=null,_.balanceUpdates={},_._shouldRaiseChange=!1,_._raiseChangeDeferRunner=u.GlobalDeferHandler.instance.createDeferRunner("CallParticipant.raiseChange"),_._disableActiveSpeakerLogging=!1,_.id=(0,p.stripMriAliases)(a),_._logger.info("constructor causeId: ".concat(t)),_.participantCapabilities=n.convertCapabilities(SlimCore.Enums.Capability.All),l&&0!==l&&_.attachSlimcoreObjectId(l,t,!1),u.GlobalDeferHandler.instance.runDeferredWithoutDedup((function(){_._logger.info("Setting participant to raise changes"),_._shouldRaiseChange=!0}),"CallParticipant.constructed"),_}return o(n,e),Object.defineProperty(n.prototype,"disableActiveSpeakerLogging",{set:function(e){this._disableActiveSpeakerLogging=e},enumerable:!1,configurable:!0}),n.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,slimcoreObjectId:this.slimcoreObjectId,state:this.state,isServerMuted:this.isServerMuted})},n.prototype.attachSlimcoreObjectId=function(e,t,n){var r=this;void 0===n&&(n=!0),this.slimcoreObjectId&&0!==this.slimcoreObjectId?this._logger.debug("Attach called on existing participant"):(this.slimcoreObjectId=e,this._slimCoreElectronRemoteStreamManager=new v.default(t,this._parentLogger,this._logger,this._settings,this._slimcoreInstance,this._callHandler,this.slimcoreObjectId,this.streams,this._streamContextMap,this._participantIdMapperFactory),this._slimCoreElectronRemoteStreamManager.changed((function(){return r.raiseChanged()})),this._setupListeners(),n&&(this._logger.debug("Updating data from attachSlimcoreObjectId method"),this.updateParticipantData(t)))},n.prototype._setupListeners=function(){var e=this;this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantStatus,(function(t){e._onStatusChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantIsServerMuted,(function(t){e._onIsServerMuted(!!t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantFailureReason,(function(t){e._onFailureReasonChange(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantAdmitFailureReason,(function(t){e._onAdmitFailureReasonChange(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantRemoveFailureReason,(function(t){e._onRemoveFailureReasonChange(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantIsActiveSpeaker,(function(t){e.setVoiceLevel(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantDominantSpeakerRank,(function(t){e._onDominantSpeakerRankChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantEndpointDetails,(function(t){e._updateEndpointDetails(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantCapabilities,(function(t){e._onCapabilitiesChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantAcceptedBy,(function(t){e._onAcceptedByChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantRole,(function(t){e._onRoleChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantTenantId,(function(t){e._onTenantIdChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantContentRole,(function(t){e._onParticipantContentSharingRoleChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantBalanceUpdate,(function(t){e._onBalanceUpdateChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantDiagnosticsCode,(function(t){e.onParticipantDiagnosticsCodeChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantMeetingRole,(function(t){e._onMeetingRoleChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantAdvancedMeetingRole,(function(t){e._onAdvancedMeetingRoleChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantParticipantType,(function(t){e._onParticipantTypeChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantMriIdentity,(function(t){e._onMriChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantDisplayName,(function(t){e._onDisplayNameChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantIsIdentityMasked,(function(t){return e._onIsIdentityMaskedChanged(!!t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantNonMaskedDisplayName,(function(t){return e._onNonMaskedDisplayNameChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantNonMaskedIdentity,(function(t){return e._onNonMaskedIdChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantNonMaskedObjectIdentity,(function(t){return e._onNonMaskedObjectIdChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantMaskedIdentitySequenceNumber,(function(t){return e._onMaskedIdSeqNumberChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantPropertyBag,(function(t){return e._onParticipantPropertyBagChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantRosterVersion,(function(t){return e._onParticipantVersionChanged(t.value)})),this._onParticipantPropertyChanged(SlimCore.Enums.Property.ParticipantVideoCountChanged,(function(){return e._slimCoreElectronRemoteStreamManager.onVideoCountChanged()}))},n.prototype.updateParticipantData=function(e,r){var i=this,o=(null==r?void 0:r.objectId)&&r.props||function(){var e=(0,t.getParticipantProps)(),n=e.strProps,r=e.intProps;return i._getProperties(i.slimcoreObjectId,n,r)}();this.displayName=o.displayName,this.role=o.role,this.tenantId=o.tenantId,this.participantCapabilities=n.convertCapabilities(o.capabilities),this.acceptedBy=o.acceptedBy,this.isServerMuted=!!o.isServerMuted,this.meetingRole=o.meetingRole,this.advancedMeetingRole=o.advancedMeetingRole,this.participantType=o.participantType,this.isIdentityMasked=!!o.isIdentityMasked,this.nonMaskedId=o.nonMaskedId,this.nonMaskedDisplayName=o.nonMaskedDisplayName,this.nonMaskedObjectId=o.nonMaskedObjectId,this.maskedIdSeqNumber=o.maskedIdSeqNumber,this.version=o.participantVersion,this._updatePropertyBag(o.participantPropertyBag),this._updateEndpointDetails(o.endpointDetails),this._onStatusChanged(o.status,!1,o.failure),this._onParticipantContentSharingRoleChanged(o.contentRole),(null==r?void 0:r.videoProps)?this._slimCoreElectronRemoteStreamManager.updateVideos(e,r.videoProps):this._slimCoreElectronRemoteStreamManager.onVideoCountChanged()},n.prototype._onParticipantPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimcoreObjectId,e,t)},n.prototype._onCapabilitiesChanged=function(e){var t=n.convertCapabilities(e);t!==this.participantCapabilities&&(this._logger.info("Computed capabilities: ".concat(JSON.stringify(t))),this.participantCapabilities=t,this.raiseChangedDeferred())},n.prototype._onAcceptedByChanged=function(e){e!==this.acceptedBy&&(this._logger.info("Accepted by is set to ".concat(g.scrubMriOrOmit(e))),this.acceptedBy=e,this.raiseChanged())},n.prototype._onRoleChanged=function(e){e!==this.role&&(this._logger.info("Role is set to ".concat(e)),this.role=e,this.raiseChanged())},n.prototype._onTenantIdChanged=function(e){e!==this.tenantId&&(this._logger.info("TenantId is set to ".concat(e)),this.tenantId=e,this.raiseChanged())},n.prototype._onMeetingRoleChanged=function(e){e!==this.meetingRole&&(this._logger.info("_onMeetingRoleChanged meetingRole: ".concat(e)),this.meetingRole=e,this.raiseChanged())},n.prototype._onAdvancedMeetingRoleChanged=function(e){e!==this.advancedMeetingRole&&(this._logger.info("_onAdvancedMeetingRoleChanged advancedMeetingRole: ".concat(e)),this.advancedMeetingRole=e,this.raiseChanged())},n.prototype._onParticipantTypeChanged=function(e){e!==this.participantType&&(this._logger.info("_onParticipantTypeChanged participantType: ".concat(e)),this.participantType=e,this.raiseChanged())},n.prototype._onMriChanged=function(e){e!==this.id&&(this._logger.info("_onMriChanged from old mri ".concat(g.scrubMriOrOmit(this.id)," to new Mri: ").concat(g.scrubMriOrOmit(e))),this.previousId=this.id,this.id=e,this.raiseChanged())},n.prototype._onDisplayNameChanged=function(e){e!==this.displayName&&(this._logger.info("_onDisplayNameChanged new displayName: ".concat(g.scrubMriOrOmit(e))),this.displayName=e,this.raiseChanged())},n.prototype._onIsIdentityMaskedChanged=function(e){e!==this.isIdentityMasked&&(this._logger.info("_onIsIdentityMaskedChanged new isIdentityMasked: ".concat(e)),this.isIdentityMasked=e,this.raiseChangedDeferred())},n.prototype._onNonMaskedIdChanged=function(e){e!==this.nonMaskedId&&(this._logger.info("_onNonMaskedIdChanged new nonMaskedId: ".concat(g.scrubMriOrOmit(e))),this.nonMaskedId=e,this.raiseChangedDeferred())},n.prototype._onNonMaskedDisplayNameChanged=function(e){e!==this.nonMaskedDisplayName&&(this._logger.info("_onNonMaskedDisplayNameChanged new nonMaskedDisplayName: ".concat(g.scrubMriOrOmit(e))),this.nonMaskedDisplayName=e,this.raiseChangedDeferred())},n.prototype._onNonMaskedObjectIdChanged=function(e){e!==this.nonMaskedObjectId&&(this._logger.info("_onNonMaskedObjectIdChanged new nonMaskedObjectId: ".concat(g.scrubMriOrOmit(e))),this.nonMaskedObjectId=e,this.raiseChangedDeferred())},n.prototype._onMaskedIdSeqNumberChanged=function(e){e!==this.maskedIdSeqNumber&&(this._logger.info("_onMaskedIdSeqNumberChanged new maskedIdSeqNumber: ".concat(e)),this.maskedIdSeqNumber=e,this.raiseChangedDeferred())},n.prototype._onParticipantPropertyBagChanged=function(e){if(e)try{var t=JSON.parse(e);a.isEqual(t,this.propertyBag)||(this._logger.info("_onParticipantPropertyBagChanged new propertyBag"),this.propertyBag=t,this.raiseChangedDeferred())}catch(e){return void this._logger.warn("Failed to parse property bag ".concat(e))}},n.prototype._onParticipantVersionChanged=function(e){e!==this.version&&(this._logger.info("_onParticipantVersionChanged new participantVersion: ".concat(e)),this.version=e,this.raiseChangedDeferred())},n.prototype.raiseChangedDeferred=function(){var e=this;this._shouldRaiseChange&&this._raiseChangeDeferRunner((function(){e.raiseChanged()}))},n.prototype.raiseChanged=function(){this._shouldRaiseChange&&e.prototype.raiseChanged.call(this)},n.prototype.getParticipantIdForSourceId=function(e,t){var n=h.getParticipantIdForSourceId(this,e,t);return n||this._logger.warn("participantId is ".concat(n," for mediaType: ").concat(e,", sourceId: ").concat(t)),n},n.prototype.hasSourceId=function(e,t){return void 0!==h.getParticipantIdForSourceId(this,e,t)},n.prototype.getSourceIdForMediaType=function(e){var t=h.getSourceIdForMediaType(this,e);return-1===t&&this._logger.warn("getSourceIdForMediaType failed"),t},n.prototype.getSourceId=function(e,t){if(!this.endpoints)return this._logger.warn("endpoints is invalid"),-1;try{var n=a.find(this.endpoints.endpointDetails,(function(t){return null!==t&&t.participantId===e}));if(!n)return this._logger.warn("participantId not found: ".concat(e)),this.getSourceIdForMediaType(t);if(!n.mediaStreams)return this._logger.warn("participantLeg ".concat(e," does not have valid mediaStreams")),this.getSourceIdForMediaType(t);var r=a.find(n.mediaStreams,(function(e){return d.mapMediaTypeStringToMediaType(e.type)===t}));return r?r.sourceId:(this._logger.warn("participantLeg ".concat(e," has no channel of type ").concat(t)),-1)}catch(e){this._logger.error("getSourceId caught exception error=".concat(e))}return-1},n.prototype.getSharingParticipantLeg=function(){var e=h.getSharingParticipantLeg(this);return e||this._logger.warn("getSharingParticipantLeg could not find sharer participantId"),e},n.getEndpointDetailsLogString=function(e){if(!(null==e?void 0:e.endpointDetails))return"";var t=[];return e.endpointDetails.forEach((function(e){t.push({participantId:e.participantId,endpointId:e.endpointId,clientVersion:e.clientVersion,mediaStreams:e.mediaStreams})})),JSON.stringify(t)},n.prototype._updatePropertyBag=function(e){if(e)try{this.propertyBag=JSON.parse(e)}catch(e){return void this._logger.warn("Failed to parse property bag, _updatePropertyBag:- ".concat(e))}},n.prototype._updateEndpointDetails=function(e){if(this._logger.log("[_updateEndpointDetails] rawEndpointDetails ".concat(e)),this._rawEndpoints!==e&&e){try{this.endpoints=JSON.parse(e),this._rawEndpoints=e,this._logger.info("Updating endpointDetails: ".concat(n.getEndpointDetailsLogString(this.endpoints)))}catch(t){return void this._logger.warn("Failed to parse call member endpointDetails - ".concat(t," -").concat(e))}this.raiseChanged()}},n.prototype._onStatusChanged=function(e,t,r){var i=this;void 0===t&&(t=!0);var o=(0,l.generateCauseId)(),a=n.convertParticipantStatus(e);if(this._logger.info("[".concat(o,"]Status changed ").concat(e," (").concat(SlimCore.Enums.CallStatus[e],") participantState=").concat(a)),void 0!==a){var s=y.convertStatusAndFailureReasonToParticipantReason(e,(function(){var e=i._getProperties(i.slimcoreObjectId,{},{participantFailureReason:{propKey:SlimCore.Enums.Property.ParticipantFailureReason}}).participantFailureReason;return null!=r?r:e}));this.setState(a,o,s,t),this._admitParticipantDeffered&&n.isParticipantActive(this.state)&&(this._admitParticipantDeffered.resolve(),this._admitParticipantDeffered=null),this._removeParticipantDeffered&&!n.isParticipantActive(this.state)&&(this._removeParticipantDeffered.resolve(),this._removeParticipantDeffered=null)}else this._logger.warn("Unrecognized ".concat(a))},n.prototype._onParticipantContentSharingRoleChanged=function(e){this._logger.log("Content sharing role changed ".concat(e," (").concat(SlimCore.Enums.ContentSharingRole[e],")")),this.setContentSharingRole(n.convertContentSharingRole(e))},n.prototype._onFailureReasonChange=function(e){var t=(0,l.generateCauseId)();this._logger.info("[".concat(t,"]Failure reason changed ").concat(e," (").concat(SlimCore.Enums.ParticipantFailureReason[e],")"));var r=this._getProperties(this.slimcoreObjectId,{},{participantStatus:{propKey:SlimCore.Enums.Property.ParticipantStatus}}).participantStatus;this.setState(n.convertParticipantStatus(r),t,y.convertFailureReasonToParticipantReason(e))},n.prototype._onAdmitFailureReasonChange=function(e){var t=f.hasFeature(SlimCore.Enums.Feature.AsyncAdmitResponse);this._logger.info("Admit failure reason changed ".concat(e," (").concat(SlimCore.Enums.ParticipantFailureReason[e],") asyncAdmitResponse=").concat(t));var n=y.convertFailureReasonToParticipantReason(e);t?e!==SlimCore.Enums.ParticipantFailureReason.NoFailure?this.rejectAdmitParticipantDeferred(n):this.resolveAdmitParticipantDeferred():e!==SlimCore.Enums.ParticipantFailureReason.NoFailure&&this.rejectAdmitParticipantDeferred(n)},n.prototype._onRemoveFailureReasonChange=function(e){if(this._logger.info("Remove failure reason changed ".concat(e," (").concat(SlimCore.Enums.ParticipantFailureReason[e],")")),e!==SlimCore.Enums.ParticipantFailureReason.NoFailure){var t=y.convertFailureReasonToParticipantReason(e);this.rejectRemoveParticipantDeferred(t)}},n.prototype.setVoiceLevel=function(e){this.voiceLevel!==e&&(this.voiceLevel=e,this._disableActiveSpeakerLogging||this._logger.info("setVoiceLevel ".concat(e)),this.raiseChanged())},n.prototype._onIsServerMuted=function(e){this._logger.info("current isServerMuted is: ".concat(this.isServerMuted,", new value is: ").concat(e," ")),e!==this.isServerMuted&&(this.isServerMuted=e,this.raiseChanged())},n.prototype._onDominantSpeakerRankChanged=function(e){this.dominantSpeakerRank!==e&&(this._logger.info("DominantSpeakerRank changing from ".concat(this.dominantSpeakerRank," to ").concat(e)),this.dominantSpeakerRank=e,this.raiseChanged())},n.prototype._onBalanceUpdateChanged=function(e){if(a.isEmpty(e))a.isEmpty(this.balanceUpdates)||(this.balanceUpdates={},this.raiseChanged());else{try{var t=JSON.parse(e);if(a.isEqual(this.balanceUpdates[t.sender.endpointId],t))return;this.balanceUpdates[t.sender.endpointId]=t}catch(t){return void this._logger.warn("Failed to parse call member balanceUpdate - ".concat(t," -").concat(e))}this.raiseChanged()}},n.prototype.onParticipantDiagnosticsCodeChanged=function(e){this._logger.info("onParticipantDiagnosticsCodeChanged diagnosticsCode: ".concat(e)),this._updateDiagnosticsCode(e)},n.prototype._updateDiagnosticsCode=function(e){if(this._rawCallEndDiagnosticsInfo!==e&&e)try{this.callEndDiagnosticsInfo=JSON.parse(e),this._rawCallEndDiagnosticsInfo=e,this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: ".concat(t,", diagnosticsCode: ").concat(e))}},n.prototype.setContentSharingRole=function(e){this.contentSharingRole!==e&&(this.contentSharingRole=e,this.raiseChangedDeferred())},n.prototype.setState=function(e,t,n,r){if(void 0===r&&(r=!0),this.state!==e){var i=S[this.state].indexOf(e)>=0,o={state:this.state,reason:this.stateReason,endpoints:[]};if(this.endpoints&&this.endpoints.endpointDetails&&this.endpoints.endpointDetails.length&&(o.endpoints=(0,c.getEndpointInformationForTelemetry)(this.endpoints.endpointDetails)),!i)return this._logger.logFailure("Invalid state transition ".concat(this.state,"->").concat(e," attempted")),void this._callTelemetry.recordEvent(s.PARTICIPANT_OPERATIONS_INTERNAL.SET_PARTICIPANT_STATE_INVALID,o,t);if(this._logger.log("state=".concat(this.state,"->").concat(e," reason=").concat(this.stateReason,"->").concat(n)),this.state=e,this.stateReason=n,3===this.state&&r){var a=this._getProperties(this.slimcoreObjectId,{endpointDetails:{propKey:SlimCore.Enums.Property.ParticipantEndpointDetails}},{}).endpointDetails;this._updateEndpointDetails(a)}else if(4===this.state){var l=this._getProperties(this.slimcoreObjectId,{diagnostics:{propKey:SlimCore.Enums.Property.ParticipantDiagnosticsCode}},{}).diagnostics;this._updateDiagnosticsCode(l)}this.raiseChangedDeferred()}},n.convertParticipantStatus=function(e){return _.default.isCallRinging(e)?2:_.default.isCallTerminated(e)?4:_.default.isCallConnected(e)?3:_.default.isCallConnecting(e)?1:_.default.isCallEarlyMedia(e)?6:_.default.isCallInLobby(e)?7:_.default.isCallStaging(e)?8:e===SlimCore.Enums.CallStatus.LocalHold||e===SlimCore.Enums.CallStatus.RemoteHold?5:void 0},n.isParticipantActive=function(e){switch(e){case 3:case 6:case 5:case 8:return!0;default:return!1}},n.convertContentSharingRole=function(e){switch(e){case SlimCore.Enums.ContentSharingRole.Attendee:return 1;case SlimCore.Enums.ContentSharingRole.Presenter:return 2;default:return 0}},n.convertCapabilities=function(e){return{canConference:!!(e&SlimCore.Enums.Capability.Conference),canShareScreen:!!(e&SlimCore.Enums.Capability.ShareScreen),canMerge:!!(e&SlimCore.Enums.Capability.Merge)}},n.prototype.addAdmitParticipantDeferred=function(e){this._admitParticipantDeffered=e},n.prototype.rejectAdmitParticipantDeferred=function(e){this._admitParticipantDeffered&&(this._admitParticipantDeffered.reject(e),this._admitParticipantDeffered=null)},n.prototype.resolveAdmitParticipantDeferred=function(){this._admitParticipantDeffered&&(this._admitParticipantDeffered.resolve(),this._admitParticipantDeffered=null)},n.prototype.addRemoveParticipantDeferred=function(e){this._removeParticipantDeffered=e},n.prototype.rejectRemoveParticipantDeferred=function(e){this._removeParticipantDeffered&&(this._removeParticipantDeffered.reject(e),this._removeParticipantDeffered=null)},n.prototype.stopVideos=function(e){return this._slimCoreElectronRemoteStreamManager?this._slimCoreElectronRemoteStreamManager.stopVideos(e):Promise.resolve()},n.prototype.enableRaisingChange=function(){this._shouldRaiseChange=!0},n.prototype.dispose=function(t){void 0===t&&(t=(0,l.generateCauseId)()),this._slimCoreElectronRemoteStreamManager&&this._slimCoreElectronRemoteStreamManager.dispose(t),this.streams[0]=[],this.streams[1]=[],this.streams[2]=[],this.resolveAdmitParticipantDeferred(),this._removeParticipantDeffered&&(this._removeParticipantDeffered.resolve(),this._removeParticipantDeffered=null),this.slimcoreObjectId=0,e.prototype.dispose.call(this,t)},n}(m.default);t.default=C},4893:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(6773),d=n(5442),p=n(6136),h=n(4545),g=n(3607),f=n(5773),m=n(1775),_=n(8994),y=n(9637),v=n(2238),S=n(7180),C=n(7443),E=n(605),T=n(8596),I=n(891),P=n(961),O=n(7584),b=n(4487),A=n(5025),R=n(2559),w=n(7277),D=n(5005),L=n(8067),N=0,M=function(e){function t(t,n,r,i,o,a,s,c,l){var u=e.call(this,new A.default(t).createChild("CallRegistry/".concat(N++%10)),n,r,l)||this;return u._deviceManager=i,u._appHooks=o,u._telemetryLoggers=a,u._skypeIdentity=s,u._globalSetup=c,u.calls=[],u.isDisposing=!1,u._loginPromiseDefered=new d.Deferred,u._logoutPromiseDefered=new d.Deferred,u._startSlimcorePromiseDefered=new d.Deferred,u._disposedPromise=new d.Deferred,u._disconnectingPromiseDefers=new Map,u.slimcoreInstanceStartCalled=!1,u._accountStatusCallback=null,u._accountConfig=null,u._accountCallBackRegistered=!1,u._enableActiveCallsProperty=!1,u._slimECSinit=new d.Deferred,u._logger.info("constructor"),u._slimcoreInstance.setMaxListeners(0),u._ecsProvider=new S.default(u._slimcoreInstance,u._logger.createChild("SlimCoreElectronEcsProvider")),u._ecs=u._ecsProvider.getEcsConfiguration(null==s?void 0:s.id),u._enableActiveCallsProperty=u._ecs.getBoolean("SkypeCalling","enableActiveCallsProperty",!1),u._telemetryManager=new T.TelemetryManager(u._logger.createChild("OneDSTelemetry")),s&&(u.identity=s.id,u._setup=new E.default(u._slimcoreInstance,u.identity)),u._setupRegistryTelemetry(),u._callOperationHandler=new L.default(u._logger,u._registryTelemetry,{},(function(e){u._publishTelemetry(e)})),u}return i(t,e),t.prototype._setupRegistryTelemetry=function(){this._registryTelemetry=new P.CallRegistryTelemetry(this._logger,(new Date).getTime())},t.prototype._publishTelemetry=function(e){var t;if(null===(t=this._telemetryLoggers)||void 0===t?void 0:t.signaling){this._registryTelemetry.setSkypeId(this.identity);try{this._registryTelemetry.setEndpointId(this._slimcoreInstance.getRegistrationId(this.identity))}catch(e){this._logger.warn("Could not get end point ID from slimcore for call registry telemetry.")}this._accountConfig&&(this._registryTelemetry.setAcsResourceId(this._accountConfig.acsResourceId),this._registryTelemetry.setApplicationType(this._accountConfig.applicationType),this._registryTelemetry.setPartition(this._accountConfig.partition),this._registryTelemetry.setRegion(this._accountConfig.region),this._registryTelemetry.setRing(this._accountConfig.ring),this._registryTelemetry.setTenantId(this._accountConfig.tenantId),this._registryTelemetry.setUserHexCID(this._accountConfig.userHexCID),this._registryTelemetry.setClientType(this._accountConfig.clientType));var n=I.TELEMETRY_EVENT_NAMES.REGISTRY_NATIVE;this._telemetryLoggers.signaling.sendEvent({eventName:n,props:this._registryTelemetry.getEvent(null,e)})}},t.prototype.dispose=function(t){var n;return void 0===t&&(t=(0,O.generateCauseId)()),c(this,void 0,void 0,(function(){var r,i,o,a,s=this;return l(this,(function(c){return(r=this._logger.createFnLogger("dispose",t)).info("disposing call registry"),this.isDisposing?(r.warn("call registry is already in disposing stage!"),[2,this._disposedPromise.promise]):(this.isDisposing=!0,null===(n=this._ecsClient)||void 0===n||n.dispose(),i=function(){s.calls=[],s._slimcoreCallHandler&&(s._slimcoreCallHandler.dispose(),s._slimcoreCallHandler=void 0),r.info("callhandler is disposed"),s._account&&(s._account.dispose(),s._account=void 0),r.info("account is disposed"),s.event("disposed").raise(),e.prototype.dispose.call(s,t),s._disposedPromise.resolve()},o=this.calls.map((function(e){return e.stop()})),a=function(){return s.logout(t)},Promise.all(o).then(a,a).then(i,i),[2,this._disposedPromise.promise])}))}))},Object.defineProperty(t.prototype,"loginPromise",{get:function(){return this._loginPromiseDefered.promise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposePromise",{get:function(){return this._disposedPromise.promise},enumerable:!1,configurable:!0}),t.prototype._initCall=function(e,t,n){this._logger.createFnLogger("initCall[callId=".concat(e.callId,"][participantId=").concat(e.participantId,"]"),n).info("callObjectId=".concat(t)),e.incomingCallInit(t,n)},t.prototype._incomingCallMonitor=function(e,t){var n=this._logger.createFnLogger("incomingCallMonitor",t);n.info("_incomingCallMonitor for objectPropertyChange objectId=".concat(e.objectId));var r=this._getProperties(e.objectId,{callId:{propKey:SlimCore.Enums.Property.CallName},userId:{propKey:SlimCore.Enums.Property.CallAccountIdentity},localParticipantId:{propKey:SlimCore.Enums.Property.CallLegId}},{}),i=r.callId,o=r.userId,a=r.localParticipantId;f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)&&o!==this.identity?n.info("incoming call(".concat(i,") for user(").concat(g.mriOrId(o),") but current user is ").concat(g.mriOrId(this.identity))):this._getCall(i,a,t)||n.logFailure("getCall failed to find the call(callId: ".concat(i,", localParticipantId: ").concat(a,")"))},t.prototype.init=function(e,t,n){var r,i=this;void 0===t&&(t={block:!0}),void 0===n&&(n=(0,O.generateCauseId)());var o=this._logger.createFnLogger("init",n);return o.info("init"),t.block||f.hasFeature(SlimCore.Enums.Feature.AsyncStart)||(t.block=!0),this.slimcoreInstanceStartCalled?o.info("skipping slimcoreInstance start, because it was already started"):(t.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},(function(e){i._onLibStatusChanged(e)}))),null===(r=this._globalSetup)||void 0===r||r.setString("*Lib/SCT/Telemetry/DiagnosticLevel",t.telemetryDiagnosticLevel||""),this._slimcoreInstance.start(t.block),o.info("starting slimcoreInstance block=".concat(t.block)),this.slimcoreInstanceStartCalled=!0,t.block&&(this.libStatus=SlimCore.Enums.LibStatus.Running,this._startSlimcorePromiseDefered.resolve())),this._skypeIdentity=e,this.identity=e.id,this._skypeIdentity.tokenProvider().then((function(e){o.info("setting up stack callbacks");var t=i._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.Account,propKey:SlimCore.Enums.Property.AccountStatus,value:SlimCore.Enums.AccountStatus.LoggedIn},(function(){i._slimcoreCallHandler=i._slimcoreInstance.createCallInterface(),o.info("createCallInterface returned"),i._loginPromiseDefered.resolve(),t&&(t.dispose(),t=null),i._hookCallRegistryEvents()}));i._registerDisposable(i._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.Call,propKey:SlimCore.Enums.Property.CallStatus,value:SlimCore.Enums.CallStatus.RingingIn},(function(e){i._incomingCallMonitor(e,n)}))),i._initializeSlimCore(e),i._logger.info("initialize returned")})).catch((function(e){o.logFailure(e),i._loginPromiseDefered.reject(e)})),this.loginPromise.then(p.noop)},t.prototype.uninit=function(){var e=this;this.slimcoreInstanceStartCalled?this.libStatus!==SlimCore.Enums.LibStatus.Running&&(this._startSlimcorePromiseDefered.reject(new Error("Callregistry uninit called before slimcore reached Running state")),this._logoutPromiseDefered.reject(new Error("Callregistry uninit called before slimcore reached Running state"))):this._logoutPromiseDefered.reject(new Error("CallRegistry uninit called without slimcore::start()"));try{this._logger.info("uninit: setting up stack callbacks");var t=this._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.Account,propKey:SlimCore.Enums.Property.AccountStatus,value:SlimCore.Enums.AccountStatus.LoggedOut},(function(){e._logoutPromiseDefered.resolve(),t&&(t.dispose(),t=null)}));this._logger.info("uninit(): calling slimcore.logout()"),this._slimcoreInstance.logout()}catch(e){this._logger.error("slimcore.logout() failed.",e),this._logoutPromiseDefered.reject(e)}return this.slimcoreInstanceStartCalled=!1,this._logoutPromiseDefered.promise.then(p.noop)},t.prototype.login=function(e,t){return void 0===t&&(t=(0,O.generateCauseId)()),this._logger.createFnLogger("login",t).info("login"),this._skypeIdentity=e,this.identity=e.id,this._setup=new E.default(this._slimcoreInstance,this.identity),this.initialize(t)},t.prototype.initialize=function(e,t){var n=this;void 0===e&&(e=(0,O.generateCauseId)());var r=this._logger.createFnLogger("initialize",e);return r.info("initialize"),this._accountConfig=t,this._tryInitSlimECS(),this._skypeIdentity.tokenProvider().then((function(i){return c(n,void 0,void 0,(function(){var n,o,a,s=this;return l(this,(function(c){switch(c.label){case 0:return r.info("setting up stack callbacks"),this._accountStatusCallback=this._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.Account,propKey:SlimCore.Enums.Property.AccountStatus,value:SlimCore.Enums.AccountStatus.LoggedIn},(function(t){var n=t.objectId;if(f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)){var i=s._account.getObjectId();if(i!==n)return void r.error("accountObjectId: ".concat(i," does not match with ").concat(n))}r.info("account status changes to logged in"),s._handleLoggedIn(n,e)})),this._telemetryManager.initialize(this._ecs,null!==(a=null===(o=null===(n=this._accountConfig)||void 0===n?void 0:n.serviceUrls)||void 0===o?void 0:o.calling_pluginlessAriaCollectorUri)&&void 0!==a?a:""),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.Call,propKey:SlimCore.Enums.Property.CallStatus,value:SlimCore.Enums.CallStatus.RingingIn},(function(t){s._incomingCallMonitor(t,e)}))),[4,this._login(i,this._skypeIdentity.displayName,r,JSON.stringify(t))];case 1:return c.sent(),[2]}}))}))})).catch((function(e){r.logFailure(e),n._loginPromiseDefered.reject(e)})),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.Call,propKey:SlimCore.Enums.Property.CallStatus},(function(t){n._disconnectedCallMonitor(t,e)}))),this.loginPromise.then((function(){return n.setAdditionalIdentities()}))},Object.defineProperty(t.prototype,"isSlimECSinitialized",{get:function(){return this._slimECSinit.promise},enumerable:!1,configurable:!0}),t.prototype._tryInitSlimECS=function(){return c(this,void 0,void 0,(function(){var e,t,n,r;return l(this,(function(i){switch(i.label){case 0:return e=this.getSetup(),"*Lib/ECS/ClientType",t=2,[4,e.getNumber("*Lib/ECS/ClientType")];case 1:return i.sent()===t?[3,2]:(this._logger.warn("ecs client disabled"),this._slimECSinit.resolve(!1),[3,6]);case 2:this._ecsClient=new v.SlimCoreElectronEcsClient(this._slimcoreInstance,this._logger.createChild("EcsClient")),n=new C.SlimCoreElectronEcsConfigurationLocal(this._logger.createChild("SlimCoreElectronEcsConfigurationLocal"),this._skypeIdentity.id),i.label=3;case 3:return i.trys.push([3,5,,6]),[4,this._ecsClient.init(this._skypeIdentity.id,e,n,this._accountConfig)];case 4:return i.sent(),this._ecs=n,this._slimECSinit.resolve(!0),[3,6];case 5:return r=i.sent(),this._logger.error("ECS client intialization error: ".concat(r)),[3,6];case 6:return[2]}}))}))},t.prototype._handleLoggedIn=function(e,t){var n=this._logger.createFnLogger("_handleLoggedIn",t);this._slimcoreCallHandler?n.info("call handler already exists"):(this._slimcoreCallHandler=this._createCallHandler(e),n.info("callhandler created successfully"),this._loginPromiseDefered.resolve(),n.info("user logged in successfully"),this._hookCallRegistryEvents()),this._accountStatusCallback&&(this._accountStatusCallback.dispose(),this._accountStatusCallback=null)},t.prototype._login=function(e,t,n,r){return c(this,void 0,void 0,(function(){var i,o,a=this;return l(this,(function(s){switch(s.label){case 0:return f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)?this._account?(n.info("already logged in. updating displayname and skypetoken!"),this._account.updateDisplayName(t),this._account.updateSkypeToken(e),[2]):(this._account=this._slimcoreInstance.getAccount(this.identity),this._accountCallBackRegistered||(this._registerDisposable(this._account.handle("skype-token-required",void 0,(function(e){a._onSkypeTokenRequired(e)}))),this._registerDisposable(this._account.handle("token-required",void 0,(function(e){a._onTokenRequired(e)}))),this._accountCallBackRegistered=!0),[4,this._account.login(e,t,f.mapToEmptyStrIfFalsy(r))]):[3,2];case 1:return s.sent(),i=this._account.getObjectId(),o=this._getProperties(i,{},{accountStatus:{propKey:SlimCore.Enums.Property.AccountStatus}}).accountStatus,o===SlimCore.Enums.AccountStatus.LoggedIn&&(n.info("check the account status after login. user account status is already logged in"),this._handleLoggedIn(i,void 0)),[3,3];case 2:this._slimcoreInstance.login(this.identity,e,t),s.label=3;case 3:return[2]}}))}))},t.prototype._createCallHandler=function(e){return f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)?this._slimcoreInstance.getCallHandler(e):this._slimcoreInstance.createCallInterface()},t.prototype.logout=function(e){var t=this;void 0===e&&(e=(0,O.generateCauseId)());var n=this._logger.createFnLogger("logout",e);n.info("logout");try{n.info("setting up stack callbacks");var r=this._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.Account,propKey:SlimCore.Enums.Property.AccountStatus,value:SlimCore.Enums.AccountStatus.LoggedOut},(function(e){var i=e.objectId;if(f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)){var o=t._account.getObjectId();if(o!==i)return void n.error("accountObjectId: ".concat(o," does not match with ").concat(i))}t._logoutPromiseDefered.resolve(),r&&(r.dispose(),r=null)}));n.info("calling slimcore.logout()"),this._logout()}catch(e){n.error("slimcore.logout() failed.",e),this._logoutPromiseDefered.reject(e)}return this._logoutPromiseDefered.promise.then(p.noop)},t.prototype._logout=function(){f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)?this._account.logout():this._slimcoreInstance.logout()},t.prototype.setConfiguration=function(e){var t=this;return Promise.resolve().then((function(){var n;if(f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)&&t._account&&t._account.setConfiguration){var r=JSON.stringify(e);t._logger.info("setConfiguration:".concat(r)),t._account.setConfiguration(r),t._accountConfig=e,null===(n=t._ecsClient)||void 0===n||n.updateQueryParameters(t._accountConfig)}}))},t.prototype.updateDisplayName=function(e){var t=this;return Promise.resolve().then((function(){return f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)&&t._account?t._account.updateDisplayName(e):t._skypeIdentity.tokenProvider().then((function(n){return t._login(n,e,t._logger)}))}))},t.prototype.updateSkypeToken=function(e){f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)&&this._account?(this._logger.info("account.updateSkypeToken"),this._account.updateSkypeToken(e)):(this._logger.info("slimcoreInstance.updateSkypeToken"),this._slimcoreInstance.updateSkypeToken(e))},t.prototype.updateToken=function(e,t,n,r,i){var o=this,a=this._logger.createFnLogger("updateToken",r);return Promise.resolve().then((function(){return f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)&&o._account?(o._account.updateToken(e,JSON.stringify(t),n||"",r,i||0),(0,b.getSuccessTransactionEnd)()):(a.info("Invalid, update token require MTMA, and account should be logged in"),Promise.reject((0,b.getRejectTransactionEnd)("Invalid, update token require MTMA, and account should be logged in")))}))},t.prototype.fireIntent=function(e,t){var n=this;return Promise.resolve().then((function(){f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)&&n._slimcoreInstance.fireIntent(SlimCore.Enums.Intent.CallPush,t,void 0,n.identity)}))},t.prototype.getCallState=function(e,t){var n=this,r=this._logger.createFnLogger("getCallState",t);if(null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler){r.logFailure("Stack not initialized yet");var i={code:I.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:I.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:I.TRANSACTION_END_PHRASE.STACK_NOT_INTIALIZED};return Promise.reject(i)}if(!e.context||!e.context.conversationUrl){i={code:I.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:I.TRANSACTION_END_SUBCODE.INVALID_ARGUMENT,phrase:"ConversationId and conversationUrl are needed"};return Promise.reject(i)}var o=this._callOperationHandler.waitForOperation(I.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE,t,t);return Promise.resolve().then((function(){n._slimcoreCallHandler.getCallState(t,JSON.stringify(e.context))})).catch((function(e){return Promise.reject((0,b.getRejectTransactionEnd)(e))})).then((function(){return o})).catch((function(e){return n._registryTelemetry.updateOperationData(I.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE,{error:(0,R.getPIISafeObject)(e)},t),r.logFailure(e),Promise.reject(e)}))},t.prototype._onCallHandlerOperationStatusChanged=function(e){if(this._logger.info("_onCallHandlerOperationStatusChanged args=".concat((0,R.getPIISafeObject)(e))),e.callHandlerOperationType===SlimCore.Enums.CallHandlerOperationType.GetCallState&&this._callOperationHandler.hasPendingOperationWithOperationId(I.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE,e.causeId)){var t={code:e.code,subCode:e.subCode,phrase:e.phrase,result:e.result};this._completeGetCallStateTransaction(I.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE,t,e.causeId,e.causeId,!0)}},t.prototype._completeGetCallStateTransaction=function(e,t,n,r,i){if(void 0===i&&(i=!1),this._logger.info("_completeGetCallStateTransaction[".concat(n,"][").concat(r,"]: operationName ").concat(e," transactionEnd ").concat(JSON.stringify(t,null,4))),this._registryTelemetry.updateOperationData(e,t,n,r),0===t.code&&0===t.subCode||i&&t.code>=200&&t.code<300)try{var o=t.result?JSON.parse(t.result):JSON.parse("{}");this._callOperationHandler.maybeResolveOperation(e,o,r,n)}catch(t){this._logger.error("_completeGetCallStateTransaction error parsing transaction result"),this._callOperationHandler.maybeRejectOperation(e,(0,b.getRejectTransactionEnd)(t,I.TRANSACTION_END_SUBCODE.CANNOT_PARSE_RESULT),r,n)}else this._callOperationHandler.maybeRejectOperation(e,t,r,n)},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsConfig=function(){return c(this,void 0,void 0,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return[4,this.isSlimECSinitialized];case 1:return e=t.sent(),this._logger.info("Returning ECS configuration reference with Slim ECS resolved as ".concat(e)),[2,this._ecs]}}))}))},t.prototype.createCallAsync=function(e){var t,n,r=this._logger.createFnLogger("createCallAsync",e.causeId),i="callId:".concat(e.callId,", localParticipantId: ").concat(g.scrubMriOrOmit(e.localParticipantId),", \n            causeId:").concat(e.causeId,", type:").concat(e.type,", ");switch(e.type){case"MeetingData":i.concat("meetingUrl:".concat(!!(null===(t=e.meetingData)||void 0===t?void 0:t.meetingUrl),", meetingCode:").concat(!!(null===(n=e.meetingData)||void 0===n?void 0:n.meetingCode)));break;case"GroupId":i.concat("groupId:".concat(g.scrubMriOrOmit(e.groupId)));break;case"ThreadId":i.concat("threadId:".concat(g.getLoggableThreadId(e.threadId),", messageId:").concat(e.messageId));break;default:throw new Error("Invalid type in passing parameter.")}r.info(i),this._createCallPreCheck(r);var o=this._getCurrentCall(e,r);if(o){if(6===o.state){var a=new d.Deferred;return this._disconnectingPromiseDefers.set(e,a),a.promise}return Promise.resolve(o)}return Promise.resolve(this._createNewCall(e))},t.prototype.createCallWithMeetingData=function(e,t,n,r){return this._createCall(r,t,n,null,null,null,e)},t.prototype.createCallWithGroupId=function(e,t,n,r){return this._createCall(r,t,n,e)},t.prototype.createCall=function(e,t,n,r,i){return void 0===i&&(i=(0,O.generateCauseId)()),this._createCall(i,t,n,void 0,e,r)},t.prototype._disconnectedCallMonitor=function(e,t){var n=this,r=this._ecs.getBoolean("SkypeCalling","createNewCallInDisconnectedState",!1),i=this._ecs.getBoolean("SkypeCalling","invokeDeleteCallInDisconnectedState",!1);if(e.value&&_.default.isCallTerminated(e.value)&&r){var o=this._logger.createFnLogger("_disconnectedCallMonitor",t);o.info("_disconnectedCallMonitor for objectPropertyChange objectType=".concat(e.objectType," objectId=").concat(e.objectId," propKey=").concat(e.propKey," value=").concat(e.value));var a=this._getProperties(e.objectId,{callId:{propKey:SlimCore.Enums.Property.CallName},userId:{propKey:SlimCore.Enums.Property.CallAccountIdentity}},{}),s=a.callId,c=a.userId;if(c===this.identity){var l=u.find(this.calls,(function(e){return e.callId===s}));l.isSubscribedPendingStart()?o.info("Subscribe failed, there is pending start/join operation, ignore create new call/delete call"):(this._disconnectingPromiseDefers.forEach((function(e,t){t.callId===s&&(n._disconnectingPromiseDefers.delete(t),e.resolve(n._createNewCall(t)))})),i&&setTimeout((function(){n.deleteCall(l,!0,t)}),0))}else o.info("incoming call(".concat(s,") for user(").concat(g.mriOrId(c),") but current user is ").concat(g.mriOrId(this.identity)))}},t.prototype._createNewCall=function(e){var t=null,n=null,r=null,i=null;switch(e.type){case"MeetingData":i=e.meetingData;break;case"GroupId":t=e.groupId;break;case"ThreadId":n=e.threadId,r=e.messageId}var o=new _.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this._ecs,this._deviceManager,this._appHooks,t,n,e.callId||(0,h.default)(),this._skypeIdentity,e.localParticipantId,this._telemetryLoggers,r,i,this._accountConfig,this._eventBus);return this.calls.push(o),this._telemetryManager.pauseLogger(),this.event("callAdded").raise(o),this.raiseChanged(),o},t.prototype._createCallPreCheck=function(e){var t,n,r=this;if(null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler)throw e.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");if(((null===(t=this._accountConfig)||void 0===t?void 0:t.clientSupportsGenericTokenAPI)||this._skypeIdentity.tokenProvider().then((function(t){t&&(e.info("Updating Skype Token..."),r.updateSkypeToken(t),e.info("Token update complete"))})),null===(n=this._accountConfig)||void 0===n?void 0:n.clientSupportsGenericTokenAPI)&&this._ecs.getBoolean("SkypeCalling","fetchTokensAtCallCreation",!1)){var i=this._ecs.getString("SkypeCalling","callingTokenLogicalUrl","https://calling.teams.microsoft.com"),o=this._ecs.getString("SkypeCalling","callingTokenLogicalVerb","POST"),a={path:i,verb:o},s='{"path":"https://calling.teams.microsoft.com","verb":"POST"}';try{s=JSON.stringify(a)}catch(t){e.info("Unable to parse factorsJsonObj logicalURL = ".concat(i,", verb = ").concat(o))}var c={factorsJson:s,requestMetadataJson:'{"authenticationHeaders":[""]}',tokenTypeAsBitmask:1,invalidToken:""};this._onTokenRequired(c);var l=1;this._ecs.getBoolean("SkypeCalling","callingServiceSupportsAADTokens",!1)&&(l|=4),this._ecs.getBoolean("SkypeCalling","callingServiceSupportsCAETokens",!1)&&(l|=8);var u={factorsJson:s,requestMetadataJson:'{"authenticationHeaders":[""]}',tokenTypeAsBitmask:l,invalidToken:""};this._onTokenRequired(u)}},t.prototype._getCurrentCall=function(e,t){var n=null;switch(e.type){case"ThreadId":if(n=u.find(this.calls,(function(t){return t.threadId===e.threadId&&(e.callId&&t.callId===e.callId||null!==e.messageId&&void 0!==e.messageId&&t.messageId===e.messageId)})))return t.info("Call Registry already has an entry for threadId: ".concat(g.getLoggableThreadId(n.threadId),", callId: ").concat(n.callId,", messageId: ").concat(n.messageId)),n;break;case"GroupId":if(n=u.find(this.calls,(function(t){return t.groupId===e.groupId})))return t.info("Call Registry already has an entry for groupId: ".concat(g.scrubMriOrOmit(n.groupId),", callId: ").concat(n.callId)),n;break;case"MeetingData":if(n=this._getCall(e.callId,e.localParticipantId,e.causeId,e.meetingData))return t.info("Call Registry already has an entry for meetingData: ".concat((0,R.safeJsonStringify)(n.meetingData),", callId: ").concat(n.callId)),n}return n},t.prototype._generateCreateCallOptions=function(e,t,n,r,i,o,a){return r?{type:"GroupId",callId:t,localParticipantId:n,causeId:e,groupId:r}:i?{type:"ThreadId",callId:t,localParticipantId:n,causeId:e,threadId:i,messageId:o}:{type:"MeetingData",callId:t,localParticipantId:n,causeId:e,meetingData:a}},t.prototype._createCall=function(e,t,n,r,i,o,a){var s=this._logger.createFnLogger("_createCall",e);s.info("threadId:".concat(g.getLoggableThreadId(i),", callId:").concat(t,", localParticipantId: ").concat(n,", \n            messageId:").concat(o,", meetingUrl:").concat(!!(null==a?void 0:a.meetingUrl),", meetingCode:").concat(!!(null==a?void 0:a.meetingCode))),this._createCallPreCheck(s);var c=this._generateCreateCallOptions(e,t,n,r,i,o,a),l=this._getCurrentCall(c,s);return l||this._createNewCall(c)},t.prototype.getCall=function(e,t,n){return void 0===n&&(n=(0,O.generateCauseId)()),this._getCall(e,t,n)},t.prototype._getCall=function(e,t,n,r){var i=this._logger.createFnLogger("getCall[callId=".concat(e,"][participantId=").concat(t,"]"),n);if(!e&&!t)return i.logFailure("callId & participantId is undefined"),null;if(null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler)throw i.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");var o=u.find(this.calls,(function(t){return t.callId===e||(0,w.compareMeetingData)(t.meetingData,r,n,i)}));if(i.log("call ".concat(o?"exists":"does not exist",", call.slimcoreCallId:").concat(o?o.slimcoreCallId:0)),o&&o.slimcoreCallId)return 8===o.state?(this._initCall(o,o.slimcoreCallId,n),o):(i.info("Call Registry already has an entry for this call"),o);var a=void 0;if(this._enableActiveCallsProperty){i.info("enableActiveCallsProperty is true");var s=this._getProperties(this._account.getObjectId(),{activeCalls:{propKey:SlimCore.Enums.Property.AccountActiveCalls}},{}).activeCalls;try{var c=JSON.parse(s);(null==c?void 0:c.calls)?a=c.calls.map((function(e){return Number(e.objectId)})):i.error("unable to retrieve activeCalls property")}catch(e){i.error("Error parsing activeCalls:",e)}}else a=this._slimcoreCallHandler.getActiveCalls();var l,d=this._getMultipleProperties(a,{callName:{propKey:SlimCore.Enums.Property.CallName},callLegId:{propKey:SlimCore.Enums.Property.CallLegId}},{});if(a.forEach((function(n,r){d[r].callName===e&&d[r].callLegId===t&&(l=n)})),!l)return i.logFailure("slimCoreCallObjectId not found"),null;if(o)return this._initCall(o,l,n),o;var p=this._getProperties(l,{groupId:{propKey:SlimCore.Enums.Property.CallGroupId},threadId:{propKey:SlimCore.Enums.Property.CallThreadId},messageId:{propKey:SlimCore.Enums.Property.CallMessageId}},{}),h=p.groupId,g=p.threadId,f=p.messageId;return o=new _.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this._ecs,this._deviceManager,this._appHooks,h,g,e,this._skypeIdentity,t,this._telemetryLoggers,f,r,this._accountConfig,this._eventBus),this._initCall(o,l,n),this.calls.push(o),this.event("callAdded").raise(o),this.raiseChanged(),o},t.prototype.deleteCall=function(e,t,n){var r=this;void 0===t&&(t=!0),void 0===n&&(n=(0,O.generateCauseId)()),this._logger.info("deleteCall ".concat(e.callId));var i=!1;return u.each(u.remove(this.calls,(function(t){return t===e})),(function(o){var a;i=!0,t&&(r.event("callRemoved").raise(e),null===(a=r._telemetryManager)||void 0===a||a.resumeLogger(),7!==o.state&&o.dispose(n))})),!!i&&(this.raiseChanged(),!0)},t.prototype.debugInformation=function(e){var t=this._slimcoreCallHandler.getDebugInformation("/callinfo");return!e||t&&!u.isEmpty(t)||(t="CallInformation\n * CallId=".concat(e.callId)),Promise.resolve(t)},t.prototype.setLocationInfo=function(e,t,n){return void 0===n&&(n=(0,O.generateCauseId)()),c(this,void 0,void 0,(function(){var r,i;return l(this,(function(o){switch(o.label){case 0:if((r=this._logger.createFnLogger("setLocationInfo",n)).info("infoType:".concat(e,", contentJson:(redacted)")),!this._slimcoreCallHandler)throw r.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.loginPromise];case 2:return o.sent(),[4,this._slimcoreCallHandler.setLocationInfo(this.mapLocationInfoType(e),t)];case 3:return[2,o.sent()];case 4:throw i=o.sent(),r.logFailure(i),i;case 5:return[2]}}))}))},t.prototype.createDownloader=function(e,t,n,r,i){return void 0===r&&(r=!0),void 0===i&&(i=(0,O.generateCauseId)()),this._logger.createFnLogger("createDownloader",i).info("createDownloader"),new y.default(this._logger,this._settings,this._slimcoreInstance,this.identity,e,t,n,r)},t.prototype.getUnassembledLocalRecordingSessions=function(e){return void 0===e&&(e=(0,O.generateCauseId)()),c(this,void 0,void 0,(function(){return l(this,(function(t){return this._logger.info("getUnassembledLocalRecordingSessions with causeId ".concat(e," current user is ").concat(g.mriOrId(this.identity))),[2,this._slimcoreInstance.getLocalRecordingSessions(this.identity,e)]}))}))},t.prototype.extendBrbFeedback=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){return this._logger.info("extendBrbFeedback uploadId=".concat(e," feedbackSettings={baseUrl=").concat(t.baseUrl,",title=").concat(t.title,",clientId=").concat(t.clientId,",clientVersion=").concat(t.clientVersion,",ring=").concat(t.ring,",")),[2,this._slimcoreInstance.extendBrbFeedback(e,t,this.identity)]}))}))},t.prototype.enableWindowUninitEventHandler=function(){},t.prototype.disableWindowUninitEventHandler=function(){},t.prototype.mapLocationInfoType=function(e){switch(e){case 0:return SlimCore.Enums.LocationInfoType.NoLocationInfo;case 1:return SlimCore.Enums.LocationInfoType.LocationContent;case 2:default:return SlimCore.Enums.LocationInfoType.NetworkContent;case 3:return SlimCore.Enums.LocationInfoType.AreaContent}},t.prototype.setAdditionalIdentities=function(){var e=this;return Promise.resolve().then((function(){if(e._skypeIdentity.sipUri){var t="2:".concat(e._skypeIdentity.sipUri);f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)&&e._account?e._account.setAdditionalIdentities(t):e._slimcoreInstance.setAdditionalIdentities(t)}}))},t.prototype._initializeSlimCore=function(e){var t=this;try{this._startSlimcorePromiseDefered.promise.then((function(){t._logger.info("logging in to slimcore libStatus=".concat(t.libStatus)),t._slimcoreInstance.login(t._skypeIdentity.id,e,t._skypeIdentity.displayName)}))}catch(e){this._logger.error("initialization failed.",e)}},t.prototype._onSkypeTokenRequired=function(e){this._logger.info("skypeTokenRequired"),this.event("skypeTokenRequired").raise(e.invalidToken)},t.prototype._onTokenRequired=function(e){this._logger.info("_onTokenRequired factors=".concat(e.factorsJson," metadata=").concat(e.requestMetadataJson," tokenType=").concat(e.tokenTypeAsBitmask));try{var t=JSON.parse(e.requestMetadataJson);this.event("tokenRequired").raise(e.factorsJson,e.tokenTypeAsBitmask,t,e.invalidToken)}catch(e){this._logger.warn("_onTokenRequired failed to parse requestMetadataJson")}},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from ".concat(this.libStatus," => ").concat(e.libStatus)),e.libStatus===SlimCore.Enums.LibStatus.Running?this._startSlimcorePromiseDefered.resolve():e.libStatus===SlimCore.Enums.LibStatus.FatalError&&this.libStatus===SlimCore.Enums.LibStatus.Constructed&&this._startSlimcorePromiseDefered.reject(new Error("Slimcore FatalError during start")),this.libStatus=e.libStatus},t.prototype._onProxiedPushNotification=function(e){var t={eventId:e.eventId,payload:e.payload};this.event("proxiedPushNotification").raise(t)},t.prototype._onIncomingTelemetryEvent=function(e){this._telemetryManager.dispatch(e.serializedEvents)},t.prototype._hookCallRegistryEvents=function(){var e=this;f.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)&&this._account?(this._accountCallBackRegistered||(this._registerDisposable(this._account.handle("skype-token-required",void 0,(function(t){e._onSkypeTokenRequired(t)}))),this._registerDisposable(this._account.handle("token-required",void 0,(function(t){e._onTokenRequired(t)})))),this._registerDisposable(this._slimcoreCallHandler.handle("proxied-push-notification",void 0,(function(t){e._onProxiedPushNotification(t)}))),this._registerDisposable(this._slimcoreCallHandler.handle("call-handler-operation-status-changed",void 0,(function(t){e._onCallHandlerOperationStatusChanged(t)}))),this._registerDisposable(this._account.handle("incoming-telemetry-event",void 0,(function(t){return e._onIncomingTelemetryEvent(t)})))):(this._registerDisposable(this._slimcoreInstance.handle("skype-token-required",void 0,(function(t){e._onSkypeTokenRequired(t)}))),this._registerDisposable(this._slimcoreInstance.handle("proxied-push-notification",void 0,(function(t){e._onProxiedPushNotification(t)}))))},o([(0,D.callOperation)(I.CALL_REGISTRY_OPERATIONS.INITIALIZE,{enableInstantTelemetry:!0}),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"initialize",null),o([(0,D.callOperation)(I.CALL_REGISTRY_OPERATIONS.LOGOUT,{enableInstantTelemetry:!0}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"logout",null),o([(0,D.callOperation)(I.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE),s(1,D.operationId),a("design:type",Function),a("design:paramtypes",[Object,String]),a("design:returntype",Promise)],t.prototype,"getCallState",null),t}(m.default);t.default=M},4385:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.getContentSharingProps=void 0;var c=n(5442),l=n(891),u=n(2211),d=n(1775),p=n(7584),h=n(5005),g=n(8067);t.getContentSharingProps=function(){return{strProps:{contentSharingGuid:{propKey:SlimCore.Enums.Property.ContentSharingId},contentSharingState:{propKey:SlimCore.Enums.Property.ContentSharingState},contentSharingIdentity:{propKey:SlimCore.Enums.Property.ContentSharingIdentity}},intProps:{contentSharingStatus:{propKey:SlimCore.Enums.Property.ContentSharingStatus}}}};var f=function(e){function n(n,r,i,o,a,s,c){var d=e.call(this,n.createChild((function(){return"ContentSharing[".concat(d.slimCoreContentSharingObjectId,"]")})),r,i)||this;d.slimCoreContentSharingObjectId=o,d._nativeContentSharing=a,d.callTelemetry=s,d.noFailureReason=SlimCore.Enums.ContentSharingFailureReason.NoFailure,d._getCallEndOperation=function(){return d._callOperationHandler.hasPendingOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING)?d._callOperationHandler.waitForOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING):Promise.resolve()},d._logger.info("constructor"),d._session=new u.ContentSharingSession(d,d._logger),d._callOperationHandler=new g.default(d._logger,d.callTelemetry),d._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingStatus,(function(e){d._onContentSharingStatusChanged(e.value)})),d._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingState,(function(e){d._onContentSharingStateChanged(e.value)})),d._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingFailureReason,(function(e){d._onContentSharingResultCodeChanged(e.value)}));var p=null!=c?c:function(){var e=(0,t.getContentSharingProps)(),n=e.strProps,r=e.intProps;return d._getProperties(d.slimCoreContentSharingObjectId,n,r)}(),h=p.contentSharingStatus,f=p.contentSharingGuid,m=p.contentSharingState,_=p.contentSharingIdentity;return d.contentSharingStatus=h,d.contentSharingGuid=f,d.contentSharingState=m,d.contentSharingIdentity=_,d._logger.info("Session created with status ".concat(d.contentSharingStatus,", guid ").concat(d.contentSharingGuid)),d._registerDisposable(d._nativeContentSharing.handle("update-session-state-result",void 0,(function(e){d._onSessionStateResult(e)}))),d._registerDisposable(d._nativeContentSharing.handle("take-control-result",void 0,(function(e){d._onTakeControlResult(e)}))),d._registerDisposable(d._nativeContentSharing.handle("update-participant-state-result",void 0,(function(e){d._onUpdateParticipantStateResult(e)}))),d._registerDisposable(d._nativeContentSharing.handle("join-result",void 0,(function(e){d._onJoinResult(e)}))),d}return i(n,e),n.prototype.startContentSharing=function(e){return void 0===e&&(e=(0,p.generateCauseId)()),this._session.startContentSharing(e)},n.prototype.joinContentSharing=function(e){return void 0===e&&(e=(0,p.generateCauseId)()),this._session.joinContentSharing(e)},n.prototype.updateContentSharingParticipantStateToViewer=function(e){return void 0===e&&(e=(0,p.generateCauseId)()),this._session.updateContentSharingParticipantStateToViewer(e)},n.prototype.updateContentSharingSessionState=function(e,t,n){return void 0===n&&(n=(0,p.generateCauseId)()),this._session.updateContentSharingSessionState(e,t,n)},n.prototype.takeContentSharingControl=function(e){return void 0===e&&(e=(0,p.generateCauseId)()),this._session.takeContentSharingControl(e)},n.prototype.stopContentSharing=function(e){return void 0===e&&(e=(0,p.generateCauseId)()),this._session.stopContentSharing(e)},n.prototype.setContentSharingStatus=function(e){if(this._logger.info("setContentSharingStatus. currentStatus: ".concat(this.contentSharingStatus," newStatus: ").concat(e)),this.contentSharingStatus!==e&&7!==this.contentSharingStatus&&8!==this.contentSharingStatus){if(this._logger.info("Changing content sharing status to: ".concat(e)),this.contentSharingStatus=e,7===e||8===e){if(this.contentSharingTerminationReason&&0!==this.contentSharingTerminationReason.terminatedReason)return;var t=this._getProperties(this.slimCoreContentSharingObjectId,{},{failure:{propKey:SlimCore.Enums.Property.ContentSharingFailureReason},code:{propKey:SlimCore.Enums.Property.ContentSharingFailureCode},subCode:{propKey:SlimCore.Enums.Property.ContentSharingFailureSubCode}}),n=t.failure,r=t.code,i=t.subCode,o=this.convertFailureReason(n);this._logger.info("setting failure reason for content sharing session. reason: ".concat(o)),this.contentSharingTerminationReason={terminatedReason:o,terminatedReasonCode:r,terminatedReasonSubCode:i,errorMessage:"Session is terminated"}}this._session.statusChanged(e),this.raiseChanged()}},n.prototype.convertContentSharingStatus=function(e){switch(e){case SlimCore.Enums.ContentSharingStatus.Routing:return 1;case SlimCore.Enums.ContentSharingStatus.Ringing:return 2;case SlimCore.Enums.ContentSharingStatus.Connected:return 4;case SlimCore.Enums.ContentSharingStatus.Presenting:return 3;case SlimCore.Enums.ContentSharingStatus.Viewing:return 5;case SlimCore.Enums.ContentSharingStatus.Finishing:return 6;case SlimCore.Enums.ContentSharingStatus.Done:case SlimCore.Enums.ContentSharingStatus.Failed:case SlimCore.Enums.ContentSharingStatus.TimedOut:return 7;default:return 0}},n.prototype.callStartContentSharing=function(){var e=this;return(0,c.asap)((function(){e._nativeContentSharing.startContentSharing()}))},n.prototype.callStopContentSharing=function(){var e=this;return(0,c.asap)((function(){e._nativeContentSharing.stopContentSharing()}))},n.prototype.callUpdateContentSharingSessionState=function(e,t){var n=this;return(0,c.asap)((function(){n._nativeContentSharing.updateContentSharingSessionState(e,t)}))},n.prototype.callTakeContentSharingControl=function(){var e=this;return(0,c.asap)((function(){e._nativeContentSharing.takeContentSharingControl()}))},n.prototype.callUpdateContentSharingParticipantState=function(){var e=this;return(0,c.asap)((function(){e._nativeContentSharing.updateContentSharingParticipantState()}))},n.prototype.convertFailureReason=function(e){switch(e){case SlimCore.Enums.ContentSharingFailureReason.NoFailure:return 1;case SlimCore.Enums.ContentSharingFailureReason.SessionNotFound:return 34;case SlimCore.Enums.ContentSharingFailureReason.SessionTimedOut:return 35;case SlimCore.Enums.ContentSharingFailureReason.NetworkError:return 3;case SlimCore.Enums.ContentSharingFailureReason.NetworkCannotConnectError:return 52;case SlimCore.Enums.ContentSharingFailureReason.ServiceFailure:return 48;case SlimCore.Enums.ContentSharingFailureReason.RequestTimedOut:return 45;case SlimCore.Enums.ContentSharingFailureReason.AuthFailure:return 29;case SlimCore.Enums.ContentSharingFailureReason.ActionNotAllowed:return 60;case SlimCore.Enums.ContentSharingFailureReason.Forbidden:return 8;case SlimCore.Enums.ContentSharingFailureReason.Failure:default:return 32}},n.prototype.dispose=function(t){var n=this;void 0===t&&(t=(0,p.generateCauseId)()),this._logger.info("dispose causeId: ".concat(t));var r=this.contentSharingTerminationReason?this.contentSharingTerminationReason:{terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Call ended"};this.slimCoreContentSharingObjectId=0,this._getCallEndOperation().then((function(){n._callOperationHandler.rejectPendingOperations(r,t),e.prototype.dispose.call(n,t)}))},n.prototype._onContentSharingPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimCoreContentSharingObjectId,e,t)},n.prototype._onContentSharingStatusChanged=function(e){this._logger.info("_onContentSharingStateChanged called"),this.setContentSharingStatus(this.convertContentSharingStatus(e))},n.prototype._onContentSharingStateChanged=function(e){this._logger.info("_onContentSharingStateChanged called"),this.contentSharingState=e,this.raiseChanged()},n.prototype._onContentSharingResultCodeChanged=function(e){if(this._logger.info("_onContentSharingResultCodeChanged called"),!this.contentSharingTerminationReason||0===this.contentSharingTerminationReason.terminatedReason){var t=this._getProperties(this.slimCoreContentSharingObjectId,{},{code:{propKey:SlimCore.Enums.Property.ContentSharingFailureCode},subCode:{propKey:SlimCore.Enums.Property.ContentSharingFailureSubCode}}),n=t.code,r=t.subCode,i=this.convertFailureReason(e);this._logger.info("setting failure reason for content sharing session. reason: ".concat(i)),this.contentSharingTerminationReason={terminatedReason:i,terminatedReasonCode:n,terminatedReasonSubCode:r,errorMessage:"Session is terminated"}}},n.prototype._onJoinResult=function(e){this._session.onJoinResultEvent(e)},n.prototype._onUpdateParticipantStateResult=function(e){this._session.onUpdateParticipantStateResultEvent(e)},n.prototype._onSessionStateResult=function(e){this._session.onSessionStateResultEvent(e)},n.prototype._onTakeControlResult=function(e){this._session.onTakeControlResultEvent(e)},o([(0,h.callOperation)(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),s(0,h.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],n.prototype,"startContentSharing",null),o([(0,h.callOperation)(l.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING),s(0,h.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],n.prototype,"joinContentSharing",null),o([(0,h.callOperation)(l.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE),s(0,h.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],n.prototype,"updateContentSharingParticipantStateToViewer",null),o([(0,h.callOperation)(l.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE),s(0,h.operationId),s(2,h.causeId),a("design:type",Function),a("design:paramtypes",[String,String,Object]),a("design:returntype",Promise)],n.prototype,"updateContentSharingSessionState",null),o([(0,h.callOperation)(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL),s(0,h.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],n.prototype,"takeContentSharingControl",null),o([(0,h.callOperation)(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,{waitFor:l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING}),s(0,h.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],n.prototype,"stopContentSharing",null),n}(d.default);t.default=f},7715:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5442),c=n(3077),l=n(891),u=n(5773),d=n(1775),p=n(2321),h=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,t.createChild((function(){return"SlimCoreElectronDataChannel"})),n,r)||this;l._call=i,l._dataChannel=o,l._dataChannelUsers=a,l.id=s,l._lastDataChannelState=SlimCore.Enums.DataChannelStatus.Unknown,l._dataChannelActive=!1,l._protocolDataSource=null,l._protocolDataSourceStarted=!1,l._protocolDataSink=null,l._dataChannelAdapterSetInternalSourceSink=null,l._onProtocolDataSourceEvent=function(e){e.event===SlimCore.Enums.DataDeviceEvent.Started&&!1===l._protocolDataSourceStarted&&(l._logger.info("datachannel _protocolDataSource Started event received"),l._protocolDataSourceStarted=!0,l._updateDataChannelUsersState())},l._asyncOperationHandler=new c.default(l._logger),l._chainedApiPromise=new p.default(t.createChild((function(){return"DataChannel[".concat(l.id,"]")}))),l._logger.info("Setting DataChannel on all users");for(var u=0;u<l._dataChannelUsers.length;u++)if(l._dataChannelUsers[u])try{l._dataChannelUsers[u].setDataChannel(l)}catch(e){l._logger.error("Exception calling setDataChannel for i=".concat(u," error=").concat(e))}return l._hookSlimCorePropertyChangedEvents(),l}return i(t,e),t.mapDataChannelStatus=function(e){switch(e){case SlimCore.Enums.DataChannelStatus.Available:return 1;case SlimCore.Enums.DataChannelStatus.Starting:return 2;case SlimCore.Enums.DataChannelStatus.Active:return 3;case SlimCore.Enums.DataChannelStatus.Stopping:return 4;case SlimCore.Enums.DataChannelStatus.NotStarted:return 5;case SlimCore.Enums.DataChannelStatus.Unknown:default:return 0}},t.prototype.setAdapterSourceSinkCallback=function(e){this._dataChannelAdapterSetInternalSourceSink=e},t.prototype.start=function(e){var t=this;return this._dataChannelActive?(this._logger.info("start() called when channel already active"),Promise.resolve()):(this._asyncOperationHandler.hasPendingOperation(l.CALL_OPERATIONS.START_DATA_CHANNEL)?this._logger.info("start promise already exists, returning previous promise"):(this._asyncOperationHandler.createPendingOperation(l.CALL_OPERATIONS.START_DATA_CHANNEL),(0,s.asap)((function(){return t._startDataChannel(e)}))),this._asyncOperationHandler.waitForOperation(l.CALL_OPERATIONS.START_DATA_CHANNEL))},t.prototype.stop=function(e){var t=this;return this._dataChannelActive?(this._asyncOperationHandler.hasPendingOperation(l.CALL_OPERATIONS.STOP_DATA_CHANNEL)?this._logger.info("stop promise already exists, returning previous promise"):(this._asyncOperationHandler.createPendingOperation(l.CALL_OPERATIONS.STOP_DATA_CHANNEL),(0,s.asap)((function(){return t._stopDataChannel(e)}))),this._asyncOperationHandler.waitForOperation(l.CALL_OPERATIONS.STOP_DATA_CHANNEL)):(this._logger.info("stop() called when channel not active"),Promise.resolve())},t.prototype.registerDataSource=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2,this._dataChannel.registerDataSource(e)]}))}))},t.prototype.unregisterDataSource=function(e){var t=this;return(0,s.asap)((function(){return t._dataChannel.unregisterDataSource(e)}))},t.prototype.registerDataSink=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2,this._dataChannel.registerDataSink(e)]}))}))},t.prototype.unregisterDataSink=function(e){var t=this;return(0,s.asap)((function(){return t._dataChannel.unregisterDataSink(e)}))},t.prototype.sendUserEvents=function(e,t){var n=this;return(0,s.asap)((function(){return n._dataChannel.sendUserEvents(e,t)}))},t.prototype.dispose=function(t){this._logger.info("dispose causeId: ".concat(t)),this._detachAndDeleteProtocolDevices(),this._call=null,this._dataChannel&&(this._dataChannel.dispose(),this._dataChannel=null),e.prototype.dispose.call(this,t)},t.prototype._hookSlimCorePropertyChangedEvents=function(){var e=this;this._onObjectPropertyChanged(this.id,SlimCore.Enums.Property.DataChannelStatus,(function(t){return e._chainedApiPromise.chainPromise((function(){return e._onDataChannelStatusChanged(t.value)}),"_onDataChannelStatusChanged")}));var t=this._getProperties(this.id,{},{status:{propKey:SlimCore.Enums.Property.DataChannelStatus}}).status;return this._chainedApiPromise.chainPromise((function(){return e._onDataChannelStatusChanged(t)}),"_onDataChannelStatusChanged")},t.prototype._onDataChannelStatusChanged=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:if(this._logger.info("Data channel status = ".concat(e)),e!==SlimCore.Enums.DataChannelStatus.Active)return[3,3];this._asyncOperationHandler.maybeResolveOperation(l.CALL_OPERATIONS.START_DATA_CHANNEL);try{this._dataChannel.setDataDevices()}catch(e){this._logger.error("setDataDevices threw exception: ".concat(e))}return!this._dataChannel||this._dataChannelActive?[3,2]:(this._dataChannelActive=!0,[4,this._createAndAttachProtocolDevices()]);case 1:t.sent(),this._dataChannelAdapterSetInternalSourceSink&&this._dataChannelAdapterSetInternalSourceSink(SlimCore.Enums.DataDeviceId.Protocol,this._protocolDataSource,this._protocolDataSink),this._logger.info("Data channel ready"),t.label=2;case 2:return[3,4];case 3:e===SlimCore.Enums.DataChannelStatus.Available&&(this._asyncOperationHandler.maybeResolveOperation(l.CALL_OPERATIONS.STOP_DATA_CHANNEL),this._dataChannel&&this._dataChannelActive&&(this._dataChannelActive=!1,this._detachAndDeleteProtocolDevices(),this._logger.info("Data channel disposed"))),t.label=4;case 4:return this._lastDataChannelState===SlimCore.Enums.DataChannelStatus.Starting&&e!==SlimCore.Enums.DataChannelStatus.Active?this._asyncOperationHandler.maybeRejectOperation(l.CALL_OPERATIONS.START_DATA_CHANNEL):this._lastDataChannelState===SlimCore.Enums.DataChannelStatus.Stopping&&e!==SlimCore.Enums.DataChannelStatus.Available&&this._asyncOperationHandler.maybeRejectOperation(l.CALL_OPERATIONS.STOP_DATA_CHANNEL),this._lastDataChannelState=e,this._updateDataChannelUsersState(),[2]}}))}))},t.prototype._updateDataChannelUsersState=function(){if(this._logger.info("_updateDataChannelUsersState"),this._lastDataChannelState!==SlimCore.Enums.DataChannelStatus.Active||this._protocolDataSourceStarted)for(var e=0;e<this._dataChannelUsers.length;e++)try{this._dataChannelUsers[e].onDataChannelStatusChanged(this._lastDataChannelState)}catch(t){this._logger.error("Exception calling onDataChannelStatusChanged for i=".concat(e," error=").concat(t))}else this._logger.info("Not propagating dataChannnelStatusChanged to dataChannel users, waiting for protocolSource to start")},t.prototype._updateProtocolDataSource=function(e){this._logger.info("Setting Protocol DataSource on all users");for(var t=0;t<this._dataChannelUsers.length;t++)if(this._dataChannelUsers[t])try{this._dataChannelUsers[t].setProtocolDataSource(e)}catch(e){this._logger.error("Exception calling setProtocolDataSource for i=".concat(t," error=").concat(e))}},t.prototype._createAndAttachProtocolDevices=function(){return o(this,void 0,void 0,(function(){var e,t,n,r=this;return a(this,(function(i){switch(i.label){case 0:if(this._logger.info("_createAndAttachProtocolDevices()"),!this._dataChannel)return[3,5];e=void 0,t=void 0,this._protocolDataSource||(this._logger.info("Create and register protocol data source"),this._protocolDataSource=this._slimcoreInstance.createDataSource(SlimCore.Enums.DataDeviceId.Protocol),this._protocolDataSource.on("event",this._onProtocolDataSourceEvent),e=this._dataChannel.registerDataSource(this._protocolDataSource)),this._protocolDataSink||(this._logger.info("Create and register protocol data sink"),this._protocolDataSink=this._slimcoreInstance.createDataSink(SlimCore.Enums.DataDeviceId.Protocol),t=this._dataChannel.registerDataSink(this._protocolDataSink)),this._protocolDataSink.on("data",(function(e){try{var t=JSON.parse(u.bufferToString(e.data));if(1!==t.type){t.type>=r._dataChannelUsers.length&&r._logger.error("Error calling processProtocolMessage i=".concat(t.type," error=Index out of bounds"));try{var n=r._call.mapDataChannelSourceIdToParticipant(e.sourceID),i=null==n?void 0:n.getParticipantIdForSourceId(3,e.sourceID);r._dataChannelUsers[t.type].processProtocolMessage(t.message,n,i,e.sourceID)}catch(e){r._logger.error("Error calling processProtocolMessage i=".concat(t.type," error=").concat(e))}}}catch(e){r._logger.error("Error handling protocol message error=".concat(e))}})),this._updateProtocolDataSource(this._protocolDataSource),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all([e,t])];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),this._logger.error("Failed to register data sink/source, error = ".concat(n)),[3,4];case 4:return[3,6];case 5:this._logger.warn("_createAndAttachProtocolDevices() null dataChannel"),i.label=6;case 6:return[2]}}))}))},t.prototype._detachAndDeleteProtocolDevices=function(){if(this._logger.info("_detachAndDeleteProtocolDevices()"),this._protocolDataSink&&this._protocolDataSink.removeAllListeners("data"),this._dataChannel){if(this._protocolDataSource){this._protocolDataSource.removeListener("event",this._onProtocolDataSourceEvent);try{this._dataChannel.unregisterDataSource(this._protocolDataSource)}catch(e){this._logger.warn("unregisterDataSource threw exception for protocol, call probably ended: ".concat(e))}this._protocolDataSource=null,this._protocolDataSourceStarted=!1,this._updateProtocolDataSource(null),this._logger.info("deleted Protocol data source")}if(this._protocolDataSink){try{this._dataChannel.unregisterDataSink(this._protocolDataSink)}catch(e){this._logger.warn("unregisterDataSink threw exception for protocol, call probably ended: ".concat(e))}this._protocolDataSink=null,this._logger.info("deleted Protocol data sink")}}else this._logger.warn("_detachAndDeleteProtocolDevices() null dataChannel")},t.prototype._startDataChannel=function(e){if(this._logger.info("_startDataChannel()"),this._dataChannel){try{this._dataChannel.start(e)}catch(e){this._logger.error("_dataChannel.start threw exception: ".concat(e))}this._logger.info("Data channel started")}},t.prototype._stopDataChannel=function(e){if(this._logger.info("_stopDataChannel()"),this._dataChannel){try{this._dataChannel.stop(e)}catch(e){this._logger.error("_dataChannel.stop threw exception: ".concat(e))}this._logger.info("Data channel stopping")}},t}(d.default);t.default=h},8672:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2321),a=function(){function e(e,t,n,r){this.dataId=e,this.handler=t,this.sourceSinkInternallyCreated=n,this.direction=r,this.isAttached=!1}return e.prototype.isSourceEnabled=function(){return 0===this.direction||1===this.direction},e.prototype.isSinkEnabled=function(){return 0===this.direction||2===this.direction},e}(),s=function(){function e(e,t){this.logger=e,this._slimcoreInstance=t,this._dataChannel=null,this._dataChannelStatus=SlimCore.Enums.DataChannelStatus.Unknown,this._handlers={},this._availableHandlers=0,this._dataChannelStartCalled=!1,this.setInternalSourceSink=this.setInternalSourceSink.bind(this),this._handlerPromises=new o.default(this.logger)}return e.prototype.addHandler=function(e,t,n,r,i){var o=this;return void 0===n&&(n=!1),void 0===i&&(i=0),this._handlerPromises.chainPromise((function(){if(e<0||e>=64)return Promise.reject(new Error("Data Id ".concat(e," is outside the valid range of 0-63")));if(o._handlers.hasOwnProperty(e)&&o._handlers[e].handler)return Promise.reject(new Error("Data Id ".concat(e," is already registered to a non-null handler")));o.logger.info("Adding handler to dataId: ".concat(e,", ").concat(n?"skipping source sink creation":"making source sink"));var s=null,c=!1;e in o._handlers?((s=o._handlers[e]).handler=t,c=!0):(s=new a(e,t,n,i),o._handlers[e]=s,n||(c=!0));var l=Promise.resolve();return c&&(o._availableHandlers++,o._isDataChannelAvailable&&(o._negotiationTag=r,l.then((function(){return o.start()}))),o._isDataChannelActive&&l.then((function(){return o._attachHandler(s)}))),l}),"addHandler")},e.prototype.removeHandler=function(e){var t=this;return this._handlerPromises.chainPromise((function(){var n=t._handlers[e];return n?t._detachHandler(n).then((function(){delete t._handlers[e],t._availableHandlers--})):Promise.reject(new Error("Handler associated with Data Id ".concat(e," wasn't attached in the first place")))}),"removeHandler")},e.prototype.updateNegotiationTag=function(e){return this._negotiationTag=e,Promise.resolve()},e.prototype.dispose=function(){this._detachAllHandlers(),this._dataChannel&&(this._dataChannel=null)},e.prototype.setDataChannel=function(e){return this._dataChannel&&!e&&(this._detachAllHandlers(),this._dataChannelStartCalled=!1),this._dataChannel=e,Promise.resolve()},e.prototype.onDataChannelStatusChanged=function(e){var t=this;return e!==SlimCore.Enums.DataChannelStatus.Active||this._isDataChannelActive?e===SlimCore.Enums.DataChannelStatus.Available&&(this._isDataChannelActive||this._isDataChannelStopping?(this._dataChannelStartCalled=!1,this._handlerPromises.chainPromise((function(){return t._detachAllHandlers()}),"onDataChannelStatusChanged, _detachAllHandlers")):this._availableHandlers>0&&this._handlerPromises.chainPromise((function(){return t.start()}),"onDataChannelStatusChanged, start")):this._handlerPromises.chainPromise((function(){return t._attachAllHandlers().catch((function(e){t.logger.error("Failed to attach all handlers error: ".concat(e))}))}),"onDataChannelStatusChanged, _attachAllHandlers"),this._dataChannelStatus=e,Promise.resolve()},e.prototype.setProtocolDataSource=function(e){return Promise.resolve()},e.prototype.processProtocolMessage=function(){return Promise.resolve()},e.prototype.setInternalSourceSink=function(e,t,n){if(e<0||e>=64)throw new Error("Data Id ".concat(e," is outside the valid range of 0-63"));if(this._handlers.hasOwnProperty(e)&&(this._handlers[e].dataSource||this._handlers[e].dataSink))this.logger.info("Data Id ".concat(e," for internal source sink is already registered"));else if(this.logger.info("Setting internal source sink for dataId: ".concat(e)),e in this._handlers)this._handlers[e].dataSource=t,this._handlers[e].dataSink=n,this.logger.info("Completed adapter details for dataId: ".concat(e)),this._availableHandlers++;else{var r=new a(e,null,!0,0);r.dataSource=t,r.dataSink=n,this._handlers[e]=r}},Object.defineProperty(e.prototype,"_isDataChannelAvailable",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Available},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isDataChannelActive",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Active},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isDataChannelStopping",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Stopping},enumerable:!1,configurable:!0}),e.prototype._attachAllHandlers=function(){var e=this;return Promise.all(Object.keys(this._handlers).map((function(t){var n=e._handlers[t];return n&&(n.handler&&n.dataSource&&n.dataSink||!n.sourceSinkInternallyCreated)?e._attachHandler(n):Promise.resolve(null)})))},e.prototype._attachHandler=function(e){return r(this,void 0,void 0,(function(){var t,n,o,a=this;return i(this,(function(s){switch(s.label){case 0:if(e.isAttached)return[2];this.logger.info("Attaching handler for dataId: ".concat(e.dataId,", ").concat(e.sourceSinkInternallyCreated?"skipping source sink creation":"making source sink")),t=[],e.sourceSinkInternallyCreated?e.dataSource&&e.dataSink||(this.logger.error("Attaching handler with null datasource or datasink"),t.push(Promise.reject(new Error("Attaching handler with null datasource or datasink")))):(e.isSourceEnabled()&&(e.dataSource=this._slimcoreInstance.createDataSource(e.dataId),t.push(this._dataChannel.registerDataSource(e.dataSource))),e.isSinkEnabled()&&(e.dataSink=this._slimcoreInstance.createDataSink(e.dataId),t.push(this._dataChannel.registerDataSink(e.dataSink)))),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Promise.all(t)];case 2:return s.sent(),e.dataSink&&(e.listener=function(t){e.handler.onDataReceived(e.dataId,t.data,t.sourceID)},e.dataSink.on("data",e.listener)),n=function(t,n){return r(a,void 0,void 0,(function(){return i(this,(function(r){if(!e.dataSource)throw new Error("Data sent to sink-only DataChannelAdapter");return[2,e.dataSource.sendData(t,n)]}))}))},e.isAttached=!0,e.handler.onStarted(e.dataId,n),[3,4];case 3:throw o=s.sent(),this.logger.error("Attaching handler for data id ".concat(e.dataId," threw exception: ").concat(o)),o;case 4:return[2]}}))}))},e.prototype._detachAllHandlers=function(){var e=this;return Promise.all(Object.keys(this._handlers).map((function(t){return e._detachHandler(e._handlers[t])})))},e.prototype._detachHandler=function(e){var t=this;if(!e.isAttached)return Promise.resolve();try{if(this.logger.info("Detaching data handler dataid: ".concat(e.dataId)),e.handler&&e.handler.onStopped(e.dataId).catch((function(e){t.logger.warn("Error in handler onStopped :".concat(e))})),!e.sourceSinkInternallyCreated){var n=[];return e.dataSource&&n.push(this._dataChannel.unregisterDataSource(e.dataSource).catch((function(e){t.logger.warn("Failed to unregister data source, call probably ended: ".concat(e))})).then((function(){e.dataSource.dispose(),e.dataSource=null}))),e.dataSink&&(e.dataSink.removeAllListeners("data"),n.push(this._dataChannel.unregisterDataSink(e.dataSink).catch((function(e){t.logger.warn("Failed to unregister data sink, call probably ended: ".concat(e))})).then((function(){e.dataSink.dispose(),e.dataSink=null})))),e.isAttached=!1,Promise.all(n).then()}if(e.dataSink)try{e.dataSink.removeListener("data",e.listener)}catch(e){this.logger.warn("Error removing internal listener, call probably ended: ".concat(e))}e.isAttached=!1}catch(t){this.logger.error("Exception thrown while detaching handler for data id ".concat(e.dataId,", error: ").concat(t))}return Promise.resolve()},e.prototype.start=function(){return this.logger.info("Data channel start called from adapter"),this._dataChannel?this._dataChannelStartCalled?(this.logger.warn("Data channel start called more than once"),Promise.resolve()):(this._dataChannelStartCalled=!0,this._dataChannel.start(this._negotiationTag)):Promise.reject(new Error("Attempted to call start without a data channel"))},e}();t.default=s},6769:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},c=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var l=n(6773),u=n(5442),d=n(7584),p=n(5773),h=n(8287),g=n(1775),f=n(2642),m=n(1011),_=n(658),y=n(8253),v=n(18),S=n(8967),C=function(){function e(e){this._logger=e,this._devices=[],this._slimcoreDevices=[],this._logger.info("constructor")}return e.prototype.getList=function(){return this._devices},e.prototype.update=function(e){var t=!l.isEqual(l.sortBy(this._slimcoreDevices),l.sortBy(e));return t&&(this._slimcoreDevices=e,this._logger.info("update: ".concat(JSON.stringify(e))),this._devices=this._enumerate(e)),t},e.prototype._getDeviceId=function(e){return e?e.id:null},e}(),E=function(e){function t(t,n){var r=e.call(this,t)||this;return r._disableAutoDeviceSelection=n,r}return i(t,e),t.prototype.getBestDevice=function(){return this._getBestDevice()},t.prototype.getSelectedDevice=function(){if(this._isAvailable(this._selectedDevice))return this._logger.debug("getSelectedDevice: ".concat(this._selectedDevice)),this._selectedDevice;if(this._disableAutoDeviceSelection)return this._logger.debug("getSelectedDevice - ".concat(this._selectedDevice," not currently present, returning null")),null;var e=this._getBestDevice();return this._logger.debug("getSelectedDevice - unknown device selected, returning preferred device: ".concat(e)),e},t.prototype.selectDevice=function(e){if(this._disableAutoDeviceSelection)return this._logger.info("selectDevice: ".concat(e)),void(this._selectedDevice=e);this._isAvailable(e)?(this._logger.info("selectDevice: ".concat(e)),this._selectedDevice=e):(this._logger.info("selectDevice - unknown device selected, selecting preferred device"),this._selectedDevice=null)},t.prototype._getBestDevice=function(){return this._getDeviceId(l.first(this._devices))},t.prototype._isAvailable=function(e){return!(!e||!l.find(this._devices,(function(t){return t.id===e})))},t}(C),T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._getBestDevice=function(){var t=this._findCamera(3),n=this._findCamera(6),r=this._findCamera(1),i=this._findCamera(4),o=this._findCamera(5),a=this._findCamera(),s=e.prototype._getBestDevice.call(this);return t||n||r||i||o||a||s},t.prototype._enumerateSCCompositeGrouped=function(e){var t=this,n={},r=[],i=[];return e.forEach((function(o){var a=t._convert(o,o.parentId.length>0?5:1,{isCompositeParent:void 0!==e.find((function(e){return e.parentId===o.id})),parentId:o.parentId});O.isChildVideoDeviceDescr(a)&&(a.useForPreview=!n[a.parentId],n[a.parentId]||(n[a.parentId]=!0)),a.isCompositeParent||O.isChildVideoDeviceDescr(a)?r.push(a):i.push(a)})),c(c([],i,!0),r,!0)},t.prototype._enumerate=function(e){var t=this;if(e.some((function(e){var t;return(null===(t=e.parentId)||void 0===t?void 0:t.length)>0})))return this._enumerateSCCompositeGrouped(e);var n=this._enumerateComposites(e),r=l.filter(e,(function(e){return!function(e){return-1!==l.findIndex(n,(function(t){return t.id===e.id}))||e.compositeCount>1||e.cameraFacing===SlimCore.Enums.CameraFacing.Panoramic||e.cameraFacing===SlimCore.Enums.CameraFacing.Participant}(e)})),i=l.map(r,(function(e){return t._convert(e,1)}));return c(c([],i,!0),n,!0)},t.prototype._isVirtual=function(e){return e.deviceType===SlimCore.Enums.DeviceType.Virtual},t.prototype._getMediaLabel=function(e,t){if(p.hasFeature(SlimCore.Enums.Feature.MediaLabels))switch(e){case 6:return"panoramic-video";case 7:return"participant-video-".concat(t);default:return"main-video"}},t.prototype._convert=function(e,t,n){void 0===n&&(n={});var r=this._getCameraPosition(e.cameraFacing),i=n.isCompositeParent?void 0:this._getMediaLabel(r,e.participantCameraId);return o({id:e.id,browserId:e.browserId,label:e.label,kind:t,position:r,isVirtual:this._isVirtual(e),generation:e.generation,participantCameraId:e.participantCameraId,productId:e.productId||"",vendorId:e.vendorId||"",serialNumber:e.serialNumber||"",mediaLabel:i},n)},t.prototype._enumerateComposites=function(e){var t=this,n=[],r=l.filter(e,(function(e){return!!e.compositeId})),i=l.groupBy(r,"compositeId");return Object.keys(i).forEach((function(e){var r=i[e],o=r.length;if(o>1){var a=r.find((function(e){return e.cameraFacing===SlimCore.Enums.CameraFacing.Panoramic}))||r[0];if(!a.compositeCount||a.compositeCount===o){var s=t._convert(a,1,{id:"composite_video_".concat(a.id),isCompositeParent:!0});n.push(s),r.forEach((function(e,r){n.push(t._convert(e,5,{parentId:s.id,useForPreview:0===r}))}))}}})),n},t.prototype._findCamera=function(e){var t=l.find(this._devices,(function(t){return!(O.isChildVideoDeviceDescr(t)||t.isVirtual||e&&t.position!==e)}));return this._getDeviceId(t)},t.prototype._getCameraPosition=function(e){switch(e){case SlimCore.Enums.CameraFacing.Front:return 1;case SlimCore.Enums.CameraFacing.LeftFront:return 4;case SlimCore.Enums.CameraFacing.RightFront:return 5;case SlimCore.Enums.CameraFacing.Back:return 2;case SlimCore.Enums.CameraFacing.External:return 3;case SlimCore.Enums.CameraFacing.Panoramic:return 6;case SlimCore.Enums.CameraFacing.Participant:return 7;default:return 0}},t}(E),I=function(e){function t(t,n,r){var i=e.call(this,n,r)||this;return i._kind=t,i}return i(t,e),t.prototype._enumerate=function(e){var t=this,n=l.find(e,(function(e){return e.isSystemDefault}))||l.first(e);return l.map(e,(function(e){return{id:e.id,browserId:e.browserId,label:e.label,kind:t._kind,isSystemDefault:e===n,productId:"".concat(e.productId||""),vendorId:"".concat(e.vendorId||""),generation:e.generation,isSpatialCapable:e.isSpatialCapable||!1,connectionType:t._getConnectionType(e.connectionType),containerId:e.containerId||"",serialNumber:e.serialNumber||"",isDefaultAudioDevice:e.isDefaultAudioDevice||!1}}))},t.prototype._getConnectionType=function(e){switch(e){case SlimCore.Enums.AudioDeviceConnectionType.BLUETOOTH:return 4;case SlimCore.Enums.AudioDeviceConnectionType.EXTERNAL:return 8;case SlimCore.Enums.AudioDeviceConnectionType.HDAUDIO:return 3;case SlimCore.Enums.AudioDeviceConnectionType.INTERNAL:return 7;case SlimCore.Enums.AudioDeviceConnectionType.PCI:return 2;case SlimCore.Enums.AudioDeviceConnectionType.USB:return 1;case SlimCore.Enums.AudioDeviceConnectionType.VIRTUAL:return 6;case SlimCore.Enums.AudioDeviceConnectionType.XBOX_KINECT:return 5;default:return 0}},t}(E),P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._enumerate=function(e){var t=this;return l.map(e,(function(e){return{id:null,label:e.label,kind:4,microphoneId:e.microphoneId,speakerId:e.speakerId,formFactor:t._getCompositeDeviceFormFactor(e.deviceType),isPcInternalDevice:e.isPcInternalDevice,connectionType:t._getConnectionType(e.connectionType),isHeadsetNSCapable:e.isHeadsetNSCapable||!1}}))},t.prototype._getCompositeDeviceFormFactor=function(e){switch(e){case SlimCore.Enums.CompositeAudioDeviceType.Speakers:return 1;case SlimCore.Enums.CompositeAudioDeviceType.Headphones:return 2;case SlimCore.Enums.CompositeAudioDeviceType.Headset:return 3;case SlimCore.Enums.CompositeAudioDeviceType.Handset:return 4;case SlimCore.Enums.CompositeAudioDeviceType.Speakerphone:return 5;default:return 0}},t.prototype._getConnectionType=function(e){switch(e){case SlimCore.Enums.AudioDeviceConnectionType.BLUETOOTH:return 4;case SlimCore.Enums.AudioDeviceConnectionType.EXTERNAL:return 8;case SlimCore.Enums.AudioDeviceConnectionType.HDAUDIO:return 3;case SlimCore.Enums.AudioDeviceConnectionType.INTERNAL:return 7;case SlimCore.Enums.AudioDeviceConnectionType.PCI:return 2;case SlimCore.Enums.AudioDeviceConnectionType.USB:return 1;case SlimCore.Enums.AudioDeviceConnectionType.VIRTUAL:return 6;case SlimCore.Enums.AudioDeviceConnectionType.XBOX_KINECT:return 5;default:return 0}},t}(C),O=function(e){function t(t,n,r,i,o){var c=e.call(this,t.createChild("DeviceManager"),n,r)||this;c._mediaReadyPromise=i,c._appHooks=o,c._browserDevices=[],c._haveStartedMedia=!1,c._disableBrowseridResolution=!1,c._previewRenderers=[],c._txNdiNotifiers=new Map,c._startPreviewVideo=function(e,t){return a(c,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._mediaReadyPromise];case 1:return n.sent(),this._logger.info("Wait AVAILABLE for preview video ".concat(t," causeId: ").concat(e)),[4,p.waitForVideoObjectState({slimcoreInstance:this._slimcoreInstance,videoObjectId:t,logger:this._logger,causeId:e,resolveStates:[SlimCore.Enums.VideoStatus.Available],rejectStates:[SlimCore.Enums.VideoStatus.NotAvailable],timeout:p.videoObjectTimeout(this._settings)})];case 2:return n.sent(),this._logger.info("Starting preview video ".concat(t," causeId: ").concat(e)),[4,this._slimcoreInstance.videoStart(t)];case 3:return n.sent(),[4,p.waitForVideoObjectState({slimcoreInstance:this._slimcoreInstance,videoObjectId:t,logger:this._logger,causeId:e,resolveStates:[SlimCore.Enums.VideoStatus.Starting,SlimCore.Enums.VideoStatus.Running],rejectStates:[SlimCore.Enums.VideoStatus.NotAvailable],timeout:p.videoObjectTimeout(this._settings)})];case 4:return n.sent(),this._logger.info("Now can use preview video ".concat(t," causeId: ").concat(e)),[2]}}))}))},c._stopPreviewVideo=function(e,t){return a(c,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this._logger.info("Stopping preview video ".concat(t," causeId: ").concat(e)),[4,this._slimcoreInstance.videoStop(t)];case 1:return n.sent(),[2]}}))}))},c._createRendererBinding=function(e,t){return a(c,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,this._previewVideoManager.acquire(e,this._rendererBindingManager,t)];case 1:return r.sent(),n=this._slimcoreInstance.createVideoBindingRenderer({enableDXVA:this._settings.enableDXVA,isLocalPreview:!0}),this._logger.info("Create rendering binding for preview video ".concat(t," causeId: ").concat(e)),[4,this._slimcoreInstance.videoCreateBinding(t,n)];case 2:return r.sent(),this._logger.info("Created rendering binding for preview video ".concat(t," causeId: ").concat(e)),this._txNdiNotifiers.set(t,new S.default(this._logger,this._slimcoreInstance)),this._txNdiNotifiers.get(t).notifyNdiVideoStarted(e,t,n),[2,n]}}))}))},c._releaseRendererBinding=function(e,t,n){return a(c,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return this._logger.info("Release rendering binding for preview video ".concat(t," causeId: ").concat(e)),this._txNdiNotifiers.get(t).notifyNdiVideoStopped(e),this._txNdiNotifiers.delete(t),[4,this._slimcoreInstance.videoReleaseBinding(t,n)];case 1:r.sent(),this._logger.info("Released rendering binding for preview video ".concat(t," causeId: ").concat(e));try{n.dispose()}catch(e){}return[4,this._previewVideoManager.release(e,this._rendererBindingManager,t)];case 2:return r.sent(),[2]}}))}))},c._createNativeRendererBinding=function(e,t){return a(c,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=this._slimcoreInstance.createVideoBindingRenderer({enableDXVA:this._settings.enableDXVA,isLocalPreview:!0,useNativePreviewBinding:!0}),this._logger.info("Creating native preview rendering binding for video ".concat(t," causeId: ").concat(e)),[4,this._slimcoreInstance.videoCreateBinding(t,n)];case 1:return r.sent(),this._logger.info("Created native preview rendering binding for video ".concat(t," causeId: ").concat(e)),this._txNdiNotifiers.set(t,new S.default(this._logger,this._slimcoreInstance)),this._txNdiNotifiers.get(t).notifyNdiVideoStarted(e,t,n),[2,n]}}))}))},c._releaseNativeRendererBinding=function(e,t,n){return a(c,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return this._logger.info("Relearning native preview rendering binding for video ".concat(t," causeId: ").concat(e)),this._txNdiNotifiers.get(t).notifyNdiVideoStopped(e),this._txNdiNotifiers.delete(t),[4,this._slimcoreInstance.videoReleaseBinding(t,n)];case 1:r.sent(),this._logger.info("Released native preview rendering binding for video ".concat(t," causeId: ").concat(e));try{n.dispose()}catch(n){this._logger.warn("Failed rendering binding for video ".concat(t," causeId: ").concat(e))}return[2]}}))}))},c._createScreenShareBinding=function(e,t){return a(c,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,this._previewVideoManager.acquire(e,this._screenShareBindingManager,t)];case 1:return r.sent(),n=this._slimcoreInstance.createVideoBindingScreenShare(),this._logger.info("Create screenshare binding for preview video ".concat(t," causeId: ").concat(e)),[4,this._slimcoreInstance.videoCreateBinding(t,n)];case 2:return r.sent(),this._logger.info("Created screenshare binding for preview video ".concat(t," causeId: ").concat(e)),[2,n]}}))}))},c._releaseScreenShareBinding=function(e,t,n){return a(c,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return this._logger.info("Release screenshare binding for preview video ".concat(t," causeId: ").concat(e)),[4,this._slimcoreInstance.videoReleaseBinding(t,n)];case 1:r.sent(),this._logger.info("Released screenshare binding for preview video ".concat(t," causeId: ").concat(e));try{n.dispose()}catch(e){}return[4,this._previewVideoManager.release(e,this._screenShareBindingManager,t)];case 2:return r.sent(),[2]}}))}))};var l=!!n.disableAutoDeviceSelection,u=!!n.disableAutoCameraSelection||l;return c._disableBrowseridResolution=!!n.disableBrowseridResolution,c._logger.info("constructor disableAutoDeviceSelection: ".concat(l," disableAutoCameraSelection: ").concat(u," disableBrowseridResolution: ").concat(c._disableBrowseridResolution)),c._cameras=new T(c._logger.createChild("cameras"),u),c._microphones=new I(2,c._logger.createChild("microphones"),l),c._speakers=new I(3,c._logger.createChild("speakers"),l),c._compositeDevices=new P(c._logger.createChild("compositeaudiodevices")),c._devicesEnumeratedPromise=c._mediaReadyPromise.then((function(){return c._updateBrowserDevices()})).then((function(){c._updateAudioDevices(),c._updateVideoDevices(),c._handleDisplaysChanged()})),c._previewVideoManager=new f.SlimCoreElectronBindingManager(c._startPreviewVideo,c._stopPreviewVideo,c._logger.createChild("PreviewBindingManager/Video")),c._rendererBindingManager=new f.SlimCoreElectronBindingManager(c._createRendererBinding,c._releaseRendererBinding,c._logger.createChild("PreviewBindingManager/RendererBinding")),c._nativeRendererBindingManager=new f.SlimCoreElectronBindingManager(c._createNativeRendererBinding,c._releaseNativeRendererBinding,c._logger.createChild("PreviewBindingManager/NativeRendererBinding")),c._screenShareBindingManager=new f.SlimCoreElectronBindingManager(c._createScreenShareBinding,c._releaseScreenShareBinding,c._logger.createChild("PreviewBindingManager/ScreenShareBinding")),c._personalizedNoiseSuppression=new y.default(c._logger,c._settings,c._slimcoreInstance),c._mediaReadyPromise.then((function(){return c._personalizedNoiseSuppression.initialize()})),c._rtcAudioManager=new v.default(c._logger,c._settings,c._slimcoreInstance),c._mediaReadyPromise.then((function(){return c._rtcAudioManager.initialize()})),c._registerDisposable(c._slimcoreInstance.handle("device-list-changed",void 0,(function(e){c._slimCoreDevicesChangedHander(e)}))),c._registerDisposable(c._appHooks.onDisplaysChanged((function(){c._handleDisplaysChanged()}))),c._registerDisposable(c._slimcoreInstance.handle("video-effects-event",void 0,(function(e){c._slimCoreVideoEffectsEventHandler(e)}))),c._registerDisposable(c._slimcoreInstance.handle("shell-sharing-event",void 0,(function(e){c._onShellSharingEvent(e)}))),c._registerDisposable(c._slimcoreInstance.handle("video-extensibility-ipc-changed-event",void 0,(function(e){c._slimCoreVideoExtensibilityIpcChangedEventHandler(e)}))),c._registerDisposable(c._slimcoreInstance.handle("video-extensibility-error",void 0,(function(e){c._slimCoreVideoExtensibilityErrorHandler(e)}))),c._registerDisposable(c._slimcoreInstance.handle("video-extensibility-event",void 0,(function(e){c._slimCoreVideoExtensibilityEventHandler(e)}))),c}return i(t,e),t.mapMediaType=function(e){switch(e){case 0:return SlimCore.Enums.MediaType.Audio;case 1:return SlimCore.Enums.MediaType.Video;case 2:return SlimCore.Enums.MediaType.AppSharing;case 3:return SlimCore.Enums.MediaType.Data;default:throw new Error("invalid media type")}},t.mapDerivedSourceType=function(e){if(1===e)return SlimCore.Enums.DerivedSourceType.CompositeCamera;throw new Error("invalid derived source type")},t.isChildVideoDeviceDescr=function(e){return 5===e.kind},t.prototype.dispose=function(t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return this._logger.info("dispose causeId: ".concat(t)),n=l.map(this._previewRenderers,(function(e){return e.dispose(t).catch(l.noop)})),this._logger.info("dispose causeId: ".concat(t," sync pending previews: ").concat(n.length)),[4,Promise.all(n)];case 1:return r.sent(),e.prototype.dispose.call(this,t),this._logger.info("dispose causeId: ".concat(t," done")),[2]}}))}))},t.prototype.createPreviewVideoSession=function(e,t,n,r,i){return new(function(){function o(t){var o=this;this.dm=t,this.id=0,this._nativePreviewBindingEnabled=!1,this._previewVideoPromise=this.dm._getPreviewVideo(e,n,r,i),this._previewVideoPromise.then((function(e){return o.id=e})),this.dm._slimcoreInstance.getStageCapability?(this._nativePreviewCapPromise=this.dm._slimcoreInstance.getStageCapability(),this._nativePreviewCapPromise.then((function(e){return o._nativePreviewBindingEnabled=null==e?void 0:e.enabledNativePreviewBinding}))):this._nativePreviewCapPromise=Promise.resolve(null)}return o.prototype.acquireRendererBinding=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._previewVideoPromise];case 1:return n.sent(),[4,this._nativePreviewCapPromise];case 2:return n.sent(),this._nativePreviewBindingEnabled?[2,this.dm._nativeRendererBindingManager.acquire(e,t,this.id)]:[2,this.dm._rendererBindingManager.acquire(e,t,this.id)]}}))}))},o.prototype.releaseRendererBinding=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._previewVideoPromise];case 1:return n.sent(),[4,this._nativePreviewCapPromise];case 2:return n.sent(),this._nativePreviewBindingEnabled?[2,this.dm._nativeRendererBindingManager.release(e,t,this.id)]:[2,this.dm._rendererBindingManager.release(e,t,this.id)]}}))}))},o.prototype.acquireScreenShareBinding=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._previewVideoPromise];case 1:return n.sent(),[2,this.dm._screenShareBindingManager.acquire(e,t,this.id)]}}))}))},o.prototype.releaseScreenShareBinding=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._previewVideoPromise];case 1:return n.sent(),[2,this.dm._screenShareBindingManager.release(e,t,this.id)]}}))}))},o.prototype.registerVideoErrorHandler=function(e,t){var n=this,r=!1,i=a(n,void 0,void 0,(function(){var n,i,o=this;return s(this,(function(c){switch(c.label){case 0:return[4,this._previewVideoPromise];case 1:return n=c.sent(),[4,this._nativePreviewCapPromise];case 2:return c.sent(),this._nativePreviewBindingEnabled?[3,4]:[4,this.dm._previewVideoManager.acquire(e,this,n)];case 3:c.sent(),c.label=4;case 4:return i=this.dm._slimcoreInstance.handle("object-property-changed",{objectId:n,propKey:SlimCore.Enums.Property.VideoError},(function(e){return!r&&t(e.value)})),[2,{dispose:function(){return a(o,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return i.dispose(),[4,this._nativePreviewCapPromise];case 1:return t.sent(),this._nativePreviewBindingEnabled?[3,3]:[4,this.dm._previewVideoManager.release(e,this,n)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))}}]}}))}));return{dispose:function(){return a(n,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:if(r)return[3,4];r=!0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i];case 2:return[2,e.sent().dispose()];case 3:return e.sent(),[3,4];case 4:return[2]}}))}))}}},o}())(this)},Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.getSpeakerDeviceDomIdAsync=function(e,t){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){if(this._disableBrowseridResolution)throw new Error("Not implemented when disableBrowseridResolution is set");if(null==(t=l.find(this._speakers.getList(),(function(t){return e===t.id})))?void 0:t.browserId)return[2,t.browserId];throw new Error("Can not find speaker device with id".concat(e))}))}))},t.prototype.askDevicePermission=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(e){return[2,{audio:!0,video:!0}]}))}))},t.prototype.enumerateDevicesAsync=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._triggerMediaInitOnce(),[4,this.synchronizeSelectDevices()];case 1:return e.sent(),[2,this._enumerateDevices()]}}))}))},t.prototype.getPreferredCamera=function(){return this._cameras.getBestDevice()},t.prototype.synchronizeSelectDevices=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){return[2,this._devicesEnumeratedPromise]}))}))},t.prototype.selectDevices=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.synchronizeSelectDevices()];case 1:return t.sent(),this._selectDevices(e),[2]}}))}))},t.prototype.getPermissionState=function(e){return"granted"},t.prototype.setVideoCaptureConfigAsync=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return r.sent(),[4,this._slimcoreInstance.setVideoCaptureConfig(e,t)];case 2:return[2,r.sent()];case 3:throw n=r.sent(),this._logger.error("Failed to set video capture config, Error = ".concat(n)),n;case 4:return[2]}}))}))},t.prototype.captureVideoFrameWithoutEffectsAsync=function(e,t,n){return a(this,void 0,void 0,(function(){var r,i;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return o.sent(),[4,this._slimcoreInstance.captureVideoFrameWithoutEffects(e,t,n)];case 2:return r=o.sent(),[2,p.convertImageData(r)];case 3:throw i=o.sent(),this._logger.error("Failed to capture frame, Error = ".concat(i)),i;case 4:return[2]}}))}))},t.prototype.enableShellSharing=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._mediaReadyPromise];case 1:return e.sent(),[4,this._slimcoreInstance.enableShellSharing()];case 2:return[2,e.sent()]}}))}))},t.prototype.disableShellSharing=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._mediaReadyPromise];case 1:return e.sent(),[4,this._slimcoreInstance.disableShellSharing()];case 2:return[2,e.sent()]}}))}))},t.prototype.enableParticipantCameras=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return r.sent(),[4,this._slimcoreInstance.enableParticipantCameras(e,t)];case 2:return[2,r.sent()];case 3:throw n=r.sent(),this._logger.error("Failed to toggle participant cameras (enabled = ".concat(e,", forceAlwaysActive = ").concat(t,"), Error = ").concat(n)),n;case 4:return[2]}}))}))},t.prototype.registerDerivedSource=function(e,n){return a(this,void 0,void 0,(function(){var r,i;return s(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return a.sent(),r=t.mapDerivedSourceType(n.type),[4,this._slimcoreInstance.registerDerivedSource(e,o(o({},n),{type:r}))];case 2:return[2,a.sent()];case 3:throw i=a.sent(),this._logger.error("registerDerivedSource failed, error = ".concat(i)),i;case 4:return[2]}}))}))},t.prototype.unregisterDerivedSource=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return n.sent(),[4,this._slimcoreInstance.unregisterDerivedSource(e)];case 2:return[2,n.sent()];case 3:throw t=n.sent(),this._logger.error("unregisterDerivedSource failed, error = ".concat(t)),t;case 4:return[2]}}))}))},t.prototype.setDeviceEffectsAsync=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return r.sent(),[4,this._slimcoreInstance.setDeviceEffects(e,m.convertVideoEffectType(t))];case 2:return[2,r.sent()];case 3:throw n=r.sent(),this._logger.error("Failed to set Video Effects, Error = ".concat(n)),n;case 4:return[2]}}))}))},t.prototype.getMicrophoneGeometryArrayInfoAsync=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return n.sent(),[4,this._slimcoreInstance.getMicrophoneGeometryArrayInfo(e)];case 2:return[2,n.sent()];case 3:throw t=n.sent(),this._logger.error("Error in getMicrophoneGeometryArrayInfo, error = ".concat(t)),t;case 4:return[2]}}))}))},t.prototype.getDeviceEffectsCapabilityAsync=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return r.sent(),[4,this._slimcoreInstance.getDeviceEffectsCapability(e,t)];case 2:return[2,r.sent()];case 3:throw n=r.sent(),this._logger.error("Error in getDeviceEffectsCapabilityAsync, error = ".concat(n)),n;case 4:return[2]}}))}))},t.prototype.setBackgroundImageAsync=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return r.sent(),[4,this._slimcoreInstance.setBackgroundImage(e,t)];case 2:return[2,r.sent()];case 3:throw n=r.sent(),this._logger.error("Failed to set background image, Error = ".concat(n)),n;case 4:return[2]}}))}))},t.prototype.getImagePropertyAsync=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return o.sent(),[4,this._slimcoreInstance.getImageProperty(e)];case 2:if("string"==typeof(t=o.sent()))throw new Error("getImageProperty API is not available");return n=t.width,r=t.height,[2,{width:n,height:r,uri:e}];case 3:throw i=o.sent(),this._logger.error("Failed to check image ".concat(e,", Error = ").concat(i)),i;case 4:return[2]}}))}))},t.prototype.transformImageAsync=function(e,t,n,r){return a(this,void 0,void 0,(function(){var i;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return o.sent(),[4,this._slimcoreInstance.transformImage(e,t,n,r)];case 2:return[2,o.sent()];case 3:throw i=o.sent(),this._logger.error("Failed to transform image ".concat(e,", Error = ").concat(i)),i;case 4:return[2]}}))}))},t.prototype.sendMessageDeviceVideoEffectsAsync=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return r.sent(),[4,this._slimcoreInstance.sendMessageDeviceVideoEffects(e,t)];case 2:return[2,r.sent()];case 3:throw n=r.sent(),this._logger.error("Failed to send message Video Effects, Error = ".concat(n)),n;case 4:return[2]}}))}))},t.prototype.sendMessageDeviceVideoExtensibilityAsync=function(e,t){return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:return r.sent(),[4,this._slimcoreInstance.sendMessageDeviceVideoExtensibility(e,t)];case 2:return[2,r.sent()];case 3:throw n=r.sent(),this._logger.error("Failed to send message Video Extensibility, Error = ".concat(n)),n;case 4:return[2]}}))}))},t.prototype.getSelectedDevices=function(){var e={camera:this._cameras.getSelectedDevice(),microphone:this._microphones.getSelectedDevice(),speaker:this._speakers.getSelectedDevice()};return this._logger.debug("getSelectedDevices - ".concat(JSON.stringify(e))),e},t.prototype.getCamera=function(e){return l.find(this._cameras.getList(),(function(t){return t.id===e}))},t.prototype.getChildCameras=function(e){return l.filter(this._cameras.getList(),(function(n){return t.isChildVideoDeviceDescr(n)&&n.parentId===e}))},t.prototype.getCameraForPreview=function(e){var t=this._getCameraForPreview(e);return this._logger.debug("getCameraForPreview id ".concat(e," - ").concat(JSON.stringify(t))),t},t.prototype.getSelectedCameraForPreview=function(){var e=this._cameras.getSelectedDevice(),t=this._getCameraForPreview(e);return this._logger.debug("getSelectedCameraForPreview id ".concat(e," - ").concat(JSON.stringify(t))),t},t.prototype.getSelectedCamera=function(){var e=this._cameras.getSelectedDevice(),t=this.getCamera(e);return this._logger.debug("getSelectedCamera - ".concat(JSON.stringify(t))),t},t.prototype.createPreview=function(e,t,n,r){return void 0===r&&(r=(0,d.generateCauseId)()),a(this,void 0,void 0,(function(){var i,o,a=this;return s(this,(function(s){switch(s.label){case 0:(i=new _.default(r,this._logger,this._settings,this._slimcoreInstance,e,this,t,n)).deferredDispose.then((function(){l.remove(a._previewRenderers,(function(e){return e===i}))})),this._previewRenderers.push(i),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,i.startVideoAsync(r)];case 2:return s.sent(),[2,i];case 3:throw o=s.sent(),i.dispose(r),o;case 4:return[2]}}))}))},t.prototype.createPreviewRenderer=function(e,t,n){return void 0===n&&(n=(0,d.generateCauseId)()),this.createPreview(e,{kind:"camera"},t,n)},t.prototype.createScreenSharingPreviewRenderer=function(e,t,n){return void 0===n&&(n=(0,d.generateCauseId)()),this.createPreview(e,{kind:"sharing"},t,n)},t.prototype.getDeviceNameAsync=function(e){var t=this;return(0,u.asap)((function(){var n=l.find(t._enumerateDevices(),(function(t){return t.id===e}));if(!n)throw new Error("Device with id: ".concat(e," not found"));return n.label}))},t.prototype.setAudioProcessingFlags=function(e){this._logger.warn("setAudioProcessingFlags not supported")},t.prototype.getSpeakerVolume=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._mediaReadyPromise];case 1:return e.sent(),[4,this._slimcoreInstance.getSpeakerVolume()];case 2:return[2,e.sent()]}}))}))},t.prototype.getSpeakerSystemVolume=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._mediaReadyPromise];case 1:return e.sent(),[4,this._slimcoreInstance.getSpeakerSystemVolume()];case 2:return[2,e.sent()]}}))}))},t.prototype.setSpeakerVolume=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._mediaReadyPromise];case 1:return t.sent(),[4,this._slimcoreInstance.setSpeakerVolume(e)];case 2:return[2,t.sent()]}}))}))},t.prototype.setSpeakerSystemVolume=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._mediaReadyPromise];case 1:return t.sent(),[4,this._slimcoreInstance.setSpeakerSystemVolume(e)];case 2:return[2,t.sent()]}}))}))},t.prototype.unmuteMicrophone=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._mediaReadyPromise];case 1:return e.sent(),[4,this._slimcoreInstance.unmuteMicrophone()];case 2:return[2,e.sent()]}}))}))},t.prototype.unmuteSpeaker=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._mediaReadyPromise];case 1:return e.sent(),[4,this._slimcoreInstance.unmuteSpeaker()];case 2:return[2,e.sent()]}}))}))},t.prototype.getNrgLevelsForDeviceTuner=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._mediaReadyPromise];case 1:return t.sent(),[4,this._slimcoreInstance.getNrgLevelsForDeviceTuner(e)];case 2:return[2,t.sent()]}}))}))},t.prototype.setAudioEffectsAsync=function(e,t){return a(this,void 0,void 0,(function(){return s(this,(function(e){return[2,Promise.reject(new Error("Not implemented"))]}))}))},t.prototype.getAudioFeatureCapability=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,this._mediaReadyPromise];case 1:return n.sent(),t=function(e){switch(e){case"HighNoiseSuppression":return SlimCore.Enums.AudioFeatureType.HighNoiseSuppression;case"PersonalizedNoiseSuppression":return SlimCore.Enums.AudioFeatureType.PersonalizedNoiseSuppression;default:return}}(e),void 0===t?[2,Promise.reject("Could not find a mapping for given AudioFeatureType of ".concat(e))]:(this._logger.info("getAudioFeatureCapability called with feature ".concat(e," which maps to SlimCore feature ").concat(t)),[4,this._slimcoreInstance.getAudioFeatureCapability(t)]);case 2:return[2,n.sent()]}}))}))},t.prototype.getMicrophoneVolume=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._mediaReadyPromise];case 1:return e.sent(),[4,this._slimcoreInstance.getMicrophoneVolume()];case 2:return[2,e.sent()]}}))}))},t.prototype.setMicrophoneVolume=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._mediaReadyPromise];case 1:return t.sent(),[4,this._slimcoreInstance.setMicrophoneVolume(e)];case 2:return[2,t.sent()]}}))}))},t.prototype.setDeviceTelemetryData=function(e,n,r,i){return void 0===i&&(i=0),a(this,void 0,void 0,(function(){var o;return s(this,(function(a){switch(a.label){case 0:if(void 0===(o=function(e){switch(e){case 0:return SlimCore.Enums.DeviceTelemetryDataContext.CallStart;case 1:return SlimCore.Enums.DeviceTelemetryDataContext.SelectedDeviceChangedFromUI;case 2:return SlimCore.Enums.DeviceTelemetryDataContext.SelectedDeviceChangedFromHid;case 3:return SlimCore.Enums.DeviceTelemetryDataContext.PairedBTDeviceUpdated;case 4:return SlimCore.Enums.DeviceTelemetryDataContext.PeriodicSelectedDeviceData;case 5:return SlimCore.Enums.DeviceTelemetryDataContext.InvalidContext;default:return}}(n)))throw new Error("Could not find a mapping for given DeviceTelemetryDataContext of ".concat(n));return[4,this._mediaReadyPromise];case 1:return a.sent(),[4,this._slimcoreInstance.setDeviceTelemetryData(e,o,r,t.mapMediaType(i))];case 2:return[2,a.sent()]}}))}))},t.prototype.getDevicePTZCapabilityAsync=function(e){return a(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:if(i.sent(),t=e,!e){if(!(null==(n=this.getSelectedDevices())?void 0:n.camera))throw new Error("applyPTZControlCommand failed: no camera selected");t=n.camera}return[4,this._slimcoreInstance.getDevicePTZCapability(t)];case 2:return[2,i.sent()];case 3:throw r=i.sent(),this._logger.error("Error in getDevicePTZCapabilityAsync, error = ".concat(r)),r;case 4:return[2]}}))}))},t.prototype.applyPTZControlCommandAsync=function(e){return a(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._mediaReadyPromise];case 1:if(r.sent(),!(null==(t=this.getSelectedDevices())?void 0:t.camera))throw new Error("applyPTZControlCommand: no camera selected");return[4,this._slimcoreInstance.applyPTZControlCommand(t.camera,e)];case 2:return[2,r.sent()];case 3:throw n=r.sent(),this._logger.error("Failed to apply ptz commands, Error = ".concat(n)),n;case 4:return[2]}}))}))},t.prototype.getSourceFormats=function(e){return this._slimcoreInstance.getSourceFormats(e)},t.prototype.startAudioLoopbackDevice=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._mediaReadyPromise];case 1:return t.sent(),[4,this._slimcoreInstance.startAudioLoopbackDevice(e)];case 2:return[2,t.sent()]}}))}))},t.prototype.getPersonalizedNoiseSuppression=function(){return this._personalizedNoiseSuppression},t.prototype.getRtcAudioManager=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._mediaReadyPromise];case 1:return e.sent(),[2,this._rtcAudioManager]}}))}))},t.prototype.createAudioPlayer=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._triggerMediaInitOnce(),[4,this._mediaReadyPromise];case 1:return e.sent(),[2,new h.default(this._logger,this._settings,this._slimcoreInstance,this)]}}))}))},t.prototype._handleDisplaysChanged=function(){try{if(this._slimcoreInstance.updateDeviceRotation)return this._slimcoreInstance.updateDeviceRotation();this._slimcoreInstance.setDeviceRotation(SlimCore.queryDeviceRotation())}catch(e){this._logger.warn("Displays Changed handling error: ".concat(e))}},t.prototype._updateVideoDevices=function(){return this._cameras.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getCameraList(),"videoinput"))},t.prototype._updateAudioDevices=function(){var e=this._microphones.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getMicrophoneList(),"audioinput")),t=this._speakers.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getSpeakerList(),"audiooutput")),n=this._slimcoreInstance.getCompositeAudioDevices&&this._compositeDevices.update(this._slimcoreInstance.getCompositeAudioDevices());return(e||t)&&this._selectAudioDevices(),e||t||n},t.prototype._updateBrowserDevices=function(){var e=this;return this._disableBrowseridResolution?Promise.resolve():"object"!=typeof navigator?(this._logger.warn("Browser-backed device list won't be fetched as navigator is not available"),Promise.resolve()):this._browserDevicesPromise?this._browserDevicesPromise:(this._logger.info("enumerate browser devices"),this._browserDevicesPromise=navigator.mediaDevices.enumerateDevices().then((function(t){e._logger.info("got browser devices"),e._browserDevices=t,e._browserDevicesPromise=void 0})))},t.prototype._fillBrowserDeviceIds=function(e,t){if(l.isEmpty(e))return e;var n=this._browserDevices.filter((function(e){return t===e.kind}));return l.isEmpty(n)||this._updateBrowserDeviceIds(e,n),e},t.prototype._triggerMediaInitOnce=function(){!this._haveStartedMedia&&p.hasFeature(SlimCore.Enums.Feature.LazyMediaInit)&&(this._slimcoreInstance.fireIntent(SlimCore.Enums.Intent.MediaInit),this._haveStartedMedia=!0)},t.prototype._updateBrowserDeviceIds=function(e,t){for(var n=l.sortBy(e,(function(e){return-e.label.length})),r=l.sortBy(t,(function(e){return e.label.length})),i=function(e){var t=l.findIndex(r,(function(t){return 0===t.label.indexOf(e.label)}));-1!==t?(e.browserId=r[t].deviceId,r.splice(t,1)):o._logger.warn("No browser device found for device ".concat(e.label))},o=this,a=0,s=n;a<s.length;a++){i(s[a])}},t.prototype.mapBrowserDevices=function(e,t){if(l.isEmpty(e)||l.isEmpty(t))return Promise.resolve(e);var n=e.map((function(e){return o({},e)}));return this._updateBrowserDeviceIds(n,t),Promise.resolve(n)},t.prototype._selectAudioDevices=function(){var e=this._microphones.getSelectedDevice(),t=this._speakers.getSelectedDevice();this._logger.info("SlimCore - selectAudioDevices: ".concat(e,", ").concat(t)),this._slimcoreInstance.selectAudioDevices(null!=e?e:"",null!=t?t:"")},t.prototype._slimCoreDevicesChangedHander=function(e){var t=this;this._logger.info("SlimCore Devices changed: ".concat(JSON.stringify(e))),this._updateBrowserDevices().then((function(){(e.video?t._updateVideoDevices():t._updateAudioDevices())?t._raiseDevicesChanged(e.video):t._logger.info("Supress device changed notification as nothing changed isVideo: ".concat(e.video))})).catch((function(e){t._logger.error("Failed to raise device changed notification, error = ".concat(e))}))},t.prototype._raiseDevicesChanged=function(e){this._logger.info("Raising device changed notification isVideo: ".concat(e)),e&&this.event("videoDevicesChanged").raise(),this.event("devicesChanged").raise(this._enumerateDevices()),this.raiseChanged(),this._logger.info("Raised device changed notification isVideo: ".concat(e))},t.prototype._enumerateDevices=function(){var e=this._cameras.getList(),t=this._microphones.getList(),n=this._speakers.getList(),r=this._compositeDevices.getList();return[].concat(e,t,n,r)},t.prototype._selectDevices=function(e){this._logger.debug("selectDevices - ".concat(JSON.stringify(e)));var t=void 0!==e.camera;if(t&&this._cameras.selectDevice(e.camera),void 0!==e.microphone&&this._microphones.selectDevice(e.microphone),void 0!==e.speaker&&this._speakers.selectDevice(e.speaker),void 0!==e.audioIngestDevice)try{this._slimcoreInstance.selectAudioIngestDevice(e.audioIngestDevice)}catch(e){this._logger.error("Failed to select audio ingest device, Error = ".concat(e))}this._selectAudioDevices(),this._raiseDevicesChanged(t)},t.prototype._slimCoreVideoEffectsEventHandler=function(e){this._logger.info("SlimCore VideoEffects events: ".concat(JSON.stringify(e)));var t={type:e.type,payload:e.payload};this.event("videoEffectsEvent").raise(e.deviceId,t)},t.prototype._onShellSharingEvent=function(e){this.event("shellSharingEvent").raise(e.windowId,e.doShare)},t.prototype._slimCoreVideoExtensibilityIpcChangedEventHandler=function(e){var t={sharedMemoryName:e.sharedMemoryName,frameReadyEventName:e.frameReadyEventName,frameProcessedEventName:e.frameProcessedEventName};this.event("videoExtensibilityIpcChangedEvent").raise(e.deviceId,t)},t.prototype._slimCoreVideoExtensibilityErrorHandler=function(e){var t={errorType:e.errorType,errorId:e.errorId,errorMessage:e.errorMessage};this.event("videoExtensibilityError").raise(e.deviceId,t)},t.prototype._slimCoreVideoExtensibilityEventHandler=function(e){var t=e.payloadJson?JSON.parse(e.payloadJson):void 0,n={eventType:e.eventType,payload:t};this.event("videoExtensibilityEvent").raise(e.deviceId,n)},t.prototype._getCameraForPreview=function(e){var t=this.getChildCameras(e);return l.isEmpty(t)?this.getCamera(e):l.find(t,(function(e){return e.useForPreview}))},t.prototype._getPreviewVideo=function(e,t,n,r){return a(this,void 0,void 0,(function(){var i;return s(this,(function(o){switch(o.label){case 0:return[4,this._mediaReadyPromise];case 1:return o.sent(),[4,this._slimcoreInstance.createPreviewVideo(t,n,r)];case 2:if(0===(i=o.sent()))throw new Error("SlimCore returned invalid video object ID 0");return this._logger.info("Got preview video ".concat(i," causeId: ").concat(e)),[2,i]}}))}))},t}(g.default);t.default=O},9637:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(1775),l=n(7584),u=n(5025),d=function(e){function t(t,n,r,i,o,a,s,c){var l=e.call(this,new u.default(t).createChild("[downloader]"),n,r)||this;return l._logger.info("constructor source=".concat(o," sourceType=").concat(a," name=").concat(s," forceDownload=").concat(c)),l._scDownloader=l._slimcoreInstance.createDownloader(o,function(e){switch(e){case 0:return SlimCore.Enums.DownloadSource.PublicUrl;case 1:return SlimCore.Enums.DownloadSource.TenantUrl;case 2:return SlimCore.Enums.DownloadSource.FileSystem;default:return}}(a),i,s,c),l}return i(t,e),t.prototype.dispose=function(e){void 0===e&&(e=(0,l.generateCauseId)()),this._logger.createFnLogger("dispose",e).info("disposing downloader"),this._scDownloader.dispose()},t.prototype.startDownload=function(e){return void 0===e&&(e=(0,l.generateCauseId)()),a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this._logger.createFnLogger("startDownload",e).info("starting download"),[4,this._scDownloader.startDownload()];case 1:return t=n.sent(),[2,o(o({},t),{result:p(t.result)})]}}))}))},t}(c.default);function p(e){switch(e){case SlimCore.Enums.DownloadResult.Ok:return 0;case SlimCore.Enums.DownloadResult.Failed:return 1;case SlimCore.Enums.DownloadResult.Cancelled:return 2;default:return}}t.default=d},2238:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreElectronEcsClient=t.QueryParametersHandler=void 0;var a=n(1759),s=n(4148),c=n(5442),l=n(3607),u=n(3907),d=function(){function e(e,t,n,r,i){this._skypeId=e,this._logger=n,this._slimcoreInstance=r,this.refreshConfig=i,this._paramsStore={},t?(this._logger.info("Processing Account configuration at init."),this.processQueryParams(t)):this._logger.info("No Account configuration provided at init."),this._registerUser(e)}return e.prototype._registerUser=function(e){this._logger.info("Adding userID/AADUserID parameters."),this._paramsStore.UserID=e,this._paramsStore.AADUserID=e},e.prototype.processQueryParams=function(e){this._printFullParams("Processing Account configuration: ".concat(JSON.stringify(e))),(null==e?void 0:e.region)&&(this._paramsStore.Region=e.region),(null==e?void 0:e.regionOverride)&&(this._paramsStore.RegionOverride=e.regionOverride),(null==e?void 0:e.tenantId)&&(this._paramsStore.TenantID=e.tenantId),(null==e?void 0:e.ring)&&(this._paramsStore.AudienceGroup=e.ring,this._paramsStore.TeamsRing!==e.ring&&(this._paramsStore.TeamsRing=e.ring,this.refreshConfig()))},e.prototype.getQueryParams=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,a=this;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._slimcoreInstance.ecsGetUserQueryParameters(this._skypeId)];case 1:return e=o.sent(),t=e?JSON.parse(e):{},n=r(r({},t),this._paramsStore),this._printFullParams("Assembled QueryParameters from slimcore and Account configuration, assembledParams: ".concat(JSON.stringify(n,(function(e,t){return a._userDataSanitizer(e,t)})))),[2,n];case 2:throw i=o.sent(),this._logger.error("getQueryParams failed. error: ".concat(i)),i;case 3:return[2]}}))}))},e.prototype._userDataSanitizer=function(e,t){return-1===["UserID","AADUserID"].indexOf(e)?t:l.mriOrId(t)},e.prototype._printFullParams=function(e){var t=320,n=Math.ceil(e.length/t);if(e.length>=t)for(var r=0,i=0;r<n;++r,i+=t)this._logger.info(e.slice(i,i+t));else this._logger.info("".concat(e))},e}();t.QueryParametersHandler=d;var p=function(){function e(e,t){this._slimcoreInstance=e,this._logger=t,this._ecsClient=new a.default,this._subscriptionToken=void 0,this._disposed=!1,this._queryParams=void 0,this._deferredInit=new c.Deferred}return e.prototype.init=function(e,t,n,r){var a;return i(this,void 0,void 0,(function(){var i,s,c=this;return o(this,(function(o){switch(o.label){case 0:return this._queryParams=new d(e,r,this._logger,this._slimcoreInstance,(function(){return c._refreshConfig()})),this._uiType=null!==(a=null==r?void 0:r.clientType)&&void 0!==a?a:"none",(i=this._getUiVersion())?[4,this._getConfig(e,i,t)]:(this._logger.warn("init uiVersion: <undefined>"),[2]);case 1:return s=o.sent(),[4,this._ecsClient.initialize(s).toEs6Promise()];case 2:return o.sent(),this._logger.info("Initialized esclient for user ".concat(l.mriOrId(e),". uiVersion: ").concat(i)),this._subscriptionToken=this._ecsClient.configUpdated.subscribe((function(){try{var t=c._ecsClient.getConfig();if((0,u.isObjectEmpty)(t.config))c._logger.error("Failed to set ECS config -object is null, will not apply it");else{var r=JSON.stringify(t.config);c._logger.info("Subscribe config received. eTag: ".concat(t.eTag,", expiration: ").concat(t.expiration,", type: ").concat(t.configType,", setting it for user ").concat(l.mriOrId(e))),c._slimcoreInstance.setEcsConfig(r,e,t.eTag),n.setConfig(t.config)}}catch(e){c._logger.error("Failed to set ECS config - error: ".concat(e))}})),this._deferredInit.resolve(),[2,this._deferredInit.promise]}}))}))},e.prototype._refreshConfig=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this._deferredInit.promise];case 1:return e.sent(),this._ecsClient.requestUpdate(),[2]}}))}))},e.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._subscriptionToken&&this._subscriptionToken.unsubscribe(),this._ecsClient.pause())},e.prototype.setAppActive=function(e){this._logger.info("setAppActive new value: ".concat(e)),this._ecsClient.setAppActive(e)},e.prototype.updateQueryParameters=function(e){this._queryParams?this._queryParams.processQueryParams(e):this._logger.warn("ecs client is not initialized")},e.prototype._getUiVersion=function(){var e;return null===(e=this._slimcoreInstance.getVersionString())||void 0===e?void 0:e.replace(/\//g,"_")},e.prototype._getEcsServers=function(e,t){return i(this,void 0,void 0,(function(){var n,r,a,s,c,l,u,d=this;return o(this,(function(p){switch(p.label){case 0:return n="*Lib/ECS/Servers","https://config.teams.microsoft.com","Teams",r="https://a.config.skype.com",a="Skype",c=function(){return"enterprise"===d._uiType?["https://config.teams.microsoft.com","Teams"]:[r,a]},[4,this._slimcoreInstance.getUserEcsServerUrl(e)];case 1:return(l=p.sent())?(this._logger.info("_getEcsServers override. Server: ".concat(l)),s=[l],[3,4]):[3,2];case 2:return u=function(e){return i(d,void 0,void 0,(function(){var r,i,a,s;return o(this,(function(o){switch(o.label){case 0:return[4,t.getSubKey(n,e)];case 1:return(r=o.sent())&&""!==r?[4,t.getString("".concat(n,"/").concat(r))]:[2,[]];case 2:return(i=o.sent())&&""!==i?(s=(a=[i]).concat,[4,u(e+1)]):[2,[]];case 3:return[2,s.apply(a,[o.sent()])]}}))}))},[4,u(0)];case 3:s=p.sent(),p.label=4;case 4:return s.length?[2,s.map((function(e){d._logger.info("_getEcsServers server: ".concat(e));try{var t=e.match(/^(https?:\/\/[^/]+)\/config\/v1\/([^/]+)\/?/);return t?[t[1],t[2]]:c()}catch(e){return d._logger.warn("_getEcsServers server match error: ".concat(e,", return default")),c()}}))]:(this._logger.info("_getEcsServers no server set. Fallback to default."),[2,[c()]])}}))}))},e.prototype._getConfig=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i=this;return o(this,(function(o){switch(o.label){case 0:return[4,this._getEcsServers(e,n)];case 1:return[2,{clientName:(r=o.sent())[0][1],clientVersion:t,hosts:r.map((function(e){return e[0]})),configsToFetch:[a.Models.EcsConfigType.Default],getEcsParameters:function(){return s.fromThenable(i._queryParams.getQueryParams())},initialAppActiveState:!0}]}}))}))},e}();t.SlimCoreElectronEcsClient=p},7443:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreElectronEcsConfigurationLocal=void 0;var r=n(3607),i=n(3907),o=function(){function e(e,t,n){this._slimcoreInstance=e,this._logger=t,this._accountIdentity=n}return e.prototype.getBoolean=function(e,t,n){var r;try{return this._slimcoreInstance.ecsGetUserSettingAsBool?this._slimcoreInstance.ecsGetUserSettingAsBool(null!==(r=this._accountIdentity)&&void 0!==r?r:"",e,t,null!=n&&n):this._slimcoreInstance.ecsGetSettingAsBool(e,t,n)}catch(e){return this._logger.error("getBoolean: ",e),null!=n&&n}},e.prototype.getNumber=function(e,t,n){var r;try{return this._slimcoreInstance.ecsGetUserSettingAsInt?this._slimcoreInstance.ecsGetUserSettingAsInt(null!==(r=this._accountIdentity)&&void 0!==r?r:"",e,t,null!=n?n:0):this._slimcoreInstance.ecsGetSettingAsInt(e,t,n)}catch(e){return this._logger.error("getNumber: ",e),null!=n?n:0}},e.prototype.getString=function(e,t,n){var r;try{return this._slimcoreInstance.ecsGetUserSettingAsString?this._slimcoreInstance.ecsGetUserSettingAsString(null!==(r=this._accountIdentity)&&void 0!==r?r:"",e,t,null!=n?n:""):this._slimcoreInstance.ecsGetSettingAsString(e,t,n)}catch(e){return this._logger.error("getString: ",e),null!=n?n:""}},e}();t.default=o;var a=function(){function e(e,t){this._logger=e,this._accountIdentity=t,this._minConfig={SkylibInfrastructure:{enableAdmitAll:!0,enablePublishState:!0,enableMeetingSettings:!0,enableJoinWithMeetingCode:!0,enableGetAllParticipants:!0,enableSearchParticipants:!0,enableMusicOnHoldV2:!0,enableBreakoutRooms:!0,enableUnrestrictingAttendees:!0,enableSafeTransfer:!0,enableRaiseHands:!0,enableStructuredMeetings:!0,enableCCWM:!0,enableE2EEncryption:!0}},this._config=this._minConfig,this._logger.info("constructed configuration object for user: ".concat(r.mriOrId(this._accountIdentity))),this._haveLocalStorage=function(){try{var e=window.localStorage,t="someKey";return e.setItem(t,"someValue"),e.removeItem(t),!0}catch(e){return!1}}(),this._haveLocalStorage&&this._loadConfig()}return e.prototype.setConfig=function(e){(0,i.isObjectEmpty)(e)?this._logger.error("Config object is null, will not apply it"):(this._config=e,this._haveLocalStorage&&this._saveConfig(this._config))},e.prototype.getBoolean=function(e,t,n){try{var r=this._valueFromKey(e,t);if("boolean"==typeof r)return r}catch(e){}return n||!1},e.prototype.getNumber=function(e,t,n){try{var r=this._valueFromKey(e,t);if("number"==typeof r)return r}catch(e){}return n||0},e.prototype.getString=function(e,t,n){try{var r=this._valueFromKey(e,t);if("string"==typeof r)return r}catch(e){}return n||""},e.prototype._valueFromKey=function(e,t){try{var n=this._config;if(""!==e)for(var r=0,i=e.split("/");r<i.length;r++){n=n[i[r]]}for(var o=0,a=t.split("/");o<a.length;o++){n=n[a[o]]}return n}catch(n){return void this._logger.warn('valueFromKey: no value found for ns "'.concat(e,'", key "').concat(t,'"'))}},e.prototype._createKey=function(){return"tscalling_ecsconf.".concat(this._accountIdentity)},e.prototype._saveConfig=function(e){try{var t=JSON.stringify(e);window.localStorage.setItem(this._createKey(),t),this._logger.info("Saved config for user: ".concat(r.mriOrId(this._accountIdentity)))}catch(e){this._logger.error("Unable to store config for user: ".concat(r.mriOrId(this._accountIdentity),", error ").concat(e))}},e.prototype._loadConfig=function(){try{var e=JSON.parse(window.localStorage.getItem(this._createKey()));(0,i.isObjectEmpty)(e)?this._logger.error("Will not load ECS config from local storage, object is null"):(this._config=e,this._logger.info("Applying ECS config from local storage"))}catch(e){this._logger.error("Unable to load config for user: ".concat(r.mriOrId(this._accountIdentity),", error ").concat(e))}},e}();t.SlimCoreElectronEcsConfigurationLocal=a},7180:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(7443),a=function(){function e(e,t){this._slimcoreInstance=e,this._logger=t}return e.prototype.setEcsConfig=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this._slimcoreInstance.setEcsConfig(e.ecsBlob,e.userIdentity,e.etag,!0)]}))}))},e.prototype.setUserEcsServerUrl=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){return[2,this._slimcoreInstance.setUserEcsServerUrl(e,t)]}))}))},e.prototype.getUserEcsServerUrl=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this._slimcoreInstance.getUserEcsServerUrl(e)]}))}))},e.prototype.setActiveUserForEcs=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this._slimcoreInstance.setActiveUserForEcs(e)]}))}))},e.prototype.shouldTriggerCQF=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){return r=SlimCore.Enums.CallType.CallTypeS2s,0===n?r=SlimCore.Enums.CallType.CallTypeGroup:2===n?r=SlimCore.Enums.CallType.CallTypePstn:1===n&&(r=SlimCore.Enums.CallType.CallTypeS2s),[2,this._slimcoreInstance.shouldTriggerCQF(e,t,r)]}))}))},e.prototype.getEcsQueryParameters=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._slimcoreInstance.getEcsQueryParameters()]}))}))},e.prototype.ecsGetUserQueryParameters=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this._slimcoreInstance.ecsGetUserQueryParameters(e)]}))}))},e.prototype.getEcsConfiguration=function(e){return new o.default(this._slimcoreInstance,this._logger.createChild("SlimCoreElectronEcsConfiguration"),e)},e}();t.default=a},1011:function(e,t){"use strict";function n(e){switch(e){case SlimCore.Enums.ParticipantFailureReason.NoFailure:case SlimCore.Enums.ParticipantFailureReason.HostEndedConf:return 0;case SlimCore.Enums.ParticipantFailureReason.AnsweredElsewhere:return 23;case SlimCore.Enums.ParticipantFailureReason.RecipientUserNotFound:case SlimCore.Enums.ParticipantFailureReason.RecipientNotOnline:case SlimCore.Enums.ParticipantFailureReason.PstnCouldNotConnectToSkypeProxy:case SlimCore.Enums.ParticipantFailureReason.CallNotificationDeliveryFailure:return 4;case SlimCore.Enums.ParticipantFailureReason.RecipientBlocked:return 5;case SlimCore.Enums.ParticipantFailureReason.CallerNotFriend:case SlimCore.Enums.ParticipantFailureReason.CallerNotAuthorized:return 6;case SlimCore.Enums.ParticipantFailureReason.ConfParticipantCountLimitReached:return 46;case SlimCore.Enums.ParticipantFailureReason.ConfLobbyParticipantCountLimitReached:return 59;case SlimCore.Enums.ParticipantFailureReason.PstnNoSkypeoutSubscription:return 7;case SlimCore.Enums.ParticipantFailureReason.CallNotFound:return 8;case SlimCore.Enums.ParticipantFailureReason.PstnNetworkError:case SlimCore.Enums.ParticipantFailureReason.PstnInternetConnectionLost:case SlimCore.Enums.ParticipantFailureReason.TrouterError:case SlimCore.Enums.ParticipantFailureReason.GeneralNetworkError:return 9;case SlimCore.Enums.ParticipantFailureReason.MediaDroppedError:case SlimCore.Enums.ParticipantFailureReason.SoundRecordingError:case SlimCore.Enums.ParticipantFailureReason.SoundPlaybackError:return 10;case SlimCore.Enums.ParticipantFailureReason.PstnInsufficientFunds:return 12;case SlimCore.Enums.ParticipantFailureReason.PstnCreditExpired:return 26;case SlimCore.Enums.ParticipantFailureReason.PstnCreditExpiredButEnough:return 27;case SlimCore.Enums.ParticipantFailureReason.MiscError:case SlimCore.Enums.ParticipantFailureReason.PstnMiscError:return 11;case SlimCore.Enums.ParticipantFailureReason.PstnSkypeoutAccountBlocked:return 13;case SlimCore.Enums.ParticipantFailureReason.PstnBlockedByUs:return 15;case SlimCore.Enums.ParticipantFailureReason.PstnBlockedRegulatoryIndia:return 16;case SlimCore.Enums.ParticipantFailureReason.PstnInvalidNumber:return 17;case SlimCore.Enums.ParticipantFailureReason.PstnNumberForbidden:return 18;case SlimCore.Enums.ParticipantFailureReason.PstnCallTimedOut:return 2;case SlimCore.Enums.ParticipantFailureReason.PstnBusy:return 19;case SlimCore.Enums.ParticipantFailureReason.PstnCallTerminated:return 20;case SlimCore.Enums.ParticipantFailureReason.PstnNumberUnavailable:return 21;case SlimCore.Enums.ParticipantFailureReason.PstnCallRejected:return 3;case SlimCore.Enums.ParticipantFailureReason.PstnEmergencyCallDenied:return 22;case SlimCore.Enums.ParticipantFailureReason.PstnNoSubscriptionCover:return 25;case SlimCore.Enums.ParticipantFailureReason.EnterprisePstnForbidden:return 30;case SlimCore.Enums.ParticipantFailureReason.EnterprisePstnInternalError:return 28;case SlimCore.Enums.ParticipantFailureReason.EnterprisePstnUnavailable:return 29;case SlimCore.Enums.ParticipantFailureReason.EnterprisePstnInvalidNumber:return 31;case SlimCore.Enums.ParticipantFailureReason.EnterprisePstnMiscError:return 32;case SlimCore.Enums.ParticipantFailureReason.Kicked:return 33;case SlimCore.Enums.ParticipantFailureReason.NetworkRequestTimeoutError:return 34;case SlimCore.Enums.ParticipantFailureReason.CallDoesNotExist:return 35;case SlimCore.Enums.ParticipantFailureReason.MediaSetupFailure:return 36;case SlimCore.Enums.ParticipantFailureReason.ServiceUnavailable:return 37;case SlimCore.Enums.ParticipantFailureReason.SignalingError:return 38;case SlimCore.Enums.ParticipantFailureReason.ConversationEstablishmentFailed:return 39;case SlimCore.Enums.ParticipantFailureReason.TemporarilyUnavailable:return 40;case SlimCore.Enums.ParticipantFailureReason.NetworkCannotConnectError:return 41;case SlimCore.Enums.ParticipantFailureReason.NoSignalingFromPeer:return 42;case SlimCore.Enums.ParticipantFailureReason.AnonymousJoinDisabledByPolicy:return 53;case SlimCore.Enums.ParticipantFailureReason.NoLobbyForBroadcastJoin:return 54;case SlimCore.Enums.ParticipantFailureReason.NotAllowedDueToInformationBarrier:return 55;case SlimCore.Enums.ParticipantFailureReason.BroadcastLimitReached:return 56;case SlimCore.Enums.ParticipantFailureReason.B2bJoinDisabledByPolicy:return 57;case SlimCore.Enums.ParticipantFailureReason.LocationBasedRoutingError:return 58;case SlimCore.Enums.ParticipantFailureReason.Forbidden:return 52;default:return 11}}Object.defineProperty(t,"__esModule",{value:!0}),t.convertFailureReasonToParticipantReason=t.convertStatusAndFailureReasonToParticipantReason=t.convertVideoEffectType=void 0,t.convertVideoEffectType=function(e){switch(e){case 0:default:return SlimCore.Enums.VideoEffectType.Off;case 1:return SlimCore.Enums.VideoEffectType.BackgroundBlurDefault;case 2:return SlimCore.Enums.VideoEffectType.BackgroundBlurLight;case 4:return SlimCore.Enums.VideoEffectType.BackgroundBlurExperimental_1;case 8:return SlimCore.Enums.VideoEffectType.BackgroundBlurExperimental_2;case 16:return SlimCore.Enums.VideoEffectType.BackgroundReplacement;case 32:return SlimCore.Enums.VideoEffectType.WhiteboardZoom;case 64:return SlimCore.Enums.VideoEffectType.WhiteboardCleanup;case 128:return SlimCore.Enums.VideoEffectType.WhiteboardMotionDetection;case 96:return SlimCore.Enums.VideoEffectType.WhiteboardZoomAndCleanup;case 192:return SlimCore.Enums.VideoEffectType.WhiteboardCleanupAndMotion;case 224:return SlimCore.Enums.VideoEffectType.WhiteboardZoomAndCleanupAndMotion}},t.convertStatusAndFailureReasonToParticipantReason=function(e,t){switch(e){case SlimCore.Enums.CallStatus.Busy:return 19;case SlimCore.Enums.CallStatus.CallTimedOut:return 9;case SlimCore.Enums.CallStatus.Cancelled:return 23;case SlimCore.Enums.CallStatus.Dropped:return 10;case SlimCore.Enums.CallStatus.Refused:return 3;case SlimCore.Enums.CallStatus.Missed:return 2;case SlimCore.Enums.CallStatus.Failed:return n(t());default:return 0}},t.convertFailureReasonToParticipantReason=n},8404:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var l=n(6773),u=n(5773),d=n(1775),p=n(8642),h=n(891),g=n(5005),f=n(8067),m=function(e){function t(t,n,r,i,o,a,s,c,l){var u=e.call(this,n.createChild((function(){return"LocalScreenShare[".concat(u._localVideoObjectId,":").concat(u.isAvailable?1:0,":").concat(u.isStreaming?1:0,"]")})),r,i)||this;return u._callObjectId=o,u._callHandler=a,u._deviceManager=s,u._appHooks=c,u._callTelemetry=l,u.isStreaming=!1,u.isAvailable=!0,u.mediaType=2,u._localVideoObjectId=0,u._editViewPPTWindowId=0,u._canHandleEvents=!1,u._logger.info("constructor"),u._callOperationHandler=new f.default(u._logger,u._callTelemetry),u._screenScraper=new p.default(u._slimcoreInstance),u._registerDisposable(u._appHooks.onDisplaysChanged((function(){u.handleDisplaysChanged(t)}))),u}return i(t,e),t.prototype.start=function(e,t,n,r){var i=this,o=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,e);o.info("local screen share start");return this._callOperationHandler.registerPromise(h.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,s(i,void 0,void 0,(function(){var i,a,s,l,d,p,h,g=this;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,13,,14]),[4,this.sourceToInfo(t)];case 1:if(!(i=c.sent()))throw new Error("Unable to start sharing, source could not be found");return o.info("calling slimcore create local video"),(a=!!t&&3===t.getType())?(s=i,l=this,[4,u.createLocalVideo(this._slimcoreInstance,this._callHandler,this._callObjectId,SlimCore.Enums.VideoType.ScreenShare,s.label,s.id)]):[3,3];case 2:return l._localVideoObjectId=c.sent(),[3,5];case 3:return d=this,[4,u.createLocalVideo(this._slimcoreInstance,this._callHandler,this._callObjectId,SlimCore.Enums.VideoType.ScreenShare,"","")];case 4:d._localVideoObjectId=c.sent(),c.label=5;case 5:this._videoStatusChangedHandler=this._slimcoreInstance.handle("object-property-changed",{objectId:this._localVideoObjectId,propKey:SlimCore.Enums.Property.VideoStatus},(function(t){g._videoObjectChanged(e,t.value)})),this._videoErrorChangedHandler=this._slimcoreInstance.handle("object-property-changed",{objectId:this._localVideoObjectId,propKey:SlimCore.Enums.Property.VideoError},(function(e){g._videoErrorChanged(e.value)})),o.info("waiting for video object to be available"),c.label=6;case 6:return c.trys.push([6,8,,9]),[4,u.waitForVideoObjectState({slimcoreInstance:this._slimcoreInstance,videoObjectId:this._localVideoObjectId,logger:this._logger,causeId:e,resolveStates:[SlimCore.Enums.VideoStatus.Available],rejectStates:[],timeout:500})];case 7:return c.sent(),[3,9];case 8:throw p=c.sent(),this.isAvailable=!1,p;case 9:return a?[3,11]:(o.info("start preview video object"),[4,this._startPreviewVideo(e)]);case 10:c.sent(),c.label=11;case 11:return o.info("calling slimcore video start"),this._canHandleEvents=!0,this.selectSource(t,i,n),this.negotiationTag=r,[4,this._slimcoreInstance.videoStart(this._localVideoObjectId,r)];case 12:return c.sent(),this.isStreaming=!0,this.raiseChanged(),[3,14];case 13:throw h=c.sent(),o.logFailure("Failed to start LocalScreenShare. Error: ".concat(h)),this.stop(e),h;case 14:return[2]}}))})))},t.prototype.stop=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,e);r.info("local screen share stop");return this._callOperationHandler.registerPromise(h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,s(n,void 0,void 0,(function(){var n;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,5,6]),this._canHandleEvents=!1,[4,this._stopPreviewVideo(e)];case 1:return i.sent(),0===this._localVideoObjectId?[3,3]:(r.info("calling slimcore video stop"),this.negotiationTag=t,[4,this._slimcoreInstance.videoStop(this._localVideoObjectId,this.negotiationTag)]);case 2:i.sent(),this._slimcoreInstance.updateShellSharingWindowId&&this._slimcoreInstance.updateShellSharingWindowId(0),i.label=3;case 3:return[3,6];case 4:throw n=i.sent(),r.logFailure("Failed to stop LocalScreenShare. Error: ".concat(n)),n;case 5:return this._localVideoObjectId=0,this.isStreaming=!1,this._selectedMonitor=null,this._selectedRegion=null,this._selectedWindow=null,this._selectedCamera=null,this._editViewPPTWindowId=0,this._appHooks.hideSharingIndicator(),this._videoStatusChangedHandler&&(this._videoStatusChangedHandler.dispose(),this._videoStatusChangedHandler=null),this._videoErrorChangedHandler&&(this._videoErrorChangedHandler.dispose(),this._videoErrorChangedHandler=null),this.raiseChanged(),[7];case 6:return[2]}}))})))},t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype.changeCropRegion=function(e){return s(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.sourceToInfo(null)];case 1:return t=n.sent(),this._canHandleEvents&&this.selectMonitorWithOptionalCrop(t,e),[2]}}))}))},t.prototype.dispose=function(t){this._logger.info("dispose causeId: ".concat(t)),(this._localVideoObjectId||this._previewVideoSession)&&this.stop(t),this._videoStatusChangedHandler&&(this._videoStatusChangedHandler.dispose(),this._videoStatusChangedHandler=null),this._videoErrorChangedHandler&&(this._videoErrorChangedHandler.dispose(),this._videoErrorChangedHandler=null),e.prototype.dispose.call(this,t)},t.prototype._setInjectionRect=function(e){var t=this,n=this._appHooks.getControlInjector();(null==n?void 0:n.setInjectionRect)&&n.setInjectionRect(e).catch((function(n){var r=JSON.stringify({errorMsg:n,region:e});t._logger.error("Set control Injector failure, disable screen sharing control. Error: ".concat(n)),t.event("setInjectorRectFailed").raise(r)}))},t.prototype._videoObjectChanged=function(e,t){var n,r;this._logger.info("_videoObjectChanged status: ".concat(t)),this.isAvailable=u.isVideoAvailable(t),this.isStreaming=!1,u.isVideoInState(t,[SlimCore.Enums.VideoStatus.Starting,SlimCore.Enums.VideoStatus.Running])&&(this._selectedMonitor||this._selectedWindow||this._selectedCamera?(this.isStreaming=!0,this._selectedCamera||this._appHooks.showSharingIndicator(this._selectedRegion||(null===(n=this._selectedMonitor)||void 0===n?void 0:n.region)||(null===(r=this._selectedWindow)||void 0===r?void 0:r.windowId),"screen-sharing")):u.forgetAndLog(this.stop(e),this._logger,"stopping screen sharing due to no monitor/camera being selected")),u.isVideoInState(t,[SlimCore.Enums.VideoStatus.Paused])&&this._appHooks.hideSharingIndicator(),this.raiseChanged()},t.prototype._videoErrorChanged=function(e){e&&(this._appHooks.hideSharingIndicator(),this._logger.error("VideoError: ".concat(e)),this.event("videoError").raise(e))},t.prototype._setCaptureRegionAndWindow=function(e,t){if(this.event("captureRegionAndWindow").raise(e,t),this._videoBindingScreenShare)return this._slimcoreInstance.updateShellSharingWindowId&&void 0!==t&&this._slimcoreInstance.updateShellSharingWindowId(t),void this._videoBindingScreenShare.setCaptureRegionAndWindow(e,t);throw new Error("Failed to set capture region / window")},t.prototype._handleScraperEvent=function(e){this._logger.info("Handle Scraper event, event = ".concat(e.event," data = ").concat(e.data));var t=e.data;switch(e.event){case SlimCore.Enums.ScraperEvent.PPTPresenterView_Enter:this._editViewPPTWindowId=this._selectedWindow.windowId,this._selectedWindow.windowId=t,this._appHooks.showSharingIndicator(t,"screen-sharing"),this._setCaptureRegionAndWindow(void 0,t),this._logger.info("shared PPT entered presenter mode");break;case SlimCore.Enums.ScraperEvent.PPTPresenterView_Exit:this._selectedWindow.windowId=this._editViewPPTWindowId,this._appHooks.showSharingIndicator(this._selectedWindow.windowId,"screen-sharing"),this._setCaptureRegionAndWindow(void 0,this._selectedWindow.windowId),this._logger.info("shared PPT exited presenter mode");break;case SlimCore.Enums.ScraperEvent.WindowClosed:if(this._selectedWindow.windowId!==t)return;this._logger.info("Application window closed. Stopping the screenshare"),this.event("windowClosed").raise();break;case SlimCore.Enums.ScraperEvent.ShellSharingStopped:this._logger.info("Stop sharing event from OS. Stopping the screenshare"),this.event("shellSharingStopped").raise();break;default:this.event("scraperEvent").raise(e)}},t.prototype._startPreviewVideo=function(e){return s(this,void 0,void 0,(function(){var t,n,r=this;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,4]),this._previewVideoSession=this._deviceManager.createPreviewVideoSession(e,this,SlimCore.Enums.VideoType.ScreenShare),t=this,[4,this._previewVideoSession.acquireScreenShareBinding(e)];case 1:return t._videoBindingScreenShare=i.sent(),this._videoBindingScreenShare.on("scraper-event",(function(e){r._handleScraperEvent(e)})),[3,4];case 2:return n=i.sent(),[4,this._stopPreviewVideo(e)];case 3:throw i.sent(),n;case 4:return[2]}}))}))},t.prototype._stopPreviewVideo=function(e){return s(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=this._previewVideoSession,n=this._videoBindingScreenShare,this._previewVideoSession=void 0,this._videoBindingScreenShare=void 0,t?n?(n.removeAllListeners("scraper-event"),[4,t.releaseScreenShareBinding(e)]):[3,2]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.selectSource=function(e,t,n){e&&2===e.getType()?this.selectWindow(t):e&&3===e.getType()?this._selectedCamera=t:this.selectMonitorWithOptionalCrop(t,n)},t.prototype.selectMonitorWithOptionalCrop=function(e,t){var n=t||e.region;this._logger.info("Selected region with optional crop, x = ".concat(n.x,", y = ").concat(n.y,", width = ").concat(n.width," height = ").concat(n.height)),this._appHooks.showSharingIndicator(n,"screen-sharing"),this._setInjectionRect(n),this._setCaptureRegionAndWindow(n),this._selectedMonitor=e,this._selectedRegion=t},t.prototype.selectWindow=function(e){this._appHooks.showSharingIndicator(e.windowId,"screen-sharing"),this._setCaptureRegionAndWindow(void 0,e.windowId),this._selectedWindow=e},t.prototype.handleDisplaysChanged=function(e){return s(this,void 0,void 0,(function(){var t,n,r,i,o,a;return c(this,(function(s){switch(s.label){case 0:return t=this._logger.createFnLogger("HandleDisplaysChanged",e),this._canHandleEvents?this._selectedMonitor?(t.info("On display change, currenlty selected monitor: ".concat(JSON.stringify(this._selectedMonitor)," selected region:  ").concat(JSON.stringify(this._selectedRegion))),this._selectedRegion?[3,2]:[4,this._screenScraper.getMonitorList()]):(t.logFailure("On display change, monitor not seleted yet"),[2]):(t.logFailure("LocalScreenShare is not running, ingnoring events"),[2]);case 1:if(n=s.sent(),!this._canHandleEvents||!this._selectedMonitor)return[2];if(!this._selectedRegion){for(r=0,i=n;r<i.length;r++)o=i[r],t.info("On display change, new listed monitor: ".concat(JSON.stringify(o)));if(a=u.selectMonitorForScreenSharing(this._selectedMonitor,n))return t.info("On display change, re-selected monitor: ".concat(JSON.stringify(a))),this.selectMonitorWithOptionalCrop(a),[2]}s.label=2;case 2:return t.info("stopping screen share because displays changed and could not resolve monitor info"),u.forgetAndLog(this.stop(e),t,"stopping screen share because sharing source lost"),this.event("sharingSourceLost").raise(),[2]}}))}))},t.prototype.sourceToInfo=function(e){return s(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return e?[3,2]:[4,this._screenScraper.getMonitorList()];case 1:return t=n.sent(),[2,l.find(t,(function(e){return e.isPrimary}))];case 2:switch(e.getType()){case 2:return[3,3];case 1:return[3,5];case 3:return[3,7]}return[3,8];case 3:return[4,this._screenScraper.getWindowList()];case 4:return t=n.sent(),[2,l.find(t,(function(t){return t.windowId===e.getId()}))];case 5:return[4,this._screenScraper.getMonitorList()];case 6:return t=n.sent(),[2,l.find(t,(function(t){return t.monitorId===e.getId()||l.isEqual(t.region,e.getBounds())}))];case 7:return[2,this._deviceManager.getCamera(e.getDeviceId())];case 8:throw new Error("Invalid source type: ".concat(e.getType()))}}))}))},o([(0,g.callOperation)(h.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING}),a("design:type",Function),a("design:paramtypes",[String,Object,Object,String]),a("design:returntype",Promise)],t.prototype,"start",null),o([(0,g.callOperation)(h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING}),a("design:type",Function),a("design:paramtypes",[String,String]),a("design:returntype",Promise)],t.prototype,"stop",null),t}(d.default);t.default=m},5320:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VideoStream=void 0;var s=n(6773),c=n(2321),l=n(5773),u=n(1775),d=n(7584),p=0,h=function(e){function t(t,n,r,i,o,a,s,c){var l=e.call(this,n.createChild((function(){return"VideoStream[".concat(l.objectId,":").concat(l.label,"]")})),r,i)||this;l.objectId=o,l.label=a,l._negotiationTag=s,l.isStreaming=!1,l._isActive=!1,l._isDisposed=!1,l._logger.info("constructor causeId: ".concat(t)),c&&l._registerDisposable(c);return l._onObjectPropertyChanged(l.objectId,SlimCore.Enums.Property.VideoStatus,(function(e){var t,n;t=e.value,(n=t===SlimCore.Enums.VideoStatus.Running)!==l.isStreaming&&(l.isStreaming=n,l._logger.info("videoStatusChanged isStreaming: ".concat(l.isStreaming," status: ").concat(t)),l.raiseChanged())})),l._onObjectPropertyChanged(l.objectId,SlimCore.Enums.Property.VideoError,(function(e){var t;(t=e.value)&&(l._logger.error("VideoError: ".concat(t)),l.event("videoError").raise(t))})),l}return i(t,e),t.prototype.startVideo=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,5]),this._logger.info("startVideo causeId: ".concat(e," start local video and wait it to become STARTING|RUNNING")),[4,this._slimcoreInstance.videoStart(this.objectId,this._negotiationTag)];case 1:return n.sent(),[4,l.waitForVideoObjectState({slimcoreInstance:this._slimcoreInstance,videoObjectId:this.objectId,logger:this._logger,causeId:e,resolveStates:[SlimCore.Enums.VideoStatus.Starting,SlimCore.Enums.VideoStatus.Running],rejectStates:[SlimCore.Enums.VideoStatus.Stopping,SlimCore.Enums.VideoStatus.NotStarted],timeout:1e3})];case 2:return n.sent(),this._isActive=!0,this._logger.info("startVideo causeId: ".concat(e," start local video successful")),[3,5];case 3:return t=n.sent(),[4,this._slimcoreInstance.videoStop(this.objectId,this._negotiationTag)];case 4:throw n.sent(),t;case 5:return[2]}}))}))},t.prototype.stopVideo=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return a(this,(function(i){switch(i.label){case 0:if(!this._isActive)return[2];i.label=1;case 1:return i.trys.push([1,5,,6]),this._isActive=!1,t?(this._logger.info("stopVideo causeId: ".concat(e," stop local video and wait it to become STOPPING|NOT_STARTED|AVAILABLE")),[4,this._slimcoreInstance.videoStop(this.objectId,n)]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,l.waitForVideoObjectState({slimcoreInstance:this._slimcoreInstance,videoObjectId:this.objectId,logger:this._logger,causeId:e,resolveStates:[SlimCore.Enums.VideoStatus.Stopping,SlimCore.Enums.VideoStatus.NotStarted,SlimCore.Enums.VideoStatus.Available],rejectStates:[],timeout:1e3})];case 4:return i.sent(),this._logger.info("stopVideo causeId: ".concat(e," stop local video successful callVideoStop: ").concat(t)),[3,6];case 5:return r=i.sent(),this._logger.error("stopVideo causeId: ".concat(e," stop local video failed. error: ").concat(r)),[3,6];case 6:return[2]}}))}))},t.prototype.control=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return this._isDisposed||this._isActive===t?(this._logControlSkip(e,t),[2]):(this._logger.info("control causeId: ".concat(e,", attempting to ").concat(t?"start":"stop"," video")),t?[4,this.startVideo(e)]:[3,2]);case 1:return n.sent(),[3,4];case 2:return[4,this.stopVideo(e,!0,this._negotiationTag)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.dispose=function(t){this.isStreaming=!1,this._isDisposed=!0,e.prototype.dispose.call(this,t)},t.prototype._logControlSkip=function(e,t){var n=this._isDisposed?"stream disposed":"stream already ".concat(this._isActive?"active":"inactive");this._logger.info("control causeId: ".concat(e,", activate: ").concat(t," skipped, reason: ").concat(n))},t}(u.default);t.VideoStream=h;var g=function(e){function t(t,n,r,i,o,a,s,l,u){var d=e.call(this,n.createChild((function(){return"LocalVideo[".concat(d._id,"]")})),r,i)||this;d._ecs=o,d._callObjectId=a,d._callHandler=s,d._deviceManager=l,d._options=u,d.mediaType=1,d.isStreaming=!1,d._id=p++,d._state=null,d._shouldRun=!1,d._disableFastCameraSwap=!1;try{d._disableFastCameraSwap=d._ecs.getBoolean("MediaAgent","tsc_disableFastCameraSwap",!1)}catch(e){d._logger.logFailure(e)}return d._logger.info("constructor causeId: ".concat(t," disableFastCameraSwap ").concat(d._disableFastCameraSwap)),d._chainedApiPromise=new c.default(n.createChild((function(){return"LocalVideo[".concat(d._id,"]")}))),d._registerDisposable(d._deviceManager.on("videoDevicesChanged",(function(){d._videoDevicesChanged(t)}))),d}return i(t,e),t.prototype.start=function(e,t){var n=this;return this._logger.info("start causeId: ".concat(e)),this._shouldRun=!0,this._chainedApiPromise.chainPromise((function(){return n._startVideo(e,t)}),"start",e)},t.prototype.stop=function(e,t){var n=this;return this._logger.info("stop causeId: ".concat(e)),this._shouldRun=!1,this._chainedApiPromise.chainPromise((function(){return n._stopVideo(e,!1,t)}),"stop",e)},t.prototype.dispose=function(e){var t=this;this._logger.info("dispose causeId: ".concat(e)),this._shouldRun=!1,this._chainedApiPromise.chainPromise((function(){return t._dispose(e)}),"dispose",e)},t.prototype._isRunning=function(){return!!this._state},t.prototype._dispose=function(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,this._stopVideo(t,!0)];case 1:return n.sent(),[3,3];case 2:return e.prototype.dispose.call(this,t),[7];case 3:return[2]}}))}))},t.prototype._updateStreamingState=function(){var e=!!this._state&&s.some(this._state.videoStreams,(function(e){return e.isStreaming}));this.isStreaming!==e&&(this._logger.info("isStreaming changed to: ".concat(e)),this.isStreaming=e,this.raiseChanged())},t.prototype._setVideoState=function(e,t){var n=this;this._state&&s.forEach(this._state.videoStreams,(function(t){t.dispose(e)})),this._state=t,this._state&&s.forEach(this._state.videoStreams,(function(e){return e.changed((function(){n._updateStreamingState()}))})),this._updateStreamingState()},t.prototype._videoDevicesChanged=function(e){var t=this;this._logger.info("_videoDevicesChanged causeId: ".concat(e)),this._chainedApiPromise.chainPromise((function(){return t._swapVideoDevice(e)}),"swapVideoDevice",e)},t.prototype._areAllStreamsStreaming=function(e){return!s.some(e.videoStreams,(function(e){return!e.isStreaming}))},t.prototype._canSuppressDeviceSwap=function(e){return!!this._ignoredVideoDeviceInVideoSwap&&this._ignoredVideoDeviceInVideoSwap.id===e.id&&this._ignoredVideoDeviceInVideoSwap.generation===e.generation},t.prototype._swapVideoDevice=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,o,s,c,l,u;return a(this,(function(a){switch(a.label){case 0:return this._shouldRun?(t=this._deviceManager.getSelectedCamera())?this._canSuppressDeviceSwap(t)?[2]:(this._ignoredVideoDeviceInVideoSwap=t,this._isRunning()?(n=this._state,r=this._disableFastCameraSwap||!this._areAllStreamsStreaming(n),this._logger.info("_swapVideoDevice causeId: ".concat(e," full stopstart? ").concat(r," will change local video device: ").concat(this._state.camera.id," -> ").concat(t.id)),this._setVideoState(e,null),r?[4,this._stopVideoDevices(e,n,this._negotiationTag)]:[3,3]):[3,8]):(this._logger.info("_swapVideoDevice causeId: ".concat(e," noop, no selected device, should run: ").concat(this._shouldRun," is running: ").concat(this._isRunning())),this._ignoredVideoDeviceInVideoSwap=void 0,[2]):(this._logger.info("_swapVideoDevice causeId: ".concat(e," noop, should run: ").concat(this._shouldRun," is running: ").concat(this._isRunning())),[2]);case 1:return a.sent(),i=this._setVideoState,o=[e],[4,this._startVideoDevices(e,t,this._negotiationTag)];case 2:return i.apply(this,o.concat([a.sent()])),[3,7];case 3:return a.trys.push([3,,5,7]),s=this._setVideoState,c=[e],[4,this._startVideoDevices(e,t,this._negotiationTag)];case 4:return s.apply(this,c.concat([a.sent()])),[3,7];case 5:return[4,this._stopVideoDevices(e,n,this._negotiationTag)];case 6:return a.sent(),[7];case 7:return[3,10];case 8:return this._logger.info("_swapVideoDevice causeId: ".concat(e," will resurrect local video device: ").concat(t.id)),l=this._setVideoState,u=[e],[4,this._startVideoDevices(e,t,this._negotiationTag)];case 9:l.apply(this,u.concat([a.sent()])),a.label=10;case 10:return[2]}}))}))},t.prototype._startVideo=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return!this._shouldRun||this._isRunning()?[3,2]:(this._negotiationTag=t||this._negotiationTag,n=this._getSelectedCamera(e),this._ignoredVideoDeviceInVideoSwap=n,r=this._setVideoState,i=[e],[4,this._startVideoDevices(e,n,this._negotiationTag)]);case 1:return r.apply(this,i.concat([o.sent()])),[3,3];case 2:this._logger.info("_startVideo causeId: ".concat(e," noop, should run: ").concat(this._shouldRun," is running: ").concat(this._isRunning())),o.label=3;case 3:return[2]}}))}))},t.prototype._getSelectedCamera=function(e){var t=this._deviceManager.getSelectedCamera();if(!t)throw new Error("_getSelectedCamera causeId: ".concat(e," no selected camera to start local video"));return t},t.prototype._getCamerasToStart=function(e){var t=[],n=this._deviceManager.getChildCameras(e.id);if(s.isEmpty(n))t.push(e);else if(this._options.enableMultiVideo)n.forEach((function(e){return t.push(e)}));else{var r=s.find(n,(function(e){return e.useForPreview}));r&&t.push(r)}return t},t.prototype._startVideoDevices=function(e,t,n){return o(this,void 0,void 0,(function(){var r,i,o,s=this;return a(this,(function(a){switch(a.label){case 0:r={camera:t,videoStreams:[]},i=this._getCamerasToStart(t),a.label=1;case 1:return a.trys.push([1,3,,6]),[4,Promise.all(i.map((function(t){return s._startVideoStream(e,t,n).then((function(e){return r.videoStreams.push(e)}))})))];case 2:return a.sent(),[3,6];case 3:return o=a.sent(),this._logger.info("_startVideoDevices causeId: ".concat(e," failed for some cameras")),r.videoStreams.length>0?[4,this._stopVideoDevices(e,r,this._negotiationTag)]:[3,5];case 4:a.sent(),r.videoStreams.forEach((function(t){t.dispose(e)})),a.label=5;case 5:throw o;case 6:return[2,r]}}))}))},t.prototype._shouldUseActivityMonitor=function(e){return 7===e.position},t.prototype._createVideoStream=function(e,t,n,r,i,s){var c,l,u=this;if(r)try{l=function(){g&&g.dispose(),p&&p.dispose()};var p=this._slimcoreInstance.createVideoDeviceListener(),g=p.handle("video-device-state-changed",void 0,(function(t){var r=(0,d.generateCauseId)(),i=t.state;if(u._logger.info("chaining stream.control id-".concat(n," oldCauseId: ").concat(e,", causeId ").concat(r,", state ").concat(i)),i===SlimCore.Enums.CameraState.Active||i===SlimCore.Enums.CameraState.Inactive){var s=i===SlimCore.Enums.CameraState.Active;u._chainedApiPromise.chainPromise((function(){return o(u,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,m.control(r,s)];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),this.event("videoError").raise("Stream control failed, ".concat(e)),[3,3];case 3:return[2]}}))}))}),"stream.control",r)}}));p.initialise(t.id);var f=this._logger.createChild((function(){return"VideoStreamActivityMonitor[".concat(n,":").concat(i,"]")}));c={dispose:function(e){f.info("dispose causeId: ".concat(e)),l()}}}catch(t){this._logger.error("failed to create VideoDeviceListener, causeId: ".concat(e,", error: ").concat(t)),l()}var m=new h(e,this._logger,this._settings,this._slimcoreInstance,n,i,s,c);return m},t.prototype._startVideoStream=function(e,t,n){return o(this,void 0,void 0,(function(){var r,i,o,s,c=this;return a(this,(function(a){switch(a.label){case 0:return this._logger.info("_startVideoStream causeId: ".concat(e," create local video ").concat(t.mediaLabel," for device name: ").concat(t.label," path: ").concat(t.id)),[4,l.createLocalVideo(this._slimcoreInstance,this._callHandler,this._callObjectId,SlimCore.Enums.VideoType.Video,t.label,t.id,t.mediaLabel)];case 1:if(0===(r=a.sent()))throw new Error("_startVideoStream id-".concat(r," causeId: ").concat(e," local video is null?"));if(i=this._shouldUseActivityMonitor(t),(o=this._createVideoStream(e,t,r,i,t.mediaLabel,n)).on("videoError",(function(e){c.event("videoError").raise(e)})),i)return[2,o];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,o.startVideo(e)];case 3:return a.sent(),[3,5];case 4:throw s=a.sent(),o.dispose(e),s;case 5:return[2,o]}}))}))},t.prototype._stopVideo=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return a(this,(function(i){switch(i.label){case 0:return this._shouldRun&&!t||!this._isRunning()?[3,2]:(this._ignoredVideoDeviceInVideoSwap=void 0,this._negotiationTag=n||this._negotiationTag,r=this._state,this._setVideoState(e,null),[4,this._stopVideoDevices(e,r,this._negotiationTag)]);case 1:return i.sent(),[3,3];case 2:this._logger.info("_stopVideo causeId: ".concat(e," noop, force: ").concat(t," should run: ").concat(this._shouldRun," is running: ").concat(this._isRunning())),i.label=3;case 3:return[2]}}))}))},t.prototype._doCallVideoStop=function(e){var t;return!(null===(t=this._state)||void 0===t?void 0:t.videoStreams.find((function(t){return t.label===e})))},t.prototype._stopVideoDevices=function(e,t,n){return o(this,void 0,void 0,(function(){var r=this;return a(this,(function(i){switch(i.label){case 0:return[4,Promise.all(t.videoStreams.map((function(t){return t.stopVideo(e,r._doCallVideoStop(t.label),n)})))];case 1:return i.sent(),[2]}}))}))},t}(u.default);t.default=g},658:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6773),c=n(5442),l=n(2321),u=n(7584),d=n(7892),p=0,h=function(e){function t(t,n,r,i,o,a,u,d){var h=e.call(this,n.createChild((function(){var e;return"LocalVideoPreview[".concat(h._id,"][").concat(h._selection.kind,"][").concat(null===(e=h._previewVideoSession)||void 0===e?void 0:e.id,"]")})),r,i)||this;if(h._currentTarget=o,h._deviceManager=a,h._selection=u,h._options=d,h._id=p++,h._isDisposed=!1,h._disposedDeferred=new c.Deferred,h._logger.info("constructor device? ".concat(h._selection.device," causeId: ").concat(t)),"camera"!==h._selection.kind&&("sharing"!==h._selection.kind||!s.isUndefined(h._selection.device)))throw new Error("invalid selection parameters causeId: ".concat(t));return h._chainedApiPromise=new l.default(n.createChild((function(){var e;return"LocalVideoPreview[".concat(h._id,"][").concat(h._selection.kind,"][").concat(null===(e=h._previewVideoSession)||void 0===e?void 0:e.id,"]")}))),"camera"===h._selection.kind&&s.isUndefined(h._selection.device)&&h._registerDisposable(h._deviceManager.on("videoDevicesChanged",(function(){return h._videoDevicesChanged(t)}))),h}return i(t,e),t.prototype.startVideoAsync=function(e){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return this._logger.info("startVideoAsync causeId: ".concat(e)),[2,this._chainedApiPromise.chainPromise((function(){return t._startVideo(e)}),"startVideoAsync",e)]}))}))},t.prototype.cameraAutoControl=function(e){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return[4,this._deviceManager.synchronizeSelectDevices()];case 1:return n.sent(),[2,this._chainedApiPromise.chainPromise((function(){return t._cameraAutoControl(e)}),"cameraAutoControl",(0,u.generateCauseId)())]}}))}))},t.prototype.getCameraManualControlStates=function(e){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return[4,this._deviceManager.synchronizeSelectDevices()];case 1:return n.sent(),[2,this._chainedApiPromise.chainPromise((function(){return t._getCameraManualControlStates(e)}),"getCameraManualControlStates",(0,u.generateCauseId)())]}}))}))},t.prototype.setCameraManualControlStates=function(e){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return[4,this._deviceManager.synchronizeSelectDevices()];case 1:return n.sent(),[2,this._chainedApiPromise.chainPromise((function(){return t._setCameraManualControlStates(e)}),"setCameraManualControlStates",(0,u.generateCauseId)())]}}))}))},t.prototype.enumerateCameraManualControls=function(){return o(this,void 0,void 0,(function(){var e=this;return a(this,(function(t){switch(t.label){case 0:return[4,this._deviceManager.synchronizeSelectDevices()];case 1:return t.sent(),[2,this._chainedApiPromise.chainPromise((function(){return e._enumerateCameraManualControls()}),"enumerateCameraManualControls",(0,u.generateCauseId)())]}}))}))},t.prototype.isCameraAdvancedControlCapable=function(){return o(this,void 0,void 0,(function(){var e=this;return a(this,(function(t){switch(t.label){case 0:return[4,this._deviceManager.synchronizeSelectDevices()];case 1:return t.sent(),[2,this._chainedApiPromise.chainPromise((function(){return e._isCameraAdvancedControlCapable()}),"isCameraAdvancedControlCapable",(0,u.generateCauseId)())]}}))}))},t.prototype.dispose=function(e){return void 0===e&&(e=(0,u.generateCauseId)()),o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return this._logger.info("dispose causeId: ".concat(e," isDisposed: ").concat(this._isDisposed)),this._isDisposed||(this._isDisposed=!0,this._chainedApiPromise.chainPromise((function(){return t._dispose(e)}),"dispose",e)),[4,this.deferredDispose];case 1:return n.sent(),[2]}}))}))},Object.defineProperty(t.prototype,"deferredDispose",{get:function(){return this._disposedDeferred.promise},enumerable:!1,configurable:!0}),t.prototype._isRunning=function(){return!(!this._previewVideoSession||!this._videoBinding)},t.prototype._dispose=function(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,this._stopVideo(t)];case 1:return n.sent(),[3,3];case 2:return this._disposedDeferred.resolve(),this._currentTarget=null,e.prototype.dispose.call(this,t),[7];case 3:return[2]}}))}))},t.prototype._canSuppressDeviceSwap=function(e){return!!this._ignoredVideoDeviceInVideoSwap&&this._ignoredVideoDeviceInVideoSwap.id===e.id&&this._ignoredVideoDeviceInVideoSwap.generation===e.generation},t.prototype._videoDevicesChanged=function(e){var t=this;this._logger.info("_videoDevicesChanged causeId: ".concat(e)),this._chainedApiPromise.chainPromise((function(){return t._swapVideoDevice(e)}),"swapVideoDevice",e)},t.prototype._swapVideoDevice=function(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return this._isDisposed?(this._logger.info("_swapVideoDevice causeId: ".concat(e," noop, isDisposed: ").concat(this._isDisposed," is running: ").concat(this._isRunning())),[2]):(t=this._deviceManager.getSelectedCameraForPreview())?this._canSuppressDeviceSwap(t)?[2]:this._isRunning()?(n=this._ignoredVideoDeviceInVideoSwap?this._ignoredVideoDeviceInVideoSwap.id:null,this._logger.info("_swapVideoDevice causeId: ".concat(e," will change video preview device: ").concat(n," -> ").concat(t.id)),[4,this._stopVideoDevice(e,!0)]):[3,2]:(this._logger.info("_swapVideoDevice causeId: ".concat(e," noop, no selected device, isDisposed: ").concat(this._isDisposed," is running: ").concat(this._isRunning())),this._ignoredVideoDeviceInVideoSwap=void 0,[2]);case 1:return r.sent(),[3,3];case 2:this._logger.info("_swapVideoDevice causeId: ".concat(e," will resurrect video preview device: ").concat(t.id)),r.label=3;case 3:return this._isDisposed?(this._logger.info("_swapVideoDevice causeId: ".concat(e," skip, isDisposed: ").concat(this._isDisposed," is running: ").concat(this._isRunning())),[2]):(this._ignoredVideoDeviceInVideoSwap=t,[4,this._startVideoDevice(e,t.label,t.id,SlimCore.Enums.VideoType.Video)]);case 4:return r.sent(),[2]}}))}))},t.prototype._startVideo=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i;return a(this,(function(o){switch(o.label){case 0:if(this._isDisposed||this._isRunning())return[3,2];if(t="",n="",r=SlimCore.Enums.VideoType.ScreenShare,i=void 0,"camera"===this._selection.kind){if(!(i=s.isUndefined(this._selection.device)?this._deviceManager.getSelectedCameraForPreview():this._deviceManager.getCameraForPreview(this._selection.device)))throw new Error("_startVideo causeId: ".concat(e," no camera to start video preview"));r=SlimCore.Enums.VideoType.Video,t=i.label,n=i.id}return this._logger.info("_startVideo causeId: ".concat(e," will start video preview now for device name: ").concat(t," path: ").concat(n)),this._ignoredVideoDeviceInVideoSwap=i,[4,this._startVideoDevice(e,t,n,r)];case 1:return o.sent(),[3,3];case 2:this._logger.info("_startVideo causeId: ".concat(e," noop, isDisposed: ").concat(this._isDisposed," is running: ").concat(this._isRunning())),o.label=3;case 3:return[2]}}))}))},t.prototype._startVideoDevice=function(e,t,n,r){return o(this,void 0,void 0,(function(){var i,o,s,c=this;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,4]),this._deviceId=n,this._previewVideoSession=this._deviceManager.createPreviewVideoSession(e,this,r,t,n),this._videoErrorChangedHandler=this._previewVideoSession.registerVideoErrorHandler(e,(function(e){return c._videoErrorChanged(e,c._previewVideoSession)})),i=this,[4,this._previewVideoSession.acquireRendererBinding(e)];case 1:return i._videoBinding=a.sent(),o=this._options||{scalingMode:1,transparent:!1},this._createVideoRenderer(e,this._currentTarget,o),[3,4];case 2:return s=a.sent(),[4,this._stopVideoDevice(e)];case 3:throw a.sent(),s;case 4:return[2]}}))}))},t.prototype._stopVideo=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this._isRunning()?(this._logger.info("_stopVideo causeId: ".concat(e," isDisposed: ").concat(this._isDisposed," will stop video preview now")),this._ignoredVideoDeviceInVideoSwap=void 0,[4,this._stopVideoDevice(e)]):[3,2];case 1:return t.sent(),[3,3];case 2:this._logger.info("_stopVideo causeId: ".concat(e," noop, isDisposed: ").concat(this._isDisposed," is running: ").concat(this._isRunning())),t.label=3;case 3:return[2]}}))}))},t.prototype._stopVideoDevice=function(e,t){return void 0===t&&(t=!1),o(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:try{this._disposeVideoRenderer(e,t)}catch(t){this._logger.warn("_stopVideoDevice causeId: ".concat(e," _disposeVideoRenderer error: ").concat(t," falied @ ").concat((new Error).stack))}return n=this._previewVideoSession,r=this._videoBinding,this._previewVideoSession=void 0,this._videoBinding=void 0,this._deviceId=void 0,this._videoErrorChangedHandler&&(this._videoErrorChangedHandler.dispose(),this._videoErrorChangedHandler=void 0),n&&r?[4,n.releaseRendererBinding(e)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},t.prototype._videoErrorChanged=function(e,t){var n=this;e&&this._chainedApiPromise.chainPromise((function(){return o(n,void 0,void 0,(function(){return a(this,(function(n){return this._isDisposed||t!==this._previewVideoSession||(this._logger.error("VideoError: ".concat(e)),this.event("videoError").raise(e)),[2]}))}))}),"videoErrorChanged",(0,u.generateCauseId)())},t.prototype._convertToSlimCoreCameraControlStates=function(e){return e.map((function(e){return{id:e.id,mode:e.mode,value:e.value,context:e.context}}))},t.prototype._convertToSlimCoreCameraControlModeSelection=function(e){return e.map((function(e){return{id:e.id,mode:e.mode}}))},t.prototype._convertToCameraControlStates=function(e){return e.map((function(e){return{id:e.id,mode:e.mode,value:e.value,context:e.context}}))},t.prototype._throwIfCanNotExecute=function(e){if(!this._isRunning())throw new Error("Cannot ".concat(e," when preview video is not running"))},t.prototype._cameraAutoControl=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this._throwIfCanNotExecute("get camera auto controls"),this._slimcoreInstance.cameraAutoControlEx?[4,this._slimcoreInstance.cameraAutoControlEx(this._deviceId,e)]:[3,2];case 1:case 3:return[2,t.sent()];case 2:return[4,this._slimcoreInstance.cameraAutoControl(this._previewVideoSession.id,e)]}}))}))},t.prototype._getCameraManualControlStates=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(i){switch(i.label){case 0:return this._throwIfCanNotExecute("get camera manual control states"),t=this._convertToSlimCoreCameraControlModeSelection(e),this._slimcoreInstance.getCameraManualControlStatesEx?[4,this._slimcoreInstance.getCameraManualControlStatesEx(this._deviceId,t)]:[3,2];case 1:return r=i.sent(),[3,4];case 2:return[4,this._slimcoreInstance.getCameraManualControlStates(this._previewVideoSession.id,t)];case 3:r=i.sent(),i.label=4;case 4:return n=r,[2,this._convertToCameraControlStates(n)]}}))}))},t.prototype._setCameraManualControlStates=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return this._throwIfCanNotExecute("set camera manual control states"),t=this._convertToSlimCoreCameraControlStates(e),this._slimcoreInstance.setCameraManualControlStatesEx?[4,this._slimcoreInstance.setCameraManualControlStatesEx(this._deviceId,t)]:[3,2];case 1:case 3:return[2,n.sent()];case 2:return[4,this._slimcoreInstance.setCameraManualControlStates(this._previewVideoSession.id,t)]}}))}))},t.prototype._enumerateCameraManualControls=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this._throwIfCanNotExecute("enumerate camera manual controls"),this._slimcoreInstance.enumerateCameraManualControlsEx?[4,this._slimcoreInstance.enumerateCameraManualControlsEx(this._deviceId)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return[4,this._slimcoreInstance.enumerateCameraManualControls(this._previewVideoSession.id)]}}))}))},t.prototype._isCameraAdvancedControlCapable=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this._throwIfCanNotExecute("is camera advanced control capable"),this._slimcoreInstance.isCameraAdvancedControlCapableEx?[4,this._slimcoreInstance.isCameraAdvancedControlCapableEx(this._deviceId)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return[4,this._slimcoreInstance.isCameraAdvancedControlCapable(this._previewVideoSession.id)]}}))}))},t}(d.default);t.default=h},2832:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7715),a=n(5442),s=n(3607),c=n(5773),l=n(1775),u="",d=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild((function(){return"SlimCoreElectronPTZHandler"})),n,r)||this;return a._deviceManager=o,a._handlerSessionState=0,a.role=0,a._ptzDataChannelStatus={id:null,readyForControl:!1,state:0},a._ptzEnabled=!1,a._dataChannelActive=!1,a._participantId=null,a._protocolDataSource=null,a._ptzDataSource=null,a._ptzDataSink=null,a._controllerRequest=null,a._controllerRequestSubscription=null,a._controllerParticipant=null,a._controllerParticipantSubscription=null,a._controlleeParticipant=null,a._requestControlTimer=null,a._acceptControlTimer=null,a._terminateControlTimer=null,a._previousPTZControlDeviceState=0,a._logger.info("constructor(). call.participantId=".concat(i.participantId)),a._participantId=i.participantId,i.on("callLegIdChanged",(function(e){a._logger.info("callLegIdChanged from:".concat(a._participantId," to:").concat(e)),a._participantId=e,a._controlleeParticipant?a._controlleeParticipant.participantId=e:a._controllerParticipant&&(a._controllerParticipant.participantId=e)})),a}return i(t,e),t.prototype.setPTZHandlerFeatureFlag=function(e){this._logger.info("setPTZHandlerFeatureFlag(enabled= ".concat(e,"), previous state: _ptzEnabled= ").concat(this._ptzEnabled)),this._ptzEnabled=e,e?this._dataChannel&&(this._dataChannel.start(),this._dataChannelActive||3!==this._ptzDataChannelStatus.state||(this._dataChannelActive=!0,this._createAndAttachPTZDevices())):this._isControllee()?this.shutdownPTZControllee():this._isController()?this.shutdownPTZController():this._logger.info("ptz handler is not involved in session yet. Nothing to cleanup")},t.prototype.isPTZFeatureEnabled=function(){return this._ptzEnabled},t.prototype.setDataChannel=function(e){var t=this;return(0,a.asap)((function(){t._setDataChannel(e)}))},t.prototype._setDataChannel=function(e){this._logger.info("Setting DataChannel: ".concat(null==e?void 0:e.id)),this._dataChannel&&!e&&this._detachAndDeletePTZDevices(),this._dataChannel=e,this._dataChannel&&this._ptzEnabled&&(this._logger.info("starting data channel: ".concat(this._dataChannel.id)),this._dataChannel.start())},t.prototype.setProtocolDataSource=function(e){var t=this;return(0,a.asap)((function(){t._setProtocolDataSource(e)}))},t.prototype._setProtocolDataSource=function(e){this._protocolDataSource=e},t.prototype.getDevicePTZCapability=function(e){return this._deviceManager?this._deviceManager.getDevicePTZCapabilityAsync(e):Promise.reject(new Error("getDevicePTZCapability called but device manager is null"))},t.prototype.shutdownPTZControllee=function(){if(this._logger.info("shutdownPTZControllee()"),this._controllerRequest){this._logger.warn("Rejecting pending control requests");var e=this._getDataSourceIdForParticipantLeg(this._controllerRequest),t=this._controllerRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(t),this._sendRequest({action:103,terminatedReason:5},e)}if(this.role=0,this._controllerParticipant){var n={inControl:!1,id:this._controllerParticipant.participant.id,terminatedReason:5};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl=".concat(n.inControl,", id=").concat(n.id,", terminatedReason=").concat(n.terminatedReason,"}")),this.event("ptzSessionChanged").raise(n)}this._resetControlState()},t.prototype.shutdownPTZController=function(){if(this._logger.info("shutdownPTZController()"),1===this._handlerSessionState){if(this._controlleeParticipant){var e=this._getDataSourceIdForParticipantLeg(this._controlleeParticipant);this._sendRequest({action:101,terminatedReason:6},e)}else this._logger.warn("shutdownPTZController: control participant is null");var t={inControl:!1,id:u,terminatedReason:6};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({sessionStatus:t,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.RequestSent action =shutdownPTZController")}else if(4===this._handlerSessionState){t={inControl:!1,id:u,terminatedReason:6};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl=".concat(t.inControl,", id=").concat(t.id,", terminatedReason=").concat(t.terminatedReason,"}")),this.event("ptzSessionChanged").raise(t)}this._resetControlState()},t.prototype._resetControlRequest=function(e){this._clearControlRequest(),this._controllerRequest=e,this._registerParticipantListener(e),3===e.participantState&&(this._logger.info("sent event:ptzIncomingRequest with request.participant.id=".concat(e.participant.id)),this.event("ptzIncomingRequest").raise(e.participant.id))},t.prototype._clearControlRequest=function(){this._stopListeningToParticipantChanges(this._controllerRequest),this._controllerRequest=null},t.prototype._stopListeningToParticipantChanges=function(e){this._controllerRequestSubscription&&(this._controllerRequestSubscription.dispose(),this._controllerRequestSubscription=null)},t.prototype._registerParticipantListener=function(e){var t=this;this._controllerRequestSubscription=e.participant.changed((function(){if(e.participant.state!==e.participantState)switch(e.participantState=e.participant.state,e.participantState){case 3:t._logger.info("sent event:ptzIncomingRequest with request.participant.id=".concat(e.participant.id)),t.event("ptzIncomingRequest").raise(e.participant.id);break;case 0:case 5:case 4:t.denyPTZControllerRequest().catch((function(e){t._logger.info("it is ok if denyPTZControllerRequest rejects here as ptz session may have just been stopped. Err is ".concat(e))})),t._logger.info("_registerParticipantListener: participant ".concat(e.participant.id," is no longer connected. resetting")),t._clearControlRequest(),t._raiseControlRequestCanceled(e);break;case 1:case 2:case 6:case 7:break;default:t._logger.error("unexpected participantState {request.participantState} unhandled")}}))},t.prototype._resetControllerParticipant=function(e){var t=this;this._controllerParticipantSubscription&&(this._logger.info("_resetControllerParticipant: stopping tracking changes for ".concat(this._controllerParticipant.participant.id)),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),e&&(this._controllerParticipantSubscription=e.participant.changed((function(){3!==e.participant.state&&t.handleParticipantRemoved(e.participant.id)}))),this._controllerParticipant=e},t.prototype.handleParticipantRemoved=function(e){if(this._logger.info("handleParticipantRemoved(): Stopping tracking state changes for ".concat(e)),this._isControllee()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===e){this._logger.info("handleParticipantRemoved: controller left call, tearing down control session"),this._resetControlState();var t={inControl:!1,id:e,terminatedReason:6};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl=".concat(t.inControl,", id=").concat(t.id,", terminatedReason=").concat(t.terminatedReason)),this.event("ptzSessionChanged").raise(t)}}else if(this._controlleeParticipant&&this._controlleeParticipant.participant.id===e&&4===this._handlerSessionState){this._logger.info("handleParticipantRemoved: Controllee left call, tearing down control session"),this._resetControlState();t={inControl:!1,id:u,terminatedReason:5};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl=".concat(t.inControl,", id=").concat(t.id,", terminatedReason=").concat(t.terminatedReason,"}")),this.event("ptzSessionChanged").raise(t)}},t.prototype.callStateChanged=function(e){this._callState=e,7===e&&this._handleCallDisconnected()},t.prototype._handleCallDisconnected=function(){this._logger.info("handleCallDisconnected()"),this._isControllee()?this.shutdownPTZControllee():this.shutdownPTZController()},t.prototype._isControllee=function(){return 1===this.role},t.prototype._isController=function(){return 2===this.role},t.prototype._createAndAttachPTZDevices=function(){var e=this;if(this._logger.info("_createAndAttachPTZDevices()"),this._dataChannel){var t=Promise.resolve(),n=Promise.resolve();this._ptzDataSource||(this._ptzDataSource=this._slimcoreInstance.createDataSource(SlimCore.Enums.DataDeviceId.PTZHandler),this._logger.info("created PTZHandler DataSource"),t=this._dataChannel.registerDataSource(this._ptzDataSource).then((function(){e._logger.info("registered PTZHandler DataSource")})).catch((function(t){e._logger.error("registerDataSource threw exception: ".concat(t))}))),this._ptzDataSink||(this._ptzDataSink=this._slimcoreInstance.createDataSink(SlimCore.Enums.DataDeviceId.PTZHandler),this._logger.info("created PTZHandler DataSink"),n=this._dataChannel.registerDataSink(this._ptzDataSink).then((function(){e._logger.info("registered PTZHandler DataSink")})).catch((function(t){e._logger.error("registerDataSink threw exception: ".concat(t))}))),Promise.all([t,n]).then((function(){e._ptzDataChannelStatus.readyForControl=!0,e._logger.info("sent event:ptzDataChannelStateChanged with readyForControl(true)"),e.event("ptzDataChannelStateChanged").raise(!0)})),this._ptzDataSink?this._ptzDataSink.on("data",(function(t){try{var n=JSON.parse(c.bufferToString(t.data));e._processPTZMessage(n)}catch(t){e._logger.error("Error processing ptz messages error=".concat(t))}})):this._logger.error("registerDataSink callback failed due to null _ptzDataSink")}else this._logger.warn("_createAndAttachPTZDevices() null dataChannel")},t.prototype._processPTZMessage=function(e){var t=this;0===e.type?this._isControllee()?this._deviceManager?this._deviceManager.applyPTZControlCommandAsync(e.value).then((function(e){t._sendPTZControlCommandState(e)})):this._logger.error("_processPTZMessage {type=".concat(e.type,", value=").concat(e.value,"}, but _deviceManager is null")):this._logger.error("_processPTZMessage type=".concat(e.type," should be recieved by Controllee only")):1===e.type?this._isController()?this._previousPTZControlDeviceState!==e.value&&(this._logger.info("Remote device state changed. previous:".concat(this._previousPTZControlDeviceState,", new: ").concat(e.value,". sending event to UI")),this._previousPTZControlDeviceState=e.value,this.event("ptzControlDeviceState").raise(e.value)):this._logger.error("_processPTZMessage type=".concat(e.type," should be recieved by Controller only")):this._logger.error("Unsupported type=".concat(e.type))},t.prototype.sendPTZControlCommand=function(e){var t=this;if(this._controlleeParticipant)if(4===this._handlerSessionState){var n={type:0,value:e},r=this._getDataSourceIdForParticipantLeg(this._controlleeParticipant);this._sendPTZMessage(n,r)}else this._logger.error("_sendPTZMessage: no remote controler session");else this._deviceManager?this._deviceManager.applyPTZControlCommandAsync(e).then((function(e){t._previousPTZControlDeviceState!==e&&(t._logger.info("Local ptz device state changed. previous:".concat(t._previousPTZControlDeviceState,", new:").concat(e,". Updating UI, since controlle and controller is same participant.")),t._previousPTZControlDeviceState=e,t.event("ptzControlDeviceState").raise(e))})):this._logger.error("_deviceManager not available, apply ptz command ignored.")},t.prototype._sendPTZControlCommandState=function(e){if(3===this._handlerSessionState){var t=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),n={type:1,value:e};this._sendPTZMessage(n,t)}else this._logger.error("_sendPTZControlCommandState(".concat(e,") ignoring because no remote controller session"))},t.prototype._sendPTZMessage=function(e,t){if(this._ptzDataSource)try{var n=[t];this._ptzDataSource.sendData(c.stringToBuffer(JSON.stringify(e)),n)}catch(n){var r="Failed to send ptz device message. Error=".concat(n);this._logger.error("".concat(r));var i={reason:7,detail:JSON.stringify({PtzDataMessage:e.value,sourceId:t,errorMsg:r})};this._logger.info("sent event:ptzHandlerError with handlerError{reason:".concat(i.reason,", detail:").concat(i.detail)),this.event("ptzHandlerError").raise(i)}else this._logger.error("Failed to send ptz device message: Data channel not set up")},t.prototype._detachAndDeletePTZDevices=function(){var e=this;this._logger.info("_detachAndDeletePTZDevices()");try{this._ptzDataSink&&this._ptzDataSink.removeAllListeners("data"),this._dataChannel?(this._ptzDataSource&&this._dataChannel.unregisterDataSource(this._ptzDataSource).catch((function(t){e._logger.warn("Failed to unregister data source, call probably ended: ".concat(t))})).then((function(){e._ptzDataSource=null,e._logger.info("deleted Control data source")})),this._ptzDataSink&&this._dataChannel.unregisterDataSink(this._ptzDataSink).catch((function(t){e._logger.warn("Failed to unregister data sink, call probably ended: ".concat(t))})).then((function(){e._ptzDataSink=null,e._logger.info("deleted Control data sink")})),this._ptzDataChannelStatus.readyForControl=!1,this._logger.info("sent event:ptzDataChannelStateChanged with readyForControl(false)"),this.event("ptzDataChannelStateChanged").raise(!1)):this._logger.warn("_detachAndDeletePTZDevices() null dataChannel")}catch(e){this._logger.error("Exception thrown while detaching ptz contro/sink devices, error: ".concat(e))}},t.prototype.onDataChannelStatusChanged=function(e){var t=this;return(0,a.asap)((function(){t._onDataChannelStatusChanged(e)}))},t.prototype._onDataChannelStatusChanged=function(e){this._logger.info("Data channel status = ".concat(e)),this._ptzDataChannelStatus.state=o.default.mapDataChannelStatus(e),e===SlimCore.Enums.DataChannelStatus.Active?this._dataChannel&&!this._dataChannelActive&&this._ptzEnabled&&(this._dataChannelActive=!0,this._createAndAttachPTZDevices()):this._dataChannel&&this._dataChannelActive&&(this._dataChannelActive=!1,this._detachAndDeletePTZDevices())},t.prototype.processProtocolMessage=function(e,t,n,r){var i=this;return(0,a.asap)((function(){i._processProtocolMessage(e,t,n,r)}))},t.prototype._raiseControlRequestCanceled=function(e){this._logger.info("sent event:ptzIncomingRequestCancelled with controlRequest.participant.id=".concat(e.participant.id)),this.event("ptzIncomingRequestCancelled").raise(e.participant.id)},t.prototype._processProtocolMessage=function(e,t,n,r){var i;try{i=JSON.parse(e)}catch(e){return void this._logger.error("Error parsing sessionControlMsg")}if(this._logger.info("_processProtocolMessage action=".concat(i.action,", senderParticipantId=").concat(n,", sender=").concat(r)),t||this._logger.warn("protocol message from unknown sender with sourceId=".concat(r)),100===i.action)!1===this._ptzEnabled?(this._logger.warn("control ptz device is disabled - rejecting request"),this._sendRequest({action:103,terminatedReason:9},r)):this._controllerRequest?(this._logger.warn("Controllee is already processing a control request...rejecting new requests"),this._sendRequest({action:103,terminatedReason:3},r)):this._controllerParticipant&&this._controllerParticipant.participant===t?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==n?(this._logger.warn("rejecting control request from second endpoint. participantId: ".concat(n)),this._sendRequest({action:103,terminatedReason:3},r)):(this._logger.warn("Got control request for someone already in control"),this._sendRequest({action:102,terminatedReason:0},r)):t?this._resetControlRequest({participant:t,participantState:t.state,participantId:n}):this._logger.error("Got ControlRequest message but could not find a sender participant, ignoring");else if(102===i.action){if(1===this._handlerSessionState)this._sendRequest({action:104,terminatedReason:0},r)?(this._handlerSessionState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.RequestSent action =".concat(i.action))):this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control is accepted, but fail to send ack"}))):this._logger.error("Unexpected, no promise could be resolved - state =".concat(this._handlerSessionState," action =").concat(i.action)),this._cancelRequestControlTimer();else this._logger.warn("AcceptRequest message received in _handlerSessionState=".concat(this._handlerSessionState))}else if(103===i.action)if(1===this._handlerSessionState){this._handlerSessionState=0;var o={inControl:!1,id:u,terminatedReason:i.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:o,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.RequestSent action =".concat(i.action)),this._resetControlState()}else this._logger.warn("RejectRequest message received in _handlerSessionState=".concat(this._handlerSessionState," reason=").concat(i.terminatedReason));else if(101===i.action){if(this._controllerRequest){var a=this._controllerRequest;this._raiseControlRequestCanceled(a),this._resetControlState()}}else if(104===i.action)if(2===this._handlerSessionState)if(this._controllerParticipant&&this._controllerParticipant.participant===t){var c=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);r!==c&&this._logger.warn("acknowledging source id: ".concat(r," does not match requesting source id: ").concat(c)),this._logger.info("Setting up remote control for controller source id=".concat(c)),this._handlerSessionState=3;var l={inControl:!0,id:this._controllerParticipant.participant.id,terminatedReason:i.terminatedReason};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl=".concat(l.inControl,", id=").concat(l.id,", terminatedReason=").concat(l.terminatedReason,"}")),this.event("ptzSessionChanged").raise(l),this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer()):this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.WaitingForControllerAck action =".concat(i.action))}else t?this._logger.warn("Ignoring ack from participant that does not match controller id = ".concat(s.scrubMriOrOmit(t.id))):this._logger.warn("Ignoring ack from null participant source id = ".concat(r));else 5===this._handlerSessionState?this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._resetControlState()):this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.WaitingForTerminateAck action =".concat(i.action)):this._logger.warn("Unexpected ack in control state = ".concat(this._handlerSessionState));else if(105===i.action||106===i.action){var d=void 0;this._isController()?d=u:t?d=t.id:this._logger.error("Got terminate message but could not find a sender participant!");l={inControl:!1,id:d,terminatedReason:i.terminatedReason};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl=".concat(l.inControl,", id=").concat(l.id,", terminatedReason=").concat(l.terminatedReason,"}")),this.event("ptzSessionChanged").raise(l),106===i.action&&this._sendRequest({action:104,terminatedReason:0},r),this._resetControlState()}else this._logger.error("Unknown request action received on control protocol data sink, action=".concat(i.action))},t.prototype._sendRequest=function(e,t){var n=!1,r=this._protocolDataSource;if(t<0)return this._logger.error("_sendRequest failed. Invalid sourceID=".concat(t)),n;if(r){var i={type:2,message:JSON.stringify(e)};this._logger.info("sending ptz session control message type=".concat(i.type,", message=").concat(i.message," to sourceID=").concat(t));try{var o=[t];r.sendData(c.stringToBuffer(JSON.stringify(i)),o),n=!0}catch(e){var a="Failed to send ptz session control message. Error=".concat(e);this._logger.error("".concat(a));var s={reason:7,detail:JSON.stringify({PtzSessionlMessage:i.message,sourceId:t,errorMsg:a})};this._logger.info("sent event:ptzHandlerError with handlerError{reason:".concat(s.reason,", detail:").concat(s.detail)),this.event("ptzHandlerError").raise(s)}}else this._logger.error("Sending ptz session control message failed: null dataSource in _sendRequest");return n},t.prototype._resetControlState=function(){this._logger.info("_resetControlState()"),this._previousPTZControlDeviceState=0,this._handlerSessionState=0,this.role=0,this._resetControllerParticipant(),this._controlleeParticipant=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelTerminateControlTimer()},t.prototype.requestPTZControl=function(e){return 3!==this._callState?Promise.reject(new Error("requestPTZControl when call is not connected")):this._dataChannelActive?0!==this._handlerSessionState?Promise.reject(new Error("requestPTZControl called in bad state=".concat(this._handlerSessionState))):e?this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while requesting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while requesting control")):this._requestPTZControl(e):Promise.reject(new Error("requestPTZControl unexpected null ControlParticipant")):Promise.reject(new Error("requestPTZControl when data channel not active"))},t.prototype._requestPTZControl=function(e){var t=this;this._logger.info("_requestPTZControl()"),this._resetControlState(),this.role=2,this._controlleeParticipant={participant:e,participantState:3,participantId:this._participantId},this._requestControlPromise=new a.Deferred;var n=function(){t._requestControlPromise=null};this._requestControlPromise.promise.then(n,n);var r=this._getDataSourceIdForParticipantLeg(this._controlleeParticipant);if(!this._sendRequest({action:100,terminatedReason:0},r)){var i={inControl:!1,id:u,terminatedReason:7};return this._requestControlPromise.reject(new Error),Promise.reject(new Error(JSON.stringify({controlInfo:i,details:""})))}return this._handlerSessionState=1,this._requestControlTimer=window.setTimeout((function(){if(1===t._handlerSessionState){t._logger.warn("No response to control request - canceling"),t._sendRequest({action:101,terminatedReason:2},r)||t._logger.error("fail to send the cancel control request");var e={inControl:!1,id:u,terminatedReason:2};t._requestControlPromise?t._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:e,details:"we did not get any response to the control - terminating session control request."}))):t._logger.error("Unexpected, no promise could be resolved - _handlerSessionState = PTZHandlerSessionState.RequestSent"),t._resetControlState()}else t._requestControlPromise?t._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control - times out in bad state - do nothing"}))):t._logger.error("Unexpected, no promise could be resolved - _handlerSessionState = ".concat(t._handlerSessionState));t._requestControlTimer=null}),3e4),this._requestControlPromise.promise},t.prototype._cancelRequestControlTimer=function(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(new Error("cancelled by _cancelRequestControlTimer")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)},t.prototype.acceptPTZControllerRequest=function(){return this._logger.info("acceptPTZControllerRequest()"),this._dataChannelActive?this._controllerRequest?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while accepting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while accepting control")):this._acceptPTZControllerRequest():Promise.reject(new Error("acceptPTZControllerRequest while no control request pending")):Promise.reject(new Error("acceptPTZControllerRequest when data channel not active"))},t.prototype._acceptPTZControllerRequest=function(){var e=this;this._logger.info("_acceptPTZControllerRequest()"),this._acceptControlPromise=new a.Deferred;var t=function(){e._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(t,t),this._controllerParticipant){this._logger.warn("_acceptPTZControllerRequest called while another participant already has control - terminating control of existing controller");var n=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:105,terminatedReason:10},n)||this._logger.error("fail to send the terminateNoAck request"),this._resetControllerParticipant()}var r=this._getDataSourceIdForParticipantLeg(this._controllerRequest),i=this._controllerRequest.participant.id;return this._sendRequest({action:102,terminatedReason:0},r)?(this._resetControllerParticipant(this._controllerRequest),this._clearControlRequest(),this._handlerSessionState=2,this.role=1,this._acceptControlTimer=window.setTimeout((function(){if(2===e._handlerSessionState){e._logger.error("No ack received when accepting control request - terminating control"),e._sendRequest({action:105,terminatedReason:4},r)||e._logger.error("fail to send the TerminateNoAck request");var t={inControl:!1,id:i,terminatedReason:4};e._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl=".concat(t.inControl,", id=").concat(t.id,", terminatedReason=").concat(t.terminatedReason,"}")),e.event("ptzSessionChanged").raise(t),e._acceptControlPromise?e._acceptControlPromise.reject(new Error("No ack received when accept control - terminating control")):e._logger.error("Unexpected, no promise could be resolved - _handlerSessionState = PTZHandlerSessionState.WaitingForControllerAck")}else e._acceptControlPromise?e._acceptControlPromise.reject(new Error("accept control - times out in bad state - do nothing")):e._logger.error("Unexpected, no promise could be resolved - _handlerSessionState = ".concat(e._handlerSessionState));e._acceptControlTimer=null,e._resetControlState()}),1e4),this._acceptControlPromise.promise):(this._logger.error("fail to send the accept control request"),this._acceptControlPromise.reject(new Error),Promise.reject(new Error("fail to send the accept control request!")))},t.prototype._cancelAcceptControlTimer=function(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(new Error("cancelled by _cancelAcceptControlTimer")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)},t.prototype.denyPTZControllerRequest=function(){return this._dataChannelActive?this._controllerRequest?this._isControllee()?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while denying control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while denying control")):this._denyPTZControllerRequest():Promise.reject(new Error("denyPTZControllerRequest when not advertized as controllee")):Promise.reject(new Error("denyPTZControllerRequest while no control request pending")):Promise.reject(new Error("denyPTZControllerRequest when data channel not active"))},t.prototype._denyPTZControllerRequest=function(){this._logger.info("_denyPTZControllerRequest()");var e=this._getDataSourceIdForParticipantLeg(this._controllerRequest);return this._clearControlRequest(),this._sendRequest({action:103,terminatedReason:1},e)?new Promise((function(e,t){e()})):Promise.reject(new Error("fail to send the deny control requst"))},t.prototype._getDataSourceIdForParticipantId=function(e,t){return this._dataChannel&&e?e.getSourceId(t,3):(this._logger.error("Null data channel or null participant cannot map participant to source id"),-1)},t.prototype._getDataSourceIdForParticipantLeg=function(e){return e?this._getDataSourceIdForParticipantId(e.participant,e.participantId):(this._logger.error("Null participantLeg cannot map participant to source id"),-1)},t.prototype.terminatePTZSession=function(){if(this._isController()){if(4!==this._handlerSessionState)return Promise.reject(new Error("terminateControl called while not in control"));if(!this._controlleeParticipant)return Promise.reject(new Error("terminateControl called but _controlleeParticipant is null"))}else{if(!this._isControllee())return Promise.reject(new Error("terminateControl called but niether controller nor controllee"));if(!this._controllerParticipant)return Promise.reject(new Error("terminateControl called but controllerParticipant is null"))}return this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while terminating control")):this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while terminating control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while terminating control")):this._terminatePTZSession()},t.prototype._terminatePTZSession=function(){var e=this;this._logger.info("_terminatePTZSession()"),this._terminateControlPromise=new a.Deferred;var t=function(){e._terminateControlPromise=null};this._terminateControlPromise.promise.then(t,t);var n,r,i=0;if(this._isController()){if(4!==this._handlerSessionState)return this._logger.error("Local Controller called terminateControl when not controlling"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local Controller called terminateControl when not controlling"));i=6,n=this._getDataSourceIdForParticipantLeg(this._controlleeParticipant),r=u}else{if(3!==this._handlerSessionState||!this._controllerParticipant)return this._logger.error("Local Controllee called terminateControl when no one is in control"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local Controllee called terminateControl when no one is in control"));i=5,n=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),r=this._controllerParticipant.participant.id}this._sendRequest({action:105,terminatedReason:i},n)||this._logger.error("fail to send the terminateNoAck request"),this._handlerSessionState=0;var o={inControl:!1,id:r,terminatedReason:i};return this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl=".concat(o.inControl,", id=").concat(o.id,", terminatedReason=").concat(o.terminatedReason,"}")),this.event("ptzSessionChanged").raise(o),this._terminateControlPromise.resolve(),this._resetControlState(),new Promise((function(e,t){e()}))},t.prototype._cancelTerminateControlTimer=function(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(new Error("cancelled by _cancelTerminateControlTimer")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null)},t.prototype.dispose=function(t){this._logger.info("dispose causeId: ".concat(t)),this._detachAndDeletePTZDevices(),this._resetControlState(),this._dataChannel&&(this._dataChannel=null),e.prototype.dispose.call(this,t)},t}(l.default);t.default=d},8253:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5442),c=n(1775),l=n(6882),u=function(e){function t(t,n,r){var i=e.call(this,t.createChild("PersonalizedNoiseSuppression"),n,r)||this;return i._initPromise=new s.Deferred,i._logger.info("created"),i._slimcoreInstance.createNoiseSuppressionHandler&&(i._noiseSuppressionHandler=i._slimcoreInstance.createNoiseSuppressionHandler(),i._noiseSuppressionHandler&&(i._logger.info("noise suppression handler created"),i._registerDisposable(i._noiseSuppressionHandler.handle("voice-signature-version-event",void 0,(function(e){i._slimCoreVoiceSignatureVersionEventHandler(e)}))),i._registerDisposable(i._noiseSuppressionHandler.handle("noise-suppression-method-in-use-event",void 0,(function(e){i._slimCoreNoiseSuppressionMethodInUseEventHandler(e)}))),i._registerDisposable(i._noiseSuppressionHandler))),i}return i(t,e),t.prototype.initialize=function(){this._logger.info("initalizing slimcore noise suppression handler"),this._noiseSuppressionHandler?(this._noiseSuppressionHandler.initialize(),this._initPromise.resolve(),this._logger.info("noise suppression handler initialized")):this._initPromise.reject(new Error("noise suppression handler is not available"))},t.prototype.setVoiceSignature=function(e){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,this._initPromise.promise.then((function(){return t._logger.info("setting voice signature: version ".concat(e.version,", signature data size ").concat(e.data.length)),t._noiseSuppressionHandler.setVoiceSignature(e)})).then((function(e){return t._convertVoiceSignatureState(e)})).catch((function(e){throw t._logger.error("Error in setVoiceSignature, error = ".concat(e)),e}))]}))}))},t.prototype.getVoiceSignatureVersions=function(){return o(this,void 0,void 0,(function(){var e=this;return a(this,(function(t){return[2,this._initPromise.promise.then((function(){return e._noiseSuppressionHandler.getVoiceSignatureVersions()})).catch((function(t){throw e._logger.error("Error in getVoiceSignatureVersions, error = ".concat(t)),t}))]}))}))},t.prototype._slimCoreVoiceSignatureVersionEventHandler=function(e){this._logger.info("slimcore voice signature version event: ".concat(JSON.stringify(e)));var t={versions:e.versions};this.event("voiceSignatureVersionEvent").raise(t)},t.prototype._slimCoreNoiseSuppressionMethodInUseEventHandler=function(e){this._logger.info("slimcore noise suppression method in use event: ".concat(JSON.stringify(e))),this.event("noiseSuppressionMethodInUseEvent").raise((0,l.convertNoiseSuppressionMethodTypeFromSlimCore)(e.method),(0,l.convertNoiseSuppressionMethodFallbackReasonFromSlimCore)(e.reason))},t.prototype._convertVoiceSignatureState=function(e){switch(e){case SlimCore.Enums.VoiceSignatureState.WrongVersion:return 0;case SlimCore.Enums.VoiceSignatureState.BadSignature:return 1;case SlimCore.Enums.VoiceSignatureState.NotValidated:return 2;case SlimCore.Enums.VoiceSignatureState.Success:return 3;default:throw new RangeError("Unmapped SlimCore.Enums.VoiceSignatureState value: ".concat(e))}},t}(c.default);t.default=u},6882:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertNoiseSuppressionMethodFallbackReasonToSlimCore=t.convertNoiseSuppressionMethodTypeToSlimCore=t.convertNoiseSuppressionMethodFallbackReasonFromSlimCore=t.convertNoiseSuppressionMethodTypeFromSlimCore=void 0,t.convertNoiseSuppressionMethodTypeFromSlimCore=function(e){switch(e){case SlimCore.Enums.NoiseSuppressionMethodType.PNS:return 0;case SlimCore.Enums.NoiseSuppressionMethodType.DNS:return 1;case SlimCore.Enums.NoiseSuppressionMethodType.Classical:return 2;case SlimCore.Enums.NoiseSuppressionMethodType.Off:return 3;case SlimCore.Enums.NoiseSuppressionMethodType.HeadsetNS:return 4;default:return 3}},t.convertNoiseSuppressionMethodFallbackReasonFromSlimCore=function(e){switch(e){case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.None:return 0;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.CpuInsufficient:return 1;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.ModelNotReady:return 2;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.VoiceSignatureMissing:return 3;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DisabledForSpeechRecognition:return 6;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DisabledForRecording:return 7;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DisabledForMicMute:return 8;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.AuditoriumMode:return 4;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.NearEndMusicMode:return 5;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DeepAECNotAllowed:return 9;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.CaptureDeviceNotSet:return 11;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.MicOutputSamplingRateNotSupported:return 12;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.MicOutputChannelsNotSupported:return 13;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.RenderDeviceNotSet:return 14;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DisabledForOffload:return 15;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.ECSModelUrlsNotSet:return 16;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.PlatformNotSupported:return 17;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.ModelNotDownloaded:return 18;case SlimCore.Enums.NoiseSuppressionMethodFallbackReason.ModelDownloadSessionCreationFailed:return 19;default:return 10}},t.convertNoiseSuppressionMethodTypeToSlimCore=function(e){switch(e){case 0:return SlimCore.Enums.NoiseSuppressionMethodType.PNS;case 1:return SlimCore.Enums.NoiseSuppressionMethodType.DNS;case 2:return SlimCore.Enums.NoiseSuppressionMethodType.Classical;case 3:default:return SlimCore.Enums.NoiseSuppressionMethodType.Off;case 4:return SlimCore.Enums.NoiseSuppressionMethodType.HeadsetNS}},t.convertNoiseSuppressionMethodFallbackReasonToSlimCore=function(e){switch(e){case 0:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.None;case 1:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.CpuInsufficient;case 2:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.ModelNotReady;case 3:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.VoiceSignatureMissing;case 6:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DisabledForSpeechRecognition;case 7:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DisabledForRecording;case 8:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DisabledForMicMute;case 4:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.AuditoriumMode;case 5:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.NearEndMusicMode;case 9:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DeepAECNotAllowed;case 11:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.CaptureDeviceNotSet;case 12:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.MicOutputSamplingRateNotSupported;case 13:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.MicOutputChannelsNotSupported;case 14:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.RenderDeviceNotSet;case 15:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.DisabledForOffload;case 16:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.ECSModelUrlsNotSet;case 17:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.PlatformNotSupported;case 18:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.ModelNotDownloaded;case 19:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.ModelDownloadSessionCreationFailed;default:return SlimCore.Enums.NoiseSuppressionMethodFallbackReason.GenericError}}},3024:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getRemoteVideoProps=t.SOURCE_NONE=t.SlimCoreElectronRemoteStreamContext=void 0;var c=n(6773),l=n(7584),u=n(2321),d=n(5773),p=n(1775),h=n(9230),g=n(8967),f=n(2559),m=function(){this.nrRunningStreams=0,this.videoStoppedEvent=new d.VideoStateCancelEvent};t.SlimCoreElectronRemoteStreamContext=m;var _=0;t.SOURCE_NONE=-1>>>0;t.getRemoteVideoProps=function(){return{strProps:{endpointId:{propKey:SlimCore.Enums.Property.VideoEndpointId},participantId:{propKey:SlimCore.Enums.Property.VideoParticipantLegId},negotiationTag:{propKey:SlimCore.Enums.Property.VideoNegotiationTag},label:{propKey:SlimCore.Enums.Property.VideoLabel},deviceCapabilitiesJson:{propKey:SlimCore.Enums.Property.VideoDeviceCapabilities}},intProps:{mediaType:{propKey:SlimCore.Enums.Property.VideoType},videoStatus:{propKey:SlimCore.Enums.Property.VideoStatus},mediaSourceId:{propKey:SlimCore.Enums.Property.VideoRank},dynamicVirtualParticipantMsi:{propKey:SlimCore.Enums.Property.VideoVirtualParticipantMsi},participantObjectId:{propKey:SlimCore.Enums.Property.VideoParticipantObjectId}}}};var y=function(e){function n(n,r,i,o,a,s,c,l,p,h){var m=e.call(this,r.createChild((function(){return"RemoteStream(".concat(m._context.nrRunningStreams,")[").concat(m._remoteVideoId,":").concat(m.mediaSourceId,":").concat(m.rank,":").concat(m._mediaType,":").concat(m._videoStatus,"]")})),i,o)||this;return m._participantId=a,m.id=s,m.type=c,m._context=p,m._participantIdMapperFactory=h,m.mediaSourceId=t.SOURCE_NONE,m._remoteVideoId=0,m._videoStatus=SlimCore.Enums.VideoStatus.None,m._dynamicVirtualParticipantMsi=t.SOURCE_NONE,m._stateCancelEvent=new d.VideoStateCancelEvent,m._shouldRun=!1,m._isDisposed=!1,m._isStreamingOverride=!1,m._hasStreamEverStarted=!1,m._txNdiNotifier=new g.default(m._logger,m._slimcoreInstance),m._nrRenderers=0,m._nrOngoingStreamStarts=0,m._nrOngoingStreamStops=0,m._vdeoStreamConfiguration={},m._chainedApiPromise=new u.default(r.createChild((function(){return"RemoteStreamChain(".concat(m._context.nrRunningStreams,")")}))),m._remoteVideoId=s,m.rank=_++,m._mediaType=l.mediaType,m._videoStatus=l.videoStatus,m._onVideoObjectPropertyChanged(SlimCore.Enums.Property.VideoStatus,(function(e){m._onVideoObjectStateChanged(n,e.value)})),m._onVideoObjectPropertyChanged(SlimCore.Enums.Property.VideoVirtualParticipantMsi,(function(e){m._onVideoObjectVirtualParticipantChanged(e.value)})),m.endpointId=l.endpointId,m.participantId=l.participantId,m.mediaSourceId=l.mediaSourceId,m.negotiationTag=l.negotiationTag,m.label=l.label,l.deviceCapabilitiesJson&&(m.deviceCapabilities=JSON.parse(l.deviceCapabilitiesJson)),m._dynamicVirtualParticipantMsi=l.dynamicVirtualParticipantMsi,m._logger.info("constructor: endpointId: ".concat((0,f.truncate)(m.endpointId,8),", participantId: ").concat(m.participantId,", negotiationTag: ").concat(m.negotiationTag,", causeId: ").concat(n,", label: ").concat(m.label,", deviceCapabilities: ").concat(d.deviceCapabilitiesToString(m.deviceCapabilities),", dynamicVirtualParticipantMsi: ").concat(m._dynamicVirtualParticipantMsi)),m}return i(n,e),Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),n.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,msi:this.mediaSourceId,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming,negotiationTag:this.negotiationTag,video_status:this._videoStatus,shouldRun:this._shouldRun,nrRenderers:this._nrRenderers,isDisposed:this._isDisposed})},n.prototype.getStats=function(){var e={isAvailable:this.isAvailable,isStreaming:this.isStreaming,negotiationTag:this.negotiationTag,video_status:this._videoStatus,shouldRun:this._shouldRun,nrRenderers:this._nrRenderers,isDisposed:this._isDisposed};return c.isEqual(this._lastStreamStats,e)||(this._streamStatsUpdatedTimestamp=Date.now(),this._lastStreamStats=e),o({id:this.id,type:this.type,timestampUpdated:this._streamStatsUpdatedTimestamp,msi:this.mediaSourceId,rank:this.rank},this._lastStreamStats)},Object.defineProperty(n.prototype,"isAvailable",{get:function(){return d.isVideoAvailable(this._videoStatus)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isStreaming",{get:function(){return this._videoStatus===SlimCore.Enums.VideoStatus.Running||this._isStreamingOverride&&this.isAvailable},enumerable:!1,configurable:!0}),n.prototype.setIsStreamingOverride=function(e,t){if(this._isStreamingOverride!==t){this._logger.info("setIsStreamingOverride: causeId: ".concat(e," override: ").concat(this._isStreamingOverride," -> ").concat(t));var n=this.isStreaming;this._isStreamingOverride=t,n!==this.isStreaming&&this.raiseChanged()}},n.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},n.prototype.start=function(e,t){return a(this,void 0,void 0,(function(){var n,r,i,o,a,c,u,p,h,g=this;return s(this,(function(s){switch(s.label){case 0:n=Date.now(),r=null==t?void 0:t.timeout,i=n,o=n,a=(0,l.generateCauseId)(),this._shouldRun=!0,this._hasStreamEverStarted=!0,this._logger.info("start causeId: ".concat(a," timout: ").concat(r)),this._nrOngoingStreamStarts++,s.label=1;case 1:return s.trys.push([1,8,9,10]),[4,d.waitForVideoObjectToBeAvailable(this._slimcoreInstance,this._remoteVideoId,this._logger,a,d.videoObjectTimeout(this._settings),this._stateCancelEvent)];case 2:return s.sent(),i=Date.now(),[4,this._chainedApiPromise.chainPromise((function(){return g._startVideo(a,e,t)}),this._chainActionFn("start"),a)];case 3:c=s.sent(),o=Date.now(),s.label=4;case 4:return s.trys.push([4,6,,7]),this._throwIfDisposed(a,"disposed while in start"),[4,d.waitForVideoObjectToBeRunning(this._slimcoreInstance,this._remoteVideoId,this._logger,a,r,this._stateCancelEvent)];case 5:return s.sent(),this._updateVideoStatus(a),h=Date.now(),this._logger.info("start causeId: ".concat(a," successful. duration: ").concat(h-n," (").concat(i-n,"+").concat(o-i,"+").concat(h-o,")")),[2,c];case 6:throw u=s.sent(),c.dispose(a),u;case 7:return[3,10];case 8:throw p=s.sent(),h=Date.now(),this._logger.warn("start causeId: ".concat(a," failed. duration: ").concat(h-n," (").concat(i-n,"+").concat(o-i,"+").concat(h-o,") error: ").concat(p)),p;case 9:return this._nrOngoingStreamStarts--,0===this._nrRenderers&&0===this._nrOngoingStreamStarts&&this._stopWithCauseId(this._chainActionFn("no renderers, cleanup"),a),[7];case 10:return[2]}}))}))},n.prototype.stop=function(){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=(0,l.generateCauseId)(),[4,this._stopWithCauseId(this._chainActionFn("stop"),e)];case 1:return t.sent(),[2]}}))}))},n.prototype.setVideoStreamConfig=function(e){var t=this,n=(0,l.generateCauseId)();this._chainedApiPromise.chainPromise((function(){return t._setVideoStreamConfig(e,n)}),this._chainActionFn("setVideoStreamConfig"),n)},n.prototype.dispose=function(e){this._logger.info("dispose causeId: ".concat(e)),this._disposeWithCauseId(this._chainActionFn("dispose"),e)},n.prototype.disposeInternal=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._disposeWithCauseId(this._chainActionFn("disposeInternal"),e)];case 1:return t.sent(),[2]}}))}))},n.prototype.registerRenderer=function(e,t){this._nrRenderers++},n.prototype.unregisterRenderer=function(e,t){0==--this._nrRenderers&&0===this._nrOngoingStreamStarts&&this._stopWithCauseId(this._chainActionFn("renderers disposed"),e)},n.prototype.changeVirtualParticipant=function(e){this.dynamicVirtualParticipantId!==e&&(this._logger.info("changeVirtualParticipant participant mri: ".concat(this.dynamicVirtualParticipantId," -> ").concat(e)),this.dynamicVirtualParticipantId=e,this.raiseChanged())},n.prototype._setVideoStreamConfig=function(e,t){return a(this,void 0,void 0,(function(){return s(this,(function(n){return this._vdeoStreamConfiguration=o(o({},this._vdeoStreamConfiguration),e),this._shouldRun&&this._isRunning()&&this._setCurrentVideoStreamConfig(this._videoBinding,t),[2]}))}))},n.prototype._setCurrentVideoStreamConfig=function(e,t){c.isEmpty(this._vdeoStreamConfiguration)||(e.setSinkDeviceConfig?(this._logger.info("setVideoStreamConfig causeId: ".concat(t," json: ").concat(JSON.stringify(this._vdeoStreamConfiguration))),e.setSinkDeviceConfig(this._vdeoStreamConfiguration)):this._logger.warn("setVideoStreamConfig causeId: ".concat(t," (that old) slimcore does not support setSinkDeviceConfig")))},n.prototype._stopWithCauseId=function(e,t){return a(this,void 0,void 0,(function(){var n=this;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,,2,3]),this._nrOngoingStreamStops++,this._shouldRun=!1,this._stateCancelEvent.fire(),[4,this._chainedApiPromise.chainPromise((function(){return n._stopVideo(t,!1)}),e,t)];case 1:return r.sent(),[3,3];case 2:return this._nrOngoingStreamStops--,[7];case 3:return[2]}}))}))},n.prototype._chainActionFn=function(e){var t=this;return function(){return"".concat(e," [").concat(t._participantId,":").concat(t._remoteVideoId,":").concat(t.rank,":").concat(t._mediaType,":").concat(t._videoStatus,"]")}},n.prototype._isVideoStatusInStopping=function(){return this._videoStatus===SlimCore.Enums.VideoStatus.Stopping},n.prototype._updateVideoStatus=function(e,t){var n=void 0===t||this._hasStreamEverStarted?this._getProperties(this._remoteVideoId,{},{status:{propKey:SlimCore.Enums.Property.VideoStatus}}).status:t;this._videoStatus!==n&&(this._logger.info("VideoStateChanged: causeId: ".concat(e," status: ").concat(this._videoStatus," -> ").concat(n)),this._videoStatus=n,this._shouldRun&&this._isVideoStatusInStopping()&&this._videoWasStopped(e),this.raiseChanged())},n.prototype._disposeWithCauseId=function(e,t){return a(this,void 0,void 0,(function(){var n=this;return s(this,(function(r){switch(r.label){case 0:return this._isDisposed=!0,this._shouldRun=!1,this._hasStreamEverStarted?(this._stateCancelEvent.fire(),[4,this._chainedApiPromise.chainPromise((function(){return n._stopAndDispose(t)}),e,t)]):[3,2];case 1:return r.sent(),[3,3];case 2:this._dispose(t),r.label=3;case 3:return[2]}}))}))},n.prototype._onVideoObjectPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.id,e,t)},n.prototype._onVideoObjectStateChanged=function(e,t){this._updateVideoStatus(e,t)},n.prototype._onVideoObjectVirtualParticipantChanged=function(e){var t=this;this._dynamicVirtualParticipantMsi!==e&&(this._logger.info("VideoVirtualParticipantMsi msi: ".concat(this._dynamicVirtualParticipantMsi," -> ").concat(e)),this._dynamicVirtualParticipantMsi=e,this._mapper||(this._mapper=this._participantIdMapperFactory((function(e){t.changeVirtualParticipant(e)}))),this._mapper.update(e))},n.prototype._videoWasStopped=function(e){0===this._nrOngoingStreamStops?this._stopWithCauseId(this._chainActionFn("discovered video stopped"),e):this._logger.info("_videoWasStopped causeId: ".concat(e," noop: because ").concat(this._nrOngoingStreamStops," pending stops"))},n.prototype._isRunning=function(){return!!this._videoBinding},n.prototype._stopVideo=function(e,t){return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this._shouldRun&&!t&&!this._isVideoStatusInStopping()||!this._isRunning()?[3,4]:(this._logger.info("_stopVideo causeId: ".concat(e," force: ").concat(t," will stop remote video now")),[4,this._slimcoreInstance.videoStop(this._remoteVideoId)]);case 1:return n.sent(),this._txNdiNotifier.notifyNdiVideoStopped(e),[4,d.forgetAndLog(this._slimcoreInstance.videoReleaseBinding(this._remoteVideoId,this._videoBinding),this._logger,"_stopVideo causeId: ".concat(e," videoReleaseBinding on remote video"))];case 2:return n.sent(),this._videoBinding=null,[4,d.waitForVideoObjectToBeStopped(this._slimcoreInstance,this._remoteVideoId,this._logger,e)];case 3:return n.sent(),this._context.nrRunningStreams--,this._logger.info("_stopVideo causeId: ".concat(e," force: ").concat(t," remote video is stopped")),this._updateVideoStatus(e),this._context.videoStoppedEvent.fire(),[3,5];case 4:this._logger.info("_stopVideo causeId: ".concat(e," noop, force: ").concat(t," should run: ").concat(this._shouldRun," is running: ").concat(this._isRunning()," already disposed: ").concat(this._isDisposed)),n.label=5;case 5:return[2]}}))}))},n.prototype._startVideo=function(e,t,n){return a(this,void 0,void 0,(function(){var r,i;return s(this,(function(o){switch(o.label){case 0:return[4,this._getStartedVideo(e)];case 1:r=o.sent(),o.label=2;case 2:return o.trys.push([2,3,,6]),this._updateVideoStatus(e),this._logger.info("_startVideo causeId: ".concat(e," create renderer")),[2,new h.default(e,this._logger,this._settings,null,t,this._mediaType,this._videoBinding,n,this)];case 3:return i=o.sent(),r?[4,d.forgetAndLog(this._stopVideo(e,!0),this._logger,"_startVideo causeId: ".concat(e," stopping remote video while got error while starting video"))]:[3,5];case 4:o.sent(),o.label=5;case 5:throw i;case 6:return[2]}}))}))},n.prototype._dispose=function(t){this._mapper&&this._mapper.dispose(),e.prototype.dispose.call(this,t)},n.prototype._stopAndDispose=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,,2,3]),[4,this._stopVideo(e,!0)];case 1:return t.sent(),[3,3];case 2:return this._dispose(e),[7];case 3:return[2]}}))}))},n.prototype._getStartedVideo=function(e){return a(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:if(this._throwIfDisposed(e,"disposed while in _getStartedVideo"),!this._shouldRun)throw new Error("_getStartedVideo causeId: ".concat(e," failing, should not run any more"));return this._isRunning()?[3,7]:(this._logger.info("_getStartedVideo causeId: ".concat(e," will start remote video now")),t=this._createVideoBindingRenderer(e),this._setCurrentVideoStreamConfig(t,e),[4,this._slimcoreInstance.videoStart(this._remoteVideoId)]);case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,6]),[4,this._slimcoreInstance.videoCreateBinding(this._remoteVideoId,t)];case 3:return r.sent(),this._txNdiNotifier.notifyNdiVideoStarted(e,this._remoteVideoId,t),[3,6];case 4:return n=r.sent(),[4,this._slimcoreInstance.videoStop(this._remoteVideoId)];case 5:throw r.sent(),n;case 6:return this._context.nrRunningStreams++,this._videoBinding=t,this._logger.info("_getStartedVideo causeId: ".concat(e," remote video is started")),[2,!0];case 7:return[2,!1]}}))}))},n.prototype._throwIfDisposed=function(e,t){if(this._isDisposed)throw new Error("_throwIfDisposed causeId: ".concat(e," reason: ").concat(t))},n.prototype._createVideoBindingRenderer=function(e){return this._logger.info("_createVideoBindingRenderer causeId: ".concat(e," createVideoBindingRenderer")),this._slimcoreInstance.createVideoBindingRenderer({enableDXVA:this._settings.enableDXVA,isLocalPreview:!1})},n}(p.default);t.default=y},1113:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.getParticipantsVideoProperties=void 0;var o=n(6773),a=n(2944),s=n(7584),c=n(6136),l=n(5773),u=n(1775),d=n(3024);function p(e,t,n,r){var i=new Map(o.map(e,(function(e){var t;return[e,(t={},t[SlimCore.Enums.VideoType.Video]=[],t[SlimCore.Enums.VideoType.ScreenShare]=[],t[SlimCore.Enums.VideoType.Ums]=[],t)]}))),a=l.getParticipantsVideos(r,e),s=(0,d.getRemoteVideoProps)(),c=s.strProps,u=s.intProps;return t.info("will read video object properties for ".concat(a.length," video objects for ").concat(e.length," participants")),l.getMultipleProperties(n,t,a,c,u).forEach((function(e,t){if(t<a.length){var n=a[t];i.get(e.participantObjectId)[e.mediaType].push({videoObjectId:n,props:e})}})),i}t.getParticipantsVideoProperties=p;var h=function(){function e(e,t,n){this._slimcoreInstance=t,this._callHandler=n,this._updateDeferRunner=a.GlobalDeferHandler.instance.createDeferRunner("RemoteStreamManager.update"),this._requests=new Map,this._logger=e.createChild("RVPC"),this._logger.info("armed")}return e.requestToUpdateVideos=function(t,n,r,i){var o=e._static.collectors,a=o.get(r);a||o.set(r,a=new e(t,n,r)),a._triggerRequest(i)},e.prototype._triggerRequest=function(e){var t=this;this._requests.set(e.participantObjectId,e),this._updateDeferRunner((function(){return t._update()}))},e.prototype._update=function(t){var n=this;void 0===t&&(t=(0,s.generateCauseId)()),e._static.collectors.delete(this._callHandler),o.filter(Array.from(this._requests.values()),(function(e){return!e.isValid()})).forEach((function(e){return n._requests.delete(e.participantObjectId)})),p(Array.from(this._requests.keys()),this._logger,this._slimcoreInstance,this._callHandler).forEach((function(e,r){var i;null===(i=n._requests.get(r))||void 0===i||i.update(t,e)}))},e._static={collectors:new Map},e}(),g=function(e){function t(t,n,r,i,o,a,s,c,l,u){var d=e.call(this,r.createChild((function(){return"SlimCoreElectronRemoteStreamManager[".concat(d._slimcoreParticipantObjectId,"]")})),i,o)||this;return d._parentLogger=n,d._callHandler=a,d._slimcoreParticipantObjectId=s,d._streams=c,d._streamContextMap=l,d._participantIdMapperFactory=u,d._isDisposed=!1,d._logger.info("constructor causeId: ".concat(t)),d}return i(t,e),t.prototype.stopVideos=function(e){this._logger.info("stopVideos causeId: ".concat(e));var t=function(t){return t.disposeInternal(e)};return Promise.all(o.flatMap(o.values(this._streams),(function(e){return o.map(e,t)}))).then(c.noop)},t.prototype.dispose=function(t){this._isDisposed=!0,this._logger.info("dispose causeId: ".concat(t)),o.each(o.values(this._streams),(function(e){return o.each(e,(function(e){return e.dispose(t)}))})),this._streams[0]=[],this._streams[1]=[],this._streams[2]=[],e.prototype.dispose.call(this,t)},t.prototype.onVideoCountChanged=function(){var e=this,t=this.updateVideos.bind(this),n={participantObjectId:this._slimcoreParticipantObjectId,isValid:function(){return!e._isDisposed},update:t};h.requestToUpdateVideos(this._parentLogger,this._slimcoreInstance,this._callHandler,n)},t.prototype.updateVideos=function(e,t){this._updateVideosByType(e,SlimCore.Enums.VideoType.Video,t[SlimCore.Enums.VideoType.Video]),this._updateVideosByType(e,SlimCore.Enums.VideoType.ScreenShare,t[SlimCore.Enums.VideoType.ScreenShare]),this._updateVideosByType(e,SlimCore.Enums.VideoType.Ums,t[SlimCore.Enums.VideoType.Ums]),this.raiseChanged()},t.prototype._updateVideosByType=function(e,t,n){var r=this,i=function(e){switch(e){case SlimCore.Enums.VideoType.ScreenShare:return 1;case SlimCore.Enums.VideoType.Video:return 0;case SlimCore.Enums.VideoType.Ums:return 2;default:return}}(t),a=this._streams[i],s=o.filter(a,(function(e){return!o.some(n,(function(t){return t.videoObjectId===e.id}))}));o.each(s,(function(t){o.remove(a,t),t.dispose(e)})),o.each(n,(function(t){if(!o.some(a,(function(e){return e.id===t.videoObjectId}))){var n=new d.default(e,r._logger,r._settings,r._slimcoreInstance,r._slimcoreParticipantObjectId,t.videoObjectId,i,t.props,r._streamContextMap[i],r._participantIdMapperFactory);r._streams[i].push(n),n.changed((function(){return r.raiseChanged()}))}}))},t}(u.default);t.default=g},9230:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7892),a=n(7584),s=0,c=function(e){function t(t,n,r,i,o,a,c,l,u){var d=e.call(this,n.createChild((function(){return"RemoteVideoRenderer[".concat(d._id,"]")})),r,i)||this;d._renderTarget=o,d._options=l,d._rendererTracker=u,d._id=s++,d._logger.info("constructor causeId: ".concat(t));var p=a===SlimCore.Enums.VideoType.ScreenShare;return d._videoBinding=c,d._options=l||{scalingMode:p?2:1,transparent:p,ignoreMirroring:!1},d._createVideoRenderer(t,d._renderTarget,d._options),d._rendererTracker.registerRenderer(t,d),d}return i(t,e),Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),t.prototype.dispose=function(t){void 0===t&&(t=(0,a.generateCauseId)()),this._logger.info("dispose causeId: ".concat(t));try{e.prototype.dispose.call(this,t)}finally{this._renderTarget=null,this._rendererTracker&&(this._rendererTracker.unregisterRenderer(t,this),this._rendererTracker=null)}},t}(o.default);t.default=c},18:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1775),c=n(5442),l=n(7939),u=function(e){function t(t,n,r){var i=e.call(this,t.createChild("RtcAudioManager"),n,r)||this;return i._initPromise=new c.Deferred,i._logger.info("created"),i._slimcoreInstance.createRtcAudioHandler&&(i._rtcAudioHandler=i._slimcoreInstance.createRtcAudioHandler(),i._rtcAudioHandler&&(i._logger.info("rtc audio handler created"),i._registerDisposable(i._rtcAudioHandler.handle("ultrasound-beacon-status-changed",void 0,(function(e){i._slimCoreUltrasoundBeaconStatusChangedHandler(e)}))),i._registerDisposable(i._rtcAudioHandler.handle("ultrasound-beacon-detected",void 0,(function(e){i._slimCoreUltrasoundBeaconDetectedHandler(e)}))),i._registerDisposable(i._rtcAudioHandler.handle("ultrasound-beacon-error",void 0,(function(e){i._slimCoreUltrasoundBeaconErrorHandler(e)}))),i._registerDisposable(i._rtcAudioHandler.handle("speaker-volume-change",void 0,(function(e){i._slimCoreSpeakerVolumeChangeHandler(e)}))),i._registerDisposable(i._rtcAudioHandler))),i}return i(t,e),t.prototype.initialize=function(){this._logger.info("initalizing slimcore rtc audio handler"),this._rtcAudioHandler?(this._rtcAudioHandler.initialize(),this._initPromise.resolve(),this._logger.info("rtc audio handler initialized")):this._initPromise.reject(new Error("rtc audio handler is not available"))},t.prototype.setAudioConfig=function(e,t){return o(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){return[2,this._initPromise.promise.then((function(){return n._logger.info("RtcAudioManager: setAudioConfig with config: ".concat(JSON.stringify(e)," and cause:").concat(t)),n._rtcAudioHandler.setAudioConfig(JSON.stringify(e),t)})).catch((function(e){throw n._logger.error("RtcAudioManager: error in setAudioConfig, error = ".concat(e)),e}))]}))}))},t.prototype.getUltrasoundBeaconStatus=function(e){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,this._initPromise.promise.then((function(){return t._logger.info("RtcAudioManager: getUltrasoundBeaconStatus: type - ".concat(e)),t._rtcAudioHandler.getUltrasoundBeaconStatus((0,l.convertUltrasoundBeaconTypeToSlimCore)(e))})).then((function(e){return(0,l.convertUltrasoundBeaconStatusFromSlimCore)(e)})).catch((function(e){throw t._logger.error("RtcAudioManager: error in getUltrasoundBeaconStatus, error = ".concat(e)),e}))]}))}))},t.prototype._slimCoreUltrasoundBeaconStatusChangedHandler=function(e){this._logger.info("slimcore ultrasound beacon status changed event: ".concat(JSON.stringify(e))),this.event("onUltrasoundBeaconStatusChanged").raise((0,l.convertUltrasoundBeaconTypeFromSlimCore)(e.type),(0,l.convertUltrasoundBeaconStatusFromSlimCore)(e.status))},t.prototype._slimCoreUltrasoundBeaconDetectedHandler=function(e){this._logger.info("slimcore ultrasound beacon detected event: ".concat(JSON.stringify(e))),this._logger.info("slimcore ultrasound beacon detected event data: ".concat(JSON.stringify(e.data))),this.event("onUltrasoundBeaconDetected").raise(e.data)},t.prototype._slimCoreUltrasoundBeaconErrorHandler=function(e){this._logger.info("slimcore ultrasound beacon error event: ".concat(JSON.stringify(e))),this.event("onUltrasoundBeaconError").raise((0,l.convertUltrasoundBeaconTypeFromSlimCore)(e.type),(0,l.convertUltrasoundBeaconErrorFromSlimCore)(e.errorCode),e.errorMessage)},t.prototype._slimCoreSpeakerVolumeChangeHandler=function(e){this._logger.info("slimcore speaker volume change event: ".concat(JSON.stringify(e))),this.event("onSpeakerVolumeChanged").raise(e.isSessionVolume,e.isMuted,e.value)},t}(s.default);t.default=u},7939:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertUltrasoundBeaconStatusToSlimCore=t.convertUltrasoundBeaconErrorToSlimCore=t.convertUltrasoundBeaconTypeToSlimCore=t.convertUltrasoundBeaconErrorFromSlimCore=t.convertUltrasoundBeaconTypeFromSlimCore=t.convertUltrasoundBeaconStatusFromSlimCore=void 0,t.convertUltrasoundBeaconStatusFromSlimCore=function(e){switch(e){case SlimCore.Enums.UltrasoundBeaconStatus.Disabled:return 0;case SlimCore.Enums.UltrasoundBeaconStatus.ListenStarted:return 1;case SlimCore.Enums.UltrasoundBeaconStatus.ListenFinished:return 2;case SlimCore.Enums.UltrasoundBeaconStatus.ProducerStarted:return 3;case SlimCore.Enums.UltrasoundBeaconStatus.ProducerFinished:return 4;case SlimCore.Enums.UltrasoundBeaconStatus.DetectorStarted:return 5;case SlimCore.Enums.UltrasoundBeaconStatus.DetectorFinished:return 6;case SlimCore.Enums.UltrasoundBeaconStatus.Enabled:return 7;default:throw new RangeError("Unmapped SlimCore.Enums.UltrasoundBeaconStatus value: ".concat(e))}},t.convertUltrasoundBeaconTypeFromSlimCore=function(e){switch(e){case SlimCore.Enums.UltrasoundBeaconType.Producer:return"UltrasoundBeaconProducer";case SlimCore.Enums.UltrasoundBeaconType.Detector:return"UltrasoundBeaconDetector";default:throw new RangeError("Unmapped SlimCore.Enums.UltrasoundBeaconType value: ".concat(e))}},t.convertUltrasoundBeaconErrorFromSlimCore=function(e){switch(e){case SlimCore.Enums.UltrasoundBeaconError.ProducerFailed:return 0;case SlimCore.Enums.UltrasoundBeaconError.DetectorFailed:return 1;default:throw new RangeError("Unmapped SlimCore.Enums.UltrasoundBeaconError value: ".concat(e))}},t.convertUltrasoundBeaconTypeToSlimCore=function(e){switch(e){case"UltrasoundBeaconProducer":return SlimCore.Enums.UltrasoundBeaconType.Producer;case"UltrasoundBeaconDetector":return SlimCore.Enums.UltrasoundBeaconType.Detector;default:throw new RangeError("Unmapped UltrasoundBeaconType value: ".concat(e))}},t.convertUltrasoundBeaconErrorToSlimCore=function(e){switch(e){case 0:return SlimCore.Enums.UltrasoundBeaconError.ProducerFailed;case 1:return SlimCore.Enums.UltrasoundBeaconError.DetectorFailed;default:throw new RangeError("Unmapped UltrasoundBeaconError value: ".concat(e))}},t.convertUltrasoundBeaconStatusToSlimCore=function(e){switch(e){case 0:return SlimCore.Enums.UltrasoundBeaconStatus.Disabled;case 1:return SlimCore.Enums.UltrasoundBeaconStatus.ListenStarted;case 2:return SlimCore.Enums.UltrasoundBeaconStatus.ListenFinished;case 3:return SlimCore.Enums.UltrasoundBeaconStatus.ProducerStarted;case 4:return SlimCore.Enums.UltrasoundBeaconStatus.ProducerFinished;case 5:return SlimCore.Enums.UltrasoundBeaconStatus.DetectorStarted;case 6:return SlimCore.Enums.UltrasoundBeaconStatus.DetectorFinished;case 7:return SlimCore.Enums.UltrasoundBeaconStatus.Enabled;default:throw new RangeError("Unmapped UltrasoundBeaconStatus value: ".concat(e))}}},8642:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(5773),a=function(){function e(e){this._slimcoreInstance=e}return e.prototype.getMonitorList=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._slimcoreInstance.getMonitorList()]}))}))},e.prototype.getMonitorPreview=function(e,t,n,a,s,c){return r(this,void 0,void 0,(function(){var r,l;return i(this,(function(i){switch(i.label){case 0:return l=(r=o).convertImageData,[4,this._slimcoreInstance.getMonitorSnapshot(e,{width:t,height:n,asImage:a},s,c)];case 1:return[2,l.apply(r,[i.sent()])]}}))}))},e.prototype.getWindowList=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._slimcoreInstance.getWindowList()]}))}))},e.prototype.getWindowPreview=function(e,t,n,a,s){return r(this,void 0,void 0,(function(){var r,c;return i(this,(function(i){switch(i.label){case 0:return c=(r=o).convertImageData,[4,this._slimcoreInstance.getWindowSnapshot(e,{width:t,height:n,asImage:a},s)];case 1:return[2,c.apply(r,[i.sent()])]}}))}))},e.prototype.getWindowIcon=function(e,t,n,a,s){return r(this,void 0,void 0,(function(){var r,c;return i(this,(function(i){switch(i.label){case 0:return c=(r=o).convertImageData,[4,this._slimcoreInstance.getWindowIcon(e,{width:t,height:n,asImage:a},s)];case 1:return[2,c.apply(r,[i.sent()])]}}))}))},e}();t.default=a},5851:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreElectronScreenSharingControl=void 0;var s=n(6144),c=n(4600),l=n(5442),u=n(5773),d=function(){function e(e,t){this.logger=e,this.injector=t,this.logger.info("ControlInjectorAdapter")}return e.prototype.enableInjector=function(e){return this._setInjectorMode(0)},e.prototype.disableInjector=function(){return Promise.resolve()},e.prototype.setPointerImage=function(e,t){return this.injector.setAvatar(u.stringToBuffer(t),e)},e.prototype.showVirtualCursor=function(e){var t=this;return e?this._setInjectorMode(1).then((function(){return t.injector.allowSingleController(e)})):this.injector.allowSingleController(e).then((function(){return t._setInjectorMode(0)}))},e.prototype.injectRawInput=function(e,t){return this.injector.injectRawInput(e,t)},e.prototype.canBeEnabled=function(){return!0},e.prototype._setInjectorMode=function(e){this.logger.info("_setInjectorMode() mode=".concat(e));var t={mode:e,noMotionTimeoutMs:0,noMotionSharerTimeoutMs:0};return this.injector.setInjectorConfig(t)},e.prototype.testSetControlInjector=function(e){this.injector=e},e}(),p=function(){function e(e){this.logger=e,this.logger.info("RendererAdapter")}return e.prototype.getTarget=function(e){return e.renderTarget},e.prototype.subscribeVideoSizeChangedEvent=function(e,t){var n=e;return n.streamSize&&t(n.streamSize.width,n.streamSize.height),n.on("videoSizeChanged",t)},e.prototype.subscribeRenderStartedEvent=function(e,t){return e.on("renderStarted",t)},e}(),h=function(e){function t(t,n){var r=e.call(this)||this;return r.logger=t,r.slimcoreInstance=n,r.controlDataSink=null,r}return i(t,e),t.prototype.isActive=function(){return!!this.dataChannel},t.prototype.sendProtocolMessage=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){if(this.protocolDataSource)return[2,this.protocolDataSource.sendData(e,t)];throw new Error("Cannot send protocol message, protocol source not present")}))}))},t.prototype.sendControlMessage=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){if(this.controlDataSource)return[2,this.controlDataSource.sendData(e,t)];throw new Error("Cannot send protocol message, protocol source not present")}))}))},t.prototype.setDataChannel=function(e){this.logger.info("Setting DataChannel ".concat(e&&e.id)),this.dataChannel&&!e&&this.detachAndDeleteControlDevices(),this.dataChannel=e},t.prototype.setProtocolDataSource=function(e){this.protocolDataSource=e},t.prototype.createAndAttachControlDevices=function(){var e=this;if(this.logger.info("createAndAttachControlDevices()"),!this.dataChannel)return this.logger.warn("_createAndAttachControlDevices() null dataChannel"),Promise.reject();var t=Promise.resolve(),n=Promise.resolve();return this.controlDataSource||(this.controlDataSource=this.slimcoreInstance.createDataSource(SlimCore.Enums.DataDeviceId.Control),this.logger.info("created Control DataSource"),t=this.dataChannel.registerDataSource(this.controlDataSource).then((function(){e.logger.info("registered Control DataSource")})).catch((function(t){e.logger.error("registerDataSource threw exception: ".concat(t))}))),this.controlDataSink||(this.controlDataSink=this.slimcoreInstance.createDataSink(SlimCore.Enums.DataDeviceId.Control),this.logger.info("created Control DataSink"),n=this.dataChannel.registerDataSink(this.controlDataSink).then((function(){e.logger.info("registered Control DataSink")})).catch((function(t){e.logger.error("registerDataSink threw exception: ".concat(t))}))),this.controlDataSink.on("data",(function(t){return e.event("controlMessage").raise(t.data,t.sourceID)})),Promise.all([t,n])},t.prototype.detachAndDeleteControlDevices=function(){var e=this;this.logger.info("detachAndDeleteControlDevices()"),this.controlDataSink&&this.controlDataSink.removeAllListeners("data"),this.dataChannel?(this.controlDataSource&&(this.dataChannel.unregisterDataSource(this.controlDataSource).then((function(){e.logger.info("Control DataSource unregistered")})).catch((function(t){e.logger.warn("unregisterDataSource threw exception: ".concat(t))})),this.controlDataSource=null,this.logger.info("deleted Control data source")),this.controlDataSink&&(this.dataChannel.unregisterDataSink(this.controlDataSink).then((function(){e.logger.info("Control DataSink unregistered")})).catch((function(t){e.logger.warn("unregisterDataSink threw exception: ".concat(t))})),this.controlDataSink=null,this.logger.info("deleted Control data sink"))):this.logger.warn("detachAndDeleteControlDevices() null dataChannel")},t}(s.default),g=function(e){function t(t,n,r,i,o,a){var s=this,c={};try{var l=a.getString("SkypeCalling","gtcHandshakeSendDelay","");l&&(c.handshakeSendDelay=JSON.parse(l))}catch(e){t.error("Failed to parse ecs config gtcAvailableAckDelay",e)}s=e.call(this,t.createChild("ScreenSharingControl"),r,o,c)||this;var u=new d(s._logger,i),g=new p(s._logger),f=new h(s._logger,n);return s.setAdapters(u,g,f),s}return i(t,e),t.prototype.setDataChannel=function(e){var t=this;return(0,l.asap)((function(){t._dataChannelAdapter.setDataChannel(e)}))},t.prototype.onDataChannelStatusChanged=function(e){this._logger.info("onDataChannelStatusChanged: ".concat(e));var t=this._dataChannelAdapter,n=e===SlimCore.Enums.DataChannelStatus.Active;return n?t.createAndAttachControlDevices():t.detachAndDeleteControlDevices(),this._onDataChannelStatusChanged(n),Promise.resolve()},t.prototype.setProtocolDataSource=function(e){return this._dataChannelAdapter.setProtocolDataSource(e),Promise.resolve()},t.prototype.testSetControlInjector=function(e){var t=e;this._controlInjector.testSetControlInjector(t)},t}(c.ControlBase);t.SlimCoreElectronScreenSharingControl=g},3385:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6773),c=n(1775),l=n(8642),u=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild("ScreenSharingManager"),n,r)||this;return a._appHooks=i,a._deviceManager=o,a._logger.info("constructor"),a._screenScraper=new l.default(a._slimcoreInstance),a._registerDisposable(a._appHooks.onDisplaysChanged((function(){a._raiseScreensChanged()}))),a}return i(t,e),t.prototype.enumerateScreensAsync=function(){return o(this,void 0,void 0,(function(){var e,t,n=this;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._screenScraper.getMonitorList()];case 1:return e=r.sent(),this._logger.debug("screenScraper.getMonitorList() result: ".concat(JSON.stringify(e))),[2,s.map(e,(function(e){return new d(e,n._logger,n._screenScraper)}))];case 2:throw t=r.sent(),this._logger.error("screenScraper.getMonitorList() failed: ".concat(t)),t;case 3:return[2]}}))}))},t.prototype.enumerateWindowsAsync=function(){return o(this,void 0,void 0,(function(){var e,t,n=this;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._screenScraper.getWindowList()];case 1:return e=r.sent(),this._logger.debug("screenScraper.getWindowList() result: ".concat(JSON.stringify(e))),[2,s.map(e,(function(e){return new p(e,n._logger,n._screenScraper)}))];case 2:throw t=r.sent(),this._logger.error("screenScraper.getWindowList() failed: ".concat(t)),t;case 3:return[2]}}))}))},t.prototype.enumerateCamerasAsync=function(){var e=this;try{return this._deviceManager?this._deviceManager.enumerateDevicesAsync().then((function(t){var n=t.filter((function(e){return 1===e.kind}));return e._logger.debug("enumerateCameras() result: ".concat(JSON.stringify(n))),s.map(n,(function(e){return new h(e)}))})):Promise.resolve([])}catch(e){return this._logger.error("enumerateCameras() failed: ".concat(e)),Promise.reject("enumerateCameras() failed: ".concat(e))}},t.prototype._raiseScreensChanged=function(){this._logger.debug("raising onScreensChanged"),this.event("screensChanged").raise()},t}(c.default);t.default=u;var d=function(){function e(e,t,n){this._monitorInfo=e,this._logger=t,this._screenScraper=n}return e.prototype.getId=function(){return this._monitorInfo.monitorId},e.prototype.getDeviceId=function(){return String(this._monitorInfo.monitorId)},e.prototype.getType=function(){return 1},e.prototype.getPreview=function(){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n,r){return o(this,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._screenScraper.getMonitorPreview(this.getId(),e,t,n,this._monitorInfo.region,r)];case 1:return i=a.sent(),this._logger.debug("screenScraper.getMonitorPreview(".concat(this.getId(),") result: ").concat(i.width,"x").concat(i.height)),[2,i];case 2:throw o=a.sent(),this._logger.error("screenScraper.getMonitorPreview(".concat(this.getId(),") failed: ").concat(o)),o;case 3:return[2]}}))}))},e.prototype.getDescription=function(){return this._monitorInfo.name},e.prototype.getIcon=function(){return Promise.resolve(null)},e.prototype.getBounds=function(){return{x:this._monitorInfo.region.x,y:this._monitorInfo.region.y,width:this._monitorInfo.region.width,height:this._monitorInfo.region.height}},e}(),p=function(){function e(e,t,n){this._windowInfo=e,this._logger=t,this._screenScraper=n}return e.prototype.getId=function(){return this._windowInfo.windowId},e.prototype.getDeviceId=function(){return String(this._windowInfo.windowId)},e.prototype.getType=function(){return 2},e.prototype.getPreview=function(){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n,r){return o(this,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._screenScraper.getWindowPreview(this.getId(),e,t,n,r)];case 1:return i=a.sent(),this._logger.debug("screenScraper.getWindowPreview(".concat(this.getId(),") result: ").concat(i.width,"x").concat(i.height)),[2,i];case 2:throw(o=a.sent()).toString().includes("Minimized window")||this._logger.error("screenScraper.getWindowPreview(".concat(this.getId(),") failed: ").concat(o)),o;case 3:return[2]}}))}))},e.prototype.getDescription=function(){return this._windowInfo.title},e.prototype.getAppName=function(){return this._windowInfo.applicationName},e.prototype.getIcon=function(e,t,n,r){return o(this,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._screenScraper.getWindowIcon(this.getId(),e,t,n,r)];case 1:return i=a.sent(),this._logger.debug("screenScraper.getWindowIcon(".concat(this.getId(),") result: ").concat(i.width,"x").concat(i.height)),[2,i];case 2:throw o=a.sent(),this._logger.error("screenScraper.getWindowIcon(".concat(this.getId(),") failed: ").concat(o)),o;case 3:return[2]}}))}))},e.prototype.getBounds=function(){},e}(),h=function(){function e(e){this._cameraDescription=e}return e.prototype.getId=function(){return null},e.prototype.getDeviceId=function(){return this._cameraDescription.id},e.prototype.getType=function(){return 3},e.prototype.getPreview=function(){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(){return Promise.reject("not implemented")},e.prototype.getDescription=function(){return this._cameraDescription.label},e.prototype.getIcon=function(){return Promise.reject("not implemented")},e.prototype.getBounds=function(){},e}()},605:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(5773),a=function(){function e(e,t){this._slimcoreInstance=e,this._accountIdentity=t}return e.prototype.setString=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){try{return[2,this.getSetup().setStr(e,t)]}catch(n){return[2,this._slimcoreInstance.setupSetStr(e,t)]}return[2]}))}))},e.prototype.setNumber=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){try{return[2,this.getSetup().setInt(e,t)]}catch(n){return[2,this._slimcoreInstance.setupSetInt(e,t)]}return[2]}))}))},e.prototype.getSubKey=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){try{return[2,this.getSetup().getSubKey(e,t)]}catch(n){return[2,this._slimcoreInstance.setupGetSubKey(e,t)]}return[2]}))}))},e.prototype.getString=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,this.getSetup().getStr(e)]}catch(t){return[2,this._slimcoreInstance.setupGetStr(e)]}return[2]}))}))},e.prototype.getNumber=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,this.getSetup().getInt(e)]}catch(t){return[2,this._slimcoreInstance.setupGetInt(e)]}return[2]}))}))},e.prototype.delete=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,this.getSetup().delete(e)]}catch(t){return[2,this._slimcoreInstance.setupDelete(e)]}return[2]}))}))},e.prototype.getSetup=function(){if(!this._setup){if(!o.hasFeature(SlimCore.Enums.Feature.MultiUserSupport))throw new Error("No Multiuser support");this._setup=this._slimcoreInstance.getSetup(this._accountIdentity)}return this._setup},e}();t.default=a},1092:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.slimCoreUwpStackFactory=t.slimCoreElectronStackFactory=t.SlimCoreElectronStack=void 0;var s=n(6773),c=n(5442),l=n(5045),u=n(3607),d=n(5212),p=n(8215),h=n(5773),g=n(2356),f=n(5437),m=n(1775),_=n(6753),y=n(4893),v=n(6769),S=n(7180),C=n(3385),E=n(605),T=n(8928),I=n(7584),P=n(5025),O=n(7358),b=function(e){function t(t,n){void 0===n&&(n=1);var r=e.call(this,t)||this;return r.callSupport=n,r}return i(t,e),t}(Error);var A=function(e){function t(n){var r,i=this,o=t._instanceCount++,a=new P.default(n.logger).createChild("CallingStack[".concat(o,"]"));if((i=e.call(this,a,s.assign(n.settings,{platform:h.PlatformType.Electron}),h.wrap(n.slimCoreInstance),new O.SlimCoreEventEmitter)||this).callRegistries=[],i._startSlimcorePromiseDefered=new c.Deferred,i._telemetryLoggers={},i._stackLoginPromise=new c.Deferred,i._mediaStartDeferredPromise=new c.Deferred,i._rtLogger=null,!SlimCore||!SlimCore.getVersion)throw new b("slimcore module is not available",1);if(R()<7)throw new b("slimcore module API version ".concat(R()," incompatible with required ").concat(7),2);n.settings.enableTsCallingULLogging&&(i._rtLogger=(0,p.initLogger)(i._slimcoreInstance,n.logger)),i._appHooks=n.appHooks,i._telemetryLoggers=function(e){var t,n,r;if(e.telemetryLoggers)r=e.telemetryLoggers;else if((null===(t=e.telemetryService)||void 0===t?void 0:t.getGenericTelemetryLogger)&&e.telemetryTenantTokens)s.forEach(Object.keys(e.telemetryTenantTokens),(function(t){return r[t]=e.telemetryService.getGenericTelemetryLogger(e.telemetryTenantTokens[t])}));else if(null===(n=e.telemetryService)||void 0===n?void 0:n.sendEvent){var i={sendEvent:function(t){e.telemetryService.sendEvent(t.eventName,t.props)}};r={media:i,rootTools:i,signaling:i}}return r}(n),null===(r=SlimCore.setJSLogger)||void 0===r||r.call(SlimCore,i._logger.createChild("SlimCorePIE")),i._setup=new E.default(i._slimcoreInstance),i._ecsProvider=new S.default(i._slimcoreInstance,i._logger.createChild("SlimCoreElectronEcsProvider")),i._callFeedback=new _.default(i._logger,i._slimcoreInstance),i._aiMdp=new f.default(i._logger,i._slimcoreInstance),i._stackLoginPromise.promise.then((function(){i._startSlimcorePromiseDefered.resolve()}));var l=h.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)?i._startSlimcorePromiseDefered.promise:i._stackLoginPromise.promise,u=h.hasFeature(SlimCore.Enums.Feature.LazyMediaInit)?l.then((function(){return i._mediaStartDeferredPromise.promise})):l;return i._deviceManager=new v.default(a,i._settings,i._slimcoreInstance,u,n.appHooks),i._screenSharingManager=new C.default(a,i._settings,i._slimcoreInstance,n.appHooks,i._deviceManager),i._registerDisposable(i._slimcoreInstance.handle("e911-info-changed",void 0,(function(e){i._onE911Info(e)}))),i._registerDisposable(i._slimcoreInstance.handle("object-property-changed",{objectType:SlimCore.Enums.ObjectType.CoreObj,propKey:SlimCore.Enums.Property.CoreObjNetworkInterfaces},(function(e){i._logger.createFnLogger("object-property-changed","networkInfo").info("NetworkInterfaces changed"),i._onNetworkInfoPropertyChange(e.value)}))),i._registerDisposable(i._slimcoreInstance.handle("probe-devices-status-changed",void 0,(function(e){i._onProbeDevicesStatusChanged(e)}))),i}return i(t,e),t.prototype.dispose=function(t){return o(this,void 0,void 0,(function(){var n,r,i,s=this;return a(this,(function(c){return(n=this._logger.createFnLogger("dispose",t)).info("dispose"),this._libStatus!==SlimCore.Enums.LibStatus.Running&&this._startSlimcorePromiseDefered.reject(new Error("CallingStack dispose called before slimcore reached Running state")),this._mediaStartDeferredPromise.reject(new Error("CallingStack dispose called before media was initialized")),r=function(){return o(s,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return this.callRegistries=[],n.info("call registries are disposed"),this._screenSharingManager.dispose(t),this._screenSharingManager=void 0,n.info("screensharing manager is disposed"),[4,this._deviceManager.dispose(t)];case 1:return r.sent(),this._deviceManager=void 0,n.info("device manager is disposed"),this._rtLogger&&(this._rtLogger.dispose(t),this._rtLogger=null),e.prototype.dispose.call(this,t),n.info("will dispose slimcore"),this._slimcoreInstance.dispose(),this._slimcoreInstance=void 0,n.info("slimcore instance is disposed"),[2]}}))}))},i=this.callRegistries.map((function(e){return e.dispose(t)})),[2,Promise.all(i).then(r,r)]}))}))},t.prototype.init=function(e,t){var n,r;return void 0===e&&(e={block:!0}),void 0===t&&(t=(0,I.generateCauseId)()),o(this,void 0,void 0,(function(){var i,o,s,c,l=this;return a(this,(function(a){switch(a.label){case 0:return(i=this._logger.createFnLogger("init",t)).info("init"),this._slimcoreInstance?(h.hasFeature(SlimCore.Enums.Feature.AsyncStart)||(e.block=!0),[4,Promise.all([this.getSetup().setNumber("*Lib/LazyMediaInit",h.hasFeature(SlimCore.Enums.Feature.LazyMediaInit)&&e.lazyMediaInit?1:0),this.getSetup().setString("*Lib/SCT/Telemetry/DiagnosticLevel",e.telemetryDiagnosticLevel||"")])]):[2,Promise.reject(new Error("slimcore instance is already disposed"))];case 1:return a.sent(),this._registerDisposable(this._slimcoreInstance.handle("media-status-changed",void 0,(function(e){l._onMediaStatusChanged(e)}))),this._registerDisposable(this._slimcoreInstance.handle("video-extensibility-ipc-changed-event",void 0,(function(e){l._onVideoExtensibilityIpcChangedEvent(e)}))),this._registerDisposable(this._slimcoreInstance.handle("video-capability-limits-changed",void 0,(function(e){l._onVideoCapabilityLimitsChanged(e)}))),this._registerDisposable(this._slimcoreInstance.handle("batched-object-property-changed",{},(function(e){l._onBatchedObjectPropertyChange(e)}))),e.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},(function(e){l._onLibStatusChanged(e)}))),e.allowPrivacySensitiveApis&&(i.info("setting slimcoreInstance allowPrivacySensitiveApis=".concat(e.allowPrivacySensitiveApis)),this.setAllowPrivacySensitiveApis(e.allowPrivacySensitiveApis)),i.info("starting slimcoreInstance block=".concat(e.block)),[4,this._slimcoreInstance.start(e.block)];case 2:return a.sent(),o=e.block?SlimCore.Enums.LibStatus.Running:this._slimcoreInstance.getLibStatus?this._slimcoreInstance.getLibStatus():void 0,i.info("after slimcoreInstance.start, libStatus=".concat(o)),o===SlimCore.Enums.LibStatus.Running&&this._onLibStatusChanged({libStatus:o}),void 0!==(s=this._slimcoreInstance.getMediaStatus?this._slimcoreInstance.getMediaStatus():void 0)&&s!==SlimCore.Enums.MediaStatus.NotAvailable&&this._onMediaStatusChanged({mediaStatus:s}),c=null===(r=(n=this._slimcoreInstance).getVideoCapabilityLimits)||void 0===r?void 0:r.call(n),i.info("getVideoCapabilityLimits=".concat(c)),c&&this._onVideoCapabilityLimitsChanged({videoCapabilityLimits:c}),[2,this._startSlimcorePromiseDefered.promise]}}))}))},t.prototype.getCallRegistry=function(){return this._logger.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this._createCallRegistry()},t.prototype.createCallRegistry=function(e,t){var n=this;void 0===t&&(t=(0,I.generateCauseId)());var r=u.mriOrId(e.id),i=this._logger.createFnLogger("createCallRegistry[identity=".concat(r,"]"),t),s=this.callRegistries.find((function(t){return t.identity===e.id}));return s&&!s.isDisposing?(i.info("callRegistry already exists for ".concat(u.mriOrId(e.id))),Promise.resolve(s)):this._startSlimcorePromiseDefered.promise.then((function(){return o(n,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return s&&s.isDisposing?[4,s.disposePromise]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2,this._createCallRegistry(e)]}}))}))}))},t.prototype.cancelOperation=function(e){this._slimcoreInstance.cancelOperation(e)},t.prototype.getDeviceManager=function(){return this._deviceManager},t.prototype.createDeviceManager=function(e){return this._deviceManager},t.prototype.getScreenSharingManager=function(){return this._screenSharingManager},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return this._ecsProvider},t.prototype.getCallFeedback=function(){return this._callFeedback},t.prototype.getAiMdp=function(){return this._aiMdp},t.prototype.fireIntent=function(e,t){if(this._slimcoreInstance){var n=function(e){switch(e){case 0:return SlimCore.Enums.Intent.CallPush;case 1:return SlimCore.Enums.Intent.CallUser;case 2:return SlimCore.Enums.Intent.CallPreheat;case 3:return SlimCore.Enums.Intent.MediaInit;default:return}}(e);n&&this._slimcoreInstance.fireIntent(n,t)}},t.prototype.getVersion=function(){return{build:(0,d.getTsCallingVersion)(),ovb:(0,d.getOvb)()}},t.prototype.getMediaStatus=function(){return this._slimcoreMediaStatusToCallingMediaStatus(this._slimcoreInstance.getMediaStatus())},t.prototype.getVideoCapabilityLimits=function(){var e,t;return null===(t=(e=this._slimcoreInstance).getVideoCapabilityLimits)||void 0===t?void 0:t.call(e)},t.prototype.setMediaConfig=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return this._logger.info("Set Media Configuration"),this._slimcoreInstance.setMediaConfig(e),[2]}))}))},t.prototype.getE911Info=function(){var e=this;return this._slimcoreInstance?this._slimcoreInstance.getE911Info?this._startSlimcorePromiseDefered.promise.then((function(){var t=e._slimcoreInstance.getE911Info();try{return JSON.parse(t)}catch(e){return Promise.reject(new Error("failed to parse e911Info ".concat(e)))}})):Promise.reject(new Error("getE911Info is not available")):Promise.reject(new Error("slimcore instance is already disposed"))},t.prototype.getLocationInfo=function(){var e=this;return this._slimcoreInstance?this._slimcoreInstance.getLocationInfo?this._startSlimcorePromiseDefered.promise.then((function(){var t=e._slimcoreInstance.getLocationInfo();try{return JSON.parse(t)}catch(e){return Promise.reject(new Error("failed to parse LocationInfo ".concat(e)))}})):Promise.reject(new Error("getLocationInfo is not available")):Promise.reject(new Error("slimcore instance is already disposed"))},t.prototype.setAllowPrivacySensitiveApis=function(e){this._slimcoreInstance&&this._slimcoreInstance.setAllowPrivacySensitiveApis&&this._slimcoreInstance.setAllowPrivacySensitiveApis(e)},t.prototype.getGeolocationCapabilityState=function(){return o(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=function(e){switch(e){case SlimCore.Enums.AppCapabilityStatus.Allowed:return 5;case SlimCore.Enums.AppCapabilityStatus.DeniedBySystem:return 2;case SlimCore.Enums.AppCapabilityStatus.DeniedByUser:return 3;case SlimCore.Enums.AppCapabilityStatus.NotDeclaredByApp:return 1;case SlimCore.Enums.AppCapabilityStatus.UserPromptRequired:return 4;case SlimCore.Enums.AppCapabilityStatus.Unknown:default:return 0}},[4,this._slimcoreInstance.getGeolocationCapabilityState()];case 1:return[2,e.apply(void 0,[n.sent()])];case 2:return t=n.sent(),this._logger.error("Unable to get geolocaltion capabilites due to error: ".concat(t,", return unknown")),[2,Promise.resolve(0)];case 3:return[2]}}))}))},t.prototype.getLiveStreamClient=function(e){var t=this;return new l.LiveStreamClient(this._ecsProvider.getEcsConfiguration(e),this._logger.createChild("LiveStreamClient"),(function(){return t._telemetryLoggers.media}))},t.prototype.createVoipCallCoordinator=function(){var e=new T.default(this._slimcoreInstance,this._logger,this._settings);return this._registerDisposable(e),e},t.prototype.setLogFileName=function(e,t,n){return o(this,void 0,void 0,(function(){return a(this,(function(r){return this._slimcoreInstance.setLogFileName?(n&&!this._rtLogger&&(this._rtLogger=(0,p.initLogger)(this._slimcoreInstance,(0,p.createLogger)(n))),[2,this._slimcoreInstance.setLogFileName(null!=e?e:"",null!=t?t:"")]):[2]}))}))},t.prototype.aggregateDiagnosticLogs=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return this._logger.info("aggregateDiagnosticLogs targetFolderName=".concat(e)),[2,this._slimcoreInstance.aggregateDiagnosticLogs(e)]}))}))},t.prototype.extendBrbFeedback=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){return this._logger.info("extendBrbFeedback uploadId=".concat(e," feedbackSettings={baseUrl=").concat(t.baseUrl,",title=").concat(t.title,",clientId=").concat(t.clientId,",clientVersion=").concat(t.clientVersion,",ring=").concat(t.ring,",")),[2,this._slimcoreInstance.extendBrbFeedback(e,t)]}))}))},t.prototype.addOcclusion=function(e,t,n,r,i,s){return o(this,void 0,void 0,(function(){return a(this,(function(o){return[2,SlimCore.vdi.addOcclusion(e,t,n,r,i,s)]}))}))},t.prototype.removeOcclusion=function(e,t,n,r){return o(this,void 0,void 0,(function(){return a(this,(function(i){return[2,SlimCore.vdi.removeOcclusion(e,t,n,r)]}))}))},t.prototype.getDebugDump=function(){},t.prototype.flushLogs=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this._logger.info("flushLogs"),[4,this._startSlimcorePromiseDefered.promise];case 1:return e.sent(),[2,this._slimcoreInstance.flushLogs()]}}))}))},t.prototype.getStageCapability=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this._startSlimcorePromiseDefered.promise];case 1:return e.sent(),[2,this._slimcoreInstance.getStageCapability()]}}))}))},t.prototype.getAiCameraCapability=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this._startSlimcorePromiseDefered.promise];case 1:return e.sent(),[2,this._slimcoreInstance.getAiCameraCapability()]}}))}))},t.prototype.createAiCameraManager=function(){return new g.default(this._slimcoreInstance)},t.prototype._onBatchedObjectPropertyChange=function(e){this._logger.createFnLogger("_onBatchedObjectPropertyChange",e.causeId.substring(0,8)).info("invoked");for(var t=0,n=e.properties;t<n.length;t++){var r=n[t];this._eventBus.emit("object-property-changed",r)}},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from ".concat(this._libStatus," => ").concat(e.libStatus)),e.libStatus===SlimCore.Enums.LibStatus.Running&&this._startSlimcorePromiseDefered.resolve(),this._libStatus=e.libStatus},t.prototype._createCallRegistry=function(e){var t=this,n=e&&this._slimcoreInstance.registerUser&&this._slimcoreInstance.unregisterUser,r=!1,i=function(){r&&(r=!1,t._slimcoreInstance.unregisterUser(e.id).catch((function(e){t._logger.error("unregisterUser failed, error: ".concat(e))})))};try{n&&(t._slimcoreInstance.registerUser(e.id).catch((function(e){t._logger.error("registerUser failed, error: ".concat(e))})),r=!0);var o=new y.default(this._logger,this._settings,this._slimcoreInstance,this._deviceManager,this._appHooks,this._telemetryLoggers,e,this._setup,this._eventBus);return o.on("disposed",(function(){t.callRegistries.splice(t.callRegistries.indexOf(o),1),i()})),o.loginPromise.then(this._stackLoginPromise.resolve,this._stackLoginPromise.reject),this.callRegistries.push(o),o}catch(e){throw i(),e}},t.prototype._slimcoreMediaStatusToCallingMediaStatus=function(e){switch(e){case SlimCore.Enums.MediaStatus.Initialized:return 1;case SlimCore.Enums.MediaStatus.NotAvailable:return 0;case SlimCore.Enums.MediaStatus.Failed:return 2;case SlimCore.Enums.MediaStatus.Uninitialized:return 3;default:return}},t.prototype._onE911Info=function(e){var t,n;try{t=JSON.parse(e.info)}catch(e){return void this._logger.error("failed to parse e911Info: ".concat(e))}try{n=JSON.parse(e.areaContent)}catch(t){this._logger.error("failed to parse areaContent from areaContent: ".concat(t));try{var r=e;n=JSON.parse(r.location)}catch(e){this._logger.error("failed to parse areaContent from location: ".concat(e)),n={}}}this._logger.info("emitting e911InfoChanged: has_bssid=".concat(t&&t.bssid?1:0," has_bssidv6=").concat(t&&t.bssidv6?1:0," has_ipv4=").concat(t&&t.ipv4?1:0," ")+"has_ipv6=".concat(t&&t.ipv6?1:0," has_mac=").concat(t&&t.mac?1:0," has_macv6=").concat(t&&t.macv6?1:0," ")+"subnetLengthIpv4=".concat(t&&t.subnetLengthIpv4," subnetLengthIpv6=").concat(t&&t.subnetLengthIpv6," e911_array_size=").concat(t&&t.e911?t.e911.length:0," ")+"has_geoCoordinates=".concat(n&&n.geoCoordinates?1:0)),this.event("e911InfoChanged").raise(t,n)},t.prototype._onMediaStatusChanged=function(e){var t=this._slimcoreMediaStatusToCallingMediaStatus(e.mediaStatus);this.event("mediaStatusChanged").raise(t),1===t?this._mediaStartDeferredPromise.resolve():2===t&&this._mediaStartDeferredPromise.reject(new Error("Media initialization FatalError"))},t.prototype._onNetworkInfoPropertyChange=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this._logger.error("_onNetworkInfoPropertyChange: failed to parse networkInfo: ".concat(e))}this._logger.info("_onNetworkInfoPropertyChange: emitting networkInfoChanged: interfaces=".concat(t.length)),this.event("networkInfoChanged").raise(t)},t.prototype._onVideoExtensibilityIpcChangedEvent=function(e){this.event("videoExtensibilityIpcChangedEvent").raise(e)},t.prototype._onVideoCapabilityLimitsChanged=function(e){this._logger.info("_onVideoCapabilityLimitsChanged - ".concat(e)),this.event("videoCapabilityLimitsChanged").raise(e.videoCapabilityLimits)},t.prototype._onProbeDevicesStatusChanged=function(e){this.event("probeDevicesStatusChanged").raise(e.ready)},t._instanceCount=0,t}(m.default);function R(){return SlimCore.getApiVersion&&SlimCore.getApiVersion()}t.SlimCoreElectronStack=A,t.slimCoreElectronStackFactory={build:function(e){return Promise.resolve().then((function(){return e.settings.enableTsCallingULLogging&&(e.logger=(0,p.createLogger)(e.logger)),new A(e)})).catch((function(e){throw e instanceof b?e:new b("".concat(e))}))},getVersion:function(){return{build:(0,d.getTsCallingVersion)(),ovb:(0,d.getOvb)()}}},t.slimCoreUwpStackFactory={build:function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){throw new Error("UwpStack deprecated")}))}))},getVersion:function(){throw new Error("UwpStack deprecated")}}},6894:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,n,r,i,a,s){var c,p=e.call(this)||this;return p._call=t,p._slimcoreInstance=r,p._callObjectId=i,p._accountIdentity=a,p._stageConfig=s,p._logger=n.createChild("Stage"),p._slimcoreStage=p._slimcoreInstance.createStage(p._callObjectId,p._accountIdentity,(c=p._stageConfig,o(o({},c),{context:g(c.context),layoutConfiguration:o(o({},c.layoutConfiguration),{groupsConfiguration:c.layoutConfiguration.groupsConfiguration.map((function(e){return o(o({},e),{group:h(e.group),renderingOptionsOverride:e.renderingOptionsOverride&&o(o({},e.renderingOptionsOverride),{videoCompositorType:f(e.renderingOptionsOverride.videoCompositorType),layoutAlgorithm:m(e.renderingOptionsOverride.layoutAlgorithm)})})}))}),renderingOptions:o(o({},c.renderingOptions),{videoCompositorType:f(c.renderingOptions.videoCompositorType),layoutAlgorithm:m(c.renderingOptions.layoutAlgorithm)}),telemetrySessionId:c.telemetrySessionId}))),p.stageController=new l(p._call,p._logger,p._slimcoreStage),p.videoController=new u(p._logger,p._slimcoreStage),p._slimcoreStage.on("metadata-changed",(function(e){p._logger.log("metadata-changed",e),p.event("metadataChanged").raise(d(e.metadata))})),p._slimcoreStage.on("failed",(function(e){p._logger.log("failed",e),p.event("failed").raise(e.errorCode)})),p}return i(t,e),t.prototype.update=function(e){return this._logger.log("update",e),this._slimcoreStage.update(o(o({},t=e),{groupsConfiguration:t.groupsConfiguration.map((function(e){return o(o({},e),{group:h(e.group),renderingOptionsOverride:e.renderingOptionsOverride&&o(o({},e.renderingOptionsOverride),{videoCompositorType:f(e.renderingOptionsOverride.videoCompositorType),layoutAlgorithm:m(e.renderingOptionsOverride.layoutAlgorithm)})})}))}));var t},t.prototype.getMetadata=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._logger.log("getMetadata"),[4,this._slimcoreStage.getMetadata()];case 1:return[2,d(e.sent())]}}))}))},t.prototype.dispose=function(){this._logger.log("dispose"),this._slimcoreStage.dispose()},t}(n(6144).default);t.default=c;var l=function(){function e(e,t,n){this.call=e,this._logger=t.createChild("StageController"),this._stage=n}return e.prototype.pin=function(e){var t=this._getParticipantObjectId(e);return this._logger.log("pin mri: ".concat(e," objectId: ").concat(t)),this._stage.stageController.pin(t)},e.prototype.spotlight=function(e){var t=this._getParticipantObjectId(e);return this._logger.log("spotlight mri: ".concat(e," objectId: ").concat(t)),this._stage.stageController.spotlight(t)},e.prototype.changePage=function(e,t){return this._logger.log("changePage",e,t),this._stage.stageController.changePage(h(e),t)},e.prototype.toggleIncomingVideo=function(e){return this._stage.stageController.toggleIncomingVideo(e)},e.prototype._getParticipantObjectId=function(e){var t=this.call.participantMap[e];if(!(null==t?void 0:t.slimcoreObjectId))throw new Error("Participant ".concat(e," does not exist in call/has no slimcoreObjectId"));return t.slimcoreObjectId},e}(),u=function(){function e(e,t){this._logger=e.createChild("VideoController"),this._stage=t}return e.prototype.update=function(e,t){return this._logger.log("update",e,t),this._stage.videoController.update(e,t.map((function(e){return o(o({},e),{group:h(e.group),descriptor:o(o({},e.descriptor),{assets:e.descriptor.assets.map((function(e){return o(o({},e),{textMode:_(e.textMode),fontStyle:y(e.fontStyle)})}))})})})))},e.prototype.setFocusView=function(e,t){return this._logger.log("setFocusView",e,t),this._stage.videoController.setFocusView(e,t)},e.prototype.setScalingMode=function(e,t){return this._logger.log("setScalingMode",e,t),this._stage.videoController.setScalingMode(e,function(e){switch(e){case 1:return SlimCore.Enums.StageScalingMode.Crop;case 0:return SlimCore.Enums.StageScalingMode.Fit;default:return SlimCore.Enums.StageScalingMode.Default}}(t))},e.prototype.zoom=function(e,t,n,r){return this._logger.log("zoom",e,t,n,r),this._stage.videoController.zoom(e,t,n,r)},e.prototype.setIgnoreMirroring=function(e,t){return this._logger.log("setIgnoreMirroring",e,t),this._stage.videoController.setIgnoreMirroring(e,t)},e.prototype.captureFrame=function(e){return this._logger.log("captureFrame",e),this._stage.videoController.captureFrame(e)},e}();function d(e){return o(o({},e),{groups:(null==e?void 0:e.groups)&&e.groups.map((function(e){return o(o({},e),{position:p(e.position)})}))})}function p(e){switch(e){case SlimCore.Enums.GroupPosition.Unknown:return 0;case SlimCore.Enums.GroupPosition.VideoStage:return 1;case SlimCore.Enums.GroupPosition.AudioStage:return 2;case SlimCore.Enums.GroupPosition.ScreenShare:return 3;case SlimCore.Enums.GroupPosition.PPT:return 4;default:throw new Error("Invalid GroupPosition: ".concat(e))}}function h(e){switch(e){case 0:return SlimCore.Enums.GroupPosition.Unknown;case 1:return SlimCore.Enums.GroupPosition.VideoStage;case 2:return SlimCore.Enums.GroupPosition.AudioStage;case 3:return SlimCore.Enums.GroupPosition.ScreenShare;case 4:return SlimCore.Enums.GroupPosition.PPT;default:throw new Error("Invalid GroupPosition: ".concat(e))}}function g(e){switch(e){case 1:return SlimCore.Enums.StageContext.CallingScreen;case 2:return SlimCore.Enums.StageContext.Popout;case 3:return SlimCore.Enums.StageContext.CallingMonitor;case 4:return SlimCore.Enums.StageContext.AttendeeView;case 5:return SlimCore.Enums.StageContext.HeroGallery;case 6:return SlimCore.Enums.StageContext.MainGallery;default:return SlimCore.Enums.StageContext.Unknown}}function f(e){switch(e){case 0:return SlimCore.Enums.CompositorType.Native;case 1:return SlimCore.Enums.CompositorType.DOM;case 2:return SlimCore.Enums.CompositorType.TextureStream;case 3:return SlimCore.Enums.CompositorType.NoCompositor;default:throw new Error("Invalid CompositorType: ".concat(e))}}function m(e){switch(e){case 0:return SlimCore.Enums.LayoutAlgorithm.Client;case 1:return SlimCore.Enums.LayoutAlgorithm.FixedGrid;case 2:return SlimCore.Enums.LayoutAlgorithm.DynamicGrid;default:throw new Error("Invalid LayoutAlgorithm: ".concat(e))}}function _(e){switch(e){case 0:return SlimCore.Enums.WatermarkTextMode.Tiled;case 1:return SlimCore.Enums.WatermarkTextMode.Grid;case 2:return SlimCore.Enums.WatermarkTextMode.TopLeft;case 3:return SlimCore.Enums.WatermarkTextMode.TopRight;case 4:return SlimCore.Enums.WatermarkTextMode.BottomLeft;case 5:return SlimCore.Enums.WatermarkTextMode.BottomRight;case 6:return SlimCore.Enums.WatermarkTextMode.Center;default:return}}function y(e){switch(e){case 0:return SlimCore.Enums.FontStyle.Regular;case 1:return SlimCore.Enums.FontStyle.Bold;case 2:return SlimCore.Enums.FontStyle.Italic;case 3:return SlimCore.Enums.FontStyle.BoldItalic;case 4:return SlimCore.Enums.FontStyle.Underline;case 5:return SlimCore.Enums.FontStyle.Strikeout;default:return}}},8596:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.OneDsTelemetryLogger=t.TelemetryManager=void 0;var i=n(4204),o=n(3224),a=n(3685),s=function(){function e(e){this._logger=e,this._defaultCollectorUrlTs="https://ic3.events.data.microsoft.com/OneCollector/1.0/",this._defaultEventsLimitInMem=200,this._defaultLogDiscardedEvents=!1,this._defaultLogSentEvents=!1,this._telemetryLoggerConfig=this._createLoggerConfig(),this._preConfigEvents=[]}return e.prototype.initialize=function(e,t){var n=this;this._ecs=e,this._collectorUrlOverride=t,this._updateLoggerConfig(),this._logger.info("Will init JS Telemetry client with url: ".concat(this._telemetryLoggerConfig.endpointUrl)),this._slimcoreEventsLogger=this._createTelemetryLogger("SlimCoreEventsTelemetry",this._telemetryLoggerConfig),this._preConfigEvents.forEach((function(e){n._sendEvent(e)})),this._preConfigEvents=void 0},e.prototype.dispatch=function(e){var t,n=this;this._preConfigEvents?(t=this._preConfigEvents).push.apply(t,e):e.forEach((function(e){n._sendEvent(e)}))},e.prototype.pauseLogger=function(){this._slimcoreEventsLogger.pause()},e.prototype.resumeLogger=function(){this._slimcoreEventsLogger.resume()},e.prototype._sendEvent=function(e){try{var t=JSON.parse(e);this._slimcoreEventsLogger.sendEvent(this._createOneDsEvent(t),t.tenantToken)}catch(e){this._logger.info("sendEvent failed with error:".concat(e.message))}},e.prototype._createTelemetryLogger=function(e,t){return new c(this._logger.createChild(e),t)},e.prototype._createOneDsEvent=function(e){var t={};return this._constructEventProperty(e,t),{name:e.EventType,data:t,latency:this._eventPriorityToLatency(e.eventPriority),time:e.TimestampISO8601,persistence:i.EventPersistence.Normal}},e.prototype._updateLoggerConfig=function(){if(this._telemetryLoggerConfig.channelConfiguration.eventsLimitInMem=this._ecs.getNumber("SCT","EventsLimitInMem",this._defaultEventsLimitInMem),this._telemetryLoggerConfig.logDiscardedEvents=this._ecs.getBoolean("SCT","LogDiscardedEvents",this._defaultLogDiscardedEvents),this._telemetryLoggerConfig.logSentEvents=this._ecs.getBoolean("SCT","LogSentEvents",this._defaultLogSentEvents),this._collectorUrlOverride?this._telemetryLoggerConfig.endpointUrl=this._collectorUrlOverride:this._telemetryLoggerConfig.endpointUrl=this._ecs.getString("SCT","CollectorUrlTs",this._defaultCollectorUrlTs),this._ecs.getBoolean("SCT","EnableLocalStorage",!1)){var e=new o.LocalStorageChannel;this._telemetryLoggerConfig.channels=[[e]]}},e.prototype._createLoggerConfig=function(){return{extensions:[],extensionConfig:{localStorage:{storageKey:"TsCalling_Electron"}},channelConfiguration:{eventsLimitInMem:this._defaultEventsLimitInMem},endpointUrl:this._defaultCollectorUrlTs,logDiscardedEvents:this._defaultLogDiscardedEvents,logSentEvents:this._defaultLogSentEvents}},e.prototype._constructEventProperty=function(e,t){for(var n=r(r({},e.Extensions),e.PIIExtensions),o=0,a=Object.keys(n);o<a.length;o++){var s=a[o],c=n[s],l={value:c.RawContent?c.RawContent:c,kind:c.Kind?this._eventPIIKindToOneDsPII(c.Kind):i.ValueKind.NotSet};t[s]=l}},e.prototype._eventPriorityToLatency=function(e){switch(e){case"Immediate":case"RealTime":return a.EventLatency.Immediate;case"High":return a.EventLatency.RealTime;case"Unspecified":case"Off":case"Low":default:return a.EventLatency.CostDeferred;case"Normal":return a.EventLatency.Normal}},e.prototype._eventPIIKindToOneDsPII=function(e){switch(e){case"NotSet":default:return i.ValueKind.NotSet;case"DistinguishedName":return i.ValueKind.Pii_DistinguishedName;case"Fqdn":return i.ValueKind.Pii_Fqdn;case"GenericData":return i.ValueKind.Pii_GenericData;case"Identity":return i.ValueKind.Pii_Identity;case"IPV4Address":return i.ValueKind.Pii_IPV4Address;case"IPV4AddressLegacy":return i.ValueKind.Pii_IPV4AddressLegacy;case"IPV6Address":return i.ValueKind.Pii_IPv6Address;case"MailSubject":return i.ValueKind.Pii_MailSubject;case"PhoneNumber":return i.ValueKind.Pii_PhoneNumber;case"QueryString":return i.ValueKind.Pii_QueryString;case"SipAddress":return i.ValueKind.Pii_SipAddress;case"SmtpAddress":return i.ValueKind.Pii_SmtpAddress;case"Uri":return i.ValueKind.Pii_Uri}},e}();t.TelemetryManager=s;var c=function(){function e(e,t){var n,r=this;this._logger=e,this._loggerConfiguration=t,this.manager=new a.ApplicationInsightsManager,this._callStateCounter=0,this._throttledProfile=((n={}).throttled=[-1,-1],n),this.manager.create(this._loggerConfiguration,[]);var i=this.manager.getPostChannel();i._notificationManager.addNotificationListener({eventsDiscarded:function(e,t){r._logDiscardedEvents(e,t)},eventsSent:function(e){r._logSentEvents(e)}}),this.manager.getPostChannel()._loadTransmitProfiles(this._throttledProfile),i._setTransmitProfile(a.RT_PROFILE)}return e.prototype.flush=function(){this.manager.getPostChannel().flush()},e.prototype.pause=function(){this._logger.info("Telemetry pause called, callStateCounter:".concat(this._callStateCounter)),1==++this._callStateCounter&&(this.manager.getPostChannel()._setTransmitProfile("throttled"),this._logger.info("Telemetry events sending paused"))},e.prototype.resume=function(){this._logger.info("Telemetry resume called, callStateCounter:".concat(this._callStateCounter)),0==--this._callStateCounter&&(this.manager.getPostChannel()._setTransmitProfile(a.RT_PROFILE),this._logger.info("Telemetry events sending resumed"))},e.prototype.sendEvent=function(e,t){this._getLogger(t).track(e)},e.prototype._getLogger=function(e){return this.manager.getInst(e)||this.manager.newInst(e)},e.prototype._logDiscardedEvents=function(e,t){this._loggerConfiguration.logDiscardedEvents&&this._logger.info("discarded events:".concat(e.map((function(e){return e.name})).join(";")," reason:").concat(t))},e.prototype._logSentEvents=function(e){this._loggerConfiguration.logSentEvents&&this._logger.info("sent events:".concat(e.map((function(e){return e.name})).join(";")))},e}();t.OneDsTelemetryLogger=c},8967:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){void 0===n&&(n=e.createChild((function(){return"TxNdiNotifier"}))),this._slimcoreInstance=t,this._logger=n,this._videoObjectId=0,this._isNdiNotificationSupported=this._slimcoreInstance.notifyNdiVideoStarted&&this._slimcoreInstance.notifyNdiVideoStopped}return e.prototype.notifyNdiVideoStarted=function(e,t,n){if(this.notifyNdiVideoStopped(e),this._isNdiNotificationSupported&&t)try{this._slimcoreInstance.notifyNdiVideoStarted(t,n),this._videoObjectId=t}catch(n){this._logger.warn("notifyNdiVideoStarted for video object ".concat(t," causeId: ").concat(e," failed with error: ").concat(n))}},e.prototype.notifyNdiVideoStopped=function(e){if(this._isNdiNotificationSupported&&this._videoObjectId)try{this._slimcoreInstance.notifyNdiVideoStopped(this._videoObjectId)}catch(t){this._logger.warn("notifyNdiVideoStopped for video object ".concat(this._videoObjectId," causeId: ").concat(e," failed with error: ").concat(t))}finally{this._videoObjectId=0}},e}();t.default=n},1153:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(6773),l=n(5442),u=n(7584),d=n(6144),p=n(5773),h=n(1775),g=n(3024),f=n(8967),m=0,_=0,y=function(e){function t(t,n,r,i){void 0===i&&(i=t.createChild((function(){return"View[".concat(o.id,":").concat(o._frameSinkId,"]")})));var o=e.call(this,i)||this;return o._frameSinkId=n,o._frameSink=r,o._logger=i,o.id=m++,o.currentSubscription=null,o._bindingRenderer=null,o._activationContext={},o._logger.info("constructor"),o}return i(t,e),t.logThis=function(e){return"".concat(e.id,":").concat(e._frameSinkId)},t.heartBeatLogTemplate=function(){return"vid:fsid:frmcnt"},t.logThisForHeartbeat=function(e){return"".concat(e.id,":").concat(e._frameSinkId,":").concat(function(e){try{return e.getStats().framesTotal}catch(e){return-1}}(e._frameSink))},t.prototype.attach=function(e,t,n,r){this._logger.info("attach causeId: ".concat(e," add frame sink to stream: ").concat(E(r))),this._bindingRenderer&&this.detach(e,this._bindingRenderer),this._activationContext=n,this._bindingRenderer=t;try{t.addFrameSink(this._frameSink)}catch(t){this._logger.error("attach causeId: ".concat(e," add frame sink failed. error: ").concat(t))}},t.prototype.detach=function(e,t){if(this._bindingRenderer===t){this._logger.info("detach causeId: ".concat(e," remove frame sink")),this._bindingRenderer=null;try{p.isDisposed(this._frameSink)?this._logger.warn("detach causeId: ".concat(e," remove frame sink - skip, sink already disposed")):t.removeFrameSink(this._frameSink)}catch(t){this._logger.error("detach causeId: ".concat(e," remove frame sink failed. error: ").concat(t))}this._activationContext={},null!==this.currentSubscription&&(this._logger.info("detach causeId: ".concat(e," ").concat(E(this.currentSubscription)," -> ").concat(E(null))),this.currentSubscription=null,this.event("subscriptionChanged").raise(this.currentSubscription),this.raiseChanged())}},t.prototype.changeVirtualParticipant=function(e){this.dynamicVirtualParticipantId!==e&&(this._logger.info("changeVirtualParticipant participant mri: ".concat(this.dynamicVirtualParticipantId," -> ").concat(e)),this.dynamicVirtualParticipantId=e,this.raiseChanged())},t.prototype.changeSubscription=function(e,t,n){this.currentSubscription!==n&&this._activationContext===t&&(this._logger.info("changeSubscription causeId: ".concat(e," ").concat(E(this.currentSubscription)," -> ").concat(E(n))),this.currentSubscription=n,this.event("subscriptionChanged").raise(this.currentSubscription),this.raiseChanged())},t}(d.default),v=function(){function e(e,t,n,r,i,o,a,s){void 0===s&&(s=t.createChild((function(){return"Receiver[".concat(c.id,":").concat(c.type,"][").concat(c._streamId,":").concat(c._streamMsi,":#").concat(c._views.length,"][").concat(c._subscribedStreamId,":").concat(c._receiverStatus,"]")})));var c=this;this._settings=n,this._slimcoreInstance=r,this._participantIdMapperFactory=o,this.type=a,this._logger=s,this.id=_++,this._isDisposed=!1,this._areResourcesDisposed=!1,this._deferredRunning=null,this._isRunning=!1,this._subscribeStartTime=0,this._subscribeEndTime=0,this._waitForRunningTimerId=0,this._isSubscriptionTimedOut=!1,this._currentStream=null,this._pendingStream=null,this._views=[],this._videoReceiverSubscriptions=[],this._deferredReady=new l.Deferred,this._isReady=!1,this._deferredAbandoned=new l.Deferred,this._receiverStatus=SlimCore.Enums.VideoReceiverStatus.Stopped,this._subscribedStreamId=0,this._txNdiNotifier=new f.default(this._logger,this._slimcoreInstance),this._dynamicVirtualParticipantMsi=g.SOURCE_NONE,this._createResources(e,i)}return Object.defineProperty(e.prototype,"_streamId",{get:function(){var e;return(null===(e=this._currentStream)||void 0===e?void 0:e.stream.id)||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_streamMsi",{get:function(){var e;return(null===(e=this._currentStream)||void 0===e?void 0:e.stream.mediaSourceId)||0},enumerable:!1,configurable:!0}),e.logThis=function(e){return"".concat(e.id,":").concat(e._streamId,":").concat(e._streamMsi,":").concat(e._isRunning)},e.heartBeatLogTemplate=function(){return"rid:sid:msi:rdy?:run?:status:timing [".concat(y.heartBeatLogTemplate(),"]")},e.logThisForHeartbeat=function(e){var t="";if(0!==e._streamId){var n=Date.now(),r=(e._subscribeEndTime-e._subscribeStartTime)/1e3,i=(n-e._subscribeStartTime)/1e3;t=r>0?"".concat(r.toFixed(3),"+").concat((i-r).toFixed(),"s"):"+".concat(i.toFixed(1),"s")}var o="".concat(e.id,":").concat(e._streamId,":").concat(e._streamMsi,":").concat(e._isReady,":").concat(e._isRunning,":").concat(e._receiverStatus,":").concat(t),a="[".concat(c.map(e._views,y.logThisForHeartbeat).join(" "),"]");return"".concat(o," ").concat(a)},e.prototype.dispose=function(e){return a(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:if(!this._isDisposed){this._isDisposed=!0,this._logger.info("dispose causeId: ".concat(e));try{this._mapper&&this._mapper.dispose(),this.suspend(e,!0),this._receiver.abandon&&this._receiver.abandon(),this._receiver.releaseBinding&&(this._logger.info("dispose causeId: ".concat(e," release binding")),this._receiver.releaseBinding(this._bindingRenderer).catch((function(n){t._logger.warn("dispose causeId: ".concat(e," releaseBinding error: ").concat(n))}))),this._receiver.abandon||this._disposeResources(e,this._receiver,this._videoReceiverSubscriptions,this._bindingRenderer,new Error("dispose causeId: ".concat(e," error: receiver disposed")))}catch(t){this._logger.error("dispose causeId: ".concat(e," error: ").concat(t))}}return this._logger.info("dispose causeId: ".concat(e," synchronize")),[4,this._deferredAbandoned.promise];case 1:return n.sent(),this._logger.info("dispose causeId: ".concat(e," done")),[2]}}))}))},e.prototype.subscribeStream=function(e,t,n,r,i,o){return a(this,void 0,void 0,(function(){var a,l,u,d,p,h,g,f,m,_,v,S,C,T,I,P,O,b=this;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),a=Date.now(),l=n.stream,this._pendingStream=n,this._streamConfig=o,u=a,this._isReady?[3,2]:(this._logger.info("subscribeStream causeId: ".concat(e," new stream: ").concat(E(l),"#").concat(r.length," config: ").concat(JSON.stringify(o))),t(),[4,this._deferredReady.promise]);case 1:s.sent(),u=Date.now(),s.label=2;case 2:if(this._pendingStream!==n)throw d=!this._pendingStream,p="receiver being ".concat(d?"suspended":"resubscribed (immediate)"),this._logger.warn("subscribeStream causeId: ".concat(e," rejecting: ").concat(p)),new Error("subscribeStream causeId: ".concat(e," error: ").concat(p));return h=this._currentStream,g=this._isSubscriptionTimedOut,f=h!==n,m=c.difference(this._views,r),_=c.difference(r,this._views),v={},(S=g||f||m.length>0||_.length>0)&&(C="stream".concat(f?" changed":g?" retried":"",": ").concat(E(null==h?void 0:h.stream)," -> ").concat(E(l),"#").concat(r.length),T=function(e){return c.map(e,y.logThis).join(" ")},I="=[".concat(T(c.intersection(this._views,r)),"] -[").concat(T(m),"] +[").concat(T(_),"]"),this._logger.info("subscribeStream causeId: ".concat(e," executing ").concat(C," views (").concat(I,")")),m.forEach((function(t){t.detach(e,b._bindingRenderer)})),this._views=c.difference(this._views,m),(f||g)&&(f&&h&&!this._isRunning&&(this._logger.warn("subscribeStream causeId: ".concat(e," rejecting: receiver being resubscribed")),this._deferredRunning.reject(new Error("subscribeStream causeId: ".concat(e," error: receiver being resubscribed")))),this._subscribeReceiver(e,n,i)),_.forEach((function(t){t.attach(e,b._bindingRenderer,v,l)})),this._views=r),this._isRunning?[3,4]:(t(),[4,this._deferredRunning.promise]);case 3:s.sent(),s.label=4;case 4:return S&&(_.forEach((function(t){t.changeSubscription(e,v,l)})),_.forEach((function(e){e.changeVirtualParticipant(b._dynamicVirtualParticipantId)})),f&&l.changeVirtualParticipant(this._dynamicVirtualParticipantId),P=u-a,O=Date.now()-a,this._logger.info("subscribeStream causeId: ".concat(e," duration: ").concat(P,"+").concat(O-P,"ms done"))),[3,6];case 5:return t(),[7];case 6:return[2]}}))}))},e.prototype.suspend=function(e,t){var n=this;void 0===t&&(t=!1),this._pendingStream=null,this._currentStream&&(this._logger.info("suspend causeId: ".concat(e," isDisposing: ").concat(t," current stream: ").concat(E(this._currentStream.stream))),this._cancelWaitForRunningTimer(),this._deferredRunning.reject(new Error("suspend causeId: ".concat(e," error: receiver being ").concat(t?"disposed":"unsubscribed"))),this._setCurrentStream(e,null),this._deferredRunning=null,this._isRunning=!1,this._views.forEach((function(t){t.detach(e,n._bindingRenderer)})),this._views=[],this._txNdiNotifier.notifyNdiVideoStopped(e),t||this._unsubscribeReceiver(e))},e.prototype.setVideoStreamConfig=function(e,t){this._streamConfig=o(o({},this._streamConfig),t),this._pendingStream===this._currentStream&&this._setSinkDeviceConfig(e,this._streamConfig)},e.prototype._setCurrentStream=function(e,t){var n,r=null===(n=this._currentStream)||void 0===n?void 0:n.stream;r&&r.setIsStreamingOverride(e,!1),this._currentStream=t},e.prototype._subscribeReceiver=function(e,t,n){this._cancelWaitForRunningTimer(),this._deferredRunning=new l.Deferred,this._subscribeStartTime=Date.now(),this._subscribeEndTime=this._subscribeStartTime-1,this._isRunning=!1,this._setCurrentStream(e,t);var r=n.startStreamTimeout;this._logger.info("_subscribeReceiver causeId: ".concat(e," timeout: ").concat(r));try{this._applyInitialSinkDeviceConfig(e),this._txNdiNotifier.notifyNdiVideoStopped(e),this._receiver.subscribe(this._streamId),this._startWaitForRunningTimer(e,r)}catch(t){this._logger.error("_subscribeReceiver causeId: ".concat(e," failed. error: ").concat(t)),this._deferredRunning.reject(new Error("_subscribeReceiver causeId: ".concat(e," error: ").concat(t)))}},e.prototype._startWaitForRunningTimer=function(e,t){var n=this;t&&(this._waitForRunningTimerId=window.setTimeout((function(){n._isSubscriptionTimedOut=!0;var t="stream did not go running";n._logger.error("_subscribeReceiver causeId: ".concat(e," failed. error: ").concat(t)),n._deferredRunning.reject(new Error("_subscribeReceiver causeId: ".concat(e," error: ").concat(t)))}),t))},e.prototype._cancelWaitForRunningTimer=function(){this._waitForRunningTimerId&&(clearTimeout(this._waitForRunningTimerId),this._waitForRunningTimerId=0,this._isSubscriptionTimedOut=!1)},e.prototype._unsubscribeReceiver=function(e){this._logger.info("_unsubscribeReceiver causeId: ".concat(e));try{this._receiver.subscribe(0)}catch(t){this._logger.error("_unsubscribeReceiver causeId: ".concat(e," failed. error: ").concat(t))}},e.prototype._setSinkDeviceConfig=function(e,t,n){if(!c.isEqual(this._appliedStreamConfig,t))try{this._appliedStreamConfig=t;var r=o(o({},n),t);this._logger.info("_setSinkDeviceConfig causeId: ".concat(e," json: ").concat(JSON.stringify(r)," config: ").concat(JSON.stringify(t))),this._bindingRenderer.setSinkDeviceConfig(r)}catch(t){this._logger.error("_setSinkDeviceConfig causeId: ".concat(e," failed. error: ").concat(t))}},e.prototype._applyInitialSinkDeviceConfig=function(e){c.isEqual(this._appliedStreamConfig,this._streamConfig)||(c.isEmpty(this._appliedStreamConfig)?this._setSinkDeviceConfig(e,this._streamConfig):this._setSinkDeviceConfig(e,this._streamConfig,{isAlphaMaskEnabled:!1,isFocusEnabled:!1}))},e.prototype._subscribed=function(e,t){var n;(null===(n=this._currentStream)||void 0===n?void 0:n.stream.id)===t&&(this._txNdiNotifier.notifyNdiVideoStarted(e,t,this._bindingRenderer),this._cancelWaitForRunningTimer(),this._deferredRunning.resolve(),this._subscribeEndTime=Date.now(),this._isRunning=!0,this._currentStream.stream.setIsStreamingOverride(e,!0))},e.prototype._createResources=function(e,t){return a(this,void 0,void 0,(function(){var n,r,i,o,a,c,l=this;return s(this,(function(s){switch(s.label){case 0:n=Date.now(),o=[],s.label=1;case 1:return s.trys.push([1,3,,4]),this._logger.info("_createResources causeId: ".concat(e," create instances")),r=this._slimcoreInstance.createVideoBindingRenderer({enableDXVA:this._settings.enableDXVA,isLocalPreview:!1}),i=this._slimcoreInstance.createVideoReceiver(t,function(e){switch(e){case 1:return SlimCore.Enums.VideoType.ScreenShare;case 0:return SlimCore.Enums.VideoType.Video;case 2:return SlimCore.Enums.VideoType.Ums;default:return}}(this.type)),o.push(i.handle("subscribed",void 0,(function(t){var n=t.videoObjectId;l._logger.info("receiver subscribed event ".concat(l._subscribedStreamId," -> ").concat(n)),l._subscribedStreamId=n,l._subscribed(e,n)}))),o.push(i.handle("status-changed",void 0,(function(e){l._logger.info("receiver status-changed event ".concat(l._receiverStatus," -> ").concat(e.status)),l._receiverStatus=e.status}))),o.push(i.handle("error-occurred",void 0,(function(e){l._logger.info("receiver error-occurred event ".concat(e.error))}))),i.abandon&&o.push(i.handle("abandoned",void 0,(function(){l._logger.info("receiver abandoned event"),l._disposeResources(e,l._receiver,l._videoReceiverSubscriptions,l._bindingRenderer,new Error("_createResources causeId: ".concat(e," error: receiver abandoned")))}))),o.push(i.handle("virtual-participant-changed",void 0,(function(e){l._logger.info("receiver virtual-participant-changed event: msi ".concat(e.virtualParticipantMsi)),l._onVideoObjectVirtualParticipantChanged(e.virtualParticipantMsi)}))),this._receiver=i,this._videoReceiverSubscriptions=o,this._bindingRenderer=r,this._logger.info("_createResources causeId: ".concat(e," setup renderer binding")),[4,i.createBinding(r)];case 2:if(s.sent(),this._isDisposed)throw new Error("already disposed");return this._isReady=!0,this._deferredReady.resolve(),c=Date.now(),this._logger.info("_createResources causeId: ".concat(e," done. duration: ").concat(c-n,"ms")),[3,4];case 3:return a=s.sent(),c=Date.now(),this._logger.error("_createResources causeId: ".concat(e," failed. duration: ").concat(c-n,"ms error: ").concat(a)),this._isDisposed||this._disposeResources(e,i,o,r,new Error("_createResources causeId: ".concat(e," error: ").concat(a))),[3,4];case 4:return[2]}}))}))},e.prototype._onVideoObjectVirtualParticipantChanged=function(e){var t=this;this._dynamicVirtualParticipantMsi!==e&&(this._logger.info("virtual-participant-changed msi: ".concat(this._dynamicVirtualParticipantMsi," -> ").concat(e)),this._dynamicVirtualParticipantMsi=e,this._mapper||(this._mapper=this._participantIdMapperFactory((function(e){var n;t._logger.info("virtualParticipantChanged participant mri: ".concat(t._dynamicVirtualParticipantId," -> ").concat(e)),t._dynamicVirtualParticipantId=e,t._views.forEach((function(e){e.changeVirtualParticipant(t._dynamicVirtualParticipantId)})),null===(n=t._currentStream)||void 0===n||n.stream.changeVirtualParticipant(t._dynamicVirtualParticipantId)}))),this._mapper.update(e))},e.prototype._disposeResources=function(e,t,n,r,i){if(!this._areResourcesDisposed){this._areResourcesDisposed=!0,this._deferredReady.reject(i);try{n.forEach((function(e){e.dispose()})),t&&t.dispose(),r&&r.dispose()}catch(t){this._logger.error("_disposeResources causeId: ".concat(e," error: ").concat(t))}this._deferredAbandoned.resolve()}},e}(),S=function(){function e(e,t,n){this._logger=e,this._setMaxVideoChannels=t,this._upperBoundReached=n,this._isDisposed=!1,this._isSetMaxVideoChannelsPending=!1,this._requestedVideoChannels=0,this._stopUpdates=!1}return e.prototype.update=function(e,t,n,r){return a(this,void 0,void 0,(function(){var i,o,a,c;return s(this,(function(s){switch(s.label){case 0:if(i=!t||!n||!r,this._isDisposed||this._stopUpdates||this._isSetMaxVideoChannelsPending||i)return[2];if(this._requestedVideoChannels=Math.max(this._requestedVideoChannels,t),o=function(e,t,n){t>n&&(t=n);var r=1;if(e-r>=t||e>=n)return e;var i=Math.max(e+r,t);return Math.min(Math.round(Math.pow(Math.ceil(Math.sqrt(i))+1,2)),n)}(this._requestedVideoChannels,n,r),this._requestedVideoChannels>=o)return[2];s.label=1;case 1:return s.trys.push([1,3,5,6]),this._isSetMaxVideoChannelsPending=!0,this._logger.info("update max video channels to ".concat(o," causeId: ").concat(e)),[4,this._setMaxVideoChannels(o,e)];case 2:return a=s.sent(),this._isDisposed?[2]:(this._logger.info("update max video channels got ".concat(a," causeId: ").concat(e)),a<o&&(this._stopUpdates=!0,this._upperBoundReached(a)),this._requestedVideoChannels=a,[3,6]);case 3:return c=s.sent(),this._isDisposed?[2]:(this._logger.error("update max video channels failed causeId: ".concat(e," error: ").concat(c)),[4,(0,l.delay)(2e3)]);case 4:return s.sent(),[3,6];case 5:return this._isSetMaxVideoChannelsPending=!1,[7];case 6:return[2]}}))}))},e.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0)},e}(),C=function(e){function t(t,n,r,i,o,a){var s,l=e.call(this,t.createChild((function(){return"VideoLayout[#".concat(l._subscriptions.size,":").concat(l._nrLayoutUpdates,"]")})),n,r)||this;l._slimcoreCallId=i,l._participantIdMapperFactory=o,l._configuration={},l._isDisposed=!1,l._nrLayoutUpdates=0,l._maxIncomingVideoCount=0,l._maxIncomingVbssCount=0,l._capabilites={streamConstraints:(s={},s[0]={maxConcurrentSubscriptions:l._maxIncomingVideoCount},s[1]={maxConcurrentSubscriptions:l._maxIncomingVbssCount},s[2]={maxConcurrentSubscriptions:8},s)},l._subscriptions=new Map,l._cleanups=[],l._streamConfigurations=new Map;l._controlMaxVideoChannels=new S(l._logger,a,(function(e){l._logger.info("raise streamConstraints changed maxNegotiatedChannels video: ".concat(e)),l._capabilites.streamConstraints[0].maxNegotiatedChannels=e,l.event("capabilitiesChanged").raise(),l.raiseChanged()}));var u=c.debounce((function(){var e=l._capabilites.streamConstraints,t=e[0],n=e[1];if(t.maxConcurrentSubscriptions!==l._maxIncomingVideoCount||n.maxConcurrentSubscriptions!==l._maxIncomingVbssCount){t.maxConcurrentSubscriptions=l._maxIncomingVideoCount,n.maxConcurrentSubscriptions=l._maxIncomingVbssCount;var r=l._capabilites.streamConstraints[0].maxConcurrentSubscriptions,i=l._capabilites.streamConstraints[1].maxConcurrentSubscriptions;l._logger.info("raise streamConstraints changed maxConcurrentSubscriptions video: ".concat(r," vbss: ").concat(i)),l.event("capabilitiesChanged").raise(),l.raiseChanged()}}),0),d=function(e,t){l._maxIncomingVideoCount===e&&l._maxIncomingVbssCount===t||(l._maxIncomingVideoCount=e,l._maxIncomingVbssCount=t,u())};l._registerDisposable(l._slimcoreInstance.handle("object-property-changed",{objectId:i,propKey:SlimCore.Enums.Property.CallMaxIncomingVideoCount},(function(e){return d(e.value,l._maxIncomingVbssCount)}))),l._registerDisposable(l._slimcoreInstance.handle("object-property-changed",{objectId:i,propKey:SlimCore.Enums.Property.CallMaxIncomingVbssCount},(function(e){return d(l._maxIncomingVideoCount,e.value)})));var p=l._getProperties(i,{},{maxIncomingVideoCount:{propKey:SlimCore.Enums.Property.CallMaxIncomingVideoCount,fallback:l._maxIncomingVideoCount},maxIncomingVbssCount:{propKey:SlimCore.Enums.Property.CallMaxIncomingVbssCount,fallback:l._maxIncomingVbssCount}}),h=p.maxIncomingVideoCount,g=p.maxIncomingVbssCount;d(h,g);var f=0;return l._triggerHartbeat=c.throttle((function(){0===f||0!==l._subscriptions.size&&!l._isDisposed||(clearInterval(f),f=0),l._isDisposed||(0!==l._subscriptions.size&&0===f&&(f=window.setInterval((function(){l._triggerHartbeat()}),2e4)),l._logHeartbeat())}),2e3),l}return i(t,e),Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilites},enumerable:!1,configurable:!0}),t.isVideoLayoutSupported=function(e){return!!e.createVideoReceiver},t.prototype.dispose=function(t){return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:if(!this._isDisposed){this._isDisposed=!0,this._logger.info("dispose causeId: ".concat(t)),this._controlMaxVideoChannels.dispose();try{this.update([])}catch(e){this._logger.error("dispose causeId: ".concat(t," error: ").concat(e))}this._triggerHartbeat.flush(),this._triggerHartbeat.cancel(),e.prototype.dispose.call(this,t)}return this._cleanups.length>0?(this._logger.info("dispose causeId: ".concat(t," synchronize pending cleanups: #").concat(this._cleanups.length)),[4,Promise.all(this._cleanups)]):[3,2];case 1:n.sent(),this._logger.info("dispose causeId: ".concat(t," done")),n.label=2;case 2:return[2]}}))}))},t.prototype.createView=function(e,t){return new y(this._logger,e,t)},t.prototype.update=function(e){var t=this,n=(0,u.generateCauseId)();if(this._isDisposed&&e.length>0)throw this._logger.warn("update causeId: ".concat(n," video layout already disposed")),new Error("video layout already disposed");var r=[],i=this._toVideoViewUpdateMap(n,e,r),o=Array.from(this._subscriptions.keys()),a=Array.from(i.keys()),s=[],l=function(e){var o=e.stream,a=e.receiverStream,s=e.receiver,l=i.get(o),u=c.map(l,(function(e){return e.view})),d=t._streamConfigurations.get(o),p=s.subscribeStream(n,t._triggerHartbeat,a,u,t._configuration,d);l.forEach((function(e){return r[e.index]=p}))},d=c.difference(o,a),p=c.intersection(o,a),h=c.difference(a,o);return this._logLayoutUpdateStreams(n,d,p,h),d.forEach((function(e){s.push(t._subscriptions.get(e)),t._subscriptions.delete(e)})),p.forEach((function(e){l(t._subscriptions.get(e))})),h.forEach((function(e){var r=function(e){var n=c.findIndex(s,(function(t){return t.receiver.type===e.type})),r=-1!==n?c.head(s.splice(n,1)):void 0;return r&&(r.stream=e,r.receiverStream=t._makeReceiverStream(e)),r}(e);r||(r={stream:e,receiverStream:t._makeReceiverStream(e),receiver:new v(n,t._logger,t._settings,t._slimcoreInstance,t._slimcoreCallId,t._participantIdMapperFactory,e.type)});t._subscriptions.set(e,r),l(r)})),s.forEach((function(e){var r=e.receiver.dispose(n).catch(c.noop),i=function(){return c.remove(t._cleanups,(function(e){return e===r}))};t._cleanups.push(r),r.then(i,i)})),this._updateMaxVideoChannels(n),this._logLayoutUpdateReceivers(n),this._nrLayoutUpdates++,this._triggerHartbeat(),r},t.prototype.setVideoStreamConfig=function(e,t){var n=this,r=(0,u.generateCauseId)();if(this._logger.info("setVideoStreamConfig causeId: ".concat(r," stream: ").concat(E(e)," config: ").concat(JSON.stringify(t))),this._streamConfigurations.forEach((function(e,t){t.isDisposed&&n._streamConfigurations.delete(t)})),!c.isEmpty(t)&&!e.isDisposed){var i=o(o({},this._streamConfigurations.get(e)),t);this._streamConfigurations.set(e,i);var a=this._subscriptions.get(e);a&&a.receiver.setVideoStreamConfig(r,i)}},t.prototype.configure=function(e){this._logger.info("configure config: ".concat(JSON.stringify(e))),this._configuration=o(o({},this._configuration),e)},t.prototype._makeReceiverStream=function(e){return{stream:e}},t.prototype._updateMaxVideoChannels=function(e){var t,n,r=this._configuration.streamConfiguration,i=null===(t=null==r?void 0:r[0])||void 0===t?void 0:t.maxNegotiatedChannels;if(i){var o=c.countBy(Array.from(this._subscriptions.values()),(function(e){return e.receiver.type}));this._controlMaxVideoChannels.update(e,this._maxIncomingVideoCount,null!==(n=o[0])&&void 0!==n?n:0,i)}},t.prototype._toVideoViewUpdateMap=function(e,t,n){var r=0,i=new Set;return t.reduce((function(t,o){var a=o.stream,s=o.view,c=r++;if(i.has(s))n[c]=Promise.reject(new Error("duplicate view for the video layout update causeId: ".concat(e," at index ").concat(c)));else{i.add(s);var l=t.get(a);l?l.push({index:c,view:s}):t.set(a,[{index:c,view:s}])}return t}),new Map)},t.prototype._logHeartbeat=function(){var e=Array.from(this._subscriptions.values()).map((function(e){return e.receiver})),t=function(t){var n=e.filter((function(e){return e.type===t}));return"#".concat(n.length," [").concat(function(e){return c.map(e,v.logThisForHeartbeat).join(" ")}(n),"]")},n=["vbss (".concat(t(1),")"),"video (".concat(t(0),")"),"ums (".concat(t(2),")")].join(" ");this._logger.info("heartbeat ".concat(v.heartBeatLogTemplate()," ").concat(n))},t.prototype._logLayoutUpdateStreams=function(e,t,n,r){var i=this,o=function(e){return c.map(e,E).join(" ")},a=function(e){var a=function(t){return t.type===e},s=t.filter(a),c=n.filter(a),l=r.filter(a),u=i._capabilites.streamConstraints[e].maxConcurrentSubscriptions,d="#".concat(c.length+l.length,"/").concat(u);return"".concat(d," =[").concat(o(c),"] -[").concat(o(s),"] +[").concat(o(l),"]")},s=["vbss (".concat(a(1),")"),"video (".concat(a(0),")"),"ums (".concat(a(2),")")].join(" ");this._logger.info("update causeId: ".concat(e," streams ").concat(s))},t.prototype._logLayoutUpdateReceivers=function(e){var t=Array.from(this._subscriptions.values()).map((function(e){return e.receiver})),n=function(e){var n=t.filter((function(t){return t.type===e}));return"#".concat(n.length," [").concat(function(e){return c.map(e,v.logThis).join(" ")}(n),"]")},r=["vbss (".concat(n(1),")"),"video (".concat(n(0),")"),"ums (".concat(n(2),")")].join(" ");this._logger.info("update causeId: ".concat(e," receivers ").concat(r))},t}(h.default);function E(e){return e?"".concat(e.id,":").concat(e.mediaSourceId,":").concat("main-video"!==e.label?e.label:""):"none"}t.default=C},7892:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6773),a=n(5442),s=n(1775),c=n(5773),l=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.isRendering=!1,i._isFrameSinkSet=!1,i._isStartedLogged=!1,i._frameTypeChanged=function(e){i._logger.info("frame-type-changed: ".concat(e.type)),i.event("frameTypeChanged").raise(p(e.type))},i._frameSizeChanged=function(e){i._logger.info("frame-size-changed: ".concat(e.width," x ").concat(e.height))},i._firstFrameRendered=function(e){i._logger.info("first-frame-rendered"),i.event("firstFrameRendered").raise()},i._fullFrameRenderRequired=function(e){i._logger.info("full-frame-render-required: ".concat(e.fullFrameRenderRequired)),i.event("fullFrameRenderRequired").raise(e.fullFrameRenderRequired)},i}return i(t,e),t.prototype.dispose=function(t){this._logger.info("dispose causeId: ".concat(t)),this._disposeVideoRenderer(t),e.prototype.dispose.call(this,t)},Object.defineProperty(t.prototype,"rendererType",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frameType",{get:function(){var e;return(null===(e=this._frameSink)||void 0===e?void 0:e.getFrameType)?p(this._frameSink.getFrameType()):-1},enumerable:!1,configurable:!0}),t.prototype.captureFrame=function(e,t){return this._videoBinding?this._videoBinding.captureFrame({timeout:e,bufferName:t}).then((function(e){return new u(c.convertImageData(e.image),e.mirror)})):Promise.resolve(void 0)},t.prototype.getStats=function(){var e=this;return(0,a.asap)((function(){return e._getStats()}))},t.prototype.setScalingMode=function(e){return this._renderer?this._renderer.setScalingMode(h(e)):Promise.reject("No video renderer")},t.prototype.cameraAutoControl=function(e){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.getCameraManualControlStates=function(e){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.setCameraManualControlStates=function(e){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.enumerateCameraManualControls=function(){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.isCameraAdvancedControlCapable=function(){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype._disposeVideoRenderer=function(e,t){if(void 0===t&&(t=!1),this._frameSink){if(this._controlFrameSink(e,!1),t)return void this._logger.info("_disposeVideoRenderer causeId: ".concat(e," Keep renderer for reuse"));this._frameSink.removeListener("frame-type-changed",this._frameTypeChanged),this._frameSink.removeListener("frame-size-changed",this._frameSizeChanged),this._frameSink.removeListener("first-frame-rendered",this._firstFrameRendered),this._frameSink.removeListener("full-frame-render-required",this._fullFrameRenderRequired)}this._renderer&&(this._renderer.removeAllListeners(),c.isDisposed(this._renderer)||this._renderer.dispose(),this._renderer=null)},t.prototype._createVideoRenderer=function(e,t,n){var r=this;if(this._frameSink)return this._logger.info("_createVideoRenderer causeId: ".concat(e," Reusing renderer")),void this._controlFrameSink(e,!0);!function(e){return void 0!==e.renderer}(t)?this._renderer=this._createVideoRendererImpl(e,t,n):this._renderer=t.renderer,this._renderer.on("video-size-changed",(function(e){r._videoSizeChanged(e.width,e.height)})),this._frameSink&&(this._frameSink.on("frame-type-changed",this._frameTypeChanged),this._frameSink.on("frame-size-changed",this._frameSizeChanged),this._frameSink.on("first-frame-rendered",this._firstFrameRendered),this._frameSink.on("full-frame-render-required",this._fullFrameRenderRequired),o.isBoolean(n.ignoreMirroring)&&this._frameSink.setIgnoreMirroring&&this._frameSink.setIgnoreMirroring(n.ignoreMirroring),this._controlFrameSink(e,!0))},Object.defineProperty(t.prototype,"_frameSink",{get:function(){return this._renderer?this._renderer.getFrameSink():null},enumerable:!1,configurable:!0}),t.prototype._videoSizeChanged=function(e,t){this._logger.info("video-size-changed: ".concat(e," x ").concat(t)),this.streamSize={width:e,height:t},this.isRendering=e>0&&t>0,!this._isStartedLogged&&this.isRendering&&(this._logger.info("renderStarted"),this.event("renderStarted").raise(),this._isStartedLogged=!0),this.event("videoSizeChanged").raise(e,t),this.raiseChanged()},t.prototype._getStats=function(){if(!this._frameSink)throw new Error("Renderer is not initialized");if(this._frameSink.getStats)return this._frameSink.getStats();throw new Error("Renderer does not support stats")},Object.defineProperty(t.prototype,"frameSinkMetadata",{get:function(){var e;return(null===(e=this._frameSink)||void 0===e?void 0:e.getMetadata)?this._frameSink.getMetadata():null},enumerable:!1,configurable:!0}),t.prototype._createVideoRendererImpl=function(e,t,n){var r={container:t,transparent:n.transparent,scalingMode:h(n.scalingMode),useBufferSharing:!!this._settings.enableBufferSharing,logger:this._logger};try{var i=SlimCore.createChromiumFrameSink({enableTextureSharing:!!this._settings.enableTextureSharing});return VideoRenderer.createChromiumVideoRenderer(i,r)}catch(t){throw this._logger.error("createChromiumVideoRenderer causeId: ".concat(e," failed: ").concat(t)),new d(t,function(e){switch(e.reason){case 1:return 2;case 2:return 3;default:return 1}}(t))}},t.prototype._controlFrameSink=function(e,t){this._videoBinding&&this._isFrameSinkSet!==t&&(this._isFrameSinkSet=t,t?this._videoBinding.addFrameSink(this._frameSink):c.isDisposed(this._frameSink)?this._logger.warn("_controlFrameSink causeId: ".concat(e," frame sink already disposed")):this._videoBinding.removeFrameSink(this._frameSink))},t}(s.default);t.default=l;var u=function(){function e(e,t){this._imageData=e,this._mirrored=t}return e.prototype.getSize=function(){return{width:this._imageData.width,height:this._imageData.height}},e.prototype.isMirrored=function(){return this._mirrored},e.prototype.getImageData=function(){return this._imageData},e}(),d=function(){function e(e,t){void 0===t&&(t=-1),this.reason=e,this.errorType=t}return e.prototype.toString=function(){return"Reason=".concat(this.reason,", errorType=").concat(this.errorType)},e}();function p(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return-1}}function h(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return}}},8928:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1775),a=0,s=function(e){function t(t,n,r){var i=e.call(this,n.createChild((function(){return"VoipCallCoordinator[".concat(i._id,"]")})),r,t)||this;i._id=a++,i._voipCallCoordinator=t.createVoipCallCoordinator();return i._registerDisposable(i._voipCallCoordinator.handle("on-air-mute-event",void 0,(function(e){i._logger.info("onAirMuteEvent, mute = ".concat(e.mute)),i.event("onAirMuteEvent").raise(e.mute)}))),i}return i(t,e),t.prototype.initialize=function(e){this._logger.info("creating slimcore voip call coordinator with app name ".concat(e)),this._voipCallCoordinator.initialize(e)},t.prototype.dispose=function(t){this._logger.info("releasing slimcore voip call coordinator, causeId is ".concat(t)),this._voipCallCoordinator.dispose(),e.prototype.dispose.call(this,t)},t.prototype.setOnAirMute=function(e){this._logger.info("set on air mute: ".concat(e)),this._voipCallCoordinator.setOnAirMute(e)},t}(o.default);t.default=s},7358:function(e,t){"use strict";var n=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function r(e){return function(t,n,r){var i=function(e,t){if(t){var n=function(n){return function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0}(n,t)&&e(n)};return n.listener=e,n}return e}(r,n);e.addListener(t,i);return{dispose:function(){e.removeListener(t,i)}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreEventEmitter=t.makeHandleForEventEmitter=void 0,t.makeHandleForEventEmitter=r;var i=function(){function e(){this.handle=r(this),this.eventListenerArrays={}}return e.prototype.on=function(e,t){return this.addListener(e,t)},e.prototype.once=function(e,t){var n=this,r=function(i){n.removeListener(e,r),t(i)};return r.listener=t,this.addListener(e,r)},e.prototype.addListener=function(e,t){var n=this.eventListenerArrays[e];return n||(n=this.eventListenerArrays[e]=[]),n.push(t),this},e.prototype.removeListener=function(e,t){var n=this.eventListenerArrays[e];if(n)for(var r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){n.splice(r,1);break}return this},e.prototype.removeAllListeners=function(e){var t=this;return e?(this.eventListenerArrays[e]&&(this.eventListenerArrays[e]=[]),this):(Object.keys(this.eventListenerArrays).forEach((function(e){t.eventListenerArrays[e]=[]})),this)},e.prototype.getMaxListeners=function(){return 0},e.prototype.setMaxListeners=function(e){},e.prototype.listeners=function(e){return this.eventListenerArrays[e]?n([],this.eventListenerArrays[e],!0):[]},e.prototype.emit=function(e,t){var r=this.eventListenerArrays[e];return!!r&&(n([],r,!0).forEach((function(e){try{e(t)}catch(e){}})),!0)},e}();t.SlimCoreEventEmitter=i},1843:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootToolsManagerDelegate=void 0;var r=n(4148),i=function(){function e(e,t,n){void 0===n&&(n=t.createChild("RootToolsManagerDelegate")),this._slimcore=e,this._logger=n,this._eventSubscription=null}return e.prototype.fetchEcsConfig=function(e,t){return r.Resolved(void 0)},e.prototype.sendTelemetry=function(e,t){},e.prototype.sendLoggingEventToNative=function(e,t){this._slimcore.handleLoggingEvent?this._slimcore.handleLoggingEvent(e,t):this._logger.warn("slimcore.handleLoggingEvent is not available")},e.prototype.setNativeLoggingEventCallback=function(e){var t=this;e&&"function"==typeof e?this._setSubscription(this._slimcore.handle("logging-event",void 0,(function(n){t._logger.debug("LoggingNativeEvent msg:".concat(n.message," aux").concat(n.auxiliaryPayload)),e(n.message,n.auxiliaryPayload)}))):this._logger.warn("setNativeLoggingEventCallback invalid callback provided")},e.prototype._setSubscription=function(e){this._eventSubscription&&this._eventSubscription.dispose(),this._eventSubscription=e},e.prototype.dispose=function(e){this._logger.info("dispose causeId: ".concat(e)),this._setSubscription(null)},e}();t.RootToolsManagerDelegate=i},8215:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLogger=t.initLogger=void 0;var r=n(4132),i=n(1595),o=n(4218),a=n(1843);t.initLogger=function(e,t){if(!r.RootToolsManager.isDelegateSet()){var n=new a.RootToolsManagerDelegate(e,t);r.RootToolsManager.setDelegate(n);return{dispose:function(e){r.RootToolsManager.stopAsyncOperations(),n.dispose(e)}}}return null},t.createLogger=function(e){if(!r.RootToolsManager.isDelegateSet()&&e){var t=new o.RedirectingLogAppender(e);r.LogFactory.instance().addAppender(t)}return new i.TsCallingLogger("JS.TsCalling.Electron",!1)}},2307:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateCauseId=t.getVersion=t.getOvb=t.slimCoreUwpStackFactory=t.slimCoreElectronStackFactory=void 0;var r=n(1092);Object.defineProperty(t,"slimCoreElectronStackFactory",{enumerable:!0,get:function(){return r.slimCoreElectronStackFactory}}),Object.defineProperty(t,"slimCoreUwpStackFactory",{enumerable:!0,get:function(){return r.slimCoreUwpStackFactory}});var i=n(5212);Object.defineProperty(t,"getOvb",{enumerable:!0,get:function(){return i.getOvb}}),Object.defineProperty(t,"getVersion",{enumerable:!0,get:function(){return i.getTsCallingVersion}});var o=n(7584);Object.defineProperty(t,"generateCauseId",{enumerable:!0,get:function(){return o.generateCauseId}})},4132:function(e){"use strict";e.exports=t},6773:function(t){"use strict";t.exports=e}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e].call(o.exports,o,o.exports,i),o.exports}return i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(5773),i(1775),i(8994),i(1325),i(4893),i(6769),i(7180),i(8404),i(5320),i(658),i(3024),i(1113),i(9230),i(3385),i(605),i(1092),i(2307)}()}));
//# sourceMappingURL=skype-calling-electron.bundle.min.js.map